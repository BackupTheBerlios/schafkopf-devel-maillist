<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Schafkopf-devel] Commit Report - Schafkopf updated admin dir
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/schafkopf-devel/2005-March/index.html" >
   <LINK REL="made" HREF="mailto:schafkopf-devel%40lists.berlios.de?Subject=Re%3A%20%5BSchafkopf-devel%5D%20Commit%20Report%20-%20Schafkopf%20updated%20admin%20dir&In-Reply-To=%3C200503221911.j2MJBYIP003121%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000094.html">
   <LINK REL="Next"  HREF="000100.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Schafkopf-devel] Commit Report - Schafkopf updated admin dir</H1>
    <B>schafkopf-devel at berlios.de</B> 
    <A HREF="mailto:schafkopf-devel%40lists.berlios.de?Subject=Re%3A%20%5BSchafkopf-devel%5D%20Commit%20Report%20-%20Schafkopf%20updated%20admin%20dir&In-Reply-To=%3C200503221911.j2MJBYIP003121%40sheep.berlios.de%3E"
       TITLE="[Schafkopf-devel] Commit Report - Schafkopf updated admin dir">schafkopf-devel at berlios.de
       </A><BR>
    <I>Tue Mar 22 20:11:34 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000094.html">[Schafkopf-devel] Commit Report - Schafkopf patch by Dominik Kuhlen
</A></li>
        <LI>Next message: <A HREF="000100.html">[Schafkopf-devel] Commit Report - Schafkopf Fixed: der spieler der zuletzt geklopft hat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95">[ date ]</a>
              <a href="thread.html#95">[ thread ]</a>
              <a href="subject.html#95">[ subject ]</a>
              <a href="author.html#95">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Log Message:
-----------
updated admin dir

Modified Files:
--------------
    schafkopf/admin:
        Doxyfile.am
        Doxyfile.global
        Makefile.common
        acinclude.m4.in
        am_edit
        bcheck.pl
        conf.change.pl
        config.pl
        configure.in.bot.end
        cvs-clean.pl
        cvs.sh
        debianrules
        detect-autoconf.sh
        install-sh
        libtool.m4.in
        ltmain.sh

-------------- next part --------------
Index: cvs.sh
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/cvs.sh,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/cvs.sh -Ladmin/cvs.sh -u -r1.1.1.1 -r1.2
--- admin/cvs.sh
+++ admin/cvs.sh
@@ -20,24 +20,25 @@
 
 strip_makefile()
 {
-  if test -f $makefile_wo; then :; else
-    perl -e '$in=0; while ( &lt;&gt; ) { $in = 1 if ($_=~ m/^if /); print $_ unless ($in); $in = 0 if ($_ =~ m/^endif/); }' &lt; Makefile.am.in &gt; $makefile_wo
+  if test ! -f $makefile_wo; then
+    perl -e '$in=0; while ( &lt;&gt; ) { $in = 1 if ($_ =~ m/^if / ); print $_ unless ($in || $_ =~ m/^include /); $in = 0 if ($_ =~ m/^endif/); }' &lt; $makefile_am &gt; $makefile_wo
   fi
 }
 
 check_autotool_versions()
 {
+required_autoconf_version=&quot;2.53 or newer&quot;
 AUTOCONF_VERSION=`$AUTOCONF --version | head -n 1`
 case $AUTOCONF_VERSION in
   Autoconf*2.5* | autoconf*2.5* ) : ;;
   &quot;&quot; )
     echo &quot;*** AUTOCONF NOT FOUND!.&quot;
-    echo &quot;*** KDE requires autoconf 2.52, 2.53 or 2.54&quot;
+    echo &quot;*** KDE requires autoconf $required_autoconf_version&quot;
     exit 1
     ;;
   * )
     echo &quot;*** YOU'RE USING $AUTOCONF_VERSION.&quot;
-    echo &quot;*** KDE requires autoconf 2.52, 2.53 or 2.54&quot;
+    echo &quot;*** KDE requires autoconf $required_autoconf_version&quot;
     exit 1
     ;;
 esac
@@ -47,27 +48,28 @@
   Autoconf*2.5* | autoheader*2.5* ) : ;;
   &quot;&quot; )
     echo &quot;*** AUTOHEADER NOT FOUND!.&quot;
-    echo &quot;*** KDE requires autoheader 2.52 or 2.53 (part of autoconf)&quot;
+    echo &quot;*** KDE requires autoheader $required_autoconf_version&quot;
     exit 1
     ;;
   * )
     echo &quot;*** YOU'RE USING $AUTOHEADER_VERSION.&quot;
-    echo &quot;*** KDE requires autoheader 2.52 or 2.53 (part of autoconf)&quot;
+    echo &quot;*** KDE requires autoheader $required_autoconf_version&quot;
     exit 1
     ;;
 esac
 
 AUTOMAKE_STRING=`$AUTOMAKE --version | head -n 1`
+required_automake_version=&quot;1.6.1 or newer&quot;
 case $AUTOMAKE_STRING in
   automake*1.5d* | automake*1.5* | automake*1.5-* )
     echo &quot;*** YOU'RE USING $AUTOMAKE_STRING.&quot;
-    echo &quot;*** KDE requires automake 1.6.1 or newer&quot;
+    echo &quot;*** KDE requires automake $required_automake_version&quot;
     exit 1
     ;;
-  automake*1.6.* | automake*1.7* ) : ;;
+  automake*1.6.* | automake*1.7* | automake*1.8* ) : ;;
   &quot;&quot; )
     echo &quot;*** AUTOMAKE NOT FOUND!.&quot;
-    echo &quot;*** KDE requires automake 1.6.1 or newer&quot;
+    echo &quot;*** KDE requires automake $required_automake_version&quot;
     exit 1
     ;;
   unsermake* ) :
@@ -76,24 +78,17 @@
     ;;
   * )
     echo &quot;*** YOU'RE USING $AUTOMAKE_STRING.&quot;
-    echo &quot;*** KDE requires automake 1.6&quot;
+    echo &quot;*** KDE requires automake $required_automake_version&quot;
     exit 1
     ;;
 esac
+unset required_automake_version
 }
 
 cvs()
 {
 check_autotool_versions
- 
-### Produce acinclude.m4
-if grep '\$(top_srcdir)/acinclude.m4:' $makefile_am &gt;/dev/null; then
-  echo &quot;*** Creating acinclude.m4&quot;
-  rm -f acinclude.m4 configure.files
-  
-  strip_makefile
-  $MAKE -f $makefile_wo top_srcdir=. ./acinclude.m4
-fi
+acinclude_m4 
 
 ### Make new subdirs and configure.in.
 ### The make calls could be optimized away here,
@@ -112,14 +107,18 @@
             Makefile_am
         fi
      fi
-     echo &quot;*** Creating configure.in&quot;
      configure_files
-     strip_makefile
-     $MAKE -f $makefile_wo top_srcdir=. ./configure.in || exit 1
+     echo &quot;*** Creating configure.in&quot;
+     if grep '\$(top_srcdir)/configure.in:' $makefile_am &gt;/dev/null; then 
+       strip_makefile
+       $MAKE -f $makefile_wo top_srcdir=. ./configure.in || exit 1
+     else
+       configure_in
+     fi
 fi
 
 echo &quot;*** Creating aclocal.m4&quot;
-$ACLOCAL || exit 1
+$ACLOCAL $ACLOCALFLAGS || exit 1
 echo &quot;*** Creating configure&quot;
 call_and_fix_autoconf
 
@@ -155,20 +154,33 @@
 ###
 ### First build all of the files necessary to do just &quot;make&quot;
 ###
-if grep '\$(top_srcdir)/acinclude.m4:' $makefile_am &gt;/dev/null; then
-  strip_makefile
-  $MAKE -f $makefile_wo top_srcdir=. ./acinclude.m4
-fi
+acinclude_m4
 if test -r configure.in.in; then
+  rm -f configure.in
   create_subdirs
-  Makefile_am
+
+  if test -r Makefile.am.in; then
+    if grep '\$(top_srcdir)/Makefile.am:' $makefile_am &gt;/dev/null; then 
+      strip_makefile
+      $MAKE -f $makefile_wo top_srcdir=. ./Makefile.am || exit 1
+    else
+      Makefile_am
+    fi
+  fi
   configure_files
-  strip_makefile
-  $MAKE -f $makefile_wo top_srcdir=. ./configure.in
+  if grep '\$(top_srcdir)/configure.in:' $makefile_am &gt;/dev/null; then 
+    strip_makefile
+    $MAKE -f $makefile_wo top_srcdir=. ./configure.in || exit 1
+  else
+    configure_in
+  fi
 fi
-$ACLOCAL
-$AUTOHEADER
-$AUTOMAKE --foreign --include-deps
+$ACLOCAL $ACLOCALFLAGS
+if egrep &quot;^AM_CONFIG_HEADER&quot; configure.in &gt;/dev/null 2&gt;&amp;1; then
+  echo &quot;*** Creating config.h template&quot;
+  $AUTOHEADER || exit 1
+fi
+$AUTOMAKE --foreign
 perl -w admin/am_edit
 call_and_fix_autoconf
 touch stamp-h.in
@@ -195,10 +207,10 @@
 
 subdir_dist()
 {
-$ACLOCAL
+$ACLOCAL $ACLOCALFLAGS
 $AUTOHEADER
 $AUTOMAKE
-perl -w ../admin/am_edit
+perl -w ../admin/am_edit --path=../admin
 call_and_fix_autoconf
 touch stamp-h.in
 }
@@ -208,13 +220,26 @@
 rm -f configure.in configure.in.new
 kde_use_qt_param=
 test -f configure.files || { echo &quot;need configure.files for configure.in&quot;; exit 1; }
-cat `fgrep -v &quot;configure.in.bot&quot; &lt; configure.files | fgrep -v &quot;configure.in.mid&quot;` &gt; configure.in.new
+list=`fgrep -v &quot;configure.in.bot&quot; &lt; configure.files | fgrep -v &quot;configure.in.mid&quot;`
+: &gt; configure.in.new
+for file in $list; do 
+  echo &quot;dnl =======================================================&quot; &gt;&gt; configure.in.new
+  echo &quot;dnl FILE: $file&quot; &gt;&gt; configure.in.new
+  echo &quot;dnl =======================================================&quot; &gt;&gt; configure.in.new
+  echo &quot;&quot; &gt;&gt; configure.in.new
+  cat $file &gt;&gt; configure.in.new
+done
 echo &quot;KDE_CREATE_SUBDIRSLIST&quot; &gt;&gt; configure.in.new
 if test -f Makefile.am.in; then
   subdirs=`cat subdirs`
   for dir in $subdirs; do
-    dir=`echo $dir | sed -e &quot;s,[-+.],_,g&quot;`
-    echo &quot;AM_CONDITIONAL($dir&quot;&quot;_SUBDIR_included, test \&quot;x\$$dir&quot;&quot;_SUBDIR_included\&quot; = xyes)&quot; &gt;&gt; configure.in.new
+    vdir=`echo $dir | sed -e 's,[-+.@],_,g'`
+    echo &quot;AM_CONDITIONAL($vdir&quot;&quot;_SUBDIR_included, test \&quot;x\$$vdir&quot;&quot;_SUBDIR_included\&quot; = xyes)&quot; &gt;&gt; configure.in.new
+    if test -f &quot;$dir/configure.in&quot;; then
+        echo &quot;if test \&quot;x\$$vdir&quot;&quot;_SUBDIR_included\&quot; = xyes; then &quot; &gt;&gt; configure.in.new
+        echo &quot;  AC_CONFIG_SUBDIRS($dir)&quot; &gt;&gt; configure.in.new
+        echo &quot;fi&quot; &gt;&gt; configure.in.new
+    fi
   done
 fi
 
@@ -284,7 +309,7 @@
    fi
 fi
 if test -z &quot;$VERSION&quot; || test &quot;$VERSION&quot; = &quot;@VERSION@&quot;; then
-     VERSION=&quot;\&quot;3.1.0\&quot;&quot;
+     VERSION=&quot;\&quot;3.2.90\&quot;&quot;
 fi
 if test -z &quot;$modulename&quot; || test &quot;$modulename&quot; = &quot;@MODULENAME@&quot;; then
    modulename=`pwd`; 
@@ -307,6 +332,7 @@
 
 configure_files()
 {
+echo &quot;*** Creating configure.files&quot;
 admindir=NO
 for i in . .. ../.. ../../..; do
   if test -x $i/admin; then admindir=$i/admin; break; fi
@@ -334,6 +360,10 @@
 fi; done
 test -f configure.in.mid &amp;&amp; echo configure.in.mid &gt;&gt; configure.files
 test -f configure.in.bot &amp;&amp; echo configure.in.bot &gt;&gt; configure.files
+if test ! -s configure.files; then
+   echo &quot;There are no files to build a configure. Please check your checkout.&quot;
+   exit 1
+fi
 }
 
 create_subdirs()
@@ -429,9 +459,21 @@
     esac
   done
 
+  adds=`fgrep '$(top_srcdir)/acinclude.m4:' Makefile.am.in | sed -e 's,^[^:]*: *,,; s,\$(top_srcdir)/,,g'`
+  if echo &quot;$adds&quot; | fgrep &quot;*&quot; &gt;/dev/null ; then
+    adds=`ls -d -1 $adds 2&gt;/dev/null`
+    fgrep -v  '$(top_srcdir)/acinclude.m4:' Makefile.am.in &gt; Makefile.am.in.adds
+    str='$(top_srcdir)/acinclude.m4:'
+    for add in $adds; do 
+	str=&quot;$str \$(top_srcdir)/$add&quot;
+    done
+    echo $str &gt;&gt; Makefile.am.in.adds
+  else
+    cat Makefile.am.in &gt; Makefile.am.in.adds
+  fi
+
   if test -n &quot;$UNSERMAKE&quot;; then
-    cp Makefile.am.in Makefile.am
-    chmod u+w Makefile.am
+    cat Makefile.am.in.adds &gt; Makefile.am
     topsubdirs=
     for i in $compilefirst $dirs $compilelast; do
        vari=`echo $i | sed -e &quot;s,[-+],_,g&quot;`
@@ -442,14 +484,37 @@
     done
     echo &quot;SUBDIRS=$topsubdirs&quot; &gt;&gt; Makefile.am
   else
-    cat Makefile.am.in | \
+    cat Makefile.am.in.adds | \
         sed -e 's,^\s*\(COMPILE_BEFORE.*\),# \1,' | \
         sed -e 's,^\s*\(COMPILE_AFTER.*\),# \1,' &gt; Makefile.am
     echo &quot;SUBDIRS=&quot;'$(TOPSUBDIRS)' &gt;&gt; Makefile.am
   fi
+  rm Makefile.am.in.adds
 fi
 }
 
+acinclude_m4()
+{
+  echo &quot;*** Creating acinclude.m4&quot;
+  adds=
+  if grep '\$(top_srcdir)/acinclude.m4:' $makefile_am &gt;/dev/null; then 
+    strip_makefile
+    rm -f acinclude.m4
+    adds=`grep '\$(top_srcdir)/acinclude.m4:' $makefile_wo | sed -e 's,^[^:]*: *,,; s,\$(top_srcdir),.,g'`
+    if echo $adds | fgrep &quot;*&quot; &gt;/dev/null ; then
+      adds=`ls -d -1 $adds 2&gt;/dev/null`
+    else
+      $MAKE -f $makefile_wo top_srcdir=. ./acinclude.m4 || exit 1
+    fi
+  else
+    rm -f acinclude.m4
+  fi
+  # if it wasn't created up to now, then we do it better
+  if test ! -f acinclude.m4; then
+     cat admin/acinclude.m4.in admin/libtool.m4.in $adds &gt; acinclude.m4
+  fi
+}
+
 cvs_clean()
 {
 if test -d CVS; then :; else
@@ -486,7 +551,7 @@
 
 for i in `ls -1 po/*.pot 2&gt;/dev/null | sed -e &quot;s#po/##&quot;`; do
   egrep -v '^#([^:]|$)' po/$i | egrep '^.*[^ ]+.*$' | grep -v &quot;\&quot;POT-Creation&quot; &gt; po.backup/$i
-  cp po/$i po.backup/backup_$i
+  cat po/$i &gt; po.backup/backup_$i
   touch -r po/$i po.backup/backup_$i
   rm po/$i
 done
@@ -503,22 +568,23 @@
   test -z &quot;$VERBOSE&quot; || echo &quot;Making messages in $subdir&quot;
   (cd $subdir
    if test -n &quot;`grep -e '^messages:.*rc.cpp' Makefile.am`&quot;; then
-	$EXTRACTRC *.rc *.ui &gt; rc.cpp
+	$EXTRACTRC *.rc *.ui *.kcfg &gt; rc.cpp
    else
-	candidates=`ls -1 *.rc *.ui 2&gt;/dev/null`
+	candidates=`ls -1 *.rc *.ui *.kcfg 2&gt;/dev/null`
 	if test -n &quot;$candidates&quot;; then
-	    echo &quot;$subdir has *.rc or *.ui files, but not correct messages line&quot;
+	    echo &quot;$subdir has *.rc, *.ui or *.kcfg files, but not correct messages line&quot;
 	fi
    fi
    if test -n &quot;`grep -r KAboutData *.c* *.C* 2&gt;/dev/null`&quot;; then
 	echo -e 'i18n(&quot;_: NAME OF TRANSLATORS\\n&quot;\n&quot;Your names&quot;)\ni18n(&quot;_: EMAIL OF TRANSLATORS\\n&quot;\n&quot;Your emails&quot;)' &gt; _translatorinfo.cpp
    else echo &quot; &quot; &gt; _translatorinfo.cpp
    fi
-   perl -e '$mes=0; while (&lt;STDIN&gt;) { next if (/^(if|else|endif)\s/); if (/^messages:/) { $mes=1; print $_; next; } if ($mes) { if (/$\\(XGETTEXT\)/ &amp;&amp; / -o/) { s/ -o \$\(podir\)/ _translatorinfo.cpp -o \$\(podir\)/ } print $_; } else { print $_; } }' &lt; Makefile.am | egrep -v '^include ' &gt; _transMakefile
+   perl -e '$mes=0; while (&lt;STDIN&gt;) { next if (/^(if\s|else\s|endif)/); if (/^messages:/) { $mes=1; print $_; next; } if ($mes) { if (/$\\(XGETTEXT\)/ &amp;&amp; / -o/) { s/ -o \$\(podir\)/ _translatorinfo.cpp -o \$\(podir\)/ } print $_; } else { print $_; } }' &lt; Makefile.am | egrep -v '^include ' &gt; _transMakefile
+
+   kdepotpath=${includedir:-${KDEDIR:-`kde-config --prefix`}/include}/kde.pot
 
    $MAKE -s -f _transMakefile podir=$podir EXTRACTRC=&quot;$EXTRACTRC&quot; PREPARETIPS=&quot;$PREPARETIPS&quot; \
-	XGETTEXT=&quot;${XGETTEXT:-xgettext} -C -ki18n -ktr2i18n -kI18N_NOOP -ktranslate -kaliasLocale -x ${includedir:-${KDEDIR:-/usr/local/kde}/include}/kde.pot&quot; \
-	messages 
+	XGETTEXT=&quot;${XGETTEXT:-xgettext} -C -ki18n -ktr2i18n -kI18N_NOOP -kaliasLocale -x $kdepotpath&quot; messages 
    exit_code=$?
    if test &quot;$exit_code&quot; != 0; then
        echo &quot;make exit code: $exit_code&quot;
@@ -534,10 +600,12 @@
   test -f po/$i || echo &quot;disappeared: $i&quot;
 done
 for i in `ls -1 po/*.pot 2&gt;/dev/null | sed -e &quot;s#po/##&quot;`; do
+   sed -e 's,^&quot;Content-Type: text/plain; charset=CHARSET\\n&quot;$,&quot;Content-Type: text/plain; charset=UTF-8\\n&quot;,' po/$i &gt; po/$i.new &amp;&amp; mv po/$i.new po/$i
    msgmerge -q -o po/$i po/$i po/$i
    egrep -v '^#([^:]|$)' po/$i | egrep '^.*[^ ]+.*$' | grep -v &quot;\&quot;POT-Creation&quot; &gt; temp.pot
   if test -f po.backup/$i &amp;&amp; test -n &quot;`diff temp.pot po.backup/$i`&quot;; then
 	echo &quot;will update $i&quot;
+        sed -e 's,^&quot;Content-Type: text/plain; charset=CHARSET\\n&quot;$,&quot;Content-Type: text/plain; charset=UTF-8\\n&quot;,' po.backup/$backup_$i &gt; po/$i.new &amp;&amp; mv po/$i.new po.backup/backup_$i
 	msgmerge -q po.backup/backup_$i po/$i &gt; temp.pot
 	mv temp.pot po/$i
   else
@@ -554,16 +622,22 @@
 rm -rf po.backup
 }
 
-unset CDPATH
+unset LC_ALL || :
+unset LANG || :
+unset LC_CTYPE || :
+unset LANGUAGE || :
+
+unset CDPATH || :
 admindir=`echo &quot;$0&quot; | sed 's%[\\/][^\\/][^\\/]*$%%'`
 test &quot;x$admindir&quot; = &quot;x$0&quot; &amp;&amp; admindir=.
 
 test &quot;x$MAKE&quot; = x &amp;&amp; MAKE=make
 makefile_am=Makefile.am
-makefile_wo=Makefile.am
+makefile_wo=Makefile.am.wo
 if test -f Makefile.am.in; then
   makefile_am=Makefile.am.in
   makefile_wo=Makefile.am.in.wo
+  rm -f $makefile_wo
 fi
 
 # Suck in the AUTOCONF detection code
@@ -576,7 +650,7 @@
 arg=`echo $1 | tr '\-.' __`
 case $arg in
   cvs | dist | subdir_dist | configure_in | configure_files | subdirs | \
-  cvs_clean | package_merge | package_messages | Makefile_am ) $arg ;;
+  cvs_clean | package_merge | package_messages | Makefile_am | acinclude_m4 ) $arg ;;
   configure ) call_and_fix_autoconf ;;
   * ) echo &quot;Usage: cvs.sh &lt;target&gt;&quot;
       echo &quot;Target can be one of:&quot;
@@ -588,8 +662,8 @@
       exit 1 ;;
 esac
 
-if test -f Makefile.am.in.wo; then
-  rm Makefile.am.in.wo
+if test -f $makefile_wo; then
+  rm $makefile_wo
 fi
 
 exit 0
Index: conf.change.pl
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/conf.change.pl,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/conf.change.pl -Ladmin/conf.change.pl -u -r1.1.1.1 -r1.2
--- admin/conf.change.pl
+++ admin/conf.change.pl
@@ -1,4 +1,4 @@
-#!/usr/bin/perl -w
+#!/usr/bin/env perl
 
 # this script patches a config.status file, to use our own perl script
 # in the main loop
@@ -27,11 +27,12 @@
 #    later autoconf's
 # 2. the big main loop which patches all Makefile.in's
 
+use strict;
 use File::Basename;
 
 my $ac_aux_dir = dirname($0);
 my ($flag);
-local $ac_version = 0;
+my $ac_version = 0;
 my $vpath_seen = 0;
 $flag = 0;
 
@@ -99,9 +100,9 @@
 	    if ($ac_version != 2141) {
 	        print STDERR &quot;hmm, don't know autoconf version\n&quot;;
 	    }
-        } elsif (/^\#\s*CONFIG_HEADER section.*|^\s+#\s(Run) the commands associated/) {
+        } elsif (/^\#\s*CONFIG_(HEADER|COMMANDS) section.*|^\s+#\s(Run) the commands associated/) {
           $flag = 4;
-          $commands = defined $1;
+          my $commands = defined $2;
           &amp;insert_main_loop();
           $commands &amp;&amp; insert_command_loop();
           if($ac_version != 250) {
Index: config.pl
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/config.pl,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/config.pl -Ladmin/config.pl -u -r1.1.1.1 -r1.2
--- admin/config.pl
+++ admin/config.pl
@@ -1,4 +1,4 @@
-#!/usr/bin/perl
+#!/usr/bin/env perl
 # a script for use by autoconf to make the Makefiles
 # from the Makefile.in's
 #
@@ -28,19 +28,28 @@
 #   the Free Software Foundation, Inc., 59 Temple Place - Suite 330,
 #   Boston, MA 02111-1307, USA.
 
+use strict;
+
+use File::Path;
+
 my $ac_subs=$ARGV[0];
 my $ac_sacfiles = $ARGV[1];
 my $ac_given_srcdir=$ARGV[2];
 my $ac_given_INSTALL=$ARGV[3];
 
+my @comp_match;
+my @comp_subs;
+
 #print &quot;ac_subs=$ac_subs\n&quot;;
 #print &quot;ac_sacfiles=$ac_sacfiles\n&quot;;
 #print &quot;ac_given_srcdir=$ac_given_srcdir\n&quot;;
 #print &quot;ac_given_INSTALL=$ac_given_INSTALL\n&quot;;
 
+my $configure_input;
 my ($srcdir, $top_srcdir);
 my $INSTALL;
 my $bad_perl = ($] &lt; 5.005);
+my $created_file_count = 0;
 
 open(CF, &quot;&lt; $ac_subs&quot;) || die &quot;can't open $ac_subs: $!&quot;;
 my @subs = &lt;CF&gt;;
@@ -94,7 +103,7 @@
         push @comp_match, eval &quot;qr/\Q$1\E/&quot;;
         push @comp_subs, &quot;&quot;;
       } else {
-          die &quot;Uhh. Malformed pattern in $ac_cs_root.subs ($pat)&quot;
+          die &quot;Uhh. Malformed pattern in $ac_subs ($pat)&quot;
           unless ( $pat =~ /^\s*$/ );   # ignore white lines
       }
     }
@@ -130,7 +139,7 @@
     ($ac_dir = $ac_file) =~ s%/[^/][^/]*$%%;
     if ( ($ac_dir ne $ac_file) &amp;&amp; ($ac_dir ne &quot;.&quot;)) {
 # The file is in a subdirectory.
-	if (! -d &quot;$ac_dir&quot;) { mkdir &quot;$ac_dir&quot;, 0777; }
+	if (! -d &quot;$ac_dir&quot;) { mkpath &quot;$ac_dir&quot;, 0, 0777; }
 	($ac_dir_suffix = $ac_dir) =~ s%^./%%;
 	$ac_dir_suffix=&quot;/&quot;.$ac_dir_suffix;
 # A &quot;../&quot; for each directory in $ac_dir_suffix.
@@ -166,20 +175,20 @@
     my $ac_comsub=&quot;&quot;;
     my $fname=$ac_file_in;
     $fname =~ s%.*/%%;
-    my $configure_input=&quot;Generated automatically from $fname by config.pl.&quot;;
-    if ($ac_file =~ /.*[Mm]akefile.*/) {
-	$ac_comsub=&quot;# &quot;.$configure_input.&quot;\n&quot;;  # for the first line in $ac_file
-    }
+    $configure_input=&quot;$ac_file.  Generated from $fname by config.pl.&quot;;
 
     my $ac_file_inputs;
     ($ac_file_inputs = $ac_file_in) =~ s%^%$ac_given_srcdir/%;
     $ac_file_inputs =~ s%:% $ac_given_srcdir/%g;
 
-    patch_file($ac_file, $ac_file_inputs, $ac_comsub);
+    patch_file($ac_file, $ac_file_inputs);
+    ++$created_file_count;
 }
 
+print &quot;config.pl: fast created $created_file_count file(s).\n&quot;;
+
 sub patch_file {
-    my ($outf, $infiles, $identline) = @_;
+    my ($outf, $infiles) = @_;
     my $filedata;
     my @infiles=split(' ', $infiles);
     my $i=0;
@@ -194,10 +203,6 @@
 	    print STDERR &quot;can't open $name: $!&quot;.&quot;\n&quot;;
 	}
     }
-    if ($identline) {
-	# Put the ident in the second line.  For shitty automake 1.6x.
-	$filedata =~ s%\n%\n$identline%;
-    }
 
     $filedata =~ s%\@configure_input\@%$configure_input%g;
     $filedata =~ s%\@srcdir\@%$srcdir%g;
@@ -223,11 +228,7 @@
 
 sub make_closure {
     my ($pat, $sub) = @_;
-    $pat =~ s/\@/\\@/g;   # @bla@ -&gt; \@bla\@
-    $pat =~ s/\$/\\\$/g;  # $bla -&gt; \$bla
-    $sub =~ s/\@/\\@/g;
-    $sub =~ s/\$/\\\$/g;
-    my $ret = eval &quot;return sub { my \$ref=shift; \$\$ref =~ s%$pat%$sub%g; }&quot;;
+    my $ret = eval &quot;return sub { my \$ref=shift; \$\$ref =~ s%\Q$pat\E%\Q$sub\E%g; }&quot;;
     if ($@) {
         print &quot;can't create CODE: $@\n&quot;;
     }
Index: debianrules
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/debianrules,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/debianrules -Ladmin/debianrules -u -r1.1.1.1 -r1.2
--- admin/debianrules
+++ admin/debianrules
@@ -7,113 +7,37 @@
 $origPwd = `pwd`;
 chomp $origPwd;
 
-$kde_confdir		=	&quot;/etc/kde3&quot;;
-$kde_prefix		=	&quot;/usr&quot;;
-$kde_bindir		=	&quot;$kde_prefix/bin&quot;;
-$kde_includedir		=	&quot;$kde_prefix/include/kde&quot;;
-$kde_libdir		=	&quot;$kde_prefix/lib&quot;;
-$kde_cgidir		=	&quot;$kde_prefix/lib/cgi-bin&quot;;
-$kde_moduledir		=	&quot;$kde_prefix/lib/kde3&quot;;
-$kde_appsdir		=	&quot;$kde_prefix/share/applnk&quot;;
-$kde_datadir		=	&quot;$kde_prefix/share/apps&quot;;
-$kde_htmldir		=	&quot;$kde_prefix/share/doc/kde/HTML&quot;;
-$kde_icondir		=	&quot;$kde_prefix/share/icons&quot;;
-$kde_locale		=	&quot;$kde_prefix/share/locale&quot;;
-$kde_mimedir		=	&quot;$kde_prefix/share/mimelnk&quot;;
-$kde_servicesdir	=	&quot;$kde_prefix/share/services&quot;;
-$kde_servicetypesdir	=	&quot;$kde_prefix/share/servicetypes&quot;;
-$kde_sounddir		=	&quot;$kde_prefix/share/sounds&quot;;
-$kde_templatesdir	=	&quot;$kde_prefix/share/templates&quot;;
-$kde_wallpaperdir	=	&quot;$kde_prefix/share/wallpapers&quot;;
-
-$mandir			=	&quot;$kde_prefix/share/man&quot;;
-$infodir		=	&quot;$kde_prefix/share/info&quot;;
-$sysconfdir		=	&quot;/etc&quot;;
-
-$QTDIR			=	&quot;/usr/share/qt3&quot;;
-$IDL			=	&quot;$kde_bindir/cuteidl&quot;;
-$DCOPIDL		=	&quot;$kde_bindir/dcopidl&quot;;
-$DCOPIDL2CPP		=	&quot;$kde_bindir/dcopidl2cpp&quot;;
-$KDB2HTML		=	&quot;$kde_bindir/kdb2html&quot;;
-$MCOPIDL		=	&quot;$kde_bindir/mcopidl&quot;;
-$ARTSCCONFIG		=	&quot;$kde_bindir/artsc-config&quot;;
+$kde_prefix	=	&quot;/usr&quot;;
+$sysconfdir	=	&quot;/etc&quot;;
+$kde_includedir	=	&quot;$kde_prefix/include/kde&quot;;
+$infodir	=	&quot;$kde_prefix/share/info&quot;;
+$mandir		=	&quot;$kde_prefix/share/man&quot;;
+$qtdir		=	&quot;/usr/share/qt3&quot;;
+
+$kde_cgidir	=	&quot;$kde_prefix/lib/cgi-bin&quot;;
+$kde_confdir	=	&quot;$sysconfdir/kde3&quot;;
+$kde_htmldir	=	&quot;$kde_prefix/share/doc/kde/HTML&quot;;
 
 if (defined $ENV{DEB_BUILD_OPTIONS} &amp;&amp;
-    $ENV{DEB_BUILD_OPTIONS} =~ /\bdebug\b/) {
-  $enable_debug=&quot;--enable-debug&quot;;
-  $enable_final=&quot;&quot;;
-}
-else {
-  $enable_debug=&quot;--disable-debug&quot;;
-  if (defined $ENV{DEB_BUILD_OPTIONS} &amp;&amp;
-              $ENV{DEB_BUILD_OPTIONS} =~ /\bnofinal\b/) {
-	  $enable_final=&quot;&quot;;
-  } else {
-	  $enable_final=&quot;--enable-final&quot;;
-  }
+    $ENV{DEB_BUILD_OPTIONS} =~ /\bnostrip\b/) {
+	$enable_debug=&quot;--enable-debug=full&quot;;
+} else {
+	$enable_debug=&quot;--disable-debug&quot;;
 }
 
 if (@ARGV &amp;&amp; $ARGV[0] eq 'echodirs') {
-  print STDOUT &quot;export kde_confdir=$kde_confdir\n&quot;;
   print STDOUT &quot;export kde_prefix=$kde_prefix\n&quot;;
-  print STDOUT &quot;export kde_bindir=$kde_bindir\n&quot;;
+  print STDOUT &quot;export sysconfdir=$sysconfdir\n&quot;;
   print STDOUT &quot;export kde_includedir=$kde_includedir\n&quot;;
-  print STDOUT &quot;export kde_libdir=$kde_libdir\n&quot;;
+  print STDOUT &quot;export infodir=$infodir\n&quot;;
+  print STDOUT &quot;export mandir=$mandir\n&quot;;
+  print STDOUT &quot;export qtdir=$qtdir\n&quot;;
+
   print STDOUT &quot;export kde_cgidir=$kde_cgidir\n&quot;;
-  print STDOUT &quot;export kde_moduledir=$kde_moduledir\n&quot;;
-  print STDOUT &quot;export kde_appsdir=$kde_appsdir\n&quot;;
-  print STDOUT &quot;export kde_datadir=$kde_datadir\n&quot;;
+  print STDOUT &quot;export kde_confdir=$kde_confdir\n&quot;;
   print STDOUT &quot;export kde_htmldir=$kde_htmldir\n&quot;;
-  print STDOUT &quot;export kde_icondir=$kde_icondir\n&quot;;
-  print STDOUT &quot;export kde_locale=$kde_locale\n&quot;;
-  print STDOUT &quot;export kde_mimedir=$kde_mimedir\n&quot;;
-  print STDOUT &quot;export kde_servicesdir=$kde_servicesdir\n&quot;;
-  print STDOUT &quot;export kde_servicetypesdir=$kde_servicetypesdir\n&quot;;
-  print STDOUT &quot;export kde_sounddir=$kde_sounddir\n&quot;;
-  print STDOUT &quot;export kde_templatesdir=$kde_templatesdir\n&quot;;
-  print STDOUT &quot;export kde_wallpaperdir=$kde_wallpaperdir\n&quot;;
 
-  print STDOUT &quot;export mandir=$mandir\n&quot;;
-  print STDOUT &quot;export infodir=$infodir\n&quot;;
-  print STDOUT &quot;export sysconfdir=$sysconfdir\n&quot;;
-
-  print STDOUT &quot;export QTDIR=$QTDIR\n&quot;;
-  print STDOUT &quot;export IDL=$IDL\n&quot;;
-  print STDOUT &quot;export DCOPIDL=$DCOPIDL\n&quot;;
-  print STDOUT &quot;export DCOPIDL2CPP=$DCOPIDL2CPP\n&quot;;
-  print STDOUT &quot;export KDB2HTML=$KDB2HTML\n&quot;;
-  print STDOUT &quot;export MCOPIDL=$MCOPIDL\n&quot;;
-  print STDOUT &quot;export ARTSCCONFIG=$ARTSCCONFIG\n&quot;;
-  print STDOUT &quot;export INSTALL_DATA=install -p -c -m 644\n&quot;;
-
-  print STDOUT &quot;configkde=$enable_debug $enable_final --disable-rpath --prefix=\$(kde_prefix) --libexecdir=\$(kde_bindir) --sysconfdir=\$(sysconfdir) --libdir=\$(kde_libdir) --includedir=\$(kde_includedir) --with-qt-includes=/usr/include/qt3 --mandir=\$(mandir) --infodir=\$(infodir) --with-xinerama\n&quot;;
-  print STDOUT &quot;configkdevelop=$enable_debug $enable_final --disable-rpath --enable-docbase --enable-kdoc2 --libdir=\$(kde_libdir) --includedir=\$(kde_includedir) --with-qt-includes=/usr/include/qt3 --mandir=\$(mandir) --with-kdelibsdoc-dir=/usr/share/doc/kdelibs3-doc/html --with-xinerama\n&quot;;
-  print STDOUT &quot;configkdepim=$enable_debug $enable_final --disable-rpath --with-extra-includes=/usr/include/libpisock --enable-shared --prefix=\$(kde_prefix) --libexecdir=\$(kde_bindir) --with-qt-includes=/usr/include/qt3 --mandir=\$(mandir) --infodir=\$(infodir) --with-xinerama\n&quot;;
+  print STDOUT &quot;configkde=$enable_debug --disable-rpath --prefix=\$(kde_prefix) --sysconfdir=\$(sysconfdir) --includedir=\$(kde_includedir) --infodir=\$(infodir) --mandir=\$(mandir) --with-qt-dir=\$(qtdir)\n&quot;;
 
   exit
-}
-
-if (@ARGV &amp;&amp; $ARGV[0] eq 'echoglobals') {
-	print STDOUT &quot;[Directories]\n&quot;;
-	print STDOUT &quot;dir_config=$kde_confdir\n&quot;;
-	print STDOUT &quot;dir_tmp=/tmp\n&quot;;
-	print STDOUT &quot;dir_socket=/tmp\n&quot;;
-	print STDOUT &quot;dir_exe=$kde_bindir\n&quot;;
-	print STDOUT &quot;dir_lib=$kde_libdir\n&quot;;
-	print STDOUT &quot;dir_cgi=$kde_cgidir\n&quot;;
-	print STDOUT &quot;dir_module=$kde_moduledir\n&quot;;
-	print STDOUT &quot;dir_apps=$kde_appsdir\n&quot;;
-	print STDOUT &quot;dir_data=$kde_datadir\n&quot;;
-	print STDOUT &quot;dir_html=$kde_htmldir\n&quot;;
-	print STDOUT &quot;dir_icon=$kde_icondir\n&quot;;
-	print STDOUT &quot;dir_locale=$kde_locale\n&quot;;
-	print STDOUT &quot;dir_mime=$kde_mimedir\n&quot;;
-	print STDOUT &quot;dir_services=$kde_servicesdir\n&quot;;
-	print STDOUT &quot;dir_servicetypes=$kde_servicetypesdir\n&quot;;
-	print STDOUT &quot;dir_sound=$kde_sounddir\n&quot;;
-	print STDOUT &quot;dir_templates=$kde_templatesdir\n&quot;;
-	print STDOUT &quot;dir_wallpaper=$kde_wallpaperdir\n&quot;;
-	print STDOUT &quot;[General]\n&quot;;
-	print STDOUT &quot;TerminalApplication=x-terminal-emulator\n&quot;;
-	exit
 }
Index: ltmain.sh
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/ltmain.sh,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/ltmain.sh -Ladmin/ltmain.sh -u -r1.1.1.1 -r1.2
--- admin/ltmain.sh
+++ admin/ltmain.sh
@@ -1,7 +1,7 @@
 # ltmain.sh - Provide generalized library-building support services.
 # NOTE: Changing this file will not affect anything until you rerun configure.
 #
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003
 # Free Software Foundation, Inc.
 # Originally by Gordon Matzigkeit &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">gord at gnu.ai.mit.edu</A>&gt;, 1996
 #
@@ -55,8 +55,8 @@
 # Constants.
 PROGRAM=ltmain.sh
 PACKAGE=libtool
-VERSION=1.4e
-TIMESTAMP=&quot; (1.1090 2002/02/07 19:54:36)&quot;
+VERSION=1.5a
+TIMESTAMP=&quot; (1.1240 2003/06/26 06:55:19)&quot;
 
 default_mode=
 help=&quot;Try \`$progname --help' for more information.&quot;
@@ -69,8 +69,17 @@
 # metacharacters that are still active within double-quoted strings.
 Xsed=&quot;${SED}&quot;' -e 1s/^X//'
 sed_quote_subst='s/\([\\`\\&quot;$\\\\]\)/\\\1/g'
-SP2NL='tr \040 \012'
-NL2SP='tr \015\012 \040\040'
+# test EBCDIC or ASCII
+case `echo A|tr A '\301'` in
+ A) # EBCDIC based system
+  SP2NL=&quot;tr '\100' '\n'&quot;
+  NL2SP=&quot;tr '\r\n' '\100\100'&quot;
+  ;;
+ *) # Assume ASCII based system
+  SP2NL=&quot;tr '\040' '\012'&quot;
+  NL2SP=&quot;tr '\015\012' '\040\040'&quot;
+  ;;
+esac
 
 # NLS nuisances.
 # Only set LANG and LC_ALL to C if already set.
@@ -88,8 +97,8 @@
 : ${IFS=&quot; 	&quot;}
 
 if test &quot;$build_libtool_libs&quot; != yes &amp;&amp; test &quot;$build_old_libs&quot; != yes; then
-  echo &quot;$modename: not configured to build any kind of library&quot; 1&gt;&amp;2
-  echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
+  $echo &quot;$modename: not configured to build any kind of library&quot; 1&gt;&amp;2
+  $echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
   exit 1
 fi
 
@@ -105,6 +114,49 @@
 lo2o=&quot;s/\\.lo\$/.${objext}/&quot;
 o2lo=&quot;s/\\.${objext}\$/.lo/&quot;
 
+#####################################
+# Shell function definitions:
+# This seems to be the best place for them
+
+# Need a lot of goo to handle *both* DLLs and import libs
+# Has to be a shell function in order to 'eat' the argument
+# that is supplied when $file_magic_command is called.
+win32_libid () {
+  win32_libid_type=&quot;unknown&quot;
+  win32_fileres=`file -L $1 2&gt;/dev/null`
+  case $win32_fileres in
+  *ar\ archive\ import\ library*) # definitely import
+    win32_libid_type=&quot;x86 archive import&quot;
+    ;;
+  *ar\ archive*) # could be an import, or static
+    if eval $OBJDUMP -f $1 | $SED -e '10q' 2&gt;/dev/null | \
+      grep -E 'file format pe-i386(.*architecture: i386)?' &gt;/dev/null ; then
+      win32_nmres=`eval $NM -f posix -A $1 | \
+	sed -n -e '1,100{/ I /{x;/import/!{s/^/import/;h;p;};x;};}'`
+      if test &quot;X$win32_nmres&quot; = &quot;Ximport&quot; ; then
+        win32_libid_type=&quot;x86 archive import&quot;
+      else
+        win32_libid_type=&quot;x86 archive static&quot;
+      fi
+    fi
+    ;;
+  *DLL*) 
+    win32_libid_type=&quot;x86 DLL&quot;
+    ;;
+  *executable*) # but shell scripts are &quot;executable&quot; too...
+    case $win32_fileres in
+    *MS\ Windows\ PE\ Intel*)
+      win32_libid_type=&quot;x86 DLL&quot;
+      ;;
+    esac
+    ;;
+  esac
+  $echo $win32_libid_type
+}
+
+# End of Shell function definitions
+#####################################
+
 # Parse our command line options once, thoroughly.
 while test &quot;$#&quot; -gt 0
 do
@@ -128,7 +180,7 @@
       # Check whether tagname contains only valid characters
       case $tagname in
       *[!-_A-Za-z0-9,/]*)
-	echo &quot;$progname: invalid tag name: $tagname&quot; 1&gt;&amp;2
+	$echo &quot;$progname: invalid tag name: $tagname&quot; 1&gt;&amp;2
 	exit 1
 	;;
       esac
@@ -144,7 +196,7 @@
 	  # Evaluate the configuration.
 	  eval &quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^# ### END LIBTOOL TAG CONFIG: '$tagname'$/p' &lt; $0`&quot;
 	else
-	  echo &quot;$progname: ignoring unknown tag $tagname&quot; 1&gt;&amp;2
+	  $echo &quot;$progname: ignoring unknown tag $tagname&quot; 1&gt;&amp;2
 	fi
 	;;
       esac
@@ -166,12 +218,11 @@
     ;;
 
   --version)
-    echo &quot;$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP&quot;
-    echo
-    echo &quot;Copyright 1996, 1997, 1998, 1999, 2000, 2001&quot;
-    echo &quot;Free Software Foundation, Inc.&quot;
-    echo &quot;This is free software; see the source for copying conditions.  There is NO&quot;
-    echo &quot;warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
+    $echo &quot;$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP&quot;
+    $echo
+    $echo &quot;Copyright (C) 2003  Free Software Foundation, Inc.&quot;
+    $echo &quot;This is free software; see the source for copying conditions.  There is NO&quot;
+    $echo &quot;warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
     exit 0
     ;;
 
@@ -185,7 +236,7 @@
     ;;
 
   --debug)
-    echo &quot;$progname: enabling shell trace mode&quot;
+    $echo &quot;$progname: enabling shell trace mode&quot;
     set -x
     ;;
 
@@ -194,16 +245,16 @@
     ;;
 
   --features)
-    echo &quot;host: $host&quot;
+    $echo &quot;host: $host&quot;
     if test &quot;$build_libtool_libs&quot; = yes; then
-      echo &quot;enable shared libraries&quot;
+      $echo &quot;enable shared libraries&quot;
     else
-      echo &quot;disable shared libraries&quot;
+      $echo &quot;disable shared libraries&quot;
     fi
     if test &quot;$build_old_libs&quot; = yes; then
-      echo &quot;enable static libraries&quot;
+      $echo &quot;enable static libraries&quot;
     else
-      echo &quot;disable static libraries&quot;
+      $echo &quot;disable static libraries&quot;
     fi
     exit 0
     ;;
@@ -259,8 +310,10 @@
 
   # Infer the operation mode.
   if test -z &quot;$mode&quot;; then
+    $echo &quot;*** Warning: inferring the mode of operation is deprecated.&quot; 1&gt;&amp;2
+    $echo &quot;*** Future versions of Libtool will require -mode=MODE be specified.&quot; 1&gt;&amp;2
     case $nonopt in
-    *cc | *++ | gcc* | *-gcc*)
+    *cc | cc* | *++ | gcc* | *-gcc* | g++* | xlc*)
       mode=link
       for arg
       do
@@ -315,153 +368,122 @@
     modename=&quot;$modename: compile&quot;
     # Get the compilation command and the source file.
     base_compile=
-    prev=
-    lastarg=
-    srcfile=&quot;$nonopt&quot;
+    srcfile=&quot;$nonopt&quot;  #  always keep a non-empty value in &quot;srcfile&quot;
     suppress_output=
+    arg_mode=normal
+    libobj=
 
-    user_target=no
     for arg
     do
-      case $prev in
-      &quot;&quot;) ;;
-      xcompiler)
-	# Aesthetically quote the previous argument.
-	prev=
-	lastarg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-
-	case $arg in
-	# Double-quote args containing other shell metacharacters.
-	# Many Bourne shells cannot handle close brackets correctly
-	# in scan sets, so we specify it separately.
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	  arg=&quot;\&quot;$arg\&quot;&quot;
-	  ;;
-	esac
+      case &quot;$arg_mode&quot; in
+      arg  )
+	# do not &quot;continue&quot;.  Instead, add this to base_compile
+	lastarg=&quot;$arg&quot;
+	arg_mode=normal
+	;;
 
-	# Add the previous argument to base_compile.
-	if test -z &quot;$base_compile&quot;; then
-	  base_compile=&quot;$lastarg&quot;
-	else
-	  base_compile=&quot;$base_compile $lastarg&quot;
-	fi
+      target )
+	libobj=&quot;$arg&quot;
+	arg_mode=normal
 	continue
 	;;
-      esac
 
-      # Accept any command-line options.
-      case $arg in
-      -o)
-	if test &quot;$user_target&quot; != &quot;no&quot;; then
-	  $echo &quot;$modename: you cannot specify \`-o' more than once&quot; 1&gt;&amp;2
-	  exit 1
-	fi
-	user_target=next
-	;;
+      normal )
+	# Accept any command-line options.
+	case $arg in
+	-o)
+	  if test -n &quot;$libobj&quot; ; then
+	    $echo &quot;$modename: you cannot specify \`-o' more than once&quot; 1&gt;&amp;2
+	    exit 1
+	  fi
+	  arg_mode=target
+	  continue
+	  ;;
 
-      -static)
-	build_old_libs=yes
-	continue
-	;;
+	-static)
+	  build_old_libs=yes
+	  continue
+	  ;;
 
-      -prefer-pic)
-	pic_mode=yes
-	continue
-	;;
+	-prefer-pic)
+	  pic_mode=yes
+	  continue
+	  ;;
 
-      -prefer-non-pic)
-	pic_mode=no
-	continue
-	;;
+	-prefer-non-pic)
+	  pic_mode=no
+	  continue
+	  ;;
 
-      -Xcompiler)
-	prev=xcompiler
-	continue
-	;;
+	-Xcompiler)
+	  arg_mode=arg  #  the next one goes into the &quot;base_compile&quot; arg list
+	  continue      #  The current &quot;srcfile&quot; will either be retained or
+	  ;;            #  replaced later.  I would guess that would be a bug.
+
+	-Wc,*)
+	  args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;s/^-Wc,//&quot;`
+	  lastarg=
+	  save_ifs=&quot;$IFS&quot;; IFS=','
+	  for arg in $args; do
+	    IFS=&quot;$save_ifs&quot;
 
-      -Wc,*)
-	args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;s/^-Wc,//&quot;`
-	lastarg=
-	save_ifs=&quot;$IFS&quot;; IFS=','
-	for arg in $args; do
+	    # Double-quote args containing other shell metacharacters.
+	    # Many Bourne shells cannot handle close brackets correctly
+	    # in scan sets, so we specify it separately.
+	    case $arg in
+	      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	      arg=&quot;\&quot;$arg\&quot;&quot;
+	      ;;
+	    esac
+	    lastarg=&quot;$lastarg $arg&quot;
+	  done
 	  IFS=&quot;$save_ifs&quot;
+	  lastarg=`$echo &quot;X$lastarg&quot; | $Xsed -e &quot;s/^ //&quot;`
 
-	  # Double-quote args containing other shell metacharacters.
-	  # Many Bourne shells cannot handle close brackets correctly
-	  # in scan sets, so we specify it separately.
-	  case $arg in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
-	    arg=&quot;\&quot;$arg\&quot;&quot;
-	    ;;
-	  esac
-	  lastarg=&quot;$lastarg $arg&quot;
-	done
-	IFS=&quot;$save_ifs&quot;
-	lastarg=`$echo &quot;X$lastarg&quot; | $Xsed -e &quot;s/^ //&quot;`
-
-	# Add the arguments to base_compile.
-	if test -z &quot;$base_compile&quot;; then
-	  base_compile=&quot;$lastarg&quot;
-	else
+	  # Add the arguments to base_compile.
 	  base_compile=&quot;$base_compile $lastarg&quot;
-	fi
-	continue
-	;;
-      esac
+	  continue
+	  ;;
 
-      case $user_target in
-      next)
-	# The next one is the -o target name
-	user_target=yes
-	continue
-	;;
-      yes)
-	# We got the output file
-	user_target=set
-	libobj=&quot;$arg&quot;
-	continue
+	* )
+	  # Accept the current argument as the source file.
+	  # The previous &quot;srcfile&quot; becomes the current argument.
+	  #
+	  lastarg=&quot;$srcfile&quot;
+	  srcfile=&quot;$arg&quot;
+	  ;;
+	esac  #  case $arg
 	;;
-      esac
-
-      # Accept the current argument as the source file.
-      lastarg=&quot;$srcfile&quot;
-      srcfile=&quot;$arg&quot;
+      esac    #  case $arg_mode
 
       # Aesthetically quote the previous argument.
-
-      # Backslashify any backslashes, double quotes, and dollar signs.
-      # These are the only characters that are still specially
-      # interpreted inside of double-quoted scrings.
       lastarg=`$echo &quot;X$lastarg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
 
+      case $lastarg in
       # Double-quote args containing other shell metacharacters.
       # Many Bourne shells cannot handle close brackets correctly
       # in scan sets, so we specify it separately.
-      case $lastarg in
       *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
 	lastarg=&quot;\&quot;$lastarg\&quot;&quot;
 	;;
       esac
 
-      # Add the previous argument to base_compile.
-      if test -z &quot;$base_compile&quot;; then
-	base_compile=&quot;$lastarg&quot;
-      else
-	base_compile=&quot;$base_compile $lastarg&quot;
-      fi
-    done
+      base_compile=&quot;$base_compile $lastarg&quot;
+    done # for arg
 
-    case $user_target in
-    set)
-      ;;
-    no)
-      # Get the name of the library object.
-      libobj=`$echo &quot;X$srcfile&quot; | $Xsed -e 's%^.*/%%'`
+    case $arg_mode in
+    arg)
+      $echo &quot;$modename: you must specify an argument for -Xcompile&quot;
+      exit 1
       ;;
-    *)
+    target)
       $echo &quot;$modename: you must specify a target with \`-o'&quot; 1&gt;&amp;2
       exit 1
       ;;
+    *)
+      # Get the name of the library object.
+      [ -z &quot;$libobj&quot; ] &amp;&amp; libobj=`$echo &quot;X$srcfile&quot; | $Xsed -e 's%^.*/%%'`
+      ;;
     esac
 
     # Recognize several different file suffixes.
@@ -498,28 +520,25 @@
     # Only attempt this if the compiler in the base compile
     # command doesn't match the default compiler.
     if test -n &quot;$available_tags&quot; &amp;&amp; test -z &quot;$tagname&quot;; then
-      case &quot;$base_compile &quot; in
-      &quot;$CC &quot;*) ;;
+      case $base_compile in
       # Blanks in the command may have been stripped by the calling shell,
-      # but not from the CC environment variable when ltconfig was run.
-      &quot;`$echo $CC` &quot;*) ;;
+      # but not from the CC environment variable when configure was run.
+      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; `$echo $CC` &quot;* | &quot;`$echo $CC` &quot;*) ;;
+      # Blanks at the start of $base_compile will cause this to fail
+      # if we don't check for them as well.
       *)
 	for z in $available_tags; do
 	  if grep &quot;^# ### BEGIN LIBTOOL TAG CONFIG: $z$&quot; &lt; &quot;$0&quot; &gt; /dev/null; then
 	    # Evaluate the configuration.
 	    eval &quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' &lt; $0`&quot;
 	    case &quot;$base_compile &quot; in
-	    &quot;$CC &quot;*)
+	    &quot;$CC &quot;* | &quot; $CC &quot;* | &quot;`$echo $CC` &quot;* | &quot; `$echo $CC` &quot;*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
 	      tagname=$z
 	      break
 	      ;;
-	    &quot;`$echo $CC` &quot;*)
-	      tagname=$z
-	      break
-	      ;;
 	    esac
 	  fi
 	done
@@ -527,11 +546,11 @@
 	# was found and let the user know that the &quot;--tag&quot; command
 	# line option must be used.
 	if test -z &quot;$tagname&quot;; then
-	  echo &quot;$modename: unable to infer tagged configuration&quot;
-	  echo &quot;$modename: specify a tag with \`--tag'&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: unable to infer tagged configuration&quot;
+	  $echo &quot;$modename: specify a tag with \`--tag'&quot; 1&gt;&amp;2
 	  exit 1
 #        else
-#          echo &quot;$modename: using $tagname tagged configuration&quot;
+#          $echo &quot;$modename: using $tagname tagged configuration&quot;
 	fi
 	;;
       esac
@@ -595,7 +614,7 @@
       done
     elif test &quot;$need_locks&quot; = warn; then
       if test -f &quot;$lockfile&quot;; then
-	echo &quot;\
+	$echo &quot;\
 *** ERROR, $lockfile exists and contains:
 `cat $lockfile 2&gt;/dev/null`
 
@@ -609,7 +628,7 @@
 	$run $rm $removelist
 	exit 1
       fi
-      echo $srcfile &gt; &quot;$lockfile&quot;
+      $echo $srcfile &gt; &quot;$lockfile&quot;
     fi
 
     if test -n &quot;$fix_srcfile_path&quot;; then
@@ -667,7 +686,7 @@
 
       if test &quot;$need_locks&quot; = warn &amp;&amp;
 	 test &quot;X`cat $lockfile 2&gt;/dev/null`&quot; != &quot;X$srcfile&quot;; then
-	echo &quot;\
+	$echo &quot;\
 *** ERROR, $lockfile contains:
 `cat $lockfile 2&gt;/dev/null`
 
@@ -737,7 +756,7 @@
 
       if test &quot;$need_locks&quot; = warn &amp;&amp;
 	 test &quot;X`cat $lockfile 2&gt;/dev/null`&quot; != &quot;X$srcfile&quot;; then
-	echo &quot;\
+	$echo &quot;\
 *** ERROR, $lockfile contains:
 `cat $lockfile 2&gt;/dev/null`
 
@@ -801,7 +820,7 @@
       # It is impossible to link a dll without this setting, and
       # we shouldn't force the makefile maintainer to figure out
       # which system we are compiling for in order to pass an extra
-      # flag for every libtool invokation.
+      # flag for every libtool invocation.
       # allow_undefined=no
 
       # FIXME: Unfortunately, there are problems with the above when trying
@@ -833,6 +852,7 @@
     linker_flags=
     dllsearchpath=
     lib_search_path=`pwd`
+    inst_prefix_dir=
 
     avoid_version=no
     dlfiles=
@@ -859,6 +879,7 @@
     temp_rpath=
     thread_safe=no
     vinfo=
+    vinfo_number=no
 
     # We need to know -static, to get the right output filenames.
     for arg
@@ -965,6 +986,11 @@
 	  prev=
 	  continue
 	  ;;
+	inst_prefix)
+	  inst_prefix_dir=&quot;$arg&quot;
+	  prev=
+	  continue
+	  ;;
 	release)
 	  release=&quot;-$arg&quot;
 	  prev=
@@ -981,7 +1007,7 @@
 	      # A libtool-controlled object.
 
 	      # Check to see that this really is a libtool object.
-	      if (${SED} -e '2q' $arg | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	      if (${SED} -e '2q' $arg | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
 		pic_object=
 		non_pic_object=
 
@@ -1115,6 +1141,14 @@
 	  finalize_command=&quot;$finalize_command $wl$qarg&quot;
 	  continue
 	  ;;
+	xcclinker)
+	  linker_flags=&quot;$linker_flags $qarg&quot;
+	  compiler_flags=&quot;$compiler_flags $qarg&quot;
+	  prev=
+	  compile_command=&quot;$compile_command $qarg&quot;
+	  finalize_command=&quot;$finalize_command $qarg&quot;
+	  continue
+	  ;;
 	*)
 	  eval &quot;$prev=\&quot;\$arg\&quot;&quot;
 	  prev=
@@ -1173,6 +1207,11 @@
 	continue
 	;;
 
+      -inst-prefix-dir)
+	prev=inst_prefix
+	continue
+	;;
+
       # The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*
       # so, if we see these flags be careful not to treat them like -L
       -L[A-Z][A-Z]*:*)
@@ -1224,6 +1263,9 @@
 	    # These systems don't actually have a C or math library (as such)
 	    continue
 	    ;;
+	  *-*-freebsd*-gnu*)
+	    # prevent being parsed by the freebsd regexp below
+	    ;;
 	  *-*-mingw* | *-*-os2*)
 	    # These systems don't actually have a C library (as such)
 	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
@@ -1239,7 +1281,10 @@
 	  esac
 	elif test &quot;X$arg&quot; = &quot;X-lc_r&quot;; then
 	 case $host in
-	 *-*-openbsd* | *-*-freebsd*)
+	 *-*-freebsd*-gnu*)
+	   # prevent being parsed by the freebsd regexp below
+	   ;;
+	 *-*-openbsd*)
 	   # Do not include libc_r directly, use -pthread flag.
 	   continue
 	   ;;
@@ -1254,6 +1299,34 @@
 	continue
 	;;
 
+      # gcc -m* arguments should be passed to the linker via $compiler_flags
+      # in order to pass architecture information to the linker
+      # (e.g. 32 vs 64-bit).  This may also be accomplished via -Wl,-mfoo
+      # but this is not reliable with gcc because gcc may use -mfoo to
+      # select a different linker, different libraries, etc, while
+      # -Wl,-mfoo simply passes -mfoo to the linker.
+      -m*)
+	# Unknown arguments in both finalize_command and compile_command need
+	# to be aesthetically quoted because they are evaled later.
+	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+	case $arg in
+	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	  arg=&quot;\&quot;$arg\&quot;&quot;
+	  ;;
+	esac
+        compile_command=&quot;$compile_command $arg&quot;
+        finalize_command=&quot;$finalize_command $arg&quot;
+        if test &quot;$with_gcc&quot; = &quot;yes&quot; ; then
+          compiler_flags=&quot;$compiler_flags $arg&quot;
+        fi
+        continue
+        ;;
+
+      -shrext)
+	prev=shrext
+	continue
+	;;
+
       -no-fast-install)
 	fast_install=no
 	continue
@@ -1335,6 +1408,11 @@
 	prev=vinfo
 	continue
 	;;
+      -version-number)
+	prev=vinfo
+	vinfo_number=yes
+	continue
+	;;
 
       -Wc,*)
 	args=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot; -e 's/^-Wc,//'`
@@ -1383,6 +1461,11 @@
 	continue
 	;;
 
+      -XCClinker)
+	prev=xcclinker
+	continue
+	;;
+
       # Some other compiler flag.
       -* | +*)
 	# Unknown arguments in both finalize_command and compile_command need
@@ -1405,7 +1488,7 @@
 	# A libtool-controlled object.
 
 	# Check to see that this really is a libtool object.
-	if (${SED} -e '2q' $arg | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	if (${SED} -e '2q' $arg | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
 	  pic_object=
 	  non_pic_object=
 
@@ -1551,27 +1634,24 @@
     # command doesn't match the default compiler.
     if test -n &quot;$available_tags&quot; &amp;&amp; test -z &quot;$tagname&quot;; then
       case $base_compile in
-      &quot;$CC &quot;*) ;;
       # Blanks in the command may have been stripped by the calling shell,
-      # but not from the CC environment variable when ltconfig was run.
-      &quot;`$echo $CC` &quot;*) ;;
+      # but not from the CC environment variable when configure was run.
+      &quot;$CC &quot;* | &quot; $CC &quot;* | &quot;`$echo $CC` &quot;* | &quot; `$echo $CC` &quot;*) ;;
+      # Blanks at the start of $base_compile will cause this to fail
+      # if we don't check for them as well.
       *)
 	for z in $available_tags; do
 	  if grep &quot;^# ### BEGIN LIBTOOL TAG CONFIG: $z$&quot; &lt; &quot;$0&quot; &gt; /dev/null; then
 	    # Evaluate the configuration.
 	    eval &quot;`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' &lt; $0`&quot;
 	    case $base_compile in
-	    &quot;$CC &quot;*)
+	    &quot;$CC &quot;* | &quot; $CC &quot;* | &quot;`$echo $CC` &quot;* | &quot; `$echo $CC` &quot;*)
 	      # The compiler in $compile_command matches
 	      # the one in the tagged configuration.
 	      # Assume this is the tagged configuration we want.
 	      tagname=$z
 	      break
 	      ;;
-	    &quot;`$echo $CC` &quot;*)
-	      tagname=$z
-	      break
-	      ;;
 	    esac
 	  fi
 	done
@@ -1579,11 +1659,11 @@
 	# was found and let the user know that the &quot;--tag&quot; command
 	# line option must be used.
 	if test -z &quot;$tagname&quot;; then
-	  echo &quot;$modename: unable to infer tagged configuration&quot;
-	  echo &quot;$modename: specify a tag with \`--tag'&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: unable to infer tagged configuration&quot;
+	  $echo &quot;$modename: specify a tag with \`--tag'&quot; 1&gt;&amp;2
 	  exit 1
 #       else
-#         echo &quot;$modename: using $tagname tagged configuration&quot;
+#         $echo &quot;$modename: using $tagname tagged configuration&quot;
 	fi
 	;;
       esac
@@ -1638,7 +1718,17 @@
     *) linkmode=prog ;; # Anything else should be a program.
     esac
 
+    case $host in
+    *cygwin* | *mingw* | *pw32*)
+      # don't eliminate duplcations in $postdeps and $predeps
+      duplicate_compiler_generated_deps=yes
+      ;;
+    *)
+      duplicate_compiler_generated_deps=$duplicate_deps
+      ;;
+    esac
     specialdeplibs=
+
     libs=
     # Find all interdependent deplibs by searching for libraries
     # that are linked more than once (e.g. -la -lb -la)
@@ -1658,7 +1748,7 @@
       # $postdeps and mark them as special (i.e., whose duplicates are
       # not to be eliminated).
       pre_post_deps=
-      if test &quot;X$duplicate_deps&quot; = &quot;Xyes&quot; ; then
+      if test &quot;X$duplicate_compiler_generated_deps&quot; = &quot;Xyes&quot; ; then
 	for pre_post_dep in $predeps $postdeps; do
 	  case &quot;$pre_post_deps &quot; in
 	  *&quot; $pre_post_dep &quot;*) specialdeplibs=&quot;$specialdeplibs $pre_post_deps&quot; ;;
@@ -1732,12 +1822,18 @@
 	  fi
 	  name=`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-l//'`
 	  for searchdir in $newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path; do
-	    # Search the libtool library
-	    lib=&quot;$searchdir/lib${name}.la&quot;
-	    if test -f &quot;$lib&quot;; then
-	      found=yes
-	      break
-	    fi
+	    for search_ext in .la $shrext .so .a; do
+	      # Search the libtool library
+	      lib=&quot;$searchdir/lib${name}${search_ext}&quot;
+	      if test -f &quot;$lib&quot;; then
+		if test &quot;$search_ext&quot; = &quot;.la&quot;; then
+		  found=yes
+		else
+		  found=no
+		fi
+		break 2
+	      fi
+	    done
 	  done
 	  if test &quot;$found&quot; != yes; then
 	    # deplib doesn't seem to be a libtool library
@@ -1749,6 +1845,42 @@
 	      test &quot;$linkmode&quot; = lib &amp;&amp; newdependency_libs=&quot;$deplib $newdependency_libs&quot;
 	    fi
 	    continue
+	  else # deplib is a libtool library
+	    # If $allow_libtool_libs_with_static_runtimes &amp;&amp; $deplib is a stdlib,
+	    # We need to do some special things here, and not later.
+	    if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+	      case &quot; $predeps $postdeps &quot; in
+	      *&quot; $deplib &quot;*)
+		if (${SED} -e '2q' $lib |
+                    grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+		  library_names=
+		  old_library=
+		  case $lib in
+		  */* | *\\*) . $lib ;;
+		  *) . ./$lib ;;
+		  esac
+		  for l in $old_library $library_names; do
+		    ll=&quot;$l&quot;
+		  done
+		  if test &quot;X$ll&quot; = &quot;X$old_library&quot; ; then # only static version available
+		    found=no
+		    ladir=`$echo &quot;X$lib&quot; | $Xsed -e 's%/[^/]*$%%'`
+		    test &quot;X$ladir&quot; = &quot;X$lib&quot; &amp;&amp; ladir=&quot;.&quot;
+		    lib=$ladir/$old_library
+		    if test &quot;$linkmode,$pass&quot; = &quot;prog,link&quot;; then
+		      compile_deplibs=&quot;$deplib $compile_deplibs&quot;
+		      finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
+		    else
+		      deplibs=&quot;$deplib $deplibs&quot;
+		      test &quot;$linkmode&quot; = lib &amp;&amp; newdependency_libs=&quot;$deplib $newdependency_libs&quot;
+		    fi
+		    continue
+		  fi
+		fi
+	        ;;
+	      *) ;;
+	      esac
+	    fi
 	  fi
 	  ;; # -l
 	-L*)
@@ -1799,17 +1931,17 @@
 	  case $linkmode in
 	  lib)
 	    if test &quot;$deplibs_check_method&quot; != pass_all; then
-	      echo
-	      echo &quot;*** Warning: Trying to link with static lib archive $deplib.&quot;
-	      echo &quot;*** I have the capability to make that library automatically link in when&quot;
-	      echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-	      echo &quot;*** shared version of the library, which you do not appear to have&quot;
-	      echo &quot;*** because the file extensions .$libext of this argument makes me believe&quot;
-	      echo &quot;*** that it is just a static archive that I should not used here.&quot;
+	      $echo
+	      $echo &quot;*** Warning: Trying to link with static lib archive $deplib.&quot;
+	      $echo &quot;*** I have the capability to make that library automatically link in when&quot;
+	      $echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+	      $echo &quot;*** shared version of the library, which you do not appear to have&quot;
+	      $echo &quot;*** because the file extensions .$libext of this argument makes me believe&quot;
+	      $echo &quot;*** that it is just a static archive that I should not used here.&quot;
 	    else
-	      echo
-	      echo &quot;*** Warning: Linking the shared library $output against the&quot;
-	      echo &quot;*** static library $deplib is not portable!&quot;
+	      $echo
+	      $echo &quot;*** Warning: Linking the shared library $output against the&quot;
+	      $echo &quot;*** static library $deplib is not portable!&quot;
 	      deplibs=&quot;$deplib $deplibs&quot;
 	    fi
 	    continue
@@ -1853,7 +1985,7 @@
 	fi
 
 	# Check to see that this really is a libtool archive.
-	if (${SED} -e '2q' $lib | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
+	if (${SED} -e '2q' $lib | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
 	else
 	  $echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
 	  exit 1
@@ -1869,8 +2001,9 @@
 	library_names=
 	old_library=
 	# If the library was installed with an old release of libtool,
-	# it will not redefine variable installed.
+	# it will not redefine variables installed, or shouldnotlink
 	installed=yes
+	shouldnotlink=no
 
 	# Read the .la file
 	case $lib in
@@ -1914,6 +2047,7 @@
 	  continue
 	fi # $pass = conv
 
+    
 	# Get the name of the library we link against.
 	linklib=
 	for l in $old_library $library_names; do
@@ -2006,6 +2140,7 @@
 	  continue
 	fi
 
+    
 	if test &quot;$linkmode&quot; = prog &amp;&amp; test &quot;$pass&quot; != link; then
 	  newlib_search_path=&quot;$newlib_search_path $ladir&quot;
 	  deplibs=&quot;$lib $deplibs&quot;
@@ -2092,6 +2227,17 @@
 	    need_relink=yes
 	  fi
 	  # This is a shared library
+	
+      # Warn about portability, can't link against -module's on some systems (darwin)
+      if test &quot;$shouldnotlink&quot; = yes &amp;&amp; test &quot;$pass&quot; = link ; then
+	    $echo
+	    if test &quot;$linkmode&quot; = prog; then
+	      $echo &quot;*** Warning: Linking the executable $output against the loadable module&quot;
+	    else
+	      $echo &quot;*** Warning: Linking the shared library $output against the loadable module&quot;
+	    fi
+	    $echo &quot;*** $linklib is not portable!&quot;    
+      fi	  
 	  if test &quot;$linkmode&quot; = lib &amp;&amp;
 	     test &quot;$hardcode_into_libs&quot; = yes; then
 	    # Hardcode the library path.
@@ -2129,7 +2275,7 @@
 	    elif test -n &quot;$soname_spec&quot;; then
 	      # bleh windows
 	      case $host in
-	      *cygwin*)
+	      *cygwin* | mingw*)
 		major=`expr $current - $age`
 		versuffix=&quot;-$major&quot;
 		;;
@@ -2141,8 +2287,8 @@
 
 	    # Make a new name for the extract_expsyms_cmds to use
 	    soroot=&quot;$soname&quot;
-	    soname=`echo $soroot | ${SED} -e 's/^.*\///'`
-	    newlib=&quot;libimp-`echo $soname | ${SED} 's/^lib//;s/\.dll$//'`.a&quot;
+	    soname=`$echo $soroot | ${SED} -e 's/^.*\///'`
+	    newlib=&quot;libimp-`$echo $soname | ${SED} 's/^lib//;s/\.dll$//'`.a&quot;
 
 	    # If the library has no export list, then create one now
 	    if test -f &quot;$output_objdir/$soname-def&quot;; then :
@@ -2184,6 +2330,22 @@
 	    immediate | unsupported)
 	      if test &quot;$hardcode_direct&quot; = no; then
 		add=&quot;$dir/$linklib&quot;
+		case $host in
+		  *-*-sco3.2v5* ) add_dir=&quot;-L$dir&quot; ;;
+		  *-*-darwin* )
+		    # if the lib is a module then we can not link against it, someone
+		    # is ignoring the new warnings I added
+		    if /usr/bin/file -L $add 2&gt; /dev/null | grep &quot;bundle&quot; &gt;/dev/null ; then
+		      $echo &quot;** Warning, lib $linklib is a module, not a shared library&quot;
+		      if test -z &quot;$old_library&quot; ; then
+		        $echo
+		        $echo &quot;** And there doesn't seem to be a static archive available&quot;
+		        $echo &quot;** The link will probably fail, sorry&quot;
+		      else
+		        add=&quot;$dir/$old_library&quot;
+		      fi 
+		    fi
+		esac
 	      elif test &quot;$hardcode_minus_L&quot; = no; then
 		case $host in
 		*-*-sunos*) add_shlibpath=&quot;$dir&quot; ;;
@@ -2202,6 +2364,14 @@
 		add=&quot;$dir/$linklib&quot;
 	      elif test &quot;$hardcode_minus_L&quot; = yes; then
 		add_dir=&quot;-L$dir&quot;
+		# Try looking first in the location we're being installed to.
+		if test -n &quot;$inst_prefix_dir&quot;; then
+		  case &quot;$libdir&quot; in
+		    [\\/]*)
+		      add_dir=&quot;-L$inst_prefix_dir$libdir $add_dir&quot;
+		      ;;
+		  esac
+		fi
 		add=&quot;-l$name&quot;
 	      elif test &quot;$hardcode_shlibpath_var&quot; = yes; then
 		add_shlibpath=&quot;$dir&quot;
@@ -2257,9 +2427,23 @@
 	      *) finalize_shlibpath=&quot;$finalize_shlibpath$libdir:&quot; ;;
 	      esac
 	      add=&quot;-l$name&quot;
+	    elif test &quot;$hardcode_automatic&quot; = yes; then
+	      if test -n &quot;$inst_prefix_dir&quot; &amp;&amp; test -f &quot;$inst_prefix_dir$libdir/$linklib&quot; ; then
+	        add=&quot;$inst_prefix_dir$libdir/$linklib&quot;
+	      else
+	        add=&quot;$libdir/$linklib&quot;
+	      fi
 	    else
 	      # We cannot seem to hardcode it, guess we'll fake it.
 	      add_dir=&quot;-L$libdir&quot;
+	      # Try looking first in the location we're being installed to.
+	      if test -n &quot;$inst_prefix_dir&quot;; then
+		case &quot;$libdir&quot; in
+		  [\\/]*)
+		    add_dir=&quot;-L$inst_prefix_dir$libdir $add_dir&quot;
+		    ;;
+		esac
+	      fi
 	      add=&quot;-l$name&quot;
 	    fi
 
@@ -2291,21 +2475,21 @@
 
 	    # Just print a warning and add the library to dependency_libs so
 	    # that the program can be linked against the static library.
-	    echo
-	    echo &quot;*** Warning: This system can not link to static lib archive $lib.&quot;
-	    echo &quot;*** I have the capability to make that library automatically link in when&quot;
-	    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-	    echo &quot;*** shared version of the library, which you do not appear to have.&quot;
+	    $echo
+	    $echo &quot;*** Warning: This system can not link to static lib archive $lib.&quot;
+	    $echo &quot;*** I have the capability to make that library automatically link in when&quot;
+	    $echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+	    $echo &quot;*** shared version of the library, which you do not appear to have.&quot;
 	    if test &quot;$module&quot; = yes; then
-	      echo &quot;*** But as you try to build a module library, libtool will still create &quot;
-	      echo &quot;*** a static module, that should work as long as the dlopening application&quot;
-	      echo &quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;
+	      $echo &quot;*** But as you try to build a module library, libtool will still create &quot;
+	      $echo &quot;*** a static module, that should work as long as the dlopening application&quot;
+	      $echo &quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;
 	      if test -z &quot;$global_symbol_pipe&quot;; then
-		echo
-		echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-		echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-		echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
-		echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+		$echo
+		$echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+		$echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+		$echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+		$echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
 	      fi
 	      if test &quot;$build_old_libs&quot; = no; then
 		build_libtool_libs=module
@@ -2376,19 +2560,70 @@
 		  ;;
 		esac
 		if grep &quot;^installed=no&quot; $deplib &gt; /dev/null; then
-		  path=&quot;-L$absdir/$objdir&quot;
+		  path=&quot;$absdir/$objdir&quot;
 		else
 		  eval libdir=`${SED} -n -e 's/^libdir=\(.*\)$/\1/p' $deplib`
 		  if test -z &quot;$libdir&quot;; then
 		    $echo &quot;$modename: \`$deplib' is not a valid libtool archive&quot; 1&gt;&amp;2
 		    exit 1
 		  fi
-		  path=&quot;-L$absdir&quot;
+		  if test &quot;$absdir&quot; != &quot;$libdir&quot;; then
+		    # Sure, some shells/systems don't implement the -ef.
+		    # Those will have to live with the warning.
+		    test &quot;$absdir&quot; -ef &quot;$libdir&quot; &gt; /dev/null 2&gt;&amp;1 ||
+		      $echo &quot;$modename: warning: \`$deplib' seems to be moved&quot; 1&gt;&amp;2
+		  fi
+		  path=&quot;$absdir&quot;
 		fi
+		depdepl=
+		case $host in
+		*-*-darwin*)
+		  # we do not want to link against static libs, but need to link against shared
+		  eval deplibrary_names=`${SED} -n -e 's/^library_names=\(.*\)$/\1/p' $deplib`
+		  if test -n &quot;$deplibrary_names&quot; ; then
+		    for tmp in $deplibrary_names ; do
+		      depdepl=$tmp
+		    done
+		    if test -f &quot;$path/$depdepl&quot; ; then
+		      depdepl=&quot;$path/$depdepl&quot;
+		   fi
+		    # do not add paths which are already there
+		    case &quot; $newlib_search_path &quot; in
+		    *&quot; $path &quot;*) ;;
+		    *) newlib_search_path=&quot;$newlib_search_path $path&quot;;;
+		    esac
+		    path=&quot;&quot;
+		  fi
+		  ;;
+		*)
+		path=&quot;-L$path&quot;
+		;;
+		esac 
+		
+		;;
+		  -l*)
+		case $host in
+		*-*-darwin*)
+		 # Again, we only want to link against shared libraries
+		 eval tmp_libs=`$echo &quot;X$deplib&quot; | $Xsed -e &quot;s,^\-l,,&quot;`
+		 for tmp in $newlib_search_path ; do
+		     if test -f &quot;$tmp/lib$tmp_libs.dylib&quot; ; then
+		       eval depdepl=&quot;$tmp/lib$tmp_libs.dylib&quot;
+		       break
+		     fi  
+         done
+         path=&quot;&quot;
+		  ;;
+		*) continue ;;
+		esac  		  
 		;;
 	      *) continue ;;
 	      esac
 	      case &quot; $deplibs &quot; in
+	      *&quot; $depdepl &quot;*) ;;
+	      *) deplibs=&quot;$deplibs $depdepl&quot; ;;
+	      esac	      
+	      case &quot; $deplibs &quot; in
 	      *&quot; $path &quot;*) ;;
 	      *) deplibs=&quot;$deplibs $path&quot; ;;
 	      esac
@@ -2434,6 +2669,7 @@
 	    # practice:
 	    case $deplib in
 	    -L*) new_libs=&quot;$deplib $new_libs&quot; ;;
+	    -R*) ;;
 	    *)
 	      # And here is the reason: when a library appears more
 	      # than once as an explicit dependence of a library, or
@@ -2470,18 +2706,25 @@
 	      *) tmp_libs=&quot;$tmp_libs $deplib&quot; ;;
 	      esac
 	      ;;
-	    -R*)
-	      temp_xrpath=`$echo &quot;X$deplib&quot; | $Xsed -e 's/^-R//'`
-	      case &quot; $xrpath &quot; in
-	      *&quot; $temp_xrpath &quot;*) ;;
-	      *) xrpath=&quot;$xrpath $temp_xrpath&quot;;;
-	      esac;;
 	    *) tmp_libs=&quot;$tmp_libs $deplib&quot; ;;
 	    esac
 	  done
 	  eval $var=\&quot;$tmp_libs\&quot;
 	done # for var
       fi
+      # Last step: remove runtime libs from dependency_libs (they stay in deplibs)
+      tmp_libs=
+      for i in $dependency_libs ; do
+	case &quot; $predeps $postdeps $compiler_lib_search_path &quot; in
+	*&quot; $i &quot;*)
+	  i=&quot;&quot;
+	  ;;
+	esac
+	if test -n &quot;$i&quot; ; then
+	  tmp_libs=&quot;$tmp_libs $i&quot;
+	fi
+      done
+      dependency_libs=$tmp_libs
     done # for pass
     if test &quot;$linkmode&quot; = prog; then
       dlfiles=&quot;$newdlfiles&quot;
@@ -2507,7 +2750,7 @@
       fi
 
       if test -n &quot;$vinfo&quot;; then
-	$echo &quot;$modename: warning: \`-version-info' is ignored for archives&quot; 1&gt;&amp;2
+	$echo &quot;$modename: warning: \`-version-info/-version-number' is ignored for archives&quot; 1&gt;&amp;2
       fi
 
       if test -n &quot;$release&quot;; then
@@ -2529,6 +2772,7 @@
       case $outputname in
       lib*)
 	name=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//' -e 's/^lib//'`
+	eval shared_ext=\&quot;$shrext\&quot;
 	eval libname=\&quot;$libname_spec\&quot;
 	;;
       *)
@@ -2540,6 +2784,7 @@
 	if test &quot;$need_lib_prefix&quot; != no; then
 	  # Add the &quot;lib&quot; prefix for modules if required
 	  name=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//'`
+	  eval shared_ext=\&quot;$shrext\&quot;
 	  eval libname=\&quot;$libname_spec\&quot;
 	else
 	  libname=`$echo &quot;X$outputname&quot; | $Xsed -e 's/\.la$//'`
@@ -2552,9 +2797,9 @@
 	  $echo &quot;$modename: cannot build libtool library \`$output' from non-libtool objects on this host:$objs&quot; 2&gt;&amp;1
 	  exit 1
 	else
-	  echo
-	  echo &quot;*** Warning: Linking the shared library $output against the non-libtool&quot;
-	  echo &quot;*** objects $objs is not portable!&quot;
+	  $echo
+	  $echo &quot;*** Warning: Linking the shared library $output against the non-libtool&quot;
+	  $echo &quot;*** objects $objs is not portable!&quot;
 	  libobjs=&quot;$libobjs $objs&quot;
 	fi
       fi
@@ -2582,7 +2827,7 @@
 	fi
 
 	if test -n &quot;$vinfo&quot;; then
-	  $echo &quot;$modename: warning: \`-version-info' is ignored for convenience libraries&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: warning: \`-version-info/-version-number' is ignored for convenience libraries&quot; 1&gt;&amp;2
 	fi
 
 	if test -n &quot;$release&quot;; then
@@ -2601,9 +2846,46 @@
 	  exit 1
 	fi
 
-	current=&quot;$2&quot;
-	revision=&quot;$3&quot;
-	age=&quot;$4&quot;
+	# convert absolute version numbers to libtool ages
+	# this retains compatibility with .la files and attempts
+	# to make the code below a bit more comprehensible
+	
+	case $vinfo_number in
+	yes)
+	  number_major=&quot;$2&quot;
+	  number_minor=&quot;$3&quot;
+	  number_revision=&quot;$4&quot;
+	  #
+	  # There are really only two kinds -- those that
+	  # use the current revision as the major version
+	  # and those that subtract age and use age as
+	  # a minor version.  But, then there is irix
+	  # which has an extra 1 added just for fun
+	  #
+	  case $version_type in
+	  darwin|linux|osf|windows)
+	    current=`expr $number_major + $number_minor`
+	    age=&quot;$number_minor&quot;
+	    revision=&quot;$number_revision&quot;
+	    ;;
+	  freebsd-aout|freebsd-elf|sunos)
+	    current=&quot;$number_major&quot;
+	    revision=&quot;$number_minor&quot;
+	    age=&quot;0&quot;
+	    ;;
+	  irix|nonstopux)
+	    current=`expr $number_major + $number_minor - 1`
+	    age=&quot;$number_minor&quot;
+	    revision=&quot;$number_minor&quot;
+	    ;;
+	  esac
+	  ;;
+	no)
+	  current=&quot;$2&quot;
+	  revision=&quot;$3&quot;
+	  age=&quot;$4&quot;
+	  ;;
+	esac
 
 	# Check that each of the things are valid numbers.
 	case $current in
@@ -2667,14 +2949,14 @@
 	  ;;
 
 	irix | nonstopux)
+	  major=`expr $current - $age + 1`
+
 	  case $version_type in
 	    nonstopux) verstring_prefix=nonstopux ;;
 	    *)         verstring_prefix=sgi ;;
 	  esac
 	  verstring=&quot;$verstring_prefix$major.$revision&quot;
 
-	  major=`expr $current - $age + 1`
-
 	  # Add in all the interfaces that we are compatible with.
 	  loop=$revision
 	  while test &quot;$loop&quot; -ne 0; do
@@ -2694,7 +2976,7 @@
 	  ;;
 
 	osf)
-	  major=`expr $current - $age`
+	  major=.`expr $current - $age`
 	  versuffix=&quot;.$current.$age.$revision&quot;
 	  verstring=&quot;$current.$age.$revision&quot;
 
@@ -2724,7 +3006,7 @@
 
 	*)
 	  $echo &quot;$modename: unknown library version type \`$version_type'&quot; 1&gt;&amp;2
-	  echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
+	  $echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
 	  exit 1
 	  ;;
 	esac
@@ -2773,7 +3055,7 @@
 	# Remove our outputs, but don't remove object files since they
 	# may have been created when compiling PIC objects.
 	removelist=
-	tempremovelist=`echo &quot;$output_objdir/*&quot;`
+	tempremovelist=`$echo &quot;$output_objdir/*&quot;`
 	for p in $tempremovelist; do
 	  case $p in
 	    *.$objext)
@@ -2800,9 +3082,9 @@
 
       # Eliminate all temporary directories.
       for path in $notinst_path; do
-	lib_search_path=`echo &quot;$lib_search_path &quot; | ${SED} -e 's% $path % %g'`
-	deplibs=`echo &quot;$deplibs &quot; | ${SED} -e 's% -L$path % %g'`
-	dependency_libs=`echo &quot;$dependency_libs &quot; | ${SED} -e 's% -L$path % %g'`
+	lib_search_path=`$echo &quot;$lib_search_path &quot; | ${SED} -e 's% $path % %g'`
+	deplibs=`$echo &quot;$deplibs &quot; | ${SED} -e 's% -L$path % %g'`
+	dependency_libs=`$echo &quot;$dependency_libs &quot; | ${SED} -e 's% -L$path % %g'`
       done
 
       if test -n &quot;$xrpath&quot;; then
@@ -2853,6 +3135,12 @@
 	  *-*-netbsd*)
 	    # Don't link with libc until the a.out ld.so is fixed.
 	    ;;
+	  *-*-freebsd*-gnu*)
+	    # Prevent $arg from being parsed by the freebsd regexp below.
+	    if test &quot;$build_libtool_need_lc&quot; = &quot;yes&quot;; then
+	      deplibs=&quot;$deplibs -lc&quot;
+	    fi
+	    ;;
 	  *-*-openbsd* | *-*-freebsd*)
 	    # Do not include libc due to us having libc/libc_r.
 	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
@@ -2886,7 +3174,7 @@
 	  # This might be a little naive.  We might want to check
 	  # whether the library exists or not.  But this is on
 	  # osf3 &amp; osf4 and I'm not really sure... Just
-	  # implementing what was already the behaviour.
+	  # implementing what was already the behavior.
 	  newdeplibs=$deplibs
 	  ;;
 	test_compile)
@@ -2905,62 +3193,82 @@
 	    for i in $deplibs; do
 	      name=&quot;`expr $i : '-l\(.*\)'`&quot;
 	      # If $name is empty we are operating on a -L argument.
-             if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test &quot;$name&quot; -ne &quot;0&quot;; then
-		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-		deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
-		set dummy $deplib_matches
-		deplib_match=$2
-		if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
-		  newdeplibs=&quot;$newdeplibs $i&quot;
-		else
-		  droppeddeps=yes
-		  echo
-		  echo &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
-		  echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		  echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		  echo &quot;*** shared version of the library, which I believe you do not have&quot;
-		  echo &quot;*** because a test_compile did reveal that the linker did not use it for&quot;
-		  echo &quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;
+              if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test &quot;$name&quot; -ne &quot;0&quot;; then
+		if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		  case &quot; $predeps $postdeps &quot; in
+		  *&quot; $i &quot;*)
+		    newdeplibs=&quot;$newdeplibs $i&quot;
+		    i=&quot;&quot;
+		    ;;
+		  esac
+	        fi
+		if test -n &quot;$i&quot; ; then
+		  libname=`eval \\$echo \&quot;$libname_spec\&quot;`
+		  deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
+		  set dummy $deplib_matches
+		  deplib_match=$2
+		  if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
+		    newdeplibs=&quot;$newdeplibs $i&quot;
+		  else
+		    droppeddeps=yes
+		    $echo
+		    $echo &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
+		    $echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		    $echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		    $echo &quot;*** shared version of the library, which I believe you do not have&quot;
+		    $echo &quot;*** because a test_compile did reveal that the linker did not use it for&quot;
+		    $echo &quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;
+		  fi
 		fi
 	      else
 		newdeplibs=&quot;$newdeplibs $i&quot;
 	      fi
 	    done
 	  else
-	    # Error occured in the first compile.  Let's try to salvage
+	    # Error occurred in the first compile.  Let's try to salvage
 	    # the situation: Compile a separate program for each library.
 	    for i in $deplibs; do
 	      name=&quot;`expr $i : '-l\(.*\)'`&quot;
-	     # If $name is empty we are operating on a -L argument.
-             if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
+	      # If $name is empty we are operating on a -L argument.
+              if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
 		$rm conftest
 		$LTCC -o conftest conftest.c $i
 		# Did it work?
 		if test &quot;$?&quot; -eq 0 ; then
 		  ldd_output=`ldd conftest`
-		  libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-		  deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
-		  set dummy $deplib_matches
-		  deplib_match=$2
-		  if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
-		    newdeplibs=&quot;$newdeplibs $i&quot;
-		  else
-		    droppeddeps=yes
-		    echo
-		    echo &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
-		    echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		    echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		    echo &quot;*** shared version of the library, which you do not appear to have&quot;
-		    echo &quot;*** because a test_compile did reveal that the linker did not use this one&quot;
-		    echo &quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;
+		  if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		    case &quot; $predeps $postdeps &quot; in
+		    *&quot; $i &quot;*)
+		      newdeplibs=&quot;$newdeplibs $i&quot;
+		      i=&quot;&quot;
+		      ;;
+		    esac
+		  fi
+		  if test -n &quot;$i&quot; ; then
+		    libname=`eval \\$echo \&quot;$libname_spec\&quot;`
+		    deplib_matches=`eval \\$echo \&quot;$library_names_spec\&quot;`
+		    set dummy $deplib_matches
+		    deplib_match=$2
+		    if test `expr &quot;$ldd_output&quot; : &quot;.*$deplib_match&quot;` -ne 0 ; then
+		      newdeplibs=&quot;$newdeplibs $i&quot;
+		    else
+		      droppeddeps=yes
+		      $echo
+		      $echo &quot;*** Warning: dynamic linker does not accept needed library $i.&quot;
+		      $echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		      $echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		      $echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		      $echo &quot;*** because a test_compile did reveal that the linker did not use this one&quot;
+		      $echo &quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;
+		    fi
 		  fi
 		else
 		  droppeddeps=yes
-		  echo
-		  echo &quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;
-		  echo &quot;***  make it link in!  You will probably need to install it or some&quot;
-		  echo &quot;*** library that it depends on before this library will be fully&quot;
-		  echo &quot;*** functional.  Installing it before continuing would be even better.&quot;
+		  $echo
+		  $echo &quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;
+		  $echo &quot;***  make it link in!  You will probably need to install it or some&quot;
+		  $echo &quot;*** library that it depends on before this library will be fully&quot;
+		  $echo &quot;*** functional.  Installing it before continuing would be even better.&quot;
 		fi
 	      else
 		newdeplibs=&quot;$newdeplibs $i&quot;
@@ -2974,11 +3282,20 @@
 	  for a_deplib in $deplibs; do
 	    name=&quot;`expr $a_deplib : '-l\(.*\)'`&quot;
 	    # If $name is empty we are operating on a -L argument.
-           if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test  &quot;$name&quot; != &quot;0&quot;; then
-	      libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-	      for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		    potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
-		    for potent_lib in $potential_libs; do
+            if test &quot;$name&quot; != &quot;&quot; &amp;&amp; test  &quot;$name&quot; != &quot;0&quot;; then
+	      if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		case &quot; $predeps $postdeps &quot; in
+		*&quot; $a_deplib &quot;*)
+		  newdeplibs=&quot;$newdeplibs $a_deplib&quot;
+		  a_deplib=&quot;&quot;
+		  ;;
+		esac
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
+		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
+		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
+		  for potent_lib in $potential_libs; do
 		      # Follow soft links.
 		      if ls -lLd &quot;$potent_lib&quot; 2&gt;/dev/null \
 			 | grep &quot; -&gt; &quot; &gt;/dev/null; then
@@ -2999,26 +3316,27 @@
 		      done
 		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null \
 			 | ${SED} 10q \
-			 | egrep &quot;$file_magic_regex&quot; &gt; /dev/null; then
+			 | $EGREP &quot;$file_magic_regex&quot; &gt; /dev/null; then
 			newdeplibs=&quot;$newdeplibs $a_deplib&quot;
 			a_deplib=&quot;&quot;
 			break 2
 		      fi
-		    done
-	      done
+		  done
+		done
+	      fi
 	      if test -n &quot;$a_deplib&quot; ; then
 		droppeddeps=yes
-		echo
-		echo &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
-		echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		echo &quot;*** shared version of the library, which you do not appear to have&quot;
-		echo &quot;*** because I did check the linker path looking for a file starting&quot;
+		$echo
+		$echo &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
+		$echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		$echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		$echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		$echo &quot;*** because I did check the linker path looking for a file starting&quot;
 		if test -z &quot;$potlib&quot; ; then
-		  echo &quot;*** with $libname but no candidates were found. (...for file magic test)&quot;
+		  $echo &quot;*** with $libname but no candidates were found. (...for file magic test)&quot;
 		else
-		  echo &quot;*** with $libname and none of the candidates passed a file format test&quot;
-		  echo &quot;*** using a file magic. Last file checked: $potlib&quot;
+		  $echo &quot;*** with $libname and none of the candidates passed a file format test&quot;
+		  $echo &quot;*** using a file magic. Last file checked: $potlib&quot;
 		fi
 	      fi
 	    else
@@ -3034,33 +3352,43 @@
 	    name=&quot;`expr $a_deplib : '-l\(.*\)'`&quot;
 	    # If $name is empty we are operating on a -L argument.
 	    if test -n &quot;$name&quot; &amp;&amp; test &quot;$name&quot; != &quot;0&quot;; then
-	      libname=`eval \\$echo \&quot;$libname_spec\&quot;`
-	      for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
-		potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
-		for potent_lib in $potential_libs; do
-		  potlib=&quot;$potent_lib&quot; # see symlink-check above in file_magic test
-		  if eval echo \&quot;$potent_lib\&quot; 2&gt;/dev/null \
-		      | ${SED} 10q \
-		      | egrep &quot;$match_pattern_regex&quot; &gt; /dev/null; then
-		    newdeplibs=&quot;$newdeplibs $a_deplib&quot;
-		    a_deplib=&quot;&quot;
-		    break 2
-		  fi
+	      if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+		case &quot; $predeps $postdeps &quot; in
+		*&quot; $a_deplib &quot;*)
+		  newdeplibs=&quot;$newdeplibs $a_deplib&quot;
+		  a_deplib=&quot;&quot;
+		  ;;
+		esac
+	      fi
+	      if test -n &quot;$a_deplib&quot; ; then
+		libname=`eval \\$echo \&quot;$libname_spec\&quot;`
+		for i in $lib_search_path $sys_lib_search_path $shlib_search_path; do
+		  potential_libs=`ls $i/$libname[.-]* 2&gt;/dev/null`
+		  for potent_lib in $potential_libs; do
+		    potlib=&quot;$potent_lib&quot; # see symlink-check above in file_magic test
+		    if eval $echo \&quot;$potent_lib\&quot; 2&gt;/dev/null \
+		        | ${SED} 10q \
+		        | $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
+		      newdeplibs=&quot;$newdeplibs $a_deplib&quot;
+		      a_deplib=&quot;&quot;
+		      break 2
+		    fi
+		  done
 		done
-	      done
+	      fi
 	      if test -n &quot;$a_deplib&quot; ; then
 		droppeddeps=yes
-		echo
-		echo &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
-		echo &quot;*** I have the capability to make that library automatically link in when&quot;
-		echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
-		echo &quot;*** shared version of the library, which you do not appear to have&quot;
-		echo &quot;*** because I did check the linker path looking for a file starting&quot;
+		$echo
+		$echo &quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;
+		$echo &quot;*** I have the capability to make that library automatically link in when&quot;
+		$echo &quot;*** you link to this library.  But I can only do this if you have a&quot;
+		$echo &quot;*** shared version of the library, which you do not appear to have&quot;
+		$echo &quot;*** because I did check the linker path looking for a file starting&quot;
 		if test -z &quot;$potlib&quot; ; then
-		  echo &quot;*** with $libname but no candidates were found. (...for regex pattern test)&quot;
+		  $echo &quot;*** with $libname but no candidates were found. (...for regex pattern test)&quot;
 		else
-		  echo &quot;*** with $libname and none of the candidates passed a file format test&quot;
-		  echo &quot;*** using a regex pattern. Last file checked: $potlib&quot;
+		  $echo &quot;*** with $libname and none of the candidates passed a file format test&quot;
+		  $echo &quot;*** using a regex pattern. Last file checked: $potlib&quot;
 		fi
 	      fi
 	    else
@@ -3071,16 +3399,23 @@
 	  ;;
 	none | unknown | *)
 	  newdeplibs=&quot;&quot;
-	  if $echo &quot;X $deplibs&quot; | $Xsed -e 's/ -lc$//' \
-	       -e 's/ -[LR][^ ]*//g' -e 's/[ 	]//g' |
-	     grep . &gt;/dev/null; then
-	    echo
+	  tmp_deplibs=`$echo &quot;X $deplibs&quot; | $Xsed -e 's/ -lc$//' \
+	    -e 's/ -[LR][^ ]*//g'`
+	  if test &quot;X$allow_libtool_libs_with_static_runtimes&quot; = &quot;Xyes&quot; ; then
+	    for i in $predeps $postdeps ; do
+	      # can't use Xsed below, because $i might contain '/'
+	      tmp_deplibs=`$echo &quot;X $tmp_deplibs&quot; | ${SED} -e &quot;1s,^X,,&quot; -e &quot;s,$i,,&quot;`
+	    done
+	  fi
+	  if $echo &quot;X $tmp_deplibs&quot; | $Xsed -e 's/[ 	]//g' \
+	    | grep . &gt;/dev/null; then
+	    $echo
 	    if test &quot;X$deplibs_check_method&quot; = &quot;Xnone&quot;; then
-	      echo &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
+	      $echo &quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;
 	    else
-	      echo &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
+	      $echo &quot;*** Warning: inter-library dependencies are not known to be supported.&quot;
 	    fi
-	    echo &quot;*** All declared inter-library dependencies are being dropped.&quot;
+	    $echo &quot;*** All declared inter-library dependencies are being dropped.&quot;
 	    droppeddeps=yes
 	  fi
 	  ;;
@@ -3100,17 +3435,17 @@
 
 	if test &quot;$droppeddeps&quot; = yes; then
 	  if test &quot;$module&quot; = yes; then
-	    echo
-	    echo &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
-	    echo &quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;
-	    echo &quot;*** a static module, that should work as long as the dlopening&quot;
-	    echo &quot;*** application is linked with the -dlopen flag.&quot;
+	    $echo
+	    $echo &quot;*** Warning: libtool could not satisfy all declared inter-library&quot;
+	    $echo &quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;
+	    $echo &quot;*** a static module, that should work as long as the dlopening&quot;
+	    $echo &quot;*** application is linked with the -dlopen flag.&quot;
 	    if test -z &quot;$global_symbol_pipe&quot;; then
-	      echo
-	      echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
-	      echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
-	      echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
-	      echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
+	      $echo
+	      $echo &quot;*** However, this would only work if libtool was able to extract symbol&quot;
+	      $echo &quot;*** lists from a program, using \`nm' or equivalent, but libtool could&quot;
+	      $echo &quot;*** not find such a program.  So, this module is probably useless.&quot;
+	      $echo &quot;*** \`nm' from GNU binutils and a full rebuild may help.&quot;
 	    fi
 	    if test &quot;$build_old_libs&quot; = no; then
 	      oldlibs=&quot;$output_objdir/$libname.$libext&quot;
@@ -3120,16 +3455,16 @@
 	      build_libtool_libs=no
 	    fi
 	  else
-	    echo &quot;*** The inter-library dependencies that have been dropped here will be&quot;
-	    echo &quot;*** automatically added whenever a program is linked with this library&quot;
-	    echo &quot;*** or is declared to -dlopen it.&quot;
+	    $echo &quot;*** The inter-library dependencies that have been dropped here will be&quot;
+	    $echo &quot;*** automatically added whenever a program is linked with this library&quot;
+	    $echo &quot;*** or is declared to -dlopen it.&quot;
 
 	    if test &quot;$allow_undefined&quot; = no; then
-	      echo
-	      echo &quot;*** Since this library must not contain undefined symbols,&quot;
-	      echo &quot;*** because either the platform does not support them or&quot;
-	      echo &quot;*** it was explicitly requested with -no-undefined,&quot;
-	      echo &quot;*** libtool will only create a static version of it.&quot;
+	      $echo
+	      $echo &quot;*** Since this library must not contain undefined symbols,&quot;
+	      $echo &quot;*** because either the platform does not support them or&quot;
+	      $echo &quot;*** it was explicitly requested with -no-undefined,&quot;
+	      $echo &quot;*** libtool will only create a static version of it.&quot;
 	      if test &quot;$build_old_libs&quot; = no; then
 		oldlibs=&quot;$output_objdir/$libname.$libext&quot;
 		build_libtool_libs=module
@@ -3187,7 +3522,11 @@
 	  if test -n &quot;$hardcode_libdir_separator&quot; &amp;&amp;
 	     test -n &quot;$hardcode_libdirs&quot;; then
 	    libdir=&quot;$hardcode_libdirs&quot;
-	    eval dep_rpath=\&quot;$hardcode_libdir_flag_spec\&quot;
+	    if test -n &quot;$hardcode_libdir_flag_spec_ld&quot;; then
+	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec_ld\&quot;
+	    else
+	      eval dep_rpath=\&quot;$hardcode_libdir_flag_spec\&quot;
+	    fi
 	  fi
 	  if test -n &quot;$runpath_var&quot; &amp;&amp; test -n &quot;$perm_rpath&quot;; then
 	    # We should set the runpath_var.
@@ -3207,6 +3546,7 @@
 	fi
 
 	# Get the real and link names of the library.
+	eval shared_ext=\&quot;$shrext\&quot;
 	eval library_names=\&quot;$library_names_spec\&quot;
 	set dummy $library_names
 	realname=&quot;$2&quot;
@@ -3240,13 +3580,21 @@
 	    save_ifs=&quot;$IFS&quot;; IFS='~'
 	    for cmd in $cmds; do
 	      IFS=&quot;$save_ifs&quot;
-	      $show &quot;$cmd&quot;
-	      $run eval &quot;$cmd&quot; || exit $?
+	      if len=`expr &quot;X$cmd&quot; : &quot;.*&quot;` &amp;&amp;
+	       test &quot;$len&quot; -le &quot;$max_cmd_len&quot; || test &quot;$max_cmd_len&quot; -le -1; then
+	        $show &quot;$cmd&quot;
+	        $run eval &quot;$cmd&quot; || exit $?
+	        skipped_export=false
+	      else
+	        # The command line is too long to execute in one step.
+	        $show &quot;using reloadable object file for export list...&quot;
+	        skipped_export=:
+	      fi
 	    done
 	    IFS=&quot;$save_ifs&quot;
 	    if test -n &quot;$export_symbols_regex&quot;; then
-	      $show &quot;egrep -e \&quot;$export_symbols_regex\&quot; \&quot;$export_symbols\&quot; &gt; \&quot;${export_symbols}T\&quot;&quot;
-	      $run eval 'egrep -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;'
+	      $show &quot;$EGREP -e \&quot;$export_symbols_regex\&quot; \&quot;$export_symbols\&quot; &gt; \&quot;${export_symbols}T\&quot;&quot;
+	      $run eval '$EGREP -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;'
 	      $show &quot;$mv \&quot;${export_symbols}T\&quot; \&quot;$export_symbols\&quot;&quot;
 	      $run eval '$mv &quot;${export_symbols}T&quot; &quot;$export_symbols&quot;'
 	    fi
@@ -3257,6 +3605,17 @@
 	  $run eval '$echo &quot;X$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$export_symbols&quot;'
 	fi
 
+	tmp_deplibs=
+	for test_deplib in $deplibs; do
+		case &quot; $convenience &quot; in
+		*&quot; $test_deplib &quot;*) ;;
+		*) 
+			tmp_deplibs=&quot;$tmp_deplibs $test_deplib&quot;
+			;;
+		esac
+	done
+	deplibs=&quot;$tmp_deplibs&quot; 
+
 	if test -n &quot;$convenience&quot;; then
 	  if test -n &quot;$whole_archive_flag_spec&quot;; then
 	    save_libobjs=$libobjs
@@ -3290,8 +3649,34 @@
 	      if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
 		exit $status
 	      fi
+	      # We will extract separately just the conflicting names and we will no
+	      # longer touch any unique names. It is faster to leave these extract
+	      # automatically by $AR in one run.
 	      $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
 	      $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
+	      if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+		:
+	      else
+		$echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
+		$echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
+		$AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
+		do
+		  i=1
+		  while test &quot;$i&quot; -le &quot;$count&quot;
+		  do
+		   # Put our $i before any first dot (extension)
+		   # Never overwrite any file
+		   name_to=&quot;$name&quot;
+		   while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
+		   do
+		     name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
+		   done
+		   $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
+		   $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
+		   i=`expr $i + 1`
+		  done
+		done
+	      fi
 
 	      libobjs=&quot;$libobjs &quot;`find $xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
 	    done
@@ -3318,13 +3703,21 @@
 	#linker_flags=&quot;$linker_flags $add_flags&quot;
 
 	# Do each of the archive commands.
+	if test &quot;$module&quot; = yes &amp;&amp; test -n &quot;$module_cmds&quot; ; then
+	  if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$module_expsym_cmds&quot;; then
+	    eval cmds=\&quot;$module_expsym_cmds\&quot;
+	  else
+	    eval cmds=\&quot;$module_cmds\&quot;
+	  fi
+	else
 	if test -n &quot;$export_symbols&quot; &amp;&amp; test -n &quot;$archive_expsym_cmds&quot;; then
 	  eval cmds=\&quot;$archive_expsym_cmds\&quot;
 	else
 	  eval cmds=\&quot;$archive_cmds\&quot;
+	  fi
 	fi
 
-	if len=`expr &quot;X$cmds&quot; : &quot;.*&quot;` &amp;&amp;
+	if test &quot;X$skipped_export&quot; != &quot;X:&quot; &amp;&amp; len=`expr &quot;X$cmds&quot; : &quot;.*&quot;` &amp;&amp;
 	   test &quot;$len&quot; -le &quot;$max_cmd_len&quot; || test &quot;$max_cmd_len&quot; -le -1; then
 	  :
 	else
@@ -3385,6 +3778,15 @@
 	  test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
 	  eval concat_cmds=\&quot;\${concat_cmds}$reload_cmds $objlist $last_robj\&quot;
 
+	  if ${skipped_export-false}; then
+	    $show &quot;generating symbol list for \`$libname.la'&quot;
+	    export_symbols=&quot;$output_objdir/$libname.exp&quot;
+	    $run $rm $export_symbols
+	    libobjs=$output
+	    # Append the command to create the export file.
+	    eval concat_cmds=\&quot;\$concat_cmds~$export_symbols_cmds\&quot;
+          fi
+
 	  # Set up a command to remove the reloadale object files
 	  # after they are used.
 	  i=0
@@ -3541,8 +3943,34 @@
 	    if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
 	      exit $status
 	    fi
+	    # We will extract separately just the conflicting names and we will no
+	    # longer touch any unique names. It is faster to leave these extract
+	    # automatically by $AR in one run.
 	    $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
 	    $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
+	    if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+	      :
+	    else
+	      $echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
+	      $echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
+	      $AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
+	      do
+		i=1
+		while test &quot;$i&quot; -le &quot;$count&quot;
+		do
+		 # Put our $i before any first dot (extension)
+		 # Never overwrite any file
+		 name_to=&quot;$name&quot;
+		 while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
+		 do
+		   name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
+		 done
+		 $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
+		 $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
+		 i=`expr $i + 1`
+		done
+	      done
+	    fi
 
 	    reload_conv_objs=&quot;$reload_objs &quot;`find $xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
 	  done
@@ -3609,7 +4037,7 @@
 
     prog)
       case $host in
-	*cygwin*) output=`echo $output | ${SED} -e 's,.exe$,,;s,$,.exe,'` ;;
+	*cygwin*) output=`$echo $output | ${SED} -e 's,.exe$,,;s,$,.exe,'` ;;
       esac
       if test -n &quot;$vinfo&quot;; then
 	$echo &quot;$modename: warning: \`-version-info' is ignored for programs&quot; 1&gt;&amp;2
@@ -3634,6 +4062,16 @@
 	;;
       esac
 
+      case $host in
+      *darwin*)
+        # Don't allow lazy linking, it breaks C++ global constructors
+        if test &quot;$tagname&quot; = CXX ; then
+        compile_command=&quot;$compile_command ${wl}-bind_at_load&quot;
+        finalize_command=&quot;$finalize_command ${wl}-bind_at_load&quot;
+        fi
+        ;;
+      esac
+
       compile_command=&quot;$compile_command $compile_deplibs&quot;
       finalize_command=&quot;$finalize_command $finalize_deplibs&quot;
 
@@ -3784,12 +4222,12 @@
 	    done
 
 	    if test -n &quot;$exclude_expsyms&quot;; then
-	      $run eval 'egrep -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      $run eval '$EGREP -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
 	      $run eval '$mv &quot;$nlist&quot;T &quot;$nlist&quot;'
 	    fi
 
 	    if test -n &quot;$export_symbols_regex&quot;; then
-	      $run eval 'egrep -e &quot;$export_symbols_regex&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      $run eval '$EGREP -e &quot;$export_symbols_regex&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
 	      $run eval '$mv &quot;$nlist&quot;T &quot;$nlist&quot;'
 	    fi
 
@@ -3807,8 +4245,8 @@
 
 	  for arg in $dlprefiles; do
 	    $show &quot;extracting global C symbols from \`$arg'&quot;
-	    name=`echo &quot;$arg&quot; | ${SED} -e 's%^.*/%%'`
-	    $run eval 'echo &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
+	    name=`$echo &quot;$arg&quot; | ${SED} -e 's%^.*/%%'`
+	    $run eval '$echo &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;'
 	    $run eval &quot;$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'&quot;
 	  done
 
@@ -3817,12 +4255,18 @@
 	    test -f &quot;$nlist&quot; || : &gt; &quot;$nlist&quot;
 
 	    if test -n &quot;$exclude_expsyms&quot;; then
-	      egrep -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T
+	      $EGREP -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T
 	      $mv &quot;$nlist&quot;T &quot;$nlist&quot;
 	    fi
 
 	    # Try sorting and uniquifying the output.
-	    if grep -v &quot;^: &quot; &lt; &quot;$nlist&quot; | sort +2 | uniq &gt; &quot;$nlist&quot;S; then
+	    if grep -v &quot;^: &quot; &lt; &quot;$nlist&quot; |
+		if sort -k 3 &lt;/dev/null &gt;/dev/null 2&gt;&amp;1; then
+		  sort -k 3
+		else
+		  sort +2
+		fi |
+		uniq &gt; &quot;$nlist&quot;S; then
 	      :
 	    else
 	      grep -v &quot;^: &quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;S
@@ -3831,7 +4275,7 @@
 	    if test -f &quot;$nlist&quot;S; then
 	      eval &quot;$global_symbol_to_cdecl&quot;' &lt; &quot;$nlist&quot;S &gt;&gt; &quot;$output_objdir/$dlsyms&quot;'
 	    else
-	      echo '/* NONE */' &gt;&gt; &quot;$output_objdir/$dlsyms&quot;
+	      $echo '/* NONE */' &gt;&gt; &quot;$output_objdir/$dlsyms&quot;
 	    fi
 
 	    $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
@@ -4075,13 +4519,228 @@
 	# win32 will think the script is a binary if it has
 	# a .exe suffix, so we strip it off here.
 	case $output in
-	  *.exe) output=`echo $output|${SED} 's,.exe$,,'` ;;
+	  *.exe) output=`$echo $output|${SED} 's,.exe$,,'` ;;
 	esac
 	# test for cygwin because mv fails w/o .exe extensions
 	case $host in
-	  *cygwin*) exeext=.exe ;;
+	  *cygwin*)
+	    exeext=.exe
+	    outputname=`$echo $outputname|${SED} 's,.exe$,,'` ;;
 	  *) exeext= ;;
 	esac
+	case $host in
+	  *cygwin* | *mingw* )
+	    cwrappersource=`$echo ${objdir}/lt-${output}.c`
+	    cwrapper=`$echo ${output}.exe`
+	    $rm $cwrappersource $cwrapper
+	    trap &quot;$rm $cwrappersource $cwrapper; exit 1&quot; 1 2 15
+
+	    cat &gt; $cwrappersource &lt;&lt;EOF
+
+/* $cwrappersource - temporary wrapper executable for $objdir/$outputname
+   Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
+
+   The $output program cannot be directly executed until all the libtool
+   libraries that it depends on are installed.
+   
+   This wrapper executable should never be moved out of the build directory.
+   If it is, it will not operate correctly.
+
+   Currently, it simply execs the wrapper *script* &quot;/bin/sh $output&quot;,
+   but could eventually absorb all of the scripts functionality and
+   exec $objdir/$outputname directly.
+*/
+EOF
+	    cat &gt;&gt; $cwrappersource&lt;&lt;&quot;EOF&quot;
+#include &lt;stdio.h&gt;
+#include &lt;stdlib.h&gt;
+#include &lt;unistd.h&gt;
+#include &lt;malloc.h&gt;
+#include &lt;stdarg.h&gt;
+#include &lt;assert.h&gt;
+
+#if defined(PATH_MAX)
+# define LT_PATHMAX PATH_MAX
+#elif defined(MAXPATHLEN)
+# define LT_PATHMAX MAXPATHLEN
+#else
+# define LT_PATHMAX 1024
+#endif
+
+#ifndef DIR_SEPARATOR
+#define DIR_SEPARATOR '/'
+#endif
+
+#if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \
+  defined (__OS2__)
+#define HAVE_DOS_BASED_FILE_SYSTEM
+#ifndef DIR_SEPARATOR_2 
+#define DIR_SEPARATOR_2 '\\'
+#endif
+#endif
+
+#ifndef DIR_SEPARATOR_2
+# define IS_DIR_SEPARATOR(ch) ((ch) == DIR_SEPARATOR)
+#else /* DIR_SEPARATOR_2 */
+# define IS_DIR_SEPARATOR(ch) \
+        (((ch) == DIR_SEPARATOR) || ((ch) == DIR_SEPARATOR_2))
+#endif /* DIR_SEPARATOR_2 */
+
+#define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))
+#define XFREE(stale) do { \
+  if (stale) { free ((void *) stale); stale = 0; } \
+} while (0)
+
+const char *program_name = NULL;
+
+void * xmalloc (size_t num);
+char * xstrdup (const char *string);
+char * basename (const char *name);
+char * fnqualify(const char *path);
+char * strendzap(char *str, const char *pat);
+void lt_fatal (const char *message, ...);
+
+int
+main (int argc, char *argv[])
+{
+  char **newargz;
+  int i;
+  
+  program_name = (char *) xstrdup ((char *) basename (argv[0]));
+  newargz = XMALLOC(char *, argc+2);
+EOF
+
+	    cat &gt;&gt; $cwrappersource &lt;&lt;EOF
+  newargz[0] = &quot;$SHELL&quot;;
+EOF
+
+	    cat &gt;&gt; $cwrappersource &lt;&lt;&quot;EOF&quot;
+  newargz[1] = fnqualify(argv[0]);
+  /* we know the script has the same name, without the .exe */
+  /* so make sure newargz[1] doesn't end in .exe */
+  strendzap(newargz[1],&quot;.exe&quot;); 
+  for (i = 1; i &lt; argc; i++)
+    newargz[i+1] = xstrdup(argv[i]);
+  newargz[argc+1] = NULL;
+EOF
+
+	    cat &gt;&gt; $cwrappersource &lt;&lt;EOF
+  execv(&quot;$SHELL&quot;,newargz);
+EOF
+
+	    cat &gt;&gt; $cwrappersource &lt;&lt;&quot;EOF&quot;
+}
+
+void *
+xmalloc (size_t num)
+{
+  void * p = (void *) malloc (num);
+  if (!p)
+    lt_fatal (&quot;Memory exhausted&quot;);
+
+  return p;
+}
+
+char * 
+xstrdup (const char *string)
+{
+  return string ? strcpy ((char *) xmalloc (strlen (string) + 1), string) : NULL
+;
+}
+
+char *
+basename (const char *name)
+{
+  const char *base;
+
+#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+  /* Skip over the disk name in MSDOS pathnames. */
+  if (isalpha (name[0]) &amp;&amp; name[1] == ':') 
+    name += 2;
+#endif
+
+  for (base = name; *name; name++)
+    if (IS_DIR_SEPARATOR (*name))
+      base = name + 1;
+  return (char *) base;
+}
+
+char * 
+fnqualify(const char *path)
+{
+  size_t size;
+  char *p;
+  char tmp[LT_PATHMAX + 1];
+
+  assert(path != NULL);
+
+  /* Is it qualified already? */
+#if defined (HAVE_DOS_BASED_FILE_SYSTEM)
+  if (isalpha (path[0]) &amp;&amp; path[1] == ':')
+    return xstrdup (path);
+#endif
+  if (IS_DIR_SEPARATOR (path[0]))
+    return xstrdup (path);
+
+  /* prepend the current directory */
+  /* doesn't handle '~' */
+  if (getcwd (tmp, LT_PATHMAX) == NULL)
+    lt_fatal (&quot;getcwd failed&quot;);
+  size = strlen(tmp) + 1 + strlen(path) + 1; /* +2 for '/' and '\0' */
+  p = XMALLOC(char, size);
+  sprintf(p, &quot;%s%c%s&quot;, tmp, DIR_SEPARATOR, path);
+  return p;
+}
+
+char *
+strendzap(char *str, const char *pat) 
+{
+  size_t len, patlen;
+
+  assert(str != NULL);
+  assert(pat != NULL);
+
+  len = strlen(str);
+  patlen = strlen(pat);
+
+  if (patlen &lt;= len)
+  {
+    str += len - patlen;
+    if (strcmp(str, pat) == 0)
+      *str = '\0';
+  }
+  return str;
+}
+
+static void
+lt_error_core (int exit_status, const char * mode, 
+          const char * message, va_list ap)
+{
+  fprintf (stderr, &quot;%s: %s: &quot;, program_name, mode);
+  vfprintf (stderr, message, ap);
+  fprintf (stderr, &quot;.\n&quot;);
+
+  if (exit_status &gt;= 0)
+    exit (exit_status);
+}
+
+void
+lt_fatal (const char *message, ...)
+{
+  va_list ap;
+  va_start (ap, message);
+  lt_error_core (EXIT_FAILURE, &quot;FATAL&quot;, message, ap);
+  va_end (ap);
+}
+EOF
+	  # we should really use a build-platform specific compiler
+	  # here, but OTOH, the wrappers (shell script and this C one)
+	  # are only useful if you want to execute the &quot;real&quot; binary.
+	  # Since the &quot;real&quot; binary is built for $host, then this
+	  # wrapper might as well be built for $host, too.
+	  $run $LTCC -s -o $cwrapper $cwrappersource
+	  ;;
+	esac
 	$rm $output
 	trap &quot;$rm $output; exit 1&quot; 1 2 15
 
@@ -4159,7 +4818,7 @@
 &quot;
 
 	if test &quot;$fast_install&quot; = yes; then
-	  echo &gt;&gt; $output &quot;\
+	  $echo &gt;&gt; $output &quot;\
   program=lt-'$outputname'$exeext
   progdir=\&quot;\$thisdir/$objdir\&quot;
 
@@ -4175,7 +4834,7 @@
       $rm \&quot;\$progdir/\$file\&quot;
     fi&quot;
 
-	  echo &gt;&gt; $output &quot;\
+	  $echo &gt;&gt; $output &quot;\
 
     # relink executable if necessary
     if test -n \&quot;\$relink_command\&quot;; then
@@ -4193,13 +4852,13 @@
     $rm \&quot;\$progdir/\$file\&quot;
   fi&quot;
 	else
-	  echo &gt;&gt; $output &quot;\
+	  $echo &gt;&gt; $output &quot;\
   program='$outputname'
   progdir=\&quot;\$thisdir/$objdir\&quot;
 &quot;
 	fi
 
-	echo &gt;&gt; $output &quot;\
+	$echo &gt;&gt; $output &quot;\
 
   if test -f \&quot;\$progdir/\$program\&quot;; then&quot;
 
@@ -4230,14 +4889,6 @@
       # Run the actual program with our arguments.
 &quot;
 	case $host in
-	# win32 systems need to use the prog path for dll
-	# lookup to work
-	*-*-cygwin* | *-*-pw32*)
-	  $echo &gt;&gt; $output &quot;\
-      exec \$progdir/\$program \${1+\&quot;\$@\&quot;}
-&quot;
-	  ;;
-
 	# Backslashes separate directories on plain windows
 	*-*-mingw | *-*-os2*)
 	  $echo &gt;&gt; $output &quot;\
@@ -4247,11 +4898,7 @@
 
 	*)
 	  $echo &gt;&gt; $output &quot;\
-      # Export the path to the program.
-      PATH=\&quot;\$progdir:\$PATH\&quot;
-      export PATH
-
-      exec \$program \${1+\&quot;\$@\&quot;}
+      exec \$progdir/\$program \${1+\&quot;\$@\&quot;}
 &quot;
 	  ;;
 	esac
@@ -4263,7 +4910,7 @@
     # The program doesn't exist.
     \$echo \&quot;\$0: error: \$progdir/\$program does not exist\&quot; 1&gt;&amp;2
     \$echo \&quot;This script is just a wrapper for \$program.\&quot; 1&gt;&amp;2
-    echo \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
+    $echo \&quot;See the $PACKAGE documentation for more information.\&quot; 1&gt;&amp;2
     exit 1
   fi
 fi\
@@ -4286,7 +4933,6 @@
 	  oldobjs=&quot;$libobjs_save&quot;
 	  build_libtool_libs=no
 	else
-	  #oldobjs=&quot;$oldobjs$old_deplibs $non_pic_objects&quot;
 	  oldobjs=&quot;$old_deplibs $non_pic_objects&quot;
 	fi
 	addlibs=&quot;$old_convenience&quot;
@@ -4322,8 +4968,34 @@
 	  if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
 	    exit $status
 	  fi
+	  # We will extract separately just the conflicting names and we will no
+	  # longer touch any unique names. It is faster to leave these extract
+	  # automatically by $AR in one run.
 	  $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
 	  $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
+	  if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+	    :
+	  else
+	    $echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
+	    $echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
+	    $AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
+	    do
+	      i=1
+	      while test &quot;$i&quot; -le &quot;$count&quot;
+	      do
+	       # Put our $i before any first dot (extension)
+	       # Never overwrite any file
+	       name_to=&quot;$name&quot;
+	       while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
+	       do
+		 name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
+	       done
+	       $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
+	       $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
+	       i=`expr $i + 1`
+	      done
+	    done
+	  fi
 
 	  oldobjs=&quot;$oldobjs &quot;`find $xdir -name \*.${objext} -print -o -name \*.lo -print | $NL2SP`
 	done
@@ -4348,6 +5020,25 @@
 	  objlist=
 	  concat_cmds=
 	  save_oldobjs=$oldobjs
+	  # GNU ar 2.10+ was changed to match POSIX; thus no paths are
+	  # encoded into archives.  This makes 'ar r' malfunction in
+	  # this piecewise linking case whenever conflicting object
+	  # names appear in distinct ar calls; check, warn and compensate.
+	    if (for obj in $save_oldobjs
+	    do
+	      $echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'
+	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+	    :
+	  else
+	    $echo &quot;$modename: warning: object name conflicts; overriding AR_FLAGS to 'cq'&quot; 1&gt;&amp;2
+	    $echo &quot;$modename: warning: to ensure that POSIX-compatible ar will work&quot; 1&gt;&amp;2
+	    AR_FLAGS=cq
+	  fi
+	  # Is there a better way of finding the last object in the list?
+	  for obj in $save_oldobjs
+	  do
+	    last_oldobj=$obj
+	  done  
 	  for obj in $save_oldobjs
 	  do
 	    oldobjs=&quot;$objlist $obj&quot;
@@ -4359,6 +5050,9 @@
 	    else
 	      # the above command should be used before it gets too long
 	      oldobjs=$objlist
+	      if test &quot;$obj&quot; = &quot;$last_oldobj&quot; ; then
+	        RANLIB=$save_RANLIB
+	      fi  
 	      test -z &quot;$concat_cmds&quot; || concat_cmds=$concat_cmds~
 	      eval concat_cmds=\&quot;\${concat_cmds}$old_archive_cmds\&quot;
 	      objlist=
@@ -4366,7 +5060,11 @@
 	  done
 	  RANLIB=$save_RANLIB
 	  oldobjs=$objlist
-	  eval cmds=\&quot;\$concat_cmds~$old_archive_cmds\&quot;
+	  if test &quot;X$oldobjs&quot; = &quot;X&quot; ; then
+	    eval cmds=\&quot;\$concat_cmds\&quot;
+	  else
+	    eval cmds=\&quot;\$concat_cmds~$old_archive_cmds\&quot;
+	  fi
 	fi
       fi
       save_ifs=&quot;$IFS&quot;; IFS='~'
@@ -4402,9 +5100,11 @@
 	fi
       done
       # Quote the link command for shipping.
-      relink_command=&quot;($relink_command; cd `pwd`; $SHELL $0 --mode=relink $libtool_args)&quot;
+      relink_command=&quot;(cd `pwd`; $SHELL $0 --mode=relink $libtool_args @inst_prefix_dir@)&quot;
       relink_command=`$echo &quot;X$relink_command&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
-
+      if test &quot;$hardcode_automatic&quot; = yes ; then
+        relink_command=
+      fi  
       # Only create the output if not a dry run.
       if test -z &quot;$run&quot;; then
 	for installed in no yes; do
@@ -4457,7 +5157,7 @@
 	  # place dlname in correct position for cygwin
 	  tdlname=$dlname
 	  case $host,$output,$installed,$module,$dlname in
-	    *cygwin*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
+	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
 	  esac
 	  $echo &gt; $output &quot;\
 # $outputname - a libtool library file
@@ -4486,6 +5186,9 @@
 # Is this an already installed library?
 installed=$installed
 
+# Should we warn about portability when linking against -modules?
+shouldnotlink=$module
+
 # Files to dlopen/dlpreopen
 dlopen='$dlfiles'
 dlpreopen='$dlprefiles'
@@ -4668,7 +5371,7 @@
 
       *.la)
 	# Check to see that this really is a libtool archive.
-	if (${SED} -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
+	if (${SED} -e '2q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
 	else
 	  $echo &quot;$modename: \`$file' is not a valid libtool archive&quot; 1&gt;&amp;2
 	  $echo &quot;$help&quot; 1&gt;&amp;2
@@ -4703,12 +5406,33 @@
 	dir=&quot;$dir$objdir&quot;
 
 	if test -n &quot;$relink_command&quot;; then
+	  # Determine the prefix the user has applied to our future dir.
+	  inst_prefix_dir=`$echo &quot;$destdir&quot; | $SED &quot;s%$libdir\$%%&quot;`
+
+	  # Don't allow the user to place us outside of our expected
+	  # location b/c this prevents finding dependent libraries that
+	  # are installed to the same prefix.
+	  # At present, this check doesn't affect windows .dll's that
+	  # are installed into $libdir/../bin (currently, that works fine)
+	  # but it's something to keep an eye on.
+	  if test &quot;$inst_prefix_dir&quot; = &quot;$destdir&quot;; then
+	    $echo &quot;$modename: error: cannot install \`$file' to a directory not ending in $libdir&quot; 1&gt;&amp;2
+	    exit 1
+	  fi
+
+	  if test -n &quot;$inst_prefix_dir&quot;; then
+	    # Stick the inst_prefix_dir data into the link command.
+	    relink_command=`$echo &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;`
+	  else
+	    relink_command=`$echo &quot;$relink_command&quot; | $SED &quot;s%@inst_prefix_dir@%%&quot;`
+	  fi
+
 	  $echo &quot;$modename: warning: relinking \`$file'&quot; 1&gt;&amp;2
 	  $show &quot;$relink_command&quot;
 	  if $run eval &quot;$relink_command&quot;; then :
 	  else
 	    $echo &quot;$modename: error: relink \`$file' with the above command before installing it&quot; 1&gt;&amp;2
-	    continue
+	    exit 1
 	  fi
 	fi
 
@@ -4816,23 +5540,43 @@
 	  destfile=&quot;$destdir/$destfile&quot;
 	fi
 
+	# If the file is missing, and there is a .exe on the end, strip it
+	# because it is most likely a libtool script we actually want to
+	# install
+	stripped_ext=&quot;&quot;
+	case $file in
+	  *.exe)
+	    if test ! -f &quot;$file&quot;; then
+	      file=`$echo $file|${SED} 's,.exe$,,'`
+	      stripped_ext=&quot;.exe&quot;
+	    fi
+	    ;;
+	esac
+
 	# Do a test to see if this is really a libtool program.
 	case $host in
 	*cygwin*|*mingw*)
-	    wrapper=`echo $file | ${SED} -e 's,.exe$,,'`
+	    wrapper=`$echo $file | ${SED} -e 's,.exe$,,'`
 	    ;;
 	*)
 	    wrapper=$file
 	    ;;
 	esac
-	if (${SED} -e '4q' $wrapper | egrep &quot;^# Generated by .*$PACKAGE&quot;)&gt;/dev/null 2&gt;&amp;1; then
+	if (${SED} -e '4q' $wrapper | grep &quot;^# Generated by .*$PACKAGE&quot;)&gt;/dev/null 2&gt;&amp;1; then
 	  notinst_deplibs=
 	  relink_command=
 
+	  # To insure that &quot;foo&quot; is sourced, and not &quot;foo.exe&quot;,
+	  # finese the cygwin/MSYS system by explicitly sourcing &quot;foo.&quot;
+	  # which disallows the automatic-append-.exe behavior.
+	  case $build in
+	  *cygwin* | *mingw*) wrapperdot=${wrapper}. ;;
+	  *) wrapperdot=${wrapper} ;;
+	  esac
 	  # If there is no directory component, then add one.
 	  case $file in
-	  */* | *\\*) . $wrapper ;;
-	  *) . ./$wrapper ;;
+	  */* | *\\*) . ${wrapperdot} ;;
+	  *) . ./${wrapperdot} ;;
 	  esac
 
 	  # Check the variables that should have been set.
@@ -4860,10 +5604,17 @@
 	  done
 
 	  relink_command=
+	  # To insure that &quot;foo&quot; is sourced, and not &quot;foo.exe&quot;,
+	  # finese the cygwin/MSYS system by explicitly sourcing &quot;foo.&quot;
+	  # which disallows the automatic-append-.exe behavior.
+	  case $build in
+	  *cygwin* | *mingw*) wrapperdot=${wrapper}. ;;
+	  *) wrapperdot=${wrapper} ;;
+	  esac
 	  # If there is no directory component, then add one.
 	  case $file in
-	  */* | *\\*) . $file ;;
-	  *) . ./$file ;;
+	  */* | *\\*) . ${wrapperdot} ;;
+	  *) . ./${wrapperdot} ;;
 	  esac
 
 	  outputname=
@@ -4872,12 +5623,12 @@
 	      tmpdir=&quot;/tmp&quot;
 	      test -n &quot;$TMPDIR&quot; &amp;&amp; tmpdir=&quot;$TMPDIR&quot;
 	      tmpdir=&quot;$tmpdir/libtool-$$&quot;
-	      if $mkdir -p &quot;$tmpdir&quot; &amp;&amp; chmod 700 &quot;$tmpdir&quot;; then :
+	      if $mkdir &quot;$tmpdir&quot; &amp;&amp; chmod 700 &quot;$tmpdir&quot;; then :
 	      else
 		$echo &quot;$modename: error: cannot create temporary directory \`$tmpdir'&quot; 1&gt;&amp;2
 		continue
 	      fi
-	      file=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
+	      file=`$echo &quot;X$file$stripped_ext&quot; | $Xsed -e 's%^.*/%%'`
 	      outputname=&quot;$tmpdir/$file&quot;
 	      # Replace the output file specification.
 	      relink_command=`$echo &quot;X$relink_command&quot; | $Xsed -e 's%@OUTPUT@%'&quot;$outputname&quot;'%g'`
@@ -4895,7 +5646,7 @@
 	    fi
 	  else
 	    # Install the binary that we compiled earlier.
-	    file=`$echo &quot;X$file&quot; | $Xsed -e &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
+	    file=`$echo &quot;X$file$stripped_ext&quot; | $Xsed -e &quot;s%\([^/]*\)$%$objdir/\1%&quot;`
 	  fi
 	fi
 
@@ -4911,7 +5662,7 @@
 	    destfile=$destfile.exe
 	    ;;
 	  *:*.exe)
-	    destfile=`echo $destfile | ${SED} -e 's,.exe$,,'`
+	    destfile=`$echo $destfile | ${SED} -e 's,.exe$,,'`
 	    ;;
 	  esac
 	  ;;
@@ -4998,40 +5749,40 @@
     # Exit here if they wanted silent mode.
     exit 0
 
-    echo &quot;----------------------------------------------------------------------&quot;
-    echo &quot;Libraries have been installed in:&quot;
+    $echo &quot;----------------------------------------------------------------------&quot;
+    $echo &quot;Libraries have been installed in:&quot;
     for libdir in $libdirs; do
-      echo &quot;   $libdir&quot;
+      $echo &quot;   $libdir&quot;
     done
-    echo
-    echo &quot;If you ever happen to want to link against installed libraries&quot;
-    echo &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
-    echo &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
-    echo &quot;flag during linking and do at least one of the following:&quot;
+    $echo
+    $echo &quot;If you ever happen to want to link against installed libraries&quot;
+    $echo &quot;in a given directory, LIBDIR, you must either use libtool, and&quot;
+    $echo &quot;specify the full pathname of the library, or use the \`-LLIBDIR'&quot;
+    $echo &quot;flag during linking and do at least one of the following:&quot;
     if test -n &quot;$shlibpath_var&quot;; then
-      echo &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
-      echo &quot;     during execution&quot;
+      $echo &quot;   - add LIBDIR to the \`$shlibpath_var' environment variable&quot;
+      $echo &quot;     during execution&quot;
     fi
     if test -n &quot;$runpath_var&quot;; then
-      echo &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
-      echo &quot;     during linking&quot;
+      $echo &quot;   - add LIBDIR to the \`$runpath_var' environment variable&quot;
+      $echo &quot;     during linking&quot;
     fi
     if test -n &quot;$hardcode_libdir_flag_spec&quot;; then
       libdir=LIBDIR
       eval flag=\&quot;$hardcode_libdir_flag_spec\&quot;
 
-      echo &quot;   - use the \`$flag' linker flag&quot;
+      $echo &quot;   - use the \`$flag' linker flag&quot;
     fi
     if test -n &quot;$admincmds&quot;; then
-      echo &quot;   - have your system administrator run these commands:$admincmds&quot;
+      $echo &quot;   - have your system administrator run these commands:$admincmds&quot;
     fi
     if test -f /etc/ld.so.conf; then
-      echo &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
+      $echo &quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'&quot;
     fi
-    echo
-    echo &quot;See any operating system documentation about shared libraries for&quot;
-    echo &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
-    echo &quot;----------------------------------------------------------------------&quot;
+    $echo
+    $echo &quot;See any operating system documentation about shared libraries for&quot;
+    $echo &quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;
+    $echo &quot;----------------------------------------------------------------------&quot;
     exit 0
     ;;
 
@@ -5059,7 +5810,7 @@
       case $file in
       *.la)
 	# Check to see that this really is a libtool archive.
-	if (${SED} -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
+	if (${SED} -e '2q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then :
 	else
 	  $echo &quot;$modename: \`$lib' is not a valid libtool archive&quot; 1&gt;&amp;2
 	  $echo &quot;$help&quot; 1&gt;&amp;2
@@ -5130,7 +5881,7 @@
       -*) ;;
       *)
 	# Do a test to see if this is really a libtool program.
-	if (${SED} -e '4q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	if (${SED} -e '4q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
 	  # If there is no directory component, then add one.
 	  case $file in
 	  */* | *\\*) . $file ;;
@@ -5153,7 +5904,7 @@
 	eval &quot;export $shlibpath_var&quot;
       fi
 
-      # Restore saved enviroment variables
+      # Restore saved environment variables
       if test &quot;${save_LC_ALL+set}&quot; = set; then
 	LC_ALL=&quot;$save_LC_ALL&quot;; export LC_ALL
       fi
@@ -5203,13 +5954,14 @@
 
     rmdirs=
 
+    origobjdir=&quot;$objdir&quot;
     for file in $files; do
       dir=`$echo &quot;X$file&quot; | $Xsed -e 's%/[^/]*$%%'`
       if test &quot;X$dir&quot; = &quot;X$file&quot;; then
 	dir=.
-	objdir=&quot;$objdir&quot;
+	objdir=&quot;$origobjdir&quot;
       else
-	objdir=&quot;$dir/$objdir&quot;
+	objdir=&quot;$dir/$origobjdir&quot;
       fi
       name=`$echo &quot;X$file&quot; | $Xsed -e 's%^.*/%%'`
       test &quot;$mode&quot; = uninstall &amp;&amp; objdir=&quot;$dir&quot;
@@ -5239,7 +5991,7 @@
       case $name in
       *.la)
 	# Possibly a libtool archive, so verify it.
-	if (${SED} -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	if (${SED} -e '2q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
 	  . $dir/$name
 
 	  # Delete the libtool libraries and symlinks.
@@ -5286,7 +6038,7 @@
 
       *.lo)
 	# Possibly a libtool object, so verify it.
-	if (${SED} -e '2q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	if (${SED} -e '2q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
 
 	  # Read the .lo file
 	  . $dir/$name
@@ -5306,15 +6058,31 @@
 	;;
 
       *)
-	# Do a test to see if this is a libtool program.
-	if test &quot;$mode&quot; = clean &amp;&amp;
-	   (${SED} -e '4q' $file | egrep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
-	  relink_command=
-	  . $dir/$file
+	if test &quot;$mode&quot; = clean ; then
+	  noexename=$name
+	  case $file in
+	  *.exe) 
+	    file=`$echo $file|${SED} 's,.exe$,,'`
+	    noexename=`$echo $name|${SED} 's,.exe$,,'`
+	    # $file with .exe has already been added to rmfiles,
+	    # add $file without .exe
+	    rmfiles=&quot;$rmfiles $file&quot;
+	    ;;
+	  esac
+	  # Do a test to see if this is a libtool program.
+	  if (${SED} -e '4q' $file | grep &quot;^# Generated by .*$PACKAGE&quot;) &gt;/dev/null 2&gt;&amp;1; then
+	    relink_command=
+	    . $dir/$noexename
 
-	  rmfiles=&quot;$rmfiles $objdir/$name $objdir/${name}S.${objext}&quot;
-	  if test &quot;$fast_install&quot; = yes &amp;&amp; test -n &quot;$relink_command&quot;; then
-	    rmfiles=&quot;$rmfiles $objdir/lt-$name&quot;
+	    # note $name still contains .exe if it was in $file originally
+	    # as does the version of $file that was added into $rmfiles
+	    rmfiles=&quot;$rmfiles $objdir/$name $objdir/${name}S.${objext}&quot;
+	    if test &quot;$fast_install&quot; = yes &amp;&amp; test -n &quot;$relink_command&quot;; then
+	      rmfiles=&quot;$rmfiles $objdir/lt-$name&quot;
+	    fi
+	    if test &quot;X$noexename&quot; != &quot;X$name&quot; ; then
+	      rmfiles=&quot;$rmfiles $objdir/lt-${noexename}.c&quot;
+	    fi
 	  fi
 	fi
 	;;
@@ -5322,6 +6090,7 @@
       $show &quot;$rm $rmfiles&quot;
       $run $rm $rmfiles || exit_status=1
     done
+    objdir=&quot;$origobjdir&quot;
 
     # Try to remove the ${objdir}s in the directories where we deleted files
     for dir in $rmdirs; do
@@ -5383,7 +6152,9 @@
       uninstall       remove libraries from an installed directory
 
 MODE-ARGS vary depending on the MODE.  Try \`$modename --help --mode=MODE' for
-a more detailed description of MODE.&quot;
+a more detailed description of MODE.
+
+Report bugs to &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">bug-libtool at gnu.org</A>&gt;.&quot;
   exit 0
   ;;
 
@@ -5541,7 +6312,7 @@
   ;;
 esac
 
-echo
+$echo
 $echo &quot;Try \`$modename --help' for more information about other modes.&quot;
 
 exit 0
@@ -5563,7 +6334,7 @@
 # ### END LIBTOOL TAG CONFIG: disable-shared
 
 # ### BEGIN LIBTOOL TAG CONFIG: disable-static
-build_old_libs=`case $build_libtool_libs in yes) echo no;; *) echo yes;; esac`
+build_old_libs=`case $build_libtool_libs in yes) $echo no;; *) $echo yes;; esac`
 # ### END LIBTOOL TAG CONFIG: disable-static
 
 # Local Variables:
Index: Doxyfile.global
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/Doxyfile.global,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/Doxyfile.global -Ladmin/Doxyfile.global -u -r1.1.1.1 -r1.2
--- admin/Doxyfile.global
+++ admin/Doxyfile.global
@@ -1,4 +1,4 @@
-# Doxyfile 1.2.15
+# Doxyfile 1.3.6
 
 # This file describes the settings to be used by the documentation system
 # doxygen (www.doxygen.org) for a project
@@ -11,7 +11,7 @@
 # Values that contain spaces should be placed between quotes (&quot; &quot;)
 
 #---------------------------------------------------------------------------
-# General configuration options
+# Project related configuration options
 #---------------------------------------------------------------------------
 
 # The PROJECT_NAME tag is a single word (or a sequence of words surrounded 
@@ -36,49 +36,22 @@
 # documentation generated by doxygen is written. Doxygen will use this 
 # information to generate all constant output in the proper language. 
 # The default language is English, other supported languages are: 
-# Brazilian, Chinese, Croatian, Czech, Danish, Dutch, Finnish, French, 
-# German, Greek, Hungarian, Italian, Japanese, Korean, Norwegian, Polish, 
-# Portuguese, Romanian, Russian, Slovak, Slovene, Spanish and Swedish.
+# Brazilian, Catalan, Chinese, Chinese-Traditional, Croatian, Czech, Danish, Dutch, 
+# Finnish, French, German, Greek, Hungarian, Italian, Japanese, Japanese-en 
+# (Japanese with English messages), Korean, Korean-en, Norwegian, Polish, Portuguese, 
+# Romanian, Russian, Serbian, Slovak, Slovene, Spanish, Swedish, and Ukrainian.
 
 OUTPUT_LANGUAGE        = English
 
-# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in 
-# documentation are documented, even if no documentation was available. 
-# Private class members and static file members will be hidden unless 
-# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
-
-EXTRACT_ALL            = NO
-
-# If the EXTRACT_PRIVATE tag is set to YES all private members of a class 
-# will be included in the documentation.
-
-EXTRACT_PRIVATE        = NO
-
-# If the EXTRACT_STATIC tag is set to YES all static members of a file 
-# will be included in the documentation.
-
-EXTRACT_STATIC         = YES
-
-# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs) 
-# defined locally in source files will be included in the documentation. 
-# If set to NO only classes defined in header files are included.
-
-EXTRACT_LOCAL_CLASSES  = NO
-
-# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all 
-# undocumented members of documented classes, files or namespaces. 
-# If set to NO (the default) these members will be included in the 
-# various overviews, but no documentation section is generated. 
-# This option has no effect if EXTRACT_ALL is enabled.
-
-HIDE_UNDOC_MEMBERS     = NO
-
-# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all 
-# undocumented classes that are normally visible in the class hierarchy. 
-# If set to NO (the default) these class will be included in the various 
-# overviews. This option has no effect if EXTRACT_ALL is enabled.
+# This tag can be used to specify the encoding used in the generated output. 
+# The encoding is not always determined by the language that is chosen, 
+# but also whether or not the output is meant for Windows or non-Windows users. 
+# In case there is a difference, setting the USE_WINDOWS_ENCODING tag to YES 
+# forces the Windows encoding (this is the default for the Windows binary), 
+# whereas setting the tag to NO uses a Unix-style encoding (the default for 
+# all platforms other than Windows).
 
-HIDE_UNDOC_CLASSES     = YES
+USE_WINDOWS_ENCODING   = NO
 
 # If the BRIEF_MEMBER_DESC tag is set to YES (the default) Doxygen will 
 # include brief member descriptions after the members that are listed in 
@@ -94,6 +67,17 @@
 
 REPEAT_BRIEF           = YES
 
+# This tag implements a quasi-intelligent brief description abbreviator 
+# that is used to form the text in various listings. Each string 
+# in this list, if found as the leading text of the brief description, will be 
+# stripped from the text and the result after processing the whole list, is used 
+# as the annotated text. Otherwise, the brief description is used as-is. If left 
+# blank, the following values are used (&quot;$name&quot; is automatically replaced with the 
+# name of the entity): &quot;The $name class&quot; &quot;The $name widget&quot; &quot;The $name file&quot; 
+# &quot;is&quot; &quot;provides&quot; &quot;specifies&quot; &quot;contains&quot; &quot;represents&quot; &quot;a&quot; &quot;an&quot; &quot;the&quot;
+
+ABBREVIATE_BRIEF       = 
+
 # If the ALWAYS_DETAILED_SEC and REPEAT_BRIEF tags are both set to YES then 
 # Doxygen will generate a detailed section even if there is only a brief 
 # description.
@@ -114,12 +98,148 @@
 FULL_PATH_NAMES        = NO
 
 # If the FULL_PATH_NAMES tag is set to YES then the STRIP_FROM_PATH tag 
-# can be used to strip a user defined part of the path. Stripping is 
+# can be used to strip a user-defined part of the path. Stripping is 
 # only done if one of the specified strings matches the left-hand part of 
-# the path. It is allowed to use relative paths in the argument list.
+# the path. It is allowed to use relative paths in the argument list. 
+# If left blank the directory from which doxygen is run is used as the 
+# path to strip.
 
 STRIP_FROM_PATH        = 
 
+# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter 
+# (but less readable) file names. This can be useful is your file systems 
+# doesn't support long names like on DOS, Mac, or CD-ROM.
+
+SHORT_NAMES            = NO
+
+# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen 
+# will interpret the first line (until the first dot) of a JavaDoc-style 
+# comment as the brief description. If set to NO, the JavaDoc 
+# comments will behave just like the Qt-style comments (thus requiring an 
+# explicit @brief command for a brief description.
+
+JAVADOC_AUTOBRIEF      = YES
+
+# The MULTILINE_CPP_IS_BRIEF tag can be set to YES to make Doxygen 
+# treat a multi-line C++ special comment block (i.e. a block of //! or /// 
+# comments) as a brief description. This used to be the default behaviour. 
+# The new default is to treat a multi-line C++ comment block as a detailed 
+# description. Set this tag to YES if you prefer the old behaviour instead.
+
+MULTILINE_CPP_IS_BRIEF = NO
+
+# If the DETAILS_AT_TOP tag is set to YES then Doxygen 
+# will output the detailed description near the top, like JavaDoc.
+# If set to NO, the detailed description appears after the member 
+# documentation.
+
+DETAILS_AT_TOP         = NO
+
+# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented 
+# member inherits the documentation from any documented member that it 
+# re-implements.
+
+INHERIT_DOCS           = YES
+
+# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
+# tag is set to YES, then doxygen will reuse the documentation of the first 
+# member in the group (if any) for the other members of the group. By default 
+# all members of a group must be documented explicitly.
+
+DISTRIBUTE_GROUP_DOC   = NO
+
+# The TAB_SIZE tag can be used to set the number of spaces in a tab. 
+# Doxygen uses this value to replace tabs by spaces in code fragments.
+
+TAB_SIZE               = 4
+
+# This tag can be used to specify a number of aliases that acts 
+# as commands in the documentation. An alias has the form &quot;name=value&quot;. 
+# For example adding &quot;sideeffect=\par Side Effects:\n&quot; will allow you to 
+# put the command \sideeffect (or @sideeffect) in the documentation, which 
+# will result in a user-defined paragraph with heading &quot;Side Effects:&quot;. 
+# You can put \n's in the value part of an alias to insert newlines.
+
+ALIASES                = obsolete=@deprecated
+
+# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C sources 
+# only. Doxygen will then generate output that is more tailored for C. 
+# For instance, some of the names that are used will be different. The list 
+# of all members will be omitted, etc.
+
+OPTIMIZE_OUTPUT_FOR_C  = NO
+
+# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java sources 
+# only. Doxygen will then generate output that is more tailored for Java. 
+# For instance, namespaces will be presented as packages, qualified scopes 
+# will look different, etc.
+
+OPTIMIZE_OUTPUT_JAVA   = NO
+
+# Set the SUBGROUPING tag to YES (the default) to allow class member groups of 
+# the same type (for instance a group of public functions) to be put as a 
+# subgroup of that type (e.g. under the Public Functions section). Set it to 
+# NO to prevent subgrouping. Alternatively, this can be done per class using 
+# the \nosubgrouping command.
+
+SUBGROUPING            = YES
+
+#---------------------------------------------------------------------------
+# Build related configuration options
+#---------------------------------------------------------------------------
+
+# If the EXTRACT_ALL tag is set to YES doxygen will assume all entities in 
+# documentation are documented, even if no documentation was available. 
+# Private class members and static file members will be hidden unless 
+# the EXTRACT_PRIVATE and EXTRACT_STATIC tags are set to YES
+
+EXTRACT_ALL            = NO
+
+# If the EXTRACT_PRIVATE tag is set to YES all private members of a class 
+# will be included in the documentation.
+
+EXTRACT_PRIVATE        = NO
+
+# If the EXTRACT_STATIC tag is set to YES all static members of a file 
+# will be included in the documentation.
+
+EXTRACT_STATIC         = YES
+
+# If the EXTRACT_LOCAL_CLASSES tag is set to YES classes (and structs) 
+# defined locally in source files will be included in the documentation. 
+# If set to NO only classes defined in header files are included.
+
+EXTRACT_LOCAL_CLASSES  = NO
+
+# If the HIDE_UNDOC_MEMBERS tag is set to YES, Doxygen will hide all 
+# undocumented members of documented classes, files or namespaces. 
+# If set to NO (the default) these members will be included in the 
+# various overviews, but no documentation section is generated. 
+# This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_MEMBERS     = NO
+
+# If the HIDE_UNDOC_CLASSES tag is set to YES, Doxygen will hide all 
+# undocumented classes that are normally visible in the class hierarchy. 
+# If set to NO (the default) these classes will be included in the various 
+# overviews. This option has no effect if EXTRACT_ALL is enabled.
+
+HIDE_UNDOC_CLASSES     = YES
+
+# If the HIDE_FRIEND_COMPOUNDS tag is set to YES, Doxygen will hide all 
+# friend (class|struct|union) declarations. 
+# If set to NO (the default) these declarations will be included in the 
+# documentation.
+
+HIDE_FRIEND_COMPOUNDS  = NO
+
+# If the HIDE_IN_BODY_DOCS tag is set to YES, Doxygen will hide any 
+# documentation blocks found inside the body of a function. 
+# If set to NO (the default) these blocks will be appended to the 
+# function's detailed documentation block.
+
+HIDE_IN_BODY_DOCS      = NO
+
 # The INTERNAL_DOCS tag determines if documentation 
 # that is typed after a \internal command is included. If the tag is set 
 # to NO (the default) then the documentation will be excluded. 
@@ -127,58 +247,26 @@
 
 INTERNAL_DOCS          = NO
 
-# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct 
-# doxygen to hide any special comment blocks from generated source code 
-# fragments. Normal C and C++ comments will always remain visible.
-
-STRIP_CODE_COMMENTS    = YES
-
 # If the CASE_SENSE_NAMES tag is set to NO then Doxygen will only generate 
-# file names in lower case letters. If set to YES upper case letters are also 
+# file names in lower-case letters. If set to YES upper-case letters are also 
 # allowed. This is useful if you have classes or files whose names only differ 
 # in case and if your file system supports case sensitive file names. Windows 
-# users are adviced to set this option to NO.
+# users are advised to set this option to NO.
 
 CASE_SENSE_NAMES       = YES
 
-# If the SHORT_NAMES tag is set to YES, doxygen will generate much shorter 
-# (but less readable) file names. This can be useful is your file systems 
-# doesn't support long names like on DOS, Mac, or CD-ROM.
-
-SHORT_NAMES            = NO
-
 # If the HIDE_SCOPE_NAMES tag is set to NO (the default) then Doxygen 
 # will show members with their full class and namespace scopes in the 
 # documentation. If set to YES the scope will be hidden.
 
 HIDE_SCOPE_NAMES       = NO
 
-# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen 
-# will generate a verbatim copy of the header file for each class for 
-# which an include is specified. Set to NO to disable this.
-
-VERBATIM_HEADERS       = YES
-
 # If the SHOW_INCLUDE_FILES tag is set to YES (the default) then Doxygen 
-# will put list of the files that are included by a file in the documentation 
+# will put a list of the files that are included by a file in the documentation 
 # of that file.
 
 SHOW_INCLUDE_FILES     = YES
 
-# If the JAVADOC_AUTOBRIEF tag is set to YES then Doxygen 
-# will interpret the first line (until the first dot) of a JavaDoc-style 
-# comment as the brief description. If set to NO, the JavaDoc 
-# comments  will behave just like the Qt-style comments (thus requiring an 
-# explict @brief command for a brief description.
-
-JAVADOC_AUTOBRIEF      = YES
-
-# If the INHERIT_DOCS tag is set to YES (the default) then an undocumented 
-# member inherits the documentation from any documented member that it 
-# reimplements.
-
-INHERIT_DOCS           = YES
-
 # If the INLINE_INFO tag is set to YES (the default) then a tag [inline] 
 # is inserted in the documentation for inline members.
 
@@ -191,17 +279,22 @@
 
 SORT_MEMBER_DOCS       = NO
 
-# If member grouping is used in the documentation and the DISTRIBUTE_GROUP_DOC 
-# tag is set to YES, then doxygen will reuse the documentation of the first 
-# member in the group (if any) for the other members of the group. By default 
-# all members of a group must be documented explicitly.
+# If the SORT_BRIEF_DOCS tag is set to YES then doxygen will sort the 
+# brief documentation of file, namespace and class members alphabetically 
+# by member name. If set to NO (the default) the members will appear in 
+# declaration order.
 
-DISTRIBUTE_GROUP_DOC   = NO
+SORT_BRIEF_DOCS        = NO
 
-# The TAB_SIZE tag can be used to set the number of spaces in a tab. 
-# Doxygen uses this value to replace tabs by spaces in code fragments.
+# If the SORT_BY_SCOPE_NAME tag is set to YES, the class list will be 
+# sorted by fully-qualified names, including namespaces. If set to 
+# NO (the default), the class list will be sorted only by class name, 
+# not including the namespace part. 
+# Note: This option is not very useful if HIDE_SCOPE_NAMES is set to YES.
+# Note: This option applies only to the class list, not to the 
+# alphabetical list.
 
-TAB_SIZE               = 4
+SORT_BY_SCOPE_NAME     = NO
 
 # The GENERATE_TODOLIST tag can be used to enable (YES) or 
 # disable (NO) the todo list. This list is created by putting \todo 
@@ -221,22 +314,11 @@
 
 GENERATE_BUGLIST       = YES
 
-# This tag can be used to specify a number of aliases that acts 
-# as commands in the documentation. An alias has the form &quot;name=value&quot;. 
-# For example adding &quot;sideeffect=\par Side Effects:\n&quot; will allow you to 
-# put the command \sideeffect (or @sideeffect) in the documentation, which 
-# will result in a user defined paragraph with heading &quot;Side Effects:&quot;. 
-# You can put \n's in the value part of an alias to insert newlines.
-
-# @ref in KDE docu are for kdoc, doxygen doesn't need them, so we alias them
-# to nothing here
+# The GENERATE_DEPRECATEDLIST tag can be used to enable (YES) or 
+# disable (NO) the deprecated list. This list is created by putting 
+# \deprecated commands in the documentation.
 
-ALIASES                = libdoc=@mainpage \
-                         sect=&lt;p&gt;&lt;b&gt; \
-                         reimplemented= \
-                         &quot;deprecated=&lt;b&gt;This class or method is obsolete, it is provided for compatibility only.&lt;/b&gt;&quot; \
-                         obsolete=@deprecated \
-			 ref=
+GENERATE_DEPRECATEDLIST= YES
 
 # The ENABLED_SECTIONS tag can be used to enable conditional 
 # documentation sections, marked by \if sectionname ... \endif.
@@ -244,7 +326,7 @@
 ENABLED_SECTIONS       = 
 
 # The MAX_INITIALIZER_LINES tag determines the maximum number of lines 
-# the initial value of a variable or define consist of for it to appear in 
+# the initial value of a variable or define consists of for it to appear in 
 # the documentation. If the initializer consists of more lines than specified 
 # here it will be hidden. Use a value of 0 to hide initializers completely. 
 # The appearance of the initializer of individual variables and defines in the 
@@ -253,20 +335,6 @@
 
 MAX_INITIALIZER_LINES  = 30
 
-# Set the OPTIMIZE_OUTPUT_FOR_C tag to YES if your project consists of C sources 
-# only. Doxygen will then generate output that is more tailored for C. 
-# For instance some of the names that are used will be different. The list 
-# of all members will be omitted, etc.
-
-OPTIMIZE_OUTPUT_FOR_C  = NO
-
-# Set the OPTIMIZE_OUTPUT_JAVA tag to YES if your project consists of Java sources 
-# only. Doxygen will then generate output that is more tailored for Java. 
-# For instance namespaces will be presented as packages, qualified scopes 
-# will look different, etc.
-
-OPTIMIZE_OUTPUT_JAVA   = NO
-
 # Set the SHOW_USED_FILES tag to NO to disable the list of files generated 
 # at the bottom of the documentation of classes and structs. If set to YES the 
 # list will mention the files that were used to generate the documentation.
@@ -286,7 +354,7 @@
 # generated by doxygen. Possible values are YES and NO. If left blank 
 # NO is used.
 
-WARNINGS               = YES
+WARNINGS               = NO
 
 # If WARN_IF_UNDOCUMENTED is set to YES, then doxygen will generate warnings 
 # for undocumented members. If EXTRACT_ALL is set to YES then this flag will 
@@ -294,6 +362,13 @@
 
 WARN_IF_UNDOCUMENTED   = NO
 
+# If WARN_IF_DOC_ERROR is set to YES, doxygen will generate warnings for 
+# potential errors in the documentation, such as not documenting some 
+# parameters in a documented function, or documenting parameters that 
+# don't exist or using markup commands wrongly.
+
+WARN_IF_DOC_ERROR      = YES
+
 # The WARN_FORMAT tag determines the format of the warning messages that 
 # doxygen can produce. The string should contain the $file, $line, and $text 
 # tags, which will be replaced by the file and line number from which the 
@@ -323,12 +398,17 @@
 # and *.h) to filter out the source-files in the directories. If left 
 # blank the following patterns are tested: 
 # *.c *.cc *.cxx *.cpp *.c++ *.java *.ii *.ixx *.ipp *.i++ *.inl *.h *.hh *.hxx *.hpp 
-# *.h++ *.idl *.odl
+# *.h++ *.idl *.odl *.cs *.php *.php3 *.inc
 
 FILE_PATTERNS          = *.h \
                          *.cpp \
                          *.cc \
-                         *.hpp
+                         *.hpp \
+                         *.dox \
+                         *.c++ \
+                         *.cxx \
+                         *.h++ \
+                         *.hh
 
 # The RECURSIVE tag can be used to turn specify whether or not subdirectories 
 # should be searched for input files as well. Possible values are YES and NO. 
@@ -395,7 +475,7 @@
 
 # If the FILTER_SOURCE_FILES tag is set to YES, the input filter (if set using 
 # INPUT_FILTER) will be used to filter the input files when producing source 
-# files to browse.
+# files to browse (i.e. when SOURCE_BROWSER is set to YES).
 
 FILTER_SOURCE_FILES    = NO
 
@@ -404,7 +484,9 @@
 #---------------------------------------------------------------------------
 
 # If the SOURCE_BROWSER tag is set to YES then a list of source files will 
-# be generated. Documented entities will be cross-referenced with these sources.
+# be generated. Documented entities will be cross-referenced with these sources. 
+# Note: To get rid of all source code in the generated output, make sure also 
+# VERBATIM_HEADERS is set to NO.
 
 SOURCE_BROWSER         = YES
 
@@ -413,6 +495,12 @@
 
 INLINE_SOURCES         = NO
 
+# Setting the STRIP_CODE_COMMENTS tag to YES (the default) will instruct 
+# doxygen to hide any special comment blocks from generated source code 
+# fragments. Normal C and C++ comments will always remain visible.
+
+STRIP_CODE_COMMENTS    = YES
+
 # If the REFERENCED_BY_RELATION tag is set to YES (the default) 
 # then for each documented function all documented 
 # functions referencing it will be listed.
@@ -425,6 +513,12 @@
 
 REFERENCES_RELATION    = YES
 
+# If the VERBATIM_HEADERS tag is set to YES (the default) then Doxygen 
+# will generate a verbatim copy of the header file for each class for 
+# which an include is specified. Set to NO to disable this.
+
+VERBATIM_HEADERS       = YES
+
 #---------------------------------------------------------------------------
 # configuration options related to the alphabetical class index
 #---------------------------------------------------------------------------
@@ -481,10 +575,12 @@
 
 HTML_FOOTER            = ../apidocs/common/footer.html
 
-# The HTML_STYLESHEET tag can be used to specify a user defined cascading 
+# The HTML_STYLESHEET tag can be used to specify a user-defined cascading 
 # style sheet that is used by each HTML page. It can be used to 
 # fine-tune the look of the HTML output. If the tag is left blank doxygen 
-# will generate a default style sheet
+# will generate a default style sheet. Note that doxygen will try to copy 
+# the style sheet file to the HTML output directory, so don't put your own 
+# stylesheet in the HTML output directory as well, or it will be erased!
 
 HTML_STYLESHEET        = ../apidocs/common/doxygen.css
 
@@ -501,6 +597,20 @@
 
 GENERATE_HTMLHELP      = NO
 
+# If the GENERATE_HTMLHELP tag is set to YES, the CHM_FILE tag can 
+# be used to specify the file name of the resulting .chm file. You 
+# can add a path in front of the file if the result should not be 
+# written to the html output directory.
+
+CHM_FILE               = 
+
+# If the GENERATE_HTMLHELP tag is set to YES, the HHC_LOCATION tag can 
+# be used to specify the location (absolute path including file name) of 
+# the HTML help compiler (hhc.exe). If non-empty doxygen will try to run 
+# the HTML help compiler on the generated index.hhp.
+
+HHC_LOCATION           = 
+
 # If the GENERATE_HTMLHELP tag is set to YES, the GENERATE_CHI flag 
 # controls if a separate .chi index file is generated (YES) or that 
 # it should be included in the master .chm file (NO).
@@ -514,7 +624,7 @@
 BINARY_TOC             = NO
 
 # The TOC_EXPAND flag can be set to YES to add extra items for group members 
-# to the contents of the Html help documentation and to the tree view.
+# to the contents of the HTML help documentation and to the tree view.
 
 TOC_EXPAND             = NO
 
@@ -532,10 +642,9 @@
 # If the GENERATE_TREEVIEW tag is set to YES, a side panel will be
 # generated containing a tree-like index structure (just like the one that 
 # is generated for HTML Help). For this to work a browser that supports 
-# JavaScript and frames is required (for instance Mozilla, Netscape 4.0+, 
-# or Internet explorer 4.0+). Note that for large projects the tree generation 
-# can take a very long time. In such cases it is better to disable this feature. 
-# Windows users are probably better off using the HTML help feature.
+# JavaScript, DHTML, CSS and frames is required (for instance Mozilla 1.0+, 
+# Netscape 6.0+, Internet explorer 5.0+, or Konqueror). Windows users are 
+# probably better off using the HTML help feature.
 
 GENERATE_TREEVIEW      = NO
 
@@ -560,7 +669,8 @@
 
 LATEX_OUTPUT           = 
 
-# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be invoked. If left blank `latex' will be used as the default command name.
+# The LATEX_CMD_NAME tag can be used to specify the LaTeX command name to be 
+# invoked. If left blank `latex' will be used as the default command name.
 
 LATEX_CMD_NAME         = latex
 
@@ -614,12 +724,18 @@
 
 LATEX_BATCHMODE        = NO
 
+# If LATEX_HIDE_INDICES is set to YES then doxygen will not 
+# include the index chapters (such as File Index, Compound Index, etc.) 
+# in the output.
+
+LATEX_HIDE_INDICES     = NO
+
 #---------------------------------------------------------------------------
 # configuration options related to the RTF output
 #---------------------------------------------------------------------------
 
 # If the GENERATE_RTF tag is set to YES Doxygen will generate RTF output 
-# The RTF output is optimised for Word 97 and may not look very pretty with 
+# The RTF output is optimized for Word 97 and may not look very pretty with 
 # other RTF readers or editors.
 
 GENERATE_RTF           = NO
@@ -646,7 +762,7 @@
 RTF_HYPERLINKS         = NO
 
 # Load stylesheet definitions from file. Syntax is similar to doxygen's 
-# config file, i.e. a series of assigments. You only have to provide 
+# config file, i.e. a series of assignments. You only have to provide 
 # replacements, missing definitions are set to their default value.
 
 RTF_STYLESHEET_FILE    = 
@@ -690,12 +806,35 @@
 
 # If the GENERATE_XML tag is set to YES Doxygen will 
 # generate an XML file that captures the structure of 
-# the code including all documentation. Note that this 
-# feature is still experimental and incomplete at the 
-# moment.
+# the code including all documentation.
 
 GENERATE_XML           = NO
 
+# The XML_OUTPUT tag is used to specify where the XML pages will be put. 
+# If a relative path is entered the value of OUTPUT_DIRECTORY will be 
+# put in front of it. If left blank `xml' will be used as the default path.
+
+XML_OUTPUT             = xml
+
+# The XML_SCHEMA tag can be used to specify an XML schema, 
+# which can be used by a validating XML parser to check the 
+# syntax of the XML files.
+
+XML_SCHEMA             = 
+
+# The XML_DTD tag can be used to specify an XML DTD, 
+# which can be used by a validating XML parser to check the 
+# syntax of the XML files.
+
+XML_DTD                = 
+
+# If the XML_PROGRAMLISTING tag is set to YES Doxygen will 
+# dump the program listings (including syntax highlighting 
+# and cross-referencing information) to the XML output. Note that 
+# enabling this will significantly increase the size of the XML output.
+
+XML_PROGRAMLISTING     = NO
+
 #---------------------------------------------------------------------------
 # configuration options for the AutoGen Definitions output
 #---------------------------------------------------------------------------
@@ -709,6 +848,39 @@
 GENERATE_AUTOGEN_DEF   = NO
 
 #---------------------------------------------------------------------------
+# configuration options related to the Perl module output
+#---------------------------------------------------------------------------
+
+# If the GENERATE_PERLMOD tag is set to YES Doxygen will 
+# generate a Perl module file that captures the structure of 
+# the code including all documentation. Note that this 
+# feature is still experimental and incomplete at the 
+# moment.
+
+GENERATE_PERLMOD       = NO
+
+# If the PERLMOD_LATEX tag is set to YES Doxygen will generate 
+# the necessary Makefile rules, Perl scripts and LaTeX code to be able 
+# to generate PDF and DVI output from the Perl module output.
+
+PERLMOD_LATEX          = NO
+
+# If the PERLMOD_PRETTY tag is set to YES the Perl module output will be 
+# nicely formatted so it can be parsed by a human reader.  This is useful 
+# if you want to understand what is going on.  On the other hand, if this 
+# tag is set to NO the size of the Perl module output will be much smaller 
+# and Perl will parse it just the same.
+
+PERLMOD_PRETTY         = YES
+
+# The names of the make variables in the generated doxyrules.make file 
+# are prefixed with the string contained in PERLMOD_MAKEVAR_PREFIX. 
+# This is useful so different doxyrules.make files included by the same 
+# Makefile don't overwrite each other's variables.
+
+PERLMOD_MAKEVAR_PREFIX = 
+
+#---------------------------------------------------------------------------
 # Configuration options related to the preprocessor   
 #---------------------------------------------------------------------------
 
@@ -755,9 +927,11 @@
 # or name=definition (no spaces). If the definition and the = are 
 # omitted =1 is assumed.
 
-PREDEFINED             = QT_VERSION=305
+PREDEFINED             = QT_VERSION=320 \
+                         __cplusplus \
+                         Q_WS_X11
 
-# If the MACRO_EXPANSION and EXPAND_PREDEF_ONLY tags are set to YES then 
+# If the MACRO_EXPANSION and EXPAND_ONLY_PREDEF tags are set to YES then 
 # this tag can be used to specify a list of macro names that should be expanded. 
 # The macro definition that is found in the sources will be used. 
 # Use the PREDEFINED tag if you want to use a different macro definition.
@@ -766,16 +940,30 @@
 
 # If the SKIP_FUNCTION_MACROS tag is set to YES (the default) then 
 # doxygen's preprocessor will remove all function-like macros that are alone 
-# on a line and do not end with a semicolon. Such function macros are typically 
-# used for boiler-plate code, and will confuse the parser if not removed.
+# on a line, have an all uppercase name, and do not end with a semicolon. Such 
+# function macros are typically used for boiler-plate code, and will confuse the 
+# parser if not removed.
 
 SKIP_FUNCTION_MACROS   = YES
 
 #---------------------------------------------------------------------------
-# Configuration::addtions related to external references   
+# Configuration::additions related to external references   
 #---------------------------------------------------------------------------
 
-# The TAGFILES tag can be used to specify one or more tagfiles.
+# The TAGFILES option can be used to specify one or more tagfiles. 
+# Optionally an initial location of the external documentation 
+# can be added for each tagfile. The format of a tag file without 
+# this location is as follows: 
+#   TAGFILES = file1 file2 ... 
+# Adding location for the tag files is done as follows: 
+#   TAGFILES = file1=loc1 &quot;file2 = loc2&quot; ... 
+# where &quot;loc1&quot; and &quot;loc2&quot; can be relative or absolute paths or 
+# URLs. If a location is present for each tag, the installdox tool 
+# does not have to be run to correct the links.
+# Note that each tag file must have a unique name
+# (where the name does NOT include the path)
+# If a tag file is not located in the directory in which doxygen 
+# is run, you must also specify the path to the tagfile here.
 
 TAGFILES               = 
 
@@ -806,13 +994,19 @@
 #---------------------------------------------------------------------------
 
 # If the CLASS_DIAGRAMS tag is set to YES (the default) Doxygen will 
-# generate a inheritance diagram (in Html, RTF and LaTeX) for classes with base or 
+# generate a inheritance diagram (in HTML, RTF and LaTeX) for classes with base or 
 # super classes. Setting the tag to NO turns the diagrams off. Note that this 
-# option is superceded by the HAVE_DOT option below. This is only a fallback. It is 
-# recommended to install and use dot, since it yield more powerful graphs.
+# option is superseded by the HAVE_DOT option below. This is only a fallback. It is 
+# recommended to install and use dot, since it yields more powerful graphs.
 
 CLASS_DIAGRAMS         = YES
 
+# If set to YES, the inheritance and collaboration graphs will hide 
+# inheritance and usage relations if the target is undocumented 
+# or is not a class.
+
+HIDE_UNDOC_RELATIONS   = NO
+
 # If you set the HAVE_DOT tag to YES then doxygen will assume the dot tool is 
 # available from the path. This tool is part of Graphviz, a graph visualization 
 # toolkit from AT&amp;T and Lucent Bell Labs. The other options in this section 
@@ -834,17 +1028,17 @@
 
 COLLABORATION_GRAPH    = YES
 
+# If the UML_LOOK tag is set to YES doxygen will generate inheritance and 
+# collaboration diagrams in a style similar to the OMG's Unified Modeling 
+# Language.
+
+UML_LOOK               = NO
+
 # If set to YES, the inheritance and collaboration graphs will show the 
 # relations between templates and their instances.
 
 TEMPLATE_RELATIONS     = YES
 
-# If set to YES, the inheritance and collaboration graphs will hide 
-# inheritance and usage relations if the target is undocumented 
-# or is not a class.
-
-HIDE_UNDOC_RELATIONS   = NO
-
 # If the ENABLE_PREPROCESSING, SEARCH_INCLUDES, INCLUDE_GRAPH, and HAVE_DOT 
 # tags are set to YES then doxygen will generate a graph for each documented 
 # file showing the direct and indirect include dependencies of the file with 
@@ -859,10 +1053,18 @@
 
 INCLUDED_BY_GRAPH      = YES
 
+# If the CALL_GRAPH and HAVE_DOT tags are set to YES then doxygen will 
+# generate a call dependency graph for every global function or class method. 
+# Note that enabling this option will significantly increase the time of a run. 
+# So in most cases it will be better to enable call graphs for selected 
+# functions only using the \callgraph command.
+
+CALL_GRAPH             = NO
+
 # If the GRAPHICAL_HIERARCHY and HAVE_DOT tags are set to YES then doxygen 
 # will graphical hierarchy of all classes instead of a textual one.
 
-GRAPHICAL_HIERARCHY    = NO
+GRAPHICAL_HIERARCHY    = YES
 
 # The DOT_IMAGE_FORMAT tag can be used to set the image format of the images 
 # generated by dot. Possible values are png, jpg, or gif
@@ -897,6 +1099,17 @@
 
 MAX_DOT_GRAPH_HEIGHT   = 1024
 
+# The MAX_DOT_GRAPH_DEPTH tag can be used to set the maximum depth of the 
+# graphs generated by dot. A depth value of 3 means that only nodes reachable 
+# from the root by following a path via at most 3 edges will be shown. Nodes that 
+# lay further from the root node will be omitted. Note that setting this option to 
+# 1 or 2 may greatly reduce the computation time needed for large code bases. Also 
+# note that a graph may be further truncated if the graph's image dimensions are 
+# not sufficient to fit the graph (see MAX_DOT_GRAPH_WIDTH and MAX_DOT_GRAPH_HEIGHT). 
+# If 0 is used for the depth value (the default), the graph is not depth-constrained.
+
+MAX_DOT_GRAPH_DEPTH    = 0
+
 # If the GENERATE_LEGEND tag is set to YES (the default) Doxygen will 
 # generate a legend page explaining the meaning of the various boxes and 
 # arrows in the dot generated graphs.
@@ -904,51 +1117,16 @@
 GENERATE_LEGEND        = YES
 
 # If the DOT_CLEANUP tag is set to YES (the default) Doxygen will 
-# remove the intermedate dot files that are used to generate 
+# remove the intermediate dot files that are used to generate 
 # the various graphs.
 
 DOT_CLEANUP            = YES
 
 #---------------------------------------------------------------------------
-# Configuration::addtions related to the search engine   
+# Configuration::additions related to the search engine   
 #---------------------------------------------------------------------------
 
 # The SEARCHENGINE tag specifies whether or not a search engine should be 
 # used. If set to NO the values of all tags below this one will be ignored.
 
 SEARCHENGINE           = NO
-
-# The CGI_NAME tag should be the name of the CGI script that 
-# starts the search engine (doxysearch) with the correct parameters. 
-# A script with this name will be generated by doxygen.
-
-CGI_NAME               = 
-
-# The CGI_URL tag should be the absolute URL to the directory where the 
-# cgi binaries are located. See the documentation of your http daemon for 
-# details.
-
-CGI_URL                = 
-
-# The DOC_URL tag should be the absolute URL to the directory where the 
-# documentation is located. If left blank the absolute path to the 
-# documentation, with <A HREF="file://">file://</A> prepended to it, will be used.
-
-DOC_URL                = 
-
-# The DOC_ABSPATH tag should be the absolute path to the directory where the 
-# documentation is located. If left blank the directory on the local machine 
-# will be used.
-
-DOC_ABSPATH            = 
-
-# The BIN_ABSPATH tag must point to the directory where the doxysearch binary 
-# is installed.
-
-BIN_ABSPATH            = 
-
-# The EXT_DOC_PATHS tag can be used to specify one or more paths to 
-# documentation generated for other projects. This allows doxysearch to search 
-# the documentation for these projects as well.
-
-EXT_DOC_PATHS          = 
Index: cvs-clean.pl
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/cvs-clean.pl,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/cvs-clean.pl -Ladmin/cvs-clean.pl -u -r1.1.1.1 -r1.2
--- admin/cvs-clean.pl
+++ admin/cvs-clean.pl
@@ -7,7 +7,7 @@
 # written by Oswald Buddenhagen &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">ossi at kde.org</A>&gt;
 #  inspired by the &quot;old&quot; cvs-clean target from Makefile.common
 #
-# This file is free software in terms of the BSD licence. That means
+# This file is free software in terms of the BSD license. That means
 # that you can do anything with it except removing this license or
 # the above copyright notice. There is NO WARRANTY of any kind.
 #
Index: install-sh
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/install-sh,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/install-sh -Ladmin/install-sh -u -r1.1.1.1 -r1.2
--- admin/install-sh
+++ admin/install-sh
@@ -56,7 +56,7 @@
 
 while [ x&quot;$1&quot; != x ]; do
     case $1 in
-	-c) instcmd=&quot;$cpprog&quot;
+	-c) instcmd=$cpprog
 	    shift
 	    continue;;
 
@@ -79,7 +79,7 @@
 	    shift
 	    continue;;
 
-	-s) stripcmd=&quot;$stripprog&quot;
+	-s) stripcmd=$stripprog
 	    shift
 	    continue;;
 
@@ -106,7 +106,7 @@
 
 if [ x&quot;$src&quot; = x ]
 then
-	echo &quot;install:	no input file specified&quot;
+	echo &quot;$0: no input file specified&quot; &gt;&amp;2
 	exit 1
 else
 	:
@@ -115,8 +115,8 @@
 if [ x&quot;$dir_arg&quot; != x ]; then
 	dst=$src
 	src=&quot;&quot;
-	
-	if [ -d $dst ]; then
+
+	if [ -d &quot;$dst&quot; ]; then
 		instcmd=:
 		chmodcmd=&quot;&quot;
 	else
@@ -125,20 +125,20 @@
 else
 
 # Waiting for this to be detected by the &quot;$instcmd $src $dsttmp&quot; command
-# might cause directories to be created, which would be especially bad 
+# might cause directories to be created, which would be especially bad
 # if $src (and thus $dsttmp) contains '*'.
 
 	if [ -f &quot;$src&quot; ] || [ -d &quot;$src&quot; ]
 	then
 		:
 	else
-		echo &quot;install:  $src does not exist&quot;
+		echo &quot;$0: $src does not exist&quot; &gt;&amp;2
 		exit 1
 	fi
-	
+
 	if [ x&quot;$dst&quot; = x ]
 	then
-		echo &quot;install:	no destination specified&quot;
+		echo &quot;$0: no destination specified&quot; &gt;&amp;2
 		exit 1
 	else
 		:
@@ -147,16 +147,16 @@
 # If destination is a directory, append the input filename; if your system
 # does not like double slashes in filenames, you may need to add some logic
 
-	if [ -d $dst ]
+	if [ -d &quot;$dst&quot; ]
 	then
-		dst=&quot;$dst&quot;/`basename $src`
+		dst=$dst/`basename &quot;$src&quot;`
 	else
 		:
 	fi
 fi
 
 ## this sed command emulates the dirname command
-dstdir=`echo $dst | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
+dstdir=`echo &quot;$dst&quot; | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
 
 # Make sure that the destination directory exists.
 #  this part is taken from Noah Friedman's mkinstalldirs script
@@ -165,69 +165,73 @@
 if [ ! -d &quot;$dstdir&quot; ]; then
 defaultIFS='
 	'
-IFS=&quot;${IFS-${defaultIFS}}&quot;
+IFS=&quot;${IFS-$defaultIFS}&quot;
 
-oIFS=&quot;${IFS}&quot;
+oIFS=$IFS
 # Some sh's can't handle IFS=/ for some reason.
 IFS='%'
-set - `echo ${dstdir} | sed -e 's@/@%@g' -e 's@^%@/@'`
-IFS=&quot;${oIFS}&quot;
+set - `echo &quot;$dstdir&quot; | sed -e 's@/@%@g' -e 's@^%@/@'`
+IFS=$oIFS
 
 pathcomp=''
 
 while [ $# -ne 0 ] ; do
-	pathcomp=&quot;${pathcomp}${1}&quot;
+	pathcomp=$pathcomp$1
 	shift
 
-	if [ ! -d &quot;${pathcomp}&quot; ] ;
+	if [ ! -d &quot;$pathcomp&quot; ] ;
         then
-		$mkdirprog &quot;${pathcomp}&quot;
+		$mkdirprog &quot;$pathcomp&quot;
 	else
 		:
 	fi
 
-	pathcomp=&quot;${pathcomp}/&quot;
+	pathcomp=$pathcomp/
 done
 fi
 
 if [ x&quot;$dir_arg&quot; != x ]
 then
-	$doit $instcmd $dst &amp;&amp;
+	$doit $instcmd &quot;$dst&quot; &amp;&amp;
 
-	if [ x&quot;$chowncmd&quot; != x ]; then $doit $chowncmd $dst; else : ; fi &amp;&amp;
-	if [ x&quot;$chgrpcmd&quot; != x ]; then $doit $chgrpcmd $dst; else : ; fi &amp;&amp;
-	if [ x&quot;$stripcmd&quot; != x ]; then $doit $stripcmd $dst; else : ; fi &amp;&amp;
-	if [ x&quot;$chmodcmd&quot; != x ]; then $doit $chmodcmd $dst; else : ; fi
+	if [ x&quot;$chowncmd&quot; != x ]; then $doit $chowncmd &quot;$dst&quot;; else : ; fi &amp;&amp;
+	if [ x&quot;$chgrpcmd&quot; != x ]; then $doit $chgrpcmd &quot;$dst&quot;; else : ; fi &amp;&amp;
+	if [ x&quot;$stripcmd&quot; != x ]; then $doit $stripcmd &quot;$dst&quot;; else : ; fi &amp;&amp;
+	if [ x&quot;$chmodcmd&quot; != x ]; then $doit $chmodcmd &quot;$dst&quot;; else : ; fi
 else
 
 # If we're going to rename the final executable, determine the name now.
 
-	if [ x&quot;$transformarg&quot; = x ] 
+	if [ x&quot;$transformarg&quot; = x ]
 	then
-		dstfile=`basename $dst`
+		dstfile=`basename &quot;$dst&quot;`
 	else
-		dstfile=`basename $dst $transformbasename | 
+		dstfile=`basename &quot;$dst&quot; $transformbasename |
 			sed $transformarg`$transformbasename
 	fi
 
 # don't allow the sed command to completely eliminate the filename
 
-	if [ x&quot;$dstfile&quot; = x ] 
+	if [ x&quot;$dstfile&quot; = x ]
 	then
-		dstfile=`basename $dst`
+		dstfile=`basename &quot;$dst&quot;`
 	else
 		:
 	fi
 
-# Make a temp file name in the proper directory.
+# Make a couple of temp file names in the proper directory.
 
 	dsttmp=$dstdir/#inst.$$#
+	rmtmp=$dstdir/#rm.$$#
 
-# Move or copy the file name to the temp name
+# Trap to clean up temp files at exit.
 
-	$doit $instcmd $src $dsttmp &amp;&amp;
+	trap 'status=$?; rm -f &quot;$dsttmp&quot; &quot;$rmtmp&quot; &amp;&amp; exit $status' 0
+	trap '(exit $?); exit' 1 2 13 15
+
+# Move or copy the file name to the temp name
 
-	trap &quot;rm -f ${dsttmp}&quot; 0 &amp;&amp;
+	$doit $instcmd &quot;$src&quot; &quot;$dsttmp&quot; &amp;&amp;
 
 # and set any options; do chmod last to preserve setuid bits
 
@@ -235,17 +239,38 @@
 # ignore errors from any of these, just make sure not to ignore
 # errors from the above &quot;$doit $instcmd $src $dsttmp&quot; command.
 
-	if [ x&quot;$chowncmd&quot; != x ]; then $doit $chowncmd $dsttmp; else :;fi &amp;&amp;
-	if [ x&quot;$chgrpcmd&quot; != x ]; then $doit $chgrpcmd $dsttmp; else :;fi &amp;&amp;
-	if [ x&quot;$stripcmd&quot; != x ]; then $doit $stripcmd $dsttmp; else :;fi &amp;&amp;
-	if [ x&quot;$chmodcmd&quot; != x ]; then $doit $chmodcmd $dsttmp; else :;fi &amp;&amp;
+	if [ x&quot;$chowncmd&quot; != x ]; then $doit $chowncmd &quot;$dsttmp&quot;; else :;fi &amp;&amp;
+	if [ x&quot;$chgrpcmd&quot; != x ]; then $doit $chgrpcmd &quot;$dsttmp&quot;; else :;fi &amp;&amp;
+	if [ x&quot;$stripcmd&quot; != x ]; then $doit $stripcmd &quot;$dsttmp&quot;; else :;fi &amp;&amp;
+	if [ x&quot;$chmodcmd&quot; != x ]; then $doit $chmodcmd &quot;$dsttmp&quot;; else :;fi &amp;&amp;
+
+# Now remove or move aside any old file at destination location.  We try this
+# two ways since rm can't unlink itself on some systems and the destination
+# file might be busy for other reasons.  In this case, the final cleanup
+# might fail but the new file should still install successfully.
+
+{
+	if [ -f &quot;$dstdir/$dstfile&quot; ]
+	then
+		$doit $rmcmd -f &quot;$dstdir/$dstfile&quot; 2&gt;/dev/null ||
+		$doit $mvcmd -f &quot;$dstdir/$dstfile&quot; &quot;$rmtmp&quot; 2&gt;/dev/null ||
+		{
+		  echo &quot;$0: cannot unlink or rename $dstdir/$dstfile&quot; &gt;&amp;2
+		  (exit 1); exit
+		}
+	else
+		:
+	fi
+} &amp;&amp;
 
 # Now rename the file to the real destination.
 
-	$doit $rmcmd -f $dstdir/$dstfile &amp;&amp;
-	$doit $mvcmd $dsttmp $dstdir/$dstfile 
+	$doit $mvcmd &quot;$dsttmp&quot; &quot;$dstdir/$dstfile&quot;
 
 fi &amp;&amp;
 
+# The final little trick to &quot;correctly&quot; pass the exit status to the exit trap.
 
-exit 0
+{
+	(exit 0); exit
+}
Index: Makefile.common
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/Makefile.common,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/Makefile.common -Ladmin/Makefile.common -u -r1.1.1.1 -r1.2
--- admin/Makefile.common
+++ admin/Makefile.common
@@ -6,7 +6,7 @@
 
 SHELL=/bin/sh
 
-cvs dist cvs-clean configure configure.in configure.files subdirs package-messages package-merge Makefile.am:
+cvs dist cvs-clean configure configure.in configure.files subdirs package-messages package-merge Makefile.am acinclude.m4:
 	@admindir=$(admindir); \
 	if test &quot;x$$admindir&quot; = x; then \
 	  admindir=.; until test -f $$admindir/admin/cvs.sh; do \
@@ -23,10 +23,11 @@
 	if test &quot;$@&quot; = &quot;package-merge&quot;; then \
 		MAKE=&quot;$(MAKE)&quot; POFILES=&quot;$(POFILES)&quot; PACKAGE=&quot;$(PACKAGE)&quot; \
 	  	$(SHELL) $$admindir/cvs.sh package-merge ;\
-	else MAKE=&quot;$(MAKE)&quot; $(SHELL) $$admindir/cvs.sh $@ ;\
+	else \
+		MAKE=&quot;$(MAKE)&quot; $(SHELL) $$admindir/cvs.sh $@ ;\
 	fi
 
-configure.in: configure.files $(shell test -f configure.files &amp;&amp; cat configure.files) subdirs
+configure.in: configure.files subdirs
 configure.files: subdirs
 
 .SILENT:
Index: libtool.m4.in
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/libtool.m4.in,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/libtool.m4.in -Ladmin/libtool.m4.in -u -r1.1.1.1 -r1.2
--- admin/libtool.m4.in
+++ admin/libtool.m4.in
@@ -24,6 +24,17 @@
 
 # serial 47 AC_PROG_LIBTOOL
 
+
+# AC_PROVIDE_IFELSE(MACRO-NAME, IF-PROVIDED, IF-NOT-PROVIDED)
+# -----------------------------------------------------------
+# If this macro is not defined by Autoconf, define it here.
+m4_ifdef([AC_PROVIDE_IFELSE],
+         [],
+         [m4_define([AC_PROVIDE_IFELSE],
+	         [m4_ifdef([AC_PROVIDE_$1],
+		           [$2], [$3])])])
+
+
 # AC_PROG_LIBTOOL
 # ---------------
 AC_DEFUN([AC_PROG_LIBTOOL],
@@ -34,6 +45,11 @@
     [AC_LIBTOOL_CXX],
     [define([AC_PROG_CXX], defn([AC_PROG_CXX])[AC_LIBTOOL_CXX
   ])])
+dnl And a similar setup for Fortran 77 support
+  AC_PROVIDE_IFELSE([AC_PROG_F77],
+    [AC_LIBTOOL_F77],
+    [define([AC_PROG_F77], defn([AC_PROG_F77])[AC_LIBTOOL_F77
+])])
 
 dnl Quote A][M_PROG_GCJ so that aclocal doesn't bring it in needlessly.
 dnl If either AC_PROG_GCJ or A][M_PROG_GCJ have already been expanded, run
@@ -59,6 +75,7 @@
 AC_DEFUN([_AC_PROG_LIBTOOL],
 [AC_REQUIRE([AC_LIBTOOL_SETUP])dnl
 AC_BEFORE([$0],[AC_LIBTOOL_CXX])dnl
+AC_BEFORE([$0],[AC_LIBTOOL_F77])dnl
 AC_BEFORE([$0],[AC_LIBTOOL_GCJ])dnl
 
 # This can be used to rebuild libtool when needed
@@ -86,7 +103,6 @@
 AC_REQUIRE([AC_PROG_LD])dnl
 AC_REQUIRE([AC_PROG_LD_RELOAD_FLAG])dnl
 AC_REQUIRE([AC_PROG_NM])dnl
-AC_REQUIRE([LT_AC_PROG_SED])dnl
 
 AC_REQUIRE([AC_PROG_LN_S])dnl
 AC_REQUIRE([AC_DEPLIBS_CHECK_METHOD])dnl
@@ -143,6 +159,7 @@
 ofile=&quot;$default_ofile&quot;
 with_gnu_ld=&quot;$lt_cv_prog_gnu_ld&quot;
 
+AC_CHECK_TOOL(AR, ar, false)
 AC_CHECK_TOOL(RANLIB, ranlib, :)
 AC_CHECK_TOOL(STRIP, strip, :)
 
@@ -192,8 +209,8 @@
   ;;
 esac
 
-ifdef([AC_PROVIDE_AC_LIBTOOL_DLOPEN], enable_dlopen=yes, enable_dlopen=no)
-ifdef([AC_PROVIDE_AC_LIBTOOL_WIN32_DLL],
+AC_PROVIDE_IFELSE([AC_LIBTOOL_DLOPEN], enable_dlopen=yes, enable_dlopen=no)
+AC_PROVIDE_IFELSE([AC_LIBTOOL_WIN32_DLL],
 enable_win32_dll=yes, enable_win32_dll=no)
 
 AC_ARG_ENABLE([libtool-lock],
@@ -224,8 +241,7 @@
 LTCC=${LTCC-&quot;$CC&quot;}
 
 # Allow CC to be a program name with arguments.
-set dummy $CC
-compiler=&quot;[$]2&quot;
+compiler=$CC
 ])# _LT_AC_SYS_COMPILER
 
 
@@ -239,24 +255,32 @@
 # to the aix ld manual.
 AC_DEFUN([_LT_AC_SYS_LIBPATH_AIX],
 [AC_LINK_IFELSE(AC_LANG_PROGRAM,[
-aix_libpath=`dump -H conftest$ac_exeext 2&gt;/dev/null | sed -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
+aix_libpath=`dump -H conftest$ac_exeext 2&gt;/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`
 # Check for a 64-bit object if we didn't find anything.
-if test -z &quot;$aix_libpath&quot;; then aix_libpath=`dump -HX64 conftest$ac_exeext 2&gt;/dev/null | sed -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
+if test -z &quot;$aix_libpath&quot;; then aix_libpath=`dump -HX64 conftest$ac_exeext 2&gt;/dev/null | $SED -n -e '/Import File Strings/,/^$/ { /^0/ { s/^0  *\(.*\)$/\1/; p; }
 }'`; fi],[])
 if test -z &quot;$aix_libpath&quot;; then aix_libpath=&quot;/usr/lib:/lib&quot;; fi
 ])# _LT_AC_SYS_LIBPATH_AIX
 
 
+# _LT_AC_SHELL_INIT(ARG)
+# ----------------------
+AC_DEFUN([_LT_AC_SHELL_INIT],
+[ifdef([AC_DIVERSION_NOTICE],
+	     [AC_DIVERT_PUSH(AC_DIVERSION_NOTICE)],
+	 [AC_DIVERT_PUSH(NOTICE)])
+$1
+AC_DIVERT_POP
+])# _LT_AC_SHELL_INIT
+
+
 # _LT_AC_PROG_ECHO_BACKSLASH
 # --------------------------
 # Add some code to the start of the generated configure script which
 # will find an echo command which doesn't interpret backslashes.
 AC_DEFUN([_LT_AC_PROG_ECHO_BACKSLASH],
-[ifdef([AC_DIVERSION_NOTICE],
-	     [AC_DIVERT_PUSH(AC_DIVERSION_NOTICE)],
-	 [AC_DIVERT_PUSH(NOTICE)])
-
+[_LT_AC_SHELL_INIT([
 # Check that we are running under the correct shell.
 SHELL=${CONFIG_SHELL-/bin/sh}
 
@@ -274,7 +298,7 @@
 elif test &quot;X[$]1&quot; = X--fallback-echo; then
   # Avoid inline document here, it may be left over
   :
-elif test &quot;X`($echo '\t') 2&gt;/dev/null`&quot; = 'X\t'; then
+elif test &quot;X`($echo '\t') 2&gt;/dev/null`&quot; = 'X\t' ; then
   # Yippee, $echo works!
   :
 else
@@ -404,8 +428,7 @@
 fi
 
 AC_SUBST(ECHO)
-AC_DIVERT_POP
-])# _LT_AC_PROG_ECHO_BACKSLASH
+])])# _LT_AC_PROG_ECHO_BACKSLASH
 
 
 # _LT_AC_LOCK
@@ -438,6 +461,19 @@
   # Find out which ABI we are using.
   echo '[#]line __oline__ &quot;configure&quot;' &gt; conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
+   if test &quot;$lt_cv_prog_gnu_ld&quot; = yes; then
+    case `/usr/bin/file conftest.$ac_objext` in
+    *32-bit*)
+      LD=&quot;${LD-ld} -melf32bsmip&quot;
+      ;;
+    *N32*)
+      LD=&quot;${LD-ld} -melf32bmipn32&quot;
+      ;;
+    *64-bit*)
+      LD=&quot;${LD-ld} -melf64bmip&quot;
+      ;;
+    esac
+   else
     case `/usr/bin/file conftest.$ac_objext` in
     *32-bit*)
       LD=&quot;${LD-ld} -32&quot;
@@ -449,26 +485,55 @@
       LD=&quot;${LD-ld} -64&quot;
       ;;
     esac
+   fi
   fi
   rm -rf conftest*
   ;;
 
-*-*-linux*)
-  # Test if the compiler is 64bit
+x86_64-*linux*|ppc*-*linux*|powerpc*-*linux*|s390*-*linux*|sparc*-*linux*)
+  # Find out which ABI we are using.
   echo 'int i;' &gt; conftest.$ac_ext
   if AC_TRY_EVAL(ac_compile); then
-    case `/usr/bin/file conftest.$ac_objext` in
-    *&quot;ELF 32&quot;*)
+    case &quot;`/usr/bin/file conftest.o`&quot; in
+    *32-bit*)
       LINUX_64_MODE=&quot;32&quot;
+      case $host in
+        x86_64-*linux*)
+          LD=&quot;${LD-ld} -m elf_i386&quot;
+          ;;
+        ppc64-*linux*)
+          LD=&quot;${LD-ld} -m elf32ppclinux&quot;
+          ;;
+        s390x-*linux*)
+          LD=&quot;${LD-ld} -m elf_s390&quot;
+          ;;
+        sparc64-*linux*)
+          LD=&quot;${LD-ld} -m elf32_sparc&quot;
+          ;;
+      esac
       ;;
-    *&quot;ELF 64&quot;*)
+    *64-bit*)
       LINUX_64_MODE=&quot;64&quot;
+      case $host in
+        x86_64-*linux*)
+          LD=&quot;${LD-ld} -m elf_x86_64&quot;
+          ;;
+        ppc*-*linux*|powerpc*-*linux*)
+          LD=&quot;${LD-ld} -m elf64ppc&quot;
+          ;;
+        s390*-*linux*)
+          LD=&quot;${LD-ld} -m elf64_s390&quot;
+          ;;
+        sparc*-*linux*)
+          LD=&quot;${LD-ld} -m elf64_sparc&quot;
+          ;;
+      esac
       ;;
     esac
   fi
   rm -rf conftest*
   ;;
-  
+
 *-*-sco3.2v5*)
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
   SAVE_CFLAGS=&quot;$CFLAGS&quot;
@@ -482,34 +547,11 @@
     CFLAGS=&quot;$SAVE_CFLAGS&quot;
   fi
   ;;
-ifdef([AC_PROVIDE_AC_LIBTOOL_WIN32_DLL],
+AC_PROVIDE_IFELSE([AC_LIBTOOL_WIN32_DLL],
 [*-*-cygwin* | *-*-mingw* | *-*-pw32*)
   AC_CHECK_TOOL(DLLTOOL, dlltool, false)
   AC_CHECK_TOOL(AS, as, false)
   AC_CHECK_TOOL(OBJDUMP, objdump, false)
-
-  # recent cygwin and mingw systems supply a stub DllMain which the user
-  # can override, but on older systems we have to supply one
-  AC_CACHE_CHECK([if libtool should supply DllMain function], lt_cv_need_dllmain,
-    [AC_TRY_LINK([],
-      [extern int __attribute__((__stdcall__)) DllMain(void*, int, void*);
-      DllMain (0, 0, 0);],
-      [lt_cv_need_dllmain=no],[lt_cv_need_dllmain=yes])])
-
-  case $host/$CC in
-  *-*-cygwin*/gcc*-mno-cygwin*|*-*-mingw*)
-    # old mingw systems require &quot;-dll&quot; to link a DLL, while more recent ones
-    # require &quot;-mdll&quot;
-    SAVE_CFLAGS=&quot;$CFLAGS&quot;
-    CFLAGS=&quot;$CFLAGS -mdll&quot;
-    AC_CACHE_CHECK([how to link DLLs], lt_cv_cc_dll_switch,
-      [AC_TRY_LINK([], [], [lt_cv_cc_dll_switch=-mdll],[lt_cv_cc_dll_switch=-dll])])
-    CFLAGS=&quot;$SAVE_CFLAGS&quot; ;;
-  *-*-cygwin* | *-*-pw32*)
-    # cygwin systems need to pass --dll to the linker, and not link
-    # crt.o which will require a <A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">WinMain at 16</A> definition.
-    lt_cv_cc_dll_switch=&quot;-Wl,--dll -nostartfiles&quot; ;;
-  esac
   ;;
   ])
 esac
@@ -524,24 +566,34 @@
 # ----------------------------------------------------------------
 # Check whether the given compiler option works
 AC_DEFUN([AC_LIBTOOL_COMPILER_OPTION],
-[AC_CACHE_CHECK([$1], [$2],
+[AC_REQUIRE([LT_AC_PROG_SED])
+AC_CACHE_CHECK([$1], [$2],
   [$2=no
   ifelse([$4], , [ac_outfile=conftest.$ac_objext], [ac_outfile=$4])
-   save_CFLAGS=&quot;$CFLAGS&quot;
-   CFLAGS=&quot;$CFLAGS $3&quot;
-   echo &quot;$lt_simple_compile_test_code&quot; &gt; conftest.$ac_ext
-   if (eval $ac_compile 2&gt;conftest.err) &amp;&amp; test -s $ac_outfile; then
+   printf &quot;$lt_simple_compile_test_code&quot; &gt; conftest.$ac_ext
+   lt_compiler_flag=&quot;$3&quot;
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing &quot;conftest.&quot;, or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   # The option is referenced via a variable to avoid confusing sed.
+   lt_compile=`echo &quot;$ac_compile&quot; | $SED \
+   -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
+   -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&amp;:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo &quot;\&quot;\$as_me:__oline__: $lt_compile\&quot;&quot; &gt;&amp;AS_MESSAGE_LOG_FD)
+   (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
+   ac_status=$?
+   cat conftest.err &gt;&amp;AS_MESSAGE_LOG_FD
+   echo &quot;$as_me:__oline__: \$? = $ac_status&quot; &gt;&amp;AS_MESSAGE_LOG_FD
+   if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test -s conftest.err; then
-       # Append any errors to the config.log.
-       cat conftest.err 1&gt;&amp;AS_MESSAGE_LOG_FD
-     else
+     if test ! -s conftest.err; then
        $2=yes
      fi
    fi
    $rm conftest*
-   CFLAGS=&quot;$save_CFLAGS&quot;
 ])
 
 if test x&quot;[$]$2&quot; = xyes; then
@@ -561,7 +613,7 @@
   [$2=no
    save_LDFLAGS=&quot;$LDFLAGS&quot;
    LDFLAGS=&quot;$LDFLAGS $3&quot;
-   echo &quot;$lt_simple_link_test_code&quot; &gt; conftest.$ac_ext
+   printf &quot;$lt_simple_link_test_code&quot; &gt; conftest.$ac_ext
    if (eval $ac_link 2&gt;conftest.err) &amp;&amp; test -s conftest$ac_exeext; then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
@@ -593,7 +645,7 @@
   i=0
   testring=&quot;ABCD&quot;
 
-  case $host_os in
+  case $build_os in
   msdosdjgpp*)
     # On DJGPP, this test can blow up pretty badly due to problems in libc
     # (any single argument exceeding 2000 bytes causes a buffer overrun
@@ -609,7 +661,18 @@
     lt_cv_sys_max_cmd_len=-1;
     ;;
 
-  *)
+  cygwin* | mingw*)
+    # On Win9x/ME, this test blows up -- it succeeds, but takes
+    # about 5 minutes as the teststring grows exponentially.
+    # Worse, since 9x/ME are not pre-emptively multitasking,
+    # you end up with a &quot;frozen&quot; computer, even though with patience
+    # the test eventually succeeds (with a max line length of 256k).
+    # Instead, let's just punt: use the minimum linelength reported by
+    # all of the supported platforms: 8192 (on NT/2K/XP).
+    lt_cv_sys_max_cmd_len=8192;
+    ;;
+
+ *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
     # we can't tell.
@@ -753,11 +816,26 @@
     lt_cv_dlopen_self=yes
     ;;
 
-  cygwin* | mingw* | pw32*)
+  mingw* | pw32*)
     lt_cv_dlopen=&quot;LoadLibrary&quot;
     lt_cv_dlopen_libs=
    ;;
 
+  cygwin*)
+    lt_cv_dlopen=&quot;dlopen&quot;
+    lt_cv_dlopen_libs=
+   ;;
+
+  darwin*)
+  # if libdl is installed we need to link against it
+    AC_CHECK_LIB([dl], [dlopen],
+		[lt_cv_dlopen=&quot;dlopen&quot; lt_cv_dlopen_libs=&quot;-ldl&quot;],[
+    lt_cv_dlopen=&quot;dyld&quot;
+    lt_cv_dlopen_libs=
+    lt_cv_dlopen_self=yes
+    ])
+   ;;
+    
   *)
     AC_CHECK_FUNC([shl_load],
 	  [lt_cv_dlopen=&quot;shl_load&quot;],
@@ -844,13 +922,7 @@
    mkdir conftest
    cd conftest
    mkdir out
-   ifelse([$1],[],[save_CFLAGS=&quot;$CFLAGS&quot;
-		   CFLAGS=&quot;$CFLAGS -o out/conftest2.$ac_objext&quot;],
-	  [$1],[CXX],[save_CXXFLAGS=&quot;$CXXFLAGS&quot;
-		   CXXFLAGS=&quot;$CXXFLAGS -o out/conftest2.$ac_objext&quot;],
-	  [$1],[GCJ],[save_GCJFLAGS=&quot;$GCJFLAGS&quot;
-		   GCJFLAGS=&quot;$GCJFLAGS -o out/conftest2.$ac_objext&quot;])
-   echo &quot;$lt_simple_compile_test_code&quot; &gt; conftest.$ac_ext
+   printf &quot;$lt_simple_compile_test_code&quot; &gt; conftest.$ac_ext
 
    # According to Tom Tromey, Ian Lance Taylor reported there are C compilers
    # that will create temporary files in the current directory regardless of
@@ -859,20 +931,28 @@
    # builds.
    chmod -w .
 
-   if (eval $ac_compile 2&gt;out/conftest.err) &amp;&amp; test -s out/conftest2.$ac_objext
+   lt_compiler_flag=&quot;-o out/conftest2.$ac_objext&quot;
+   # Insert the option either (1) after the last *FLAGS variable, or
+   # (2) before a word containing &quot;conftest.&quot;, or (3) at the end.
+   # Note that $ac_compile itself does not contain backslashes and begins
+   # with a dollar sign (not a hyphen), so the echo should work correctly.
+   lt_compile=`echo &quot;$ac_compile&quot; | $SED \
+   -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
+   -e 's: [[^ ]]*conftest\.: $lt_compiler_flag&amp;:; t' \
+   -e 's:$: $lt_compiler_flag:'`
+   (eval echo &quot;\&quot;\$as_me:__oline__: $lt_compile\&quot;&quot; &gt;&amp;AS_MESSAGE_LOG_FD)
+   (eval &quot;$lt_compile&quot; 2&gt;out/conftest.err)
+   ac_status=$?
+   cat out/conftest.err &gt;&amp;AS_MESSAGE_LOG_FD
+   echo &quot;$as_me:__oline__: \$? = $ac_status&quot; &gt;&amp;AS_MESSAGE_LOG_FD
+   if (exit $ac_status) &amp;&amp; test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test -s out/conftest.err; then
-       # Append any errors to the config.log.
-       cat out/conftest.err 1&gt;&amp;AS_MESSAGE_LOG_FD
-     else
+     if test ! -s out/conftest.err; then
        _LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
      fi
    fi
-   ifelse([$1],[],[CFLAGS=&quot;$save_CFLAGS&quot;],
-	  [$1],[CXX],[CXXFLAGS=&quot;$save_CXXFLAGS&quot;],
-	  [$1],[GCJ],[GCJFLAGS=&quot;$save_GCJFLAGS&quot;])
    chmod u+w .
    $rm conftest* out/*
    rmdir out
@@ -934,7 +1014,8 @@
 [AC_MSG_CHECKING([how to hardcode library paths into programs])
 _LT_AC_TAGVAR(hardcode_action, $1)=
 if test -n &quot;$_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)&quot; || \
-   test -n &quot;$_LT_AC_TAGVAR(runpath_var $1)&quot;; then
+   test -n &quot;$_LT_AC_TAGVAR(runpath_var $1)&quot; || \
+   test &quot;X$_LT_AC_TAGVAR(hardcode_automatic, $1)&quot;=&quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$_LT_AC_TAGVAR(hardcode_direct, $1)&quot; != no &amp;&amp;
@@ -978,7 +1059,20 @@
   test -z &quot;$striplib&quot; &amp;&amp; striplib=&quot;$STRIP --strip-unneeded&quot;
   AC_MSG_RESULT([yes])
 else
+# FIXME - insert some real tests, host_os isn't really good enough
+  case $host_os in
+   darwin*)
+       if test -n &quot;$STRIP&quot; ; then
+         striplib=&quot;$STRIP -x&quot;
+         AC_MSG_RESULT([yes])
+       else
+  AC_MSG_RESULT([no])
+fi
+       ;;
+   *)
   AC_MSG_RESULT([no])
+    ;;
+  esac  
 fi
 ])# AC_LIBTOOL_SYS_LIB_STRIP
 
@@ -991,6 +1085,7 @@
 library_names_spec=
 libname_spec='lib$name'
 soname_spec=
+shrext=&quot;.so&quot;
 postinstall_cmds=
 postuninstall_cmds=
 finish_cmds=
@@ -1011,19 +1106,21 @@
 case $host_os in
 aix3*)
   version_type=linux
-  library_names_spec='${libname}${release}.so$versuffix $libname.a'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix $libname.a'
   shlibpath_var=LIBPATH
 
   # AIX 3 has no versioning support, so we append a major version to the name.
-  soname_spec='${libname}${release}.so$major'
+  soname_spec='${libname}${release}${shared_ext}$major'
   ;;
 
 aix4* | aix5*)
   version_type=linux
+  need_lib_prefix=no
+  need_version=no
   hardcode_into_libs=yes
   if test &quot;$host_cpu&quot; = ia64; then
     # AIX 5 supports IA64
-    library_names_spec='${libname}${release}.so$major ${libname}${release}.so$versuffix $libname.so'
+    library_names_spec='${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext}$versuffix $libname${shared_ext}'
     shlibpath_var=LD_LIBRARY_PATH
   else
     # With GCC up to 2.95.x, collect2 would create an import file
@@ -1049,12 +1146,12 @@
       # If using run time linking (on AIX 4.2 or later) use lib&lt;name&gt;.so
       # instead of lib&lt;name&gt;.a to let people know that these are not
       # typical AIX shared libraries.
-      library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
     else
       # We preserve .a as extension for shared libraries through AIX4.2
       # and later when we are not doing run time linking.
       library_names_spec='${libname}${release}.a $libname.a'
-      soname_spec='${libname}${release}.so$major'
+      soname_spec='${libname}${release}${shared_ext}$major'
     fi
     shlibpath_var=LIBPATH
   fi
@@ -1067,7 +1164,7 @@
   ;;
 
 beos*)
-  library_names_spec='${libname}.so'
+  library_names_spec='${libname}${shared_ext}'
   dynamic_linker=&quot;$host_os ld.so&quot;
   shlibpath_var=LIBRARY_PATH
   ;;
@@ -1075,8 +1172,8 @@
 bsdi4*)
   version_type=linux
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec=&quot;/shlib /usr/lib /usr/X11/lib /usr/contrib/lib /lib /usr/local/lib&quot;
@@ -1088,41 +1185,55 @@
 
 cygwin* | mingw* | pw32*)
   version_type=windows
+  shrext=&quot;.dll&quot;
   need_version=no
   need_lib_prefix=no
+
   case $GCC,$host_os in
-  yes,cygwin*)
+  yes,cygwin* | yes,mingw* | yes,pw32*)
     library_names_spec='$libname.dll.a'
-    sys_lib_search_path_spec=&quot;/lib /lib/w32api /usr/lib /usr/local/lib&quot;
-    soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | sed -e 's/[[.]]/-/g'`${versuffix}.dll'
-    postinstall_cmds='dlpath=`bash 2&gt;&amp;1 -c '\''. $dir/${file}i;echo \$dlname'\''`~
+    # DLL is installed to $(libdir)/../bin by postinstall_cmds
+    postinstall_cmds='base_file=`basename \${file}`~
+      dlpath=`$SHELL 2&gt;&amp;1 -c '\''. $dir/'\''\${base_file}'\''i;echo \$dlname'\''`~
       dldir=$destdir/`dirname \$dlpath`~
       test -d \$dldir || mkdir -p \$dldir~
-      $install_prog .libs/$dlname \$dldir/$dlname'
-    postuninstall_cmds='dldll=`bash 2&gt;&amp;1 -c '\''. $file; echo \$dlname'\''`~
+      $install_prog $dir/$dlname \$dldir/$dlname'
+    postuninstall_cmds='dldll=`$SHELL 2&gt;&amp;1 -c '\''. $file; echo \$dlname'\''`~
       dlpath=$dir/\$dldll~
        $rm \$dlpath'
+    shlibpath_overrides_runpath=yes
+
+    case $host_os in
+    cygwin*)
+      # Cygwin DLLs use 'cyg' prefix rather than 'lib'
+      soname_spec='`echo ${libname} | sed -e 's/^lib/cyg/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+      sys_lib_search_path_spec=&quot;/usr/lib /lib/w32api /lib /usr/local/lib&quot;
+      ;;
+    mingw*)
+      # MinGW DLLs use traditional 'lib' prefix
+      soname_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
+      sys_lib_search_path_spec=`$CC -print-search-dirs | grep &quot;^libraries:&quot; | $SED -e &quot;s/^<A HREF="libraries://">libraries://</A>&quot; -e &quot;s,=/,/,g&quot;`
+      if echo &quot;$sys_lib_search_path_spec&quot; | [grep ';[c-zC-Z]:/' &gt;/dev/null]; then
+        # It is most probably a Windows format PATH printed by
+        # mingw gcc, but we are running on Cygwin. Gcc prints its search
+        # path with ; separators, and with drive letters. We can handle the
+        # drive letters (cygwin fileutils understands them), so leave them,
+        # especially as we might pass files found there to a mingw objdump,
+        # which wouldn't understand a cygwinified path. Ahh.
+        sys_lib_search_path_spec=`echo &quot;$sys_lib_search_path_spec&quot; | $SED -e 's/;/ /g'`
+      else
+        sys_lib_search_path_spec=`echo &quot;$sys_lib_search_path_spec&quot; | $SED  -e &quot;s/$PATH_SEPARATOR/ /g&quot;`
+      fi
+      ;;
+    pw32*)
+      # pw32 DLLs use 'pw' prefix rather than 'lib'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      ;;
+    esac
     ;;
-  yes,mingw*)
-    library_names_spec='${libname}`echo ${release} | sed -e 's/[[.]]/-/g'`${versuffix}.dll'
-    sys_lib_search_path_spec=`$CC -print-search-dirs | grep &quot;^libraries:&quot; | sed -e &quot;s/^<A HREF="libraries://">libraries://</A>&quot;`
-    if echo &quot;$sys_lib_search_path_spec&quot; | [egrep ';[C-Z]:/' &gt;/dev/null]; then
-      # It is most probably a Windows format PATH printed by
-      # mingw gcc, but we are running on Cygwin. Gcc prints its search
-      # path with ; separators, and with drive letters. We can handle the
-      # drive letters (cygwin fileutils understands them), so leave them,
-      # especially as we might pass files found there to a mingw objdump,
-      # which wouldn't understand a cygwinified path. Ahh.
-      sys_lib_search_path_spec=`echo &quot;$sys_lib_search_path_spec&quot; | sed -e 's/;/ /g'`
-    else
-      sys_lib_search_path_spec=`echo &quot;$sys_lib_search_path_spec&quot; | sed  -e &quot;s/$PATH_SEPARATOR/ /g&quot;`
-    fi
-    ;;
-  yes,pw32*)
-    library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | sed -e 's/[.]/-/g'`${versuffix}.dll'
-    ;;
+
   *)
-    library_names_spec='${libname}`echo ${release} | sed -e 's/[[.]]/-/g'`${versuffix}.dll $libname.lib'
+    library_names_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
   esac
   dynamic_linker='Win32 ld.exe'
@@ -1135,21 +1246,26 @@
   version_type=darwin
   need_lib_prefix=no
   need_version=no
-  # FIXME: Relying on posixy $() will cause problems for
-  #        cross-compilation, but unfortunately the echo tests do not
-  #        yet detect zsh echo's removal of \ escapes.
-  library_names_spec='${libname}${release}${versuffix}.$(test .$module = .yes &amp;&amp; echo so || echo dylib) ${libname}${release}${major}.$(test .$module = .yes &amp;&amp; echo so || echo dylib) ${libname}.$(test .$module = .yes &amp;&amp; echo so || echo dylib)'
-  soname_spec='${libname}${release}${major}.$(test .$module = .yes &amp;&amp; echo so || echo dylib)'
+  library_names_spec='${libname}${release}${versuffix}$shared_ext ${libname}${release}${major}$shared_ext ${libname}$shared_ext'
+  soname_spec='${libname}${release}${major}$shared_ext'
   shlibpath_overrides_runpath=yes
   shlibpath_var=DYLD_LIBRARY_PATH
+  shrext='$(test .$module = .yes &amp;&amp; echo .so || echo .dylib)'
+  # Apple's gcc prints 'gcc -print-search-dirs' doesn't operate the same.
+  if test &quot;$GCC&quot; = yes; then
+    sys_lib_search_path_spec=`$CC -print-search-dirs | tr &quot;\n&quot; &quot;$PATH_SEPARATOR&quot; | sed -e 's/libraries:/@libraries:/' | tr &quot;@&quot; &quot;\n&quot; | grep &quot;^libraries:&quot; | sed -e &quot;s/^<A HREF="libraries://">libraries://</A>&quot; -e &quot;s,=/,/,g&quot; -e &quot;s,$PATH_SEPARATOR, ,g&quot; -e &quot;s,.*,&amp; /lib /usr/lib /usr/local/lib,g&quot;`
+  else
+    sys_lib_search_path_spec='/lib /usr/lib /usr/local/lib'
+  fi
+  sys_lib_dlsearch_path_spec='/usr/local/lib /lib /usr/lib'
   ;;
 
 dgux*)
   version_type=linux
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname$shared_ext'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@@ -1157,17 +1273,29 @@
   dynamic_linker=no
   ;;
 
+freebsd*-gnu*)
+  version_type=linux
+  need_lib_prefix=no
+  need_version=no
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  shlibpath_var=LD_LIBRARY_PATH
+  shlibpath_overrides_runpath=no
+  hardcode_into_libs=yes
+  dynamic_linker='GNU ld.so'
+  ;;
+
 freebsd*)
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
     freebsd-elf*)
-      library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so $libname.so'
+      library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext} $libname${shared_ext}'
       need_version=no
       need_lib_prefix=no
       ;;
     freebsd-*)
-      library_names_spec='${libname}${release}.so$versuffix $libname.so$versuffix'
+      library_names_spec='${libname}${release}${shared_ext}$versuffix $libname${shared_ext}$versuffix'
       need_version=yes
       ;;
   esac
@@ -1191,8 +1319,8 @@
   version_type=linux
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so${major} ${libname}.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}${major} ${libname}${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   hardcode_into_libs=yes
   ;;
@@ -1203,26 +1331,42 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  if test &quot;$host_cpu&quot; = ia64; then
+  case &quot;$host_cpu&quot; in
+  ia64*)
+    shrext='.so'
     hardcode_into_libs=yes
     dynamic_linker=&quot;$host_os dld.so&quot;
     shlibpath_var=LD_LIBRARY_PATH
     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
-    library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-    soname_spec='${libname}${release}.so$major'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
     if test &quot;X$HPUX_IA64_MODE&quot; = X32; then
       sys_lib_search_path_spec=&quot;/usr/lib/hpux32 /usr/local/lib/hpux32 /usr/local/lib&quot;
     else
       sys_lib_search_path_spec=&quot;/usr/lib/hpux64 /usr/local/lib/hpux64&quot;
     fi
     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
-  else
+    ;;
+   hppa*64*)
+     shrext='.sl'
+     hardcode_into_libs=yes
+     dynamic_linker=&quot;$host_os dld.sl&quot;
+     shlibpath_var=LD_LIBRARY_PATH # How should we handle SHLIB_PATH
+     shlibpath_overrides_runpath=yes # Unless +noenvvar is specified.
+     library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+     soname_spec='${libname}${release}${shared_ext}$major'
+     sys_lib_search_path_spec=&quot;/usr/lib/pa20_64 /usr/ccs/lib/pa20_64&quot;
+     sys_lib_dlsearch_path_spec=$sys_lib_search_path_spec
+     ;;
+   *)
+    shrext='.sl'
     dynamic_linker=&quot;$host_os dld.sl&quot;
     shlibpath_var=SHLIB_PATH
     shlibpath_overrides_runpath=no # +s is required to enable SHLIB_PATH
-    library_names_spec='${libname}${release}.sl$versuffix ${libname}${release}.sl$major $libname.sl'
-    soname_spec='${libname}${release}.sl$major'
-  fi
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
+    ;;
+  esac
   # HP-UX runs *really* slowly unless shared libraries are mode 555.
   postinstall_cmds='chmod 555 $lib'
   ;;
@@ -1230,21 +1374,29 @@
 irix5* | irix6* | nonstopux*)
   case $host_os in
     nonstopux*) version_type=nonstopux ;;
-    *)          version_type=irix ;;
+    *)
+	if test &quot;$lt_cv_prog_gnu_ld&quot; = yes; then
+		version_type=linux
+	else
+		version_type=irix
+	fi ;;
   esac
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}.so$major'
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major ${libname}${release}.so $libname.so'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} $libname${shared_ext}'
   case $host_os in
   irix5* | nonstopux*)
     libsuff= shlibsuff=
     ;;
   *)
     case $LD in # libtool.m4 will add one of these switches to LD
-    *-32|*&quot;-32 &quot;) libsuff= shlibsuff= libmagic=32-bit;;
-    *-n32|*&quot;-n32 &quot;) libsuff=32 shlibsuff=N32 libmagic=N32;;
-    *-64|*&quot;-64 &quot;) libsuff=64 shlibsuff=64 libmagic=64-bit;;
+    *-32|*&quot;-32 &quot;|*-melf32bsmip|*&quot;-melf32bsmip &quot;)
+      libsuff= shlibsuff= libmagic=32-bit;;
+    *-n32|*&quot;-n32 &quot;|*-melf32bmipn32|*&quot;-melf32bmipn32 &quot;)
+      libsuff=32 shlibsuff=N32 libmagic=N32;;
+    *-64|*&quot;-64 &quot;|*-melf64bmip|*&quot;-melf64bmip &quot;)
+      libsuff=64 shlibsuff=64 libmagic=64-bit;;
     *) libsuff= shlibsuff= libmagic=never-match;;
     esac
     ;;
@@ -1253,6 +1405,7 @@
   shlibpath_overrides_runpath=no
   sys_lib_search_path_spec=&quot;/usr/lib${libsuff} /lib${libsuff} /usr/local/lib${libsuff}&quot;
   sys_lib_dlsearch_path_spec=&quot;/usr/lib${libsuff} /lib${libsuff}&quot;
+  hardcode_into_libs=yes
   ;;
 
 # No shared lib support for Linux oldld, aout, or coff.
@@ -1265,8 +1418,8 @@
   version_type=linux
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -n $libdir'
   libsuff=
   if test &quot;x$LINUX_64_MODE&quot; = x64; then
@@ -1298,12 +1451,12 @@
   need_lib_prefix=no
   need_version=no
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
-    library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
     finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
     dynamic_linker='NetBSD (a.out) ld.so'
   else
-    library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major ${libname}${release}.so ${libname}.so'
-    soname_spec='${libname}${release}.so$major'
+    library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${release}${shared_ext} ${libname}${shared_ext}'
+    soname_spec='${libname}${release}${shared_ext}$major'
     dynamic_linker='NetBSD ld.elf_so'
   fi
   shlibpath_var=LD_LIBRARY_PATH
@@ -1313,17 +1466,17 @@
 
 newsos6)
   version_type=linux
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   ;;
 
-nto-qnx)
+nto-qnx*)
   version_type=linux
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   ;;
@@ -1332,7 +1485,7 @@
   version_type=sunos
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
@@ -1351,8 +1504,9 @@
 
 os2*)
   libname_spec='$name'
+  shrext=&quot;.dll&quot;
   need_lib_prefix=no
-  library_names_spec='$libname.dll $libname.a'
+  library_names_spec='$libname${shared_ext} $libname.a'
   dynamic_linker='OS/2 ld.exe'
   shlibpath_var=LIBPATH
   ;;
@@ -1361,8 +1515,8 @@
   version_type=osf
   need_lib_prefix=no
   need_version=no
-  soname_spec='${libname}${release}.so'
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so $libname.so'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   sys_lib_search_path_spec=&quot;/usr/shlib /usr/ccs/lib /usr/lib/cmplrs/cc /usr/lib /usr/local/lib /var/shlib&quot;
   sys_lib_dlsearch_path_spec=&quot;$sys_lib_search_path_spec&quot;
@@ -1370,8 +1524,8 @@
 
 sco3.2v5*)
   version_type=osf
-  soname_spec='${libname}${release}.so$major'
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
+  soname_spec='${libname}${release}${shared_ext}$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@@ -1379,8 +1533,8 @@
   version_type=linux
   need_lib_prefix=no
   need_version=no
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
   hardcode_into_libs=yes
@@ -1390,7 +1544,7 @@
 
 sunos4*)
   version_type=sunos
-  library_names_spec='${libname}${release}.so$versuffix ${libname}.so$versuffix'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/usr/etc&quot; ldconfig $libdir'
   shlibpath_var=LD_LIBRARY_PATH
   shlibpath_overrides_runpath=yes
@@ -1402,12 +1556,18 @@
 
 sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
   version_type=linux
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   case $host_vendor in
     sni)
       shlibpath_overrides_runpath=no
+      need_lib_prefix=no
+      export_dynamic_flag_spec='${wl}-Blargedynsym'
+      runpath_var=LD_RUN_PATH
+      ;;
+    siemens)
+      need_lib_prefix=no
       ;;
     motorola)
       need_lib_prefix=no
@@ -1421,16 +1581,16 @@
 sysv4*MP*)
   if test -d /usr/nec ;then
     version_type=linux
-    library_names_spec='$libname.so.$versuffix $libname.so.$major $libname.so'
-    soname_spec='$libname.so.$major'
+    library_names_spec='$libname${shared_ext}.$versuffix $libname${shared_ext}.$major $libname${shared_ext}'
+    soname_spec='$libname${shared_ext}.$major'
     shlibpath_var=LD_LIBRARY_PATH
   fi
   ;;
 
 uts4*)
   version_type=linux
-  library_names_spec='${libname}${release}.so$versuffix ${libname}${release}.so$major $libname.so'
-  soname_spec='${libname}${release}.so$major'
+  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
+  soname_spec='${libname}${release}${shared_ext}$major'
   shlibpath_var=LD_LIBRARY_PATH
   ;;
 
@@ -1447,13 +1607,9 @@
 # ----------------
 AC_DEFUN([_LT_AC_TAGCONFIG],
 [AC_ARG_WITH([tags],
-    [AC_HELP_STRING([--with-tags=TAGS],
-	[include additional configurations @&lt;:@CXX,GCJ@:&gt;@])],
-    [tagnames=&quot;$withval&quot;],
-    [tagnames=&quot;CXX,GCJ&quot;
-    case $host_os in
-      mingw*|cygwin*) tagnames=&quot;$tagnames,RC&quot; ;;
-    esac])
+    [AC_HELP_STRING([--with-tags@&lt;:@=TAGS@:&gt;@],
+        [include additional configurations @&lt;:@automatic@:&gt;@])],
+    [tagnames=&quot;$withval&quot;])
 
 if test -f &quot;$ltmain&quot; &amp;&amp; test -n &quot;$tagnames&quot;; then
   if test ! -f &quot;${ofile}&quot;; then
@@ -1471,7 +1627,7 @@
 
   # Extract list of available tagged configurations in $ofile.
   # Note that this assumes the entire list is on one line.
-  available_tags=`grep &quot;^available_tags=&quot; &quot;${ofile}&quot; | sed -e 's/available_tags=\(.*$\)/\1/' -e 's/\&quot;//g'`
+  available_tags=`grep &quot;^available_tags=&quot; &quot;${ofile}&quot; | $SED -e 's/available_tags=\(.*$\)/\1/' -e 's/\&quot;//g'`
 
   lt_save_ifs=&quot;$IFS&quot;; IFS=&quot;${IFS}$PATH_SEPARATOR,&quot;
   for tagname in $tagnames; do
@@ -1494,11 +1650,27 @@
 
       case $tagname in
       CXX)
-	AC_LIBTOOL_LANG_CXX_CONFIG
+	if test -n &quot;$CXX&quot; &amp;&amp; test &quot;X$CXX&quot; != &quot;Xno&quot;; then
+	  AC_LIBTOOL_LANG_CXX_CONFIG
+	else
+	  tagname=&quot;&quot;
+	fi
+	;;
+
+      F77)
+	if test -n &quot;$F77&quot; &amp;&amp; test &quot;X$F77&quot; != &quot;Xno&quot;; then
+	  AC_LIBTOOL_LANG_F77_CONFIG
+	else
+	  tagname=&quot;&quot;
+	fi
 	;;
 
       GCJ)
-	AC_LIBTOOL_LANG_GCJ_CONFIG
+	if test -n &quot;$GCJ&quot; &amp;&amp; test &quot;X$GCJ&quot; != &quot;Xno&quot;; then
+	  AC_LIBTOOL_LANG_GCJ_CONFIG
+	else
+	  tagname=&quot;&quot;
+	fi
 	;;
 
       RC)
@@ -1511,8 +1683,10 @@
       esac
 
       # Append the new tag name to the list of available tags.
+      if test -n &quot;$tagname&quot; ; then
       available_tags=&quot;$available_tags $tagname&quot;
     fi
+    fi
   done
   IFS=&quot;$lt_save_ifs&quot;
 
@@ -1671,11 +1845,27 @@
 ])# AC_LIBTOOL_PICMODE
 
 
+# AC_PROG_EGREP
+# -------------
+# This is predefined starting with Autoconf 2.54, so this conditional
+# definition can be removed once we require Autoconf 2.54 or later.
+m4_ifndef([AC_PROG_EGREP], [AC_DEFUN([AC_PROG_EGREP],
+[AC_CACHE_CHECK([for egrep], [ac_cv_prog_egrep],
+   [if echo a | (grep -E '(a|b)') &gt;/dev/null 2&gt;&amp;1
+    then ac_cv_prog_egrep='grep -E'
+    else ac_cv_prog_egrep='egrep'
+    fi])
+ EGREP=$ac_cv_prog_egrep
+ AC_SUBST([EGREP])
+])])
+
+
 # AC_PATH_TOOL_PREFIX
 # -------------------
 # find a file program which can recognise shared library
 AC_DEFUN([AC_PATH_TOOL_PREFIX],
-[AC_MSG_CHECKING([for $1])
+[AC_REQUIRE([AC_PROG_EGREP])dnl
+AC_MSG_CHECKING([for $1])
 AC_CACHE_VAL(lt_cv_path_MAGIC_CMD,
 [case $MAGIC_CMD in
 [[\\/*] |  ?:[\\/]*])
@@ -1699,7 +1889,7 @@
 	  file_magic_regex=&quot;`expr \&quot;$deplibs_check_method\&quot; : \&quot;file_magic \(.*\)\&quot;`&quot;
 	  MAGIC_CMD=&quot;$lt_cv_path_MAGIC_CMD&quot;
 	  if eval $file_magic_cmd \$file_magic_test_file 2&gt; /dev/null |
-	    egrep &quot;$file_magic_regex&quot; &gt; /dev/null; then
+	    $EGREP &quot;$file_magic_regex&quot; &gt; /dev/null; then
 	    :
 	  else
 	    cat &lt;&lt;EOF 1&gt;&amp;2
@@ -1750,20 +1940,21 @@
 
 # AC_PROG_LD
 # ----------
-# find the path to the GNU or non-GNU linker
+# find the pathname to the GNU or non-GNU linker
 AC_DEFUN([AC_PROG_LD],
 [AC_ARG_WITH([gnu-ld],
     [AC_HELP_STRING([--with-gnu-ld],
 	[assume the C compiler uses GNU ld @&lt;:@default=no@:&gt;@])],
     [test &quot;$withval&quot; = no || with_gnu_ld=yes],
     [with_gnu_ld=no])
+AC_REQUIRE([LT_AC_PROG_SED])dnl
 AC_REQUIRE([AC_PROG_CC])dnl
 AC_REQUIRE([AC_CANONICAL_HOST])dnl
 AC_REQUIRE([AC_CANONICAL_BUILD])dnl
 ac_prog=ld
 if test &quot;$GCC&quot; = yes; then
   # Check if gcc -print-prog-name=ld gives a path.
-  AC_MSG_CHECKING([for ld used by GCC])
+  AC_MSG_CHECKING([for ld used by $CC])
   case $host in
   *-*-mingw*)
     # gcc leaves a trailing carriage return which upsets mingw
@@ -1775,10 +1966,10 @@
     # Accept absolute paths.
     [[\\/]]* | ?:[[\\/]]*)
       re_direlt='/[[^/]][[^/]]*/\.\./'
-      # Canonicalize the path of ld
-      ac_prog=`echo $ac_prog| sed 's%\\\\%/%g'`
+      # Canonicalize the pathname of ld
+      ac_prog=`echo $ac_prog| $SED 's%\\\\%/%g'`
       while echo $ac_prog | grep &quot;$re_direlt&quot; &gt; /dev/null 2&gt;&amp;1; do
-	ac_prog=`echo $ac_prog| sed &quot;s%$re_direlt%/%&quot;`
+	ac_prog=`echo $ac_prog| $SED &quot;s%$re_direlt%/%&quot;`
       done
       test -z &quot;$LD&quot; &amp;&amp; LD=&quot;$ac_prog&quot;
       ;;
@@ -1807,11 +1998,14 @@
       # Check to see if the program is GNU ld.  I'd rather use --version,
       # but apparently some GNU ld's only accept -v.
       # Break only if it was the GNU/non-GNU ld that we prefer.
-      if &quot;$lt_cv_path_LD&quot; -v 2&gt;&amp;1 &lt; /dev/null | egrep '(GNU|with BFD)' &gt; /dev/null; then
+      case `&quot;$lt_cv_path_LD&quot; -v 2&gt;&amp;1 &lt;/dev/null` in
+      *GNU* | *'with BFD'*)
 	test &quot;$with_gnu_ld&quot; != no &amp;&amp; break
-      else
+	;;
+      *)
 	test &quot;$with_gnu_ld&quot; != yes &amp;&amp; break
-      fi
+	;;
+      esac
     fi
   done
   IFS=&quot;$lt_save_ifs&quot;
@@ -1832,13 +2026,17 @@
 # AC_PROG_LD_GNU
 # --------------
 AC_DEFUN([AC_PROG_LD_GNU],
-[AC_CACHE_CHECK([if the linker ($LD) is GNU ld], lt_cv_prog_gnu_ld,
+[AC_REQUIRE([AC_PROG_EGREP])dnl
+AC_CACHE_CHECK([if the linker ($LD) is GNU ld], lt_cv_prog_gnu_ld,
 [# I'd rather use --version here, but apparently some GNU ld's only accept -v.
-if $LD -v 2&gt;&amp;1 &lt;/dev/null | egrep '(GNU|with BFD)' 1&gt;&amp;5; then
+case `$LD -v 2&gt;&amp;1 &lt;/dev/null` in
+*GNU* | *'with BFD'*)
   lt_cv_prog_gnu_ld=yes
-else
+  ;;
+*)
   lt_cv_prog_gnu_ld=no
-fi])
+  ;;
+esac])
 with_gnu_ld=$lt_cv_prog_gnu_ld
 ])# AC_PROG_LD_GNU
 
@@ -1865,7 +2063,7 @@
 # how to check for library dependencies
 #  -- PORTME fill in with the dynamic library characteristics
 AC_DEFUN([AC_DEPLIBS_CHECK_METHOD],
-[AC_CACHE_CHECK([how to recognise dependant libraries],
+[AC_CACHE_CHECK([how to recognise dependent libraries],
 lt_cv_deplibs_check_method,
 [lt_cv_file_magic_cmd='$MAGIC_CMD'
 lt_cv_file_magic_test_file=
@@ -1877,7 +2075,7 @@
 # 'pass_all' -- all dependencies passed with no checks.
 # 'test_compile' -- check by making test program.
 # 'file_magic [[regex]]' -- check by looking for files in library path
-# which responds to the $file_magic_cmd with a given egrep regex.
+# which responds to the $file_magic_cmd with a given extended regex.
 # If you have `file' or equivalent on your system and you're not sure
 # whether `pass_all' will *always* work, you probably want this one.
 
@@ -1896,12 +2094,18 @@
   lt_cv_file_magic_test_file=/shlib/libc.so
   ;;
 
-cygwin* | mingw* | pw32*)
-  lt_cv_deplibs_check_method='file_magic file format pei*-i386(.*architecture: i386)?'
-  lt_cv_file_magic_cmd='$OBJDUMP -f'
+cygwin*)
+  lt_cv_deplibs_check_method=pass_all
+  ;;
+  
+mingw* | pw32*)
+  # win32_libid is a shell function defined in ltmain.sh
+  lt_cv_deplibs_check_method='file_magic ^x86 archive import|^x86 DLL'
+  lt_cv_file_magic_cmd='win32_libid'
   ;;
 
 darwin* | rhapsody*)
+  # this will be overwritten by pass_all, but leave it in just in case
   lt_cv_deplibs_check_method='file_magic Mach-O dynamically linked shared library'
   lt_cv_file_magic_cmd='/usr/bin/file -L'
   case &quot;$host_os&quot; in
@@ -1912,6 +2116,7 @@
     lt_cv_file_magic_test_file='/usr/lib/libSystem.dylib'
     ;;
   esac
+  lt_cv_deplibs_check_method=pass_all
   ;;
 
 freebsd*)
@@ -1936,13 +2141,20 @@
 
 hpux10.20* | hpux11*)
   lt_cv_file_magic_cmd=/usr/bin/file
-  if test &quot;$host_cpu&quot; = ia64; then
+  case &quot;$host_cpu&quot; in
+  ia64*)
     lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|ELF-[[0-9]][[0-9]]) shared object file - IA64'
     lt_cv_file_magic_test_file=/usr/lib/hpux32/libc.so
-  else
+    ;;
+  hppa*64*)
+    [lt_cv_deplibs_check_method='file_magic (s[0-9][0-9][0-9]|ELF-[0-9][0-9]) shared object file - PA-RISC [0-9].[0-9]']
+    lt_cv_file_magic_test_file=/usr/lib/pa20_64/libc.sl
+    ;;
+  *)
     lt_cv_deplibs_check_method='file_magic (s[[0-9]][[0-9]][[0-9]]|PA-RISC[[0-9]].[[0-9]]) shared library'
     lt_cv_file_magic_test_file=/usr/lib/libc.sl
-  fi
+    ;;
+  esac
   ;;
 
 irix5* | irix6* | nonstopux*)
@@ -1969,7 +2181,7 @@
 # This must be Linux ELF.
 linux*)
   case $host_cpu in
-  alpha* | hppa* | i*86 | ia64* | m68* | mips | mipsel | powerpc* | sparc* | s390* | sh* | x86_64* )
+  alpha* | hppa* | i*86 | ia64* | m68* | mips* | powerpc* | sparc* | s390* | sh* | x86_64* )
     lt_cv_deplibs_check_method=pass_all ;;
   # the debian people say, arm and glibc 2.3.1 works for them with pass_all
   arm* )
@@ -1983,9 +2195,9 @@
 
 netbsd*)
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt; /dev/null; then
-    lt_cv_deplibs_check_method='match_pattern /lib[[^/\.]]+\.so\.[[0-9]]+\.[[0-9]]+$'
+    lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   else
-    lt_cv_deplibs_check_method='match_pattern /lib[[^/\.]]+\.so$'
+    lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so|_pic\.a)$'
   fi
   ;;
 
@@ -1995,7 +2207,7 @@
   lt_cv_file_magic_test_file=/usr/lib/libnls.so
   ;;
 
-nto-qnx)
+nto-qnx*)
   lt_cv_deplibs_check_method=unknown
   ;;
 
@@ -2043,6 +2255,9 @@
     lt_cv_deplibs_check_method=&quot;file_magic ELF [[0-9]][[0-9]]*-bit [[LM]]SB dynamic lib&quot;
     lt_cv_file_magic_test_file=/lib/libc.so
     ;;
+  siemens)
+    lt_cv_deplibs_check_method=pass_all
+    ;;
   esac
   ;;
 
@@ -2059,7 +2274,7 @@
 
 # AC_PROG_NM
 # ----------
-# find the path to a BSD-compatible name lister
+# find the pathname to a BSD-compatible name lister
 AC_DEFUN([AC_PROG_NM],
 [AC_CACHE_CHECK([for BSD-compatible nm], lt_cv_path_NM,
 [if test -n &quot;$NM&quot;; then
@@ -2076,16 +2291,23 @@
       # Adding the `sed 1q' prevents false positives on HP-UX, which says:
       #   nm: unknown option &quot;B&quot; ignored
       # Tru64's nm complains that /dev/null is an invalid object file
-      if (&quot;$tmp_nm&quot; -B /dev/null 2&gt;&amp;1 | sed '1q'; exit 0) | egrep '(/dev/null|Invalid file or object type)' &gt;/dev/null; then
+      case `&quot;$tmp_nm&quot; -B /dev/null 2&gt;&amp;1 | sed '1q'` in
+      */dev/null* | *'Invalid file or object type'*)
 	lt_cv_path_NM=&quot;$tmp_nm -B&quot;
 	break
-      elif (&quot;$tmp_nm&quot; -p /dev/null 2&gt;&amp;1 | sed '1q'; exit 0) | egrep /dev/null &gt;/dev/null; then
-	lt_cv_path_NM=&quot;$tmp_nm -p&quot;
-	break
-      else
-	lt_cv_path_NM=${lt_cv_path_NM=&quot;$tmp_nm&quot;} # keep the first match, but
-	continue # so that we can try to find one that supports BSD flags
-      fi
+        ;;
+      *)
+	case `&quot;$tmp_nm&quot; -p /dev/null 2&gt;&amp;1 | sed '1q'` in
+	*/dev/null*)
+	  lt_cv_path_NM=&quot;$tmp_nm -p&quot;
+	  break
+	  ;;
+	*)
+	  lt_cv_path_NM=${lt_cv_path_NM=&quot;$tmp_nm&quot;} # keep the first match, but
+	  continue # so that we can try to find one that supports BSD flags
+	  ;;
+	esac
+      esac
     fi
   done
   IFS=&quot;$lt_save_ifs&quot;
@@ -2102,15 +2324,15 @@
 [AC_REQUIRE([AC_CANONICAL_HOST])dnl
 LIBM=
 case $host in
-*-*-beos* | *-*-cygwin* | *-*-pw32*)
-  # These system don't have libm
+*-*-beos* | *-*-cygwin* | *-*-pw32* | *-*-darwin*)
+  # These system don't have libm, or don't need it
   ;;
 *-ncr-sysv4.3*)
   AC_CHECK_LIB(mw, _mwvalidcheckl, LIBM=&quot;-lmw&quot;)
-  AC_CHECK_LIB(m, main, LIBM=&quot;$LIBM -lm&quot;)
+  AC_CHECK_LIB(m, cos, LIBM=&quot;$LIBM -lm&quot;)
   ;;
 *)
-  AC_CHECK_LIB(m, main, LIBM=&quot;-lm&quot;)
+  AC_CHECK_LIB(m, cos, LIBM=&quot;-lm&quot;)
   ;;
 esac
 ])# AC_CHECK_LIBM
@@ -2155,7 +2377,7 @@
 # In the future, this macro may have to be called after AC_PROG_LIBTOOL.
 AC_DEFUN([AC_LIBLTDL_INSTALLABLE],
 [AC_BEFORE([$0],[AC_LIBTOOL_SETUP])dnl
-  AC_CHECK_LIB(ltdl, main,
+  AC_CHECK_LIB(ltdl, lt_dlinit,
   [test x&quot;$enable_ltdl_install&quot; != xyes &amp;&amp; enable_ltdl_install=no],
   [if test x&quot;$enable_ltdl_install&quot; = xno; then
      AC_MSG_WARN([libltdl not installed, but installation disabled])
@@ -2177,14 +2399,6 @@
 ])# AC_LIBLTDL_INSTALLABLE
 
 
-# If this macro is not defined by Autoconf, define it here.
-ifdef([AC_PROVIDE_IFELSE],
-      [],
-      [define([AC_PROVIDE_IFELSE],
-	      [ifdef([AC_PROVIDE_$1],
-		     [$2], [$3])])])
-
-
 # AC_LIBTOOL_CXX
 # --------------
 # enable support for C++ libraries
@@ -2198,9 +2412,26 @@
 AC_DEFUN([_LT_AC_LANG_CXX],
 [AC_REQUIRE([AC_PROG_CXX])
 AC_REQUIRE([AC_PROG_CXXCPP])
+_LT_AC_SHELL_INIT([tagnames=${tagnames+${tagnames},}CXX])
 ])# _LT_AC_LANG_CXX
 
 
+# AC_LIBTOOL_F77
+# --------------
+# enable support for Fortran 77 libraries
+AC_DEFUN([AC_LIBTOOL_F77],
+[AC_REQUIRE([_LT_AC_LANG_F77])
+])# AC_LIBTOOL_F77
+
+
+# _LT_AC_LANG_F77
+# ---------------
+AC_DEFUN([_LT_AC_LANG_F77],
+[AC_REQUIRE([AC_PROG_F77])
+_LT_AC_SHELL_INIT([tagnames=${tagnames+${tagnames},}F77])
+])# _LT_AC_LANG_F77
+
+
 # AC_LIBTOOL_GCJ
 # --------------
 # enable support for GCJ libraries
@@ -2218,6 +2449,7 @@
       [ifdef([AC_PROG_GCJ],[AC_REQUIRE([AC_PROG_GCJ])],
 	 [ifdef([A][M_PROG_GCJ],[AC_REQUIRE([A][M_PROG_GCJ])],
 	   [AC_REQUIRE([A][C_PROG_GCJ_OR_A][M_PROG_GCJ])])])])])])
+_LT_AC_SHELL_INIT([tagnames=${tagnames+${tagnames},}GCJ])
 ])# _LT_AC_LANG_GCJ
 
 
@@ -2225,7 +2457,8 @@
 # --------------
 # enable support for Windows resource files
 AC_DEFUN([AC_LIBTOOL_RC],
-[AC_REQUIRE([AC_PROG_RC])
+[AC_REQUIRE([LT_AC_PROG_RC])
+_LT_AC_SHELL_INIT([tagnames=${tagnames+${tagnames},}RC])
 ])# AC_LIBTOOL_RC
 
 
@@ -2247,10 +2480,10 @@
 _LT_AC_TAGVAR(objext, $1)=$objext
 
 # Code to be used in simple compile tests
-lt_simple_compile_test_code=&quot;int some_variable = 0;&quot;
+lt_simple_compile_test_code=&quot;int some_variable = 0;\n&quot;
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='main(){return(0);}'
+lt_simple_link_test_code='int main(){return(0);}\n'
 
 _LT_AC_SYS_COMPILER
 
@@ -2267,7 +2500,7 @@
 fi
 if test -n &quot;$_LT_AC_TAGVAR(lt_prog_cc_shlib, $1)&quot;; then
   AC_MSG_WARN([`$CC' requires `$_LT_AC_TAGVAR(lt_prog_cc_shlib, $1)' to build shared libraries])
-  if echo &quot;$old_CC $old_CFLAGS &quot; | egrep -e &quot;[[ 	]]$]_LT_AC_TAGVAR(lt_prog_cc_shlib, $1)[[[ 	]]&quot; &gt;/dev/null; then :
+  if echo &quot;$old_CC $old_CFLAGS &quot; | grep &quot;[[ 	]]$]_LT_AC_TAGVAR(lt_prog_cc_shlib, $1)[[[ 	]]&quot; &gt;/dev/null; then :
   else
     AC_MSG_WARN([add `$_LT_AC_TAGVAR(lt_prog_cc_shlib, $1)' to the CC or CFLAGS env variable and reconfigure])
     _LT_AC_TAGVAR(lt_cv_prog_cc_can_build_shared, $1)=no
@@ -2294,9 +2527,9 @@
 AC_LIBTOOL_PROG_CC_C_O($1)
 AC_LIBTOOL_SYS_HARD_LINK_LOCKS($1)
 AC_LIBTOOL_PROG_LD_SHLIBS($1)
+AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
 AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH($1)
 AC_LIBTOOL_SYS_LIB_STRIP
-AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
 AC_LIBTOOL_DLOPEN_SELF($1)
 
 # Report which librarie types wil actually be built
@@ -2322,6 +2555,32 @@
     test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
   fi
   ;;
+  darwin* | rhapsody*)
+  if test &quot;$GCC&quot; = yes; then
+    _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+    case &quot;$host_os&quot; in
+    rhapsody* | darwin1.[[012]])
+      _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
+      ;;
+    *) # Darwin 1.3 on
+      test -z ${LD_TWOLEVEL_NAMESPACE} &amp;&amp; _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+      ;;
+    esac
+    output_verbose_link_cmd='echo'
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring'
+    _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    _LT_AC_TAGVAR(hardcode_direct, $1)=no
+    _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
+    _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
+    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
+    _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
+  else
+    _LT_AC_TAGVAR(ld_shlibs, $1)=no
+  fi  
+    ;;  
 esac
 AC_MSG_RESULT([$enable_shared])
 
@@ -2355,12 +2614,17 @@
 _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)=
 _LT_AC_TAGVAR(hardcode_direct, $1)=no
 _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
+_LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
 _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=
 _LT_AC_TAGVAR(hardcode_minus_L, $1)=no
+_LT_AC_TAGVAR(hardcode_automatic, $1)=no
+_LT_AC_TAGVAR(module_cmds, $1)=
+_LT_AC_TAGVAR(module_expsym_cmds, $1)=
 _LT_AC_TAGVAR(link_all_deplibs, $1)=unknown
 _LT_AC_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
 _LT_AC_TAGVAR(no_undefined_flag, $1)=
 _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
+_LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=no
 
 # Dependencies to place before and after the object being linked:
 _LT_AC_TAGVAR(predep_objects, $1)=
@@ -2369,27 +2633,42 @@
 _LT_AC_TAGVAR(postdeps, $1)=
 _LT_AC_TAGVAR(compiler_lib_search_path, $1)=
 
-# Source file extension for C test sources.
+# Source file extension for C++ test sources.
 ac_ext=cc
 
-# Object file extension for compiled C test sources.
+# Object file extension for compiled C++ test sources.
 objext=o
 _LT_AC_TAGVAR(objext, $1)=$objext
 
 # Code to be used in simple compile tests
-lt_simple_compile_test_code=&quot;int some_variable = 0;&quot;
+lt_simple_compile_test_code=&quot;int some_variable = 0;\n&quot;
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='int main(int char *[]) { return(0); }'
+lt_simple_link_test_code='int main(int, char *[]) { return(0); }\n'
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
 
 # Allow CC to be a program name with arguments.
-lt_save_CC=&quot;$CC&quot;
+lt_save_CC=$CC
+lt_save_LD=$LD
+lt_save_GCC=$GCC
+GCC=$GXX
+lt_save_with_gnu_ld=$with_gnu_ld
+lt_save_path_LD=$lt_cv_path_LD
+if test -n &quot;${lt_cv_prog_gnu_ldcxx+set}&quot;; then
+  lt_cv_prog_gnu_ld=$lt_cv_prog_gnu_ldcxx
+else
+  unset lt_cv_prog_gnu_ld
+fi
+if test -n &quot;${lt_cv_path_LDCXX+set}&quot;; then
+  lt_cv_path_LD=$lt_cv_path_LDCXX
+else
+  unset lt_cv_path_LD
+fi
+test -z &quot;${LDCXX+set}&quot; || LD=$LDCXX
 CC=${CXX-&quot;c++&quot;}
-set dummy $CC
-compiler=&quot;[$]2&quot;
+compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
 cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
 
@@ -2404,12 +2683,11 @@
 if test &quot;$GXX&quot; = yes; then
   # Set up default GNU C++ configuration
 
+  AC_PROG_LD
+
   # Check if GNU C++ uses GNU ld as the underlying linker, since the
   # archiving commands below assume that GNU ld is being used.
-  if eval &quot;`$CC -print-prog-name=ld` --version 2&gt;&amp;1&quot; | \
-      egrep 'GNU ld' &gt; /dev/null; then
-    with_gnu_ld=yes
-
+  if test &quot;$with_gnu_ld&quot; = yes; then
     _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
     _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 
@@ -2423,7 +2701,7 @@
 
     # ancient GNU ld didn't support --whole-archive et. al.
     if eval &quot;`$CC -print-prog-name=ld` --help 2&gt;&amp;1&quot; | \
-	egrep 'no-whole-archive' &gt; /dev/null; then
+	grep 'no-whole-archive' &gt; /dev/null; then
       _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
     else
       _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
@@ -2437,13 +2715,13 @@
     # linker, instead of GNU ld.  If possible, this setting should
     # overridden to take advantage of the native linker features on
     # the platform it is being used on.
-    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
   fi
 
   # Commands to make compiler produce verbose output that lists
   # what &quot;hidden&quot; libraries, object files and flags are used when
   # linking a shared library.
-  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep &quot;\-L&quot;'
+  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;\-L&quot;'
 
 else
   GXX=no
@@ -2564,6 +2842,71 @@
 	;;
     esac
     ;;
+
+  cygwin* | mingw* | pw32*)
+    # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
+    # as there is no search path for DLLs.
+    _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+    _LT_AC_TAGVAR(allow_undefined_flag, $1)=no
+    _LT_AC_TAGVAR(always_export_symbols, $1)=no
+    _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+
+    if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
+      # If the export-symbols file already is a .def file (1st line
+      # is EXPORTS), use it as is; otherwise, prepend...
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='if test &quot;x`$SED 1q $export_symbols`&quot; = xEXPORTS; then
+	cp $export_symbols $output_objdir/$soname.def;
+      else
+	echo EXPORTS &gt; $output_objdir/$soname.def;
+	cat $export_symbols &gt;&gt; $output_objdir/$soname.def;
+      fi~
+      $CC -shared -nostdlib $output_objdir/$soname.def $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
+    else
+      _LT_AC_TAGVAR(ld_shlibs, $1)=no
+    fi
+  ;;
+
+  darwin* | rhapsody*)
+  if test &quot;$GXX&quot; = yes; then
+    _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+    case &quot;$host_os&quot; in
+    rhapsody* | darwin1.[[012]])
+      _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
+      ;;
+    *) # Darwin 1.3 on
+      test -z ${LD_TWOLEVEL_NAMESPACE} &amp;&amp; _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+      ;;
+    esac
+    lt_int_apple_cc_single_mod=no
+    output_verbose_link_cmd='echo'
+    if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
+      lt_int_apple_cc_single_mod=yes
+    fi
+    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+    else
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+    fi
+    _LT_AC_TAGVAR(module_cmds, $1)='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+
+    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    else
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    fi
+    _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+    _LT_AC_TAGVAR(hardcode_direct, $1)=no
+    _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
+    _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
+    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
+    _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
+  else
+    _LT_AC_TAGVAR(ld_shlibs, $1)=no
+  fi
+    ;;
+
   dgux*)
     case $cc_basename in
       ec++)
@@ -2595,25 +2938,79 @@
     ;;
   gnu*)
     ;;
-  hpux*)
+  hpux9*)
+    _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+    _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
+    _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+    _LT_AC_TAGVAR(hardcode_direct, $1)=yes
+    _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes # Not in the search PATH,
+				# but as the default
+				# location of the library.
+
+    case $cc_basename in
+    CC)
+      # FIXME: insert proper C++ library support
+      _LT_AC_TAGVAR(ld_shlibs, $1)=no
+      ;;
+    aCC)
+      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      # Commands to make compiler produce verbose output that lists
+      # what &quot;hidden&quot; libraries, object files and flags are used when
+      # linking a shared library.
+      #
+      # There doesn't appear to be a way to prevent this compiler from
+      # explicitly linking system object files so we need to strip them
+      # from the output so that they don't get included in the library
+      # dependencies.
+      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | egrep &quot;\-L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+      ;;
+    *)
+      if test &quot;$GXX&quot; = yes; then
+        _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+      else
+        # FIXME: insert proper C++ library support
+        _LT_AC_TAGVAR(ld_shlibs, $1)=no
+      fi
+      ;;
+    esac
+    ;;
+  hpux10*|hpux11*)
     if test $with_gnu_ld = no; then
-      if test &quot;$host_cpu&quot; = ia64; then
+      case &quot;$host_cpu&quot; in
+      hppa*64*)
+	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+	_LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='+b $libdir'
+	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
+        ;;
+      ia64*)
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-      else
+        ;;
+      *)
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
 	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
 	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
-      fi
+        ;;
+      esac
     fi
-    if test &quot;$host_cpu&quot; = ia64; then
+    case &quot;$host_cpu&quot; in
+    hppa*64*)
       _LT_AC_TAGVAR(hardcode_direct, $1)=no
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
-    else
+      ;;
+    ia64*)
+      _LT_AC_TAGVAR(hardcode_direct, $1)=no
+      _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+      _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes # Not in the search PATH,
+					      # but as the default
+					      # location of the library.
+      ;;
+    *)
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
-    fi
-    _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes # Not in the search PATH,
-					    # but as the default
-					    # location of the library.
+      _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes # Not in the search PATH,
+					      # but as the default
+					      # location of the library.
+      ;;
+    esac
 
     case $cc_basename in
       CC)
@@ -2621,16 +3018,12 @@
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
       aCC)
-	case $host_os in
-	hpux9*)
-	  _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	case &quot;$host_cpu&quot; in
+	hppa*64*|ia64*)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
 	  ;;
 	*)
-	  if test &quot;$host_cpu&quot; = ia64; then
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
-	  else
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
-	  fi
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -b ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	  ;;
 	esac
 	# Commands to make compiler produce verbose output that lists
@@ -2641,21 +3034,17 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | egrep &quot;\-L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | grep &quot;\-L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 	;;
       *)
 	if test &quot;$GXX&quot; = yes; then
 	  if test $with_gnu_ld = no; then
-	    case $host_os in
-	    hpux9*)
-	      _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -shared -nostdlib -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
+	    case &quot;$host_cpu&quot; in
+	    ia64*|hppa*64*)
+	      _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
 	      ;;
 	    *)
-	      if test &quot;$host_cpu&quot; = ia64; then
-		_LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
-	      else
-		_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
-	      fi
+	      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
 	      ;;
 	    esac
 	  fi
@@ -2683,7 +3072,7 @@
 	  if test &quot;$with_gnu_ld&quot; = no; then
 	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
 	  else
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -o $lib'
+	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` -o $lib'
 	  fi
 	fi
 	_LT_AC_TAGVAR(link_all_deplibs, $1)=yes
@@ -2700,9 +3089,8 @@
 	# KCC will only create a shared library if the output file
 	# ends with &quot;.so&quot; (or &quot;.sl&quot; for HP-UX), so rename the library
 	# to its proper name (with version) after linking.
-	_LT_AC_TAGVAR(archive_cmds, $1)='templib=`echo $lib | sed -e &quot;s/\.so\..*/\.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='templib=`echo $lib | sed -e &quot;s/\.so\..*/\.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib ${wl}-retain-symbols-file,$export_symbols; mv \$templib $lib'
-
+	_LT_AC_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e &quot;s/\${tempext}\..*/.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e &quot;s/\${tempext}\..*/.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib ${wl}-retain-symbols-file,$export_symbols; mv \$templib $lib'
 	# Commands to make compiler produce verbose output that lists
 	# what &quot;hidden&quot; libraries, object files and flags are used when
 	# linking a shared library.
@@ -2711,7 +3099,7 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest.so 2&gt;&amp;1 | egrep &quot;ld&quot;`; rm -f libconftest.so; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`$CC $CFLAGS -v conftest.$objext -o libconftest$shared_ext 2&gt;&amp;1 | grep &quot;ld&quot;`; rm -f libconftest$shared_ext; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath,$libdir'
 	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -2747,7 +3135,7 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot;`; templist=`echo $templist | sed &quot;s/\(^.*ld.*\)\( .*ld .*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot;`; templist=`echo $templist | $SED &quot;s/\(^.*ld.*\)\( .*ld .*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 	;;
     esac
     ;;
@@ -2772,7 +3160,15 @@
     esac
     ;;
   netbsd*)
-    # NetBSD uses g++ - do we need to do anything?
+    if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
+      _LT_AC_TAGVAR(archive_cmds, $1)='$LD -Bshareable  -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags'
+      wlarc=
+      _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
+      _LT_AC_TAGVAR(hardcode_direct, $1)=yes
+      _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+    fi
+    # Workaround some broken pre-1.5 toolchains
+    output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep conftest.$objext | $SED -e &quot;s:-lgcc -lc -lgcc::&quot;'
     ;;
   osf3*)
     case $cc_basename in
@@ -2782,7 +3178,7 @@
 	# KCC will only create a shared library if the output file
 	# ends with &quot;.so&quot; (or &quot;.sl&quot; for HP-UX), so rename the library
 	# to its proper name (with version) after linking.
-	_LT_AC_TAGVAR(archive_cmds, $1)='templib=`echo $lib | sed -e &quot;s/\.so\..*/\.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e &quot;s/\${tempext}\..*/.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -2812,7 +3208,7 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot; | grep -v &quot;ld:&quot;`; templist=`echo $templist | sed &quot;s/\(^.*ld.*\)\( .*ld.*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot; | grep -v &quot;ld:&quot;`; templist=`echo $templist | $SED &quot;s/\(^.*ld.*\)\( .*ld.*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 	;;
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
@@ -2825,7 +3221,7 @@
 	  # Commands to make compiler produce verbose output that lists
 	  # what &quot;hidden&quot; libraries, object files and flags are used when
 	  # linking a shared library.
-	  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep &quot;\-L&quot;'
+	  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;\-L&quot;'
 
 	else
 	  # FIXME: insert proper C++ library support
@@ -2842,7 +3238,7 @@
 	# KCC will only create a shared library if the output file
 	# ends with &quot;.so&quot; (or &quot;.sl&quot; for HP-UX), so rename the library
 	# to its proper name (with version) after linking.
-	_LT_AC_TAGVAR(archive_cmds, $1)='templib=`echo $lib | sed -e &quot;s/\.so\..*/\.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='tempext=`echo $shared_ext | $SED -e '\''s/\([[^()0-9A-Za-z{}]]\)/\\\\\1/g'\''`; templib=`echo $lib | $SED -e &quot;s/\${tempext}\..*/.so/&quot;`; $CC $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags --soname $soname -o \$templib; mv \$templib $lib'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -2859,7 +3255,7 @@
       cxx)
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;-exported_symbol &quot; &gt;&gt; $lib.exp; echo &quot;\$i&quot; &gt;&gt; $lib.exp; done~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done~
 	  echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
 	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version	$verstring` -update_registry $objdir/so_locations -o $lib~
 	  $rm $lib.exp'
@@ -2875,7 +3271,7 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot; | grep -v &quot;ld:&quot;`; templist=`echo $templist | sed &quot;s/\(^.*ld.*\)\( .*ld.*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;ld&quot; | grep -v &quot;ld:&quot;`; templist=`echo $templist | $SED &quot;s/\(^.*ld.*\)\( .*ld.*$\)/\1/&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 	;;
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
@@ -2888,7 +3284,7 @@
 	  # Commands to make compiler produce verbose output that lists
 	  # what &quot;hidden&quot; libraries, object files and flags are used when
 	  # linking a shared library.
-	  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep &quot;\-L&quot;'
+	  output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;\-L&quot;'
 
 	else
 	  # FIXME: insert proper C++ library support
@@ -2938,7 +3334,7 @@
 	# Sun C++ 4.2, 5.x and Centerline C++
 	_LT_AC_TAGVAR(no_undefined_flag, $1)=' -zdefs'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	$CC -G${allow_undefined_flag} -nolib ${wl}-M ${wl}$lib.exp -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
@@ -2963,7 +3359,7 @@
 	# explicitly linking system object files so we need to strip them
 	# from the output so that they don't get included in the library
 	# dependencies.
-	output_verbose_link_cmd='templist=`$CC -G $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep &quot;\-R|\-L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+	output_verbose_link_cmd='templist=`$CC -G $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep &quot;\-[[LR]]&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
 
 	# Archives containing C++ object files must be created using
 	# &quot;CC -xar&quot;, where &quot;CC&quot; is the Sun C++ compiler.  This is
@@ -2982,26 +3378,26 @@
 	# GNU C++ compiler with Solaris linker
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
 	  _LT_AC_TAGVAR(no_undefined_flag, $1)=' ${wl}-z ${wl}defs'
-	  if $CC --version | egrep -v '^2\.7' &gt; /dev/null; then
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $linker_flags ${wl}-h $wl$soname -o $lib'
-	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
-		$CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags~$rm $lib.exp'
+	  if $CC --version | grep -v '^2\.7' &gt; /dev/null; then
+	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+		$CC -shared -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
 	    # what &quot;hidden&quot; libraries, object files and flags are used when
 	    # linking a shared library.
-	    output_verbose_link_cmd=&quot;$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep \&quot;\-L\&quot;&quot;
+	    output_verbose_link_cmd=&quot;$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep \&quot;\-L\&quot;&quot;
 	  else
 	    # g++ 2.7 appears to require `-G' NOT `-shared' on this
 	    # platform.
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -G -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $linker_flags ${wl}-h $wl$soname -o $lib'
-	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
-		$CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags~$rm $lib.exp'
+	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -G -nostdlib $LDFLAGS $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
+	    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+		$CC -G -nostdlib ${wl}-M $wl$lib.exp -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~$rm $lib.exp'
 
 	    # Commands to make compiler produce verbose output that lists
 	    # what &quot;hidden&quot; libraries, object files and flags are used when
 	    # linking a shared library.
-	    output_verbose_link_cmd=&quot;$CC -G $CFLAGS -v conftest.$objext 2&gt;&amp;1 | egrep \&quot;\-L\&quot;&quot;
+	    output_verbose_link_cmd=&quot;$CC -G $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep \&quot;\-L\&quot;&quot;
 	  fi
 
 	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-R $wl$libdir'
@@ -3037,19 +3433,82 @@
 AC_MSG_RESULT([$_LT_AC_TAGVAR(ld_shlibs, $1)])
 test &quot;$_LT_AC_TAGVAR(ld_shlibs, $1)&quot; = no &amp;&amp; can_build_shared=no
 
-# Figure out &quot;hidden&quot; C++ library dependencies from verbose
-# compiler output whening linking a shared library.
-cat &gt; conftest.$ac_ext &lt;&lt;EOF
-class Foo
-{
-public:
-  Foo (void) { a = 0; }
-private:
-  int a;
-};
-EOF
+_LT_AC_TAGVAR(GCC, $1)=&quot;$GXX&quot;
+_LT_AC_TAGVAR(LD, $1)=&quot;$LD&quot;
+
+## CAVEAT EMPTOR:
+## There is no encapsulation within the following macros, do not change
+## the running order or otherwise move them around unless you know exactly
+## what you are doing...
+AC_LIBTOOL_POSTDEP_PREDEP($1)
+AC_LIBTOOL_PROG_COMPILER_PIC($1)
+AC_LIBTOOL_PROG_CC_C_O($1)
+AC_LIBTOOL_SYS_HARD_LINK_LOCKS($1)
+AC_LIBTOOL_PROG_LD_SHLIBS($1)
+AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
+AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH($1)
+AC_LIBTOOL_SYS_LIB_STRIP
+AC_LIBTOOL_DLOPEN_SELF($1)
 
+AC_LIBTOOL_CONFIG($1)
+
+AC_LANG_POP
+CC=$lt_save_CC
+LDCXX=$LD
+LD=$lt_save_LD
+GCC=$lt_save_GCC
+with_gnu_ldcxx=$with_gnu_ld
+with_gnu_ld=$lt_save_with_gnu_ld
+lt_cv_path_LDCXX=$lt_cv_path_LD
+lt_cv_path_LD=$lt_save_path_LD
+lt_cv_prog_gnu_ldcxx=$lt_cv_prog_gnu_ld
+lt_cv_prog_gnu_ld=$lt_save_with_gnu_ld
+])# AC_LIBTOOL_LANG_CXX_CONFIG
 
+# AC_LIBTOOL_POSTDEP_PREDEP([TAGNAME])
+# ------------------------
+# Figure out &quot;hidden&quot; library dependencies from verbose
+# compiler output when linking a shared library.
+# Parse the compiler output and extract the necessary
+# objects, libraries and library flags.
+AC_DEFUN([AC_LIBTOOL_POSTDEP_PREDEP],[
+dnl we can't use the lt_simple_compile_test_code here,
+dnl because it contains code intended for an executable,
+dnl not a library.  It's possible we should let each
+dnl tag define a new lt_????_link_test_code variable,
+dnl but it's only used here...
+ifelse([$1],[],[cat &gt; conftest.$ac_ext &lt;&lt;EOF
+int a;
+void foo (void) { a = 0; }
+EOF
+],[$1],[CXX],[cat &gt; conftest.$ac_ext &lt;&lt;EOF
+class Foo
+{
+public:
+  Foo (void) { a = 0; }
+private:
+  int a;
+};
+EOF
+],[$1],[F77],[cat &gt; conftest.$ac_ext &lt;&lt;EOF
+      subroutine foo
+      implicit none
+      integer*4 a
+      a=0
+      return
+      end
+EOF
+],[$1],[GCJ],[cat &gt; conftest.$ac_ext &lt;&lt;EOF
+public class foo {
+  private int a;
+  public void bar (void) {
+    a = 0;
+  }
+};
+EOF
+])
+dnl Parse the compiler output and extract the necessary
+dnl objects, libraries and library flags.
 if AC_TRY_EVAL(ac_compile); then
   # Parse the compiler output and extract the necessary
   # objects, libraries and library flags.
@@ -3130,39 +3589,116 @@
   done
 
   # Clean up.
-  rm -f a.out
+  rm -f a.out a.exe
 else
-  echo &quot;libtool.m4: error: problem compiling C++ test program&quot;
+  echo &quot;libtool.m4: error: problem compiling $1 test program&quot;
 fi
 
 $rm -f confest.$objext
 
 case &quot; $_LT_AC_TAGVAR(postdeps, $1) &quot; in
 *&quot; -lc &quot;*) _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no ;;
-*) _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=yes ;;
 esac
+])# AC_LIBTOOL_POSTDEP_PREDEP
 
-_LT_AC_TAGVAR(GCC, $1)=&quot;$GXX&quot;
+# AC_LIBTOOL_LANG_F77_CONFIG
+# ------------------------
+# Ensure that the configuration vars for the C compiler are
+# suitably defined.  Those variables are subsequently used by
+# AC_LIBTOOL_CONFIG to write the compiler configuration to `libtool'.
+AC_DEFUN([AC_LIBTOOL_LANG_F77_CONFIG], [_LT_AC_LANG_F77_CONFIG(F77)])
+AC_DEFUN([_LT_AC_LANG_F77_CONFIG],
+[AC_REQUIRE([AC_PROG_F77])
+AC_LANG_PUSH(Fortran 77)
+
+_LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+_LT_AC_TAGVAR(allow_undefined_flag, $1)=
+_LT_AC_TAGVAR(always_export_symbols, $1)=no
+_LT_AC_TAGVAR(archive_expsym_cmds, $1)=
+_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)=
+_LT_AC_TAGVAR(hardcode_direct, $1)=no
+_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
+_LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
+_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=
+_LT_AC_TAGVAR(hardcode_minus_L, $1)=no
+_LT_AC_TAGVAR(hardcode_automatic, $1)=no
+_LT_AC_TAGVAR(module_cmds, $1)=
+_LT_AC_TAGVAR(module_expsym_cmds, $1)=
+_LT_AC_TAGVAR(link_all_deplibs, $1)=unknown
+_LT_AC_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+_LT_AC_TAGVAR(no_undefined_flag, $1)=
+_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
+_LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=no
+
+# Source file extension for f77 test sources.
+ac_ext=f
+
+# Object file extension for compiled f77 test sources.
+objext=o
+_LT_AC_TAGVAR(objext, $1)=$objext
+
+# Code to be used in simple compile tests
+lt_simple_compile_test_code=&quot;      subroutine t\n      return\n      end\n&quot;
+
+# Code to be used in simple link tests
+lt_simple_link_test_code=&quot;      program t\n      end\n&quot;
+
+# ltmain only uses $CC for tagged configurations so make sure $CC is set.
+_LT_AC_SYS_COMPILER
+
+# Allow CC to be a program name with arguments.
+lt_save_CC=&quot;$CC&quot;
+CC=${F77-&quot;f77&quot;}
+compiler=$CC
+_LT_AC_TAGVAR(compiler, $1)=$CC
+cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
+
+AC_MSG_CHECKING([if libtool supports shared libraries])
+AC_MSG_RESULT([$can_build_shared])
+
+AC_MSG_CHECKING([whether to build shared libraries])
+test &quot;$can_build_shared&quot; = &quot;no&quot; &amp;&amp; enable_shared=no
+
+# On AIX, shared libraries and static libraries use the same namespace, and
+# are all built from PIC.
+case &quot;$host_os&quot; in
+aix3*)
+  test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  if test -n &quot;$RANLIB&quot;; then
+    archive_cmds=&quot;$archive_cmds~\$RANLIB \$lib&quot;
+    postinstall_cmds='$RANLIB $lib'
+  fi
+  ;;
+aix4*)
+  test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  ;;
+esac
+AC_MSG_RESULT([$enable_shared])
+
+AC_MSG_CHECKING([whether to build static libraries])
+# Make sure either enable_shared or enable_static is yes.
+test &quot;$enable_shared&quot; = yes || enable_static=yes
+AC_MSG_RESULT([$enable_static])
+
+test &quot;$_LT_AC_TAGVAR(ld_shlibs, $1)&quot; = no &amp;&amp; can_build_shared=no
+
+_LT_AC_TAGVAR(GCC, $1)=&quot;$G77&quot;
 _LT_AC_TAGVAR(LD, $1)=&quot;$LD&quot;
 
-## CAVEAT EMPTOR:
-## There is no encapsulation within the following macros, do not change
-## the running order or otherwise move them around unless you know exactly
-## what you are doing...
 AC_LIBTOOL_PROG_COMPILER_PIC($1)
 AC_LIBTOOL_PROG_CC_C_O($1)
 AC_LIBTOOL_SYS_HARD_LINK_LOCKS($1)
 AC_LIBTOOL_PROG_LD_SHLIBS($1)
+AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
 AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH($1)
 AC_LIBTOOL_SYS_LIB_STRIP
-AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
-AC_LIBTOOL_DLOPEN_SELF($1)
+
 
 AC_LIBTOOL_CONFIG($1)
 
 AC_LANG_POP
 CC=&quot;$lt_save_CC&quot;
-])# AC_LIBTOOL_LANG_CXX_CONFIG
+])# AC_LIBTOOL_LANG_F77_CONFIG
 
 
 # AC_LIBTOOL_LANG_GCJ_CONFIG
@@ -3174,18 +3710,18 @@
 AC_DEFUN([_LT_AC_LANG_GCJ_CONFIG],
 [AC_LANG_SAVE
 
-# Source file extension for C test sources.
+# Source file extension for Java test sources.
 ac_ext=java
 
-# Object file extension for compiled C test sources.
+# Object file extension for compiled Java test sources.
 objext=o
 _LT_AC_TAGVAR(objext, $1)=$objext
 
 # Code to be used in simple compile tests
-lt_simple_compile_test_code=&quot;class foo {}&quot;
+lt_simple_compile_test_code=&quot;class foo {}\n&quot;
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='public class conftest { public static void main(String[] argv) {}; }'
+lt_simple_link_test_code='public class conftest { public static void main(String[] argv) {}; }\n'
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
@@ -3193,8 +3729,7 @@
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${GCJ-&quot;gcj&quot;}
-set dummy $CC
-compiler=&quot;[$]2&quot;
+compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
 
 # GCJ did not exist at the time GCC didn't implicitly link libc in.
@@ -3209,9 +3744,9 @@
 AC_LIBTOOL_PROG_CC_C_O($1)
 AC_LIBTOOL_SYS_HARD_LINK_LOCKS($1)
 AC_LIBTOOL_PROG_LD_SHLIBS($1)
+AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
 AC_LIBTOOL_PROG_LD_HARDCODE_LIBPATH($1)
 AC_LIBTOOL_SYS_LIB_STRIP
-AC_LIBTOOL_SYS_DYNAMIC_LINKER($1)
 AC_LIBTOOL_DLOPEN_SELF($1)
 
 AC_LIBTOOL_CONFIG($1)
@@ -3238,7 +3773,7 @@
 _LT_AC_TAGVAR(objext, $1)=$objext
 
 # Code to be used in simple compile tests
-lt_simple_compile_test_code='sample MENU { MENUITEM &quot;&amp;Soup&quot;, 100, CHECKED }'
+lt_simple_compile_test_code='sample MENU { MENUITEM &quot;&amp;Soup&quot;, 100, CHECKED }\n'
 
 # Code to be used in simple link tests
 lt_simple_link_test_code=&quot;$lt_simple_compile_test_code&quot;
@@ -3249,8 +3784,7 @@
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${RC-&quot;windres&quot;}
-set dummy $CC
-compiler=&quot;[$]2&quot;
+compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
 _LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
 
@@ -3273,10 +3807,15 @@
 # with your package, and you will get complaints that there are
 # no rules to generate ltmain.sh.
 if test -f &quot;$ltmain&quot;; then
+  # See if we are running on zsh, and set the options which allow our commands through
+  # without removal of \ escapes.
+  if test -n &quot;${ZSH_VERSION+set}&quot; ; then
+    setopt NO_GLOB_SUBST
+  fi  
   # Now quote all the things that may contain metacharacters while being
   # careful not to overquote the AC_SUBSTed values.  We take copies of the
   # variables and quote the copies for generation of the libtool script.
-  for var in echo old_CC old_CFLAGS AR AR_FLAGS RANLIB LN_S LTCC NM SED SHELL \
+  for var in echo old_CC old_CFLAGS AR AR_FLAGS EGREP RANLIB LN_S LTCC NM SED SHELL \
     libname_spec library_names_spec soname_spec extract_expsyms_cmds \
     old_striplib striplib file_magic_cmd finish_cmds finish_eval \
     deplibs_check_method reload_flag reload_cmds need_locks \
@@ -3294,6 +3833,7 @@
     _LT_AC_TAGVAR(export_dynamic_flag_spec, $1) \
     _LT_AC_TAGVAR(thread_safe_flag_spec, $1) \
     _LT_AC_TAGVAR(whole_archive_flag_spec, $1) \
+    _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1) \
     _LT_AC_TAGVAR(old_archive_cmds, $1) \
     _LT_AC_TAGVAR(old_archive_from_new_cmds, $1) \
     _LT_AC_TAGVAR(predep_objects, $1) \
@@ -3310,7 +3850,11 @@
     _LT_AC_TAGVAR(no_undefined_flag, $1) \
     _LT_AC_TAGVAR(export_symbols_cmds, $1) \
     _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1) \
+    _LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1) \
     _LT_AC_TAGVAR(hardcode_libdir_separator, $1) \
+    _LT_AC_TAGVAR(hardcode_automatic, $1) \
+    _LT_AC_TAGVAR(module_cmds, $1) \
+    _LT_AC_TAGVAR(module_expsym_cmds, $1) \
     _LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1) \
     _LT_AC_TAGVAR(exclude_expsyms, $1) \
     _LT_AC_TAGVAR(include_expsyms, $1); do
@@ -3320,6 +3864,8 @@
     _LT_AC_TAGVAR(old_archive_from_new_cmds, $1) | \
     _LT_AC_TAGVAR(archive_cmds, $1) | \
     _LT_AC_TAGVAR(archive_expsym_cmds, $1) | \
+    _LT_AC_TAGVAR(module_cmds, $1) | \
+    _LT_AC_TAGVAR(module_expsym_cmds, $1) | \   
     _LT_AC_TAGVAR(old_archive_from_expsyms_cmds, $1) | \
     _LT_AC_TAGVAR(export_symbols_cmds, $1) | \
     extract_expsyms_cmds | reload_cmds | finish_cmds | \
@@ -3381,8 +3927,11 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
+# A sed program that does not truncate output.
+SED=$lt_SED
+
 # Sed that helps us avoid accidentally triggering echo(1) options like -n.
-Xsed=&quot;sed -e s/^X//&quot;
+Xsed=&quot;$SED -e s/^X//&quot;
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
@@ -3408,6 +3957,9 @@
 # Whether or not to add -lc for building shared libraries.
 build_libtool_need_lc=$_LT_AC_TAGVAR(archive_cmds_need_lc, $1)
 
+# Whether or not to disallow shared libs when runtime libs are static
+allow_libtool_libs_with_static_runtimes=$_LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)
+
 # Whether or not to optimize for fast installation.
 fast_install=$enable_fast_install
 
@@ -3431,6 +3983,9 @@
 # Is the compiler the GNU C compiler?
 with_gcc=$_LT_AC_TAGVAR(GCC, $1)
 
+# An ERE matcher.
+EGREP=$lt_EGREP
+
 # The linker used to build libraries.
 LD=$lt_[]_LT_AC_TAGVAR(LD, $1)
 
@@ -3440,9 +3995,6 @@
 # A BSD-compatible nm program.
 NM=$lt_NM
 
-# A sed program that does not truncate output.
-SED=$lt_SED
-
 # A symbol stripping program
 STRIP=$STRIP
 
@@ -3474,6 +4026,9 @@
 # Old archive suffix (normally &quot;a&quot;).
 libext=&quot;$libext&quot;
 
+# Shared library suffix (normally &quot;.so&quot;).
+shrext='$shrext'
+
 # Executable file suffix (normally &quot;&quot;).
 exeext=&quot;$exeext&quot;
 
@@ -3551,6 +4106,10 @@
 postinstall_cmds=$lt_postinstall_cmds
 postuninstall_cmds=$lt_postuninstall_cmds
 
+# Commands used to build a loadable module (assumed same as above if empty)
+module_cmds=$lt_[]_LT_AC_TAGVAR(module_cmds, $1)
+module_expsym_cmds=$lt_[]_LT_AC_TAGVAR(module_expsym_cmds, $1)
+
 # Commands to strip libraries.
 old_striplib=$lt_old_striplib
 striplib=$lt_striplib
@@ -3621,10 +4180,15 @@
 # This must work even if \$libdir does not exist.
 hardcode_libdir_flag_spec=$lt_[]_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)
 
+# If ld is used when linking, flag to hardcode \$libdir into
+# a binary during linking. This must work even if \$libdir does
+# not exist.
+hardcode_libdir_flag_spec_ld=$lt_[]_LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)
+
 # Whether we need a single -rpath flag with a separated argument.
 hardcode_libdir_separator=$lt_[]_LT_AC_TAGVAR(hardcode_libdir_separator, $1)
 
-# Set to yes if using DIR/libNAME.so during linking hardcodes DIR into the
+# Set to yes if using DIR/libNAME${shared_ext} during linking hardcodes DIR into the
 # resulting binary.
 hardcode_direct=$_LT_AC_TAGVAR(hardcode_direct, $1)
 
@@ -3636,6 +4200,10 @@
 # the resulting binary.
 hardcode_shlibpath_var=$_LT_AC_TAGVAR(hardcode_shlibpath_var, $1)
 
+# Set to yes if building a shared library automatically hardcodes DIR into the library
+# and all subsequent libraries and executables linked against it.
+hardcode_automatic=$_LT_AC_TAGVAR(hardcode_automatic, $1)
+
 # Variables whose values should be saved in libtool wrapper scripts and
 # restored at relink time.
 variables_saved_for_relink=&quot;$variables_saved_for_relink&quot;
@@ -3687,18 +4255,6 @@
 fi
 EOF
     ;;
-
-  cygwin* | mingw* | pw32* | os2*)
-    cat &lt;&lt;'EOF' &gt;&gt; &quot;$cfgfile&quot;
-    # This is a source program that is used to create dlls on Windows
-    # Don't remove nor modify the starting and closing comments
-    _LT_AC_FILE_LTDLL_C
-    # This is a source program that is used to create import libraries
-    # on Windows for dlls which lack them. Don't remove nor modify the
-    # starting and closing comments
-    _LT_AC_FILE_IMPGEN_C
-EOF
-    ;;
   esac
 
   # We use sed instead of cat because bash on DJGPP gets confused if
@@ -3732,7 +4288,7 @@
 
   AC_LIBTOOL_COMPILER_OPTION([if $compiler supports -fno-rtti -fno-exceptions],
     lt_cv_prog_compiler_rtti_exceptions,
-    [-fno-rtti -fno-exceptions -c conftest.$ac_ext], [],
+    [-fno-rtti -fno-exceptions], [],
     [_LT_AC_TAGVAR(lt_prog_compiler_no_builtin_flag, $1)=&quot;$_LT_AC_TAGVAR(lt_prog_compiler_no_builtin_flag, $1) -fno-rtti -fno-exceptions&quot;])
 fi
 ])# AC_LIBTOOL_PROG_COMPILER_NO_RTTI
@@ -3784,6 +4340,9 @@
 irix* | nonstopux*)
   symcode='[[BCDEGRST]]'
   ;;
+osf*)
+  symcode='[[BCDEGQRST]]'
+  ;;
 solaris* | sysv5*)
   symcode='[[BDT]]'
   ;;
@@ -3794,16 +4353,17 @@
 
 # Handle CRLF in mingw tool chain
 opt_cr=
-case $host_os in
+case $build_os in
 mingw*)
   opt_cr=`echo 'x\{0,1\}' | tr x '\015'` # option cr in regexp
   ;;
 esac
 
 # If we're using GNU nm, then use its standard symbol codes.
-if $NM -V 2&gt;&amp;1 | egrep '(GNU|with BFD)' &gt; /dev/null; then
-  symcode='[[ABCDGISTW]]'
-fi
+case `$NM -V 2&gt;&amp;1` in
+*GNU* | *'with BFD'*)
+  symcode='[[ABCDGISTW]]' ;;
+esac
 
 # Try without a prefix undercore, then with it.
 for ac_symprfx in &quot;&quot; &quot;_&quot;; do
@@ -3839,8 +4399,8 @@
       fi
 
       # Make sure that we snagged all the symbols we need.
-      if egrep ' nm_test_var$' &quot;$nlist&quot; &gt;/dev/null; then
-	if egrep ' nm_test_func$' &quot;$nlist&quot; &gt;/dev/null; then
+      if grep ' nm_test_var$' &quot;$nlist&quot; &gt;/dev/null; then
+	if grep ' nm_test_func$' &quot;$nlist&quot; &gt;/dev/null; then
 	  cat &lt;&lt;EOF &gt; conftest.$ac_ext
 #ifdef __cplusplus
 extern &quot;C&quot; {
@@ -3866,7 +4426,7 @@
 lt_preloaded_symbols[[]] =
 {
 EOF
-	  sed &quot;s/^$symcode$symcode* \(.*\) \(.*\)$/  {\&quot;\2\&quot;, (lt_ptr_t) \&amp;\2},/&quot; &lt; &quot;$nlist&quot; | grep -v main &gt;&gt; conftest.$ac_ext
+	  $SED &quot;s/^$symcode$symcode* \(.*\) \(.*\)$/  {\&quot;\2\&quot;, (lt_ptr_t) \&amp;\2},/&quot; &lt; &quot;$nlist&quot; | grep -v main &gt;&gt; conftest.$ac_ext
 	  cat &lt;&lt;\EOF &gt;&gt; conftest.$ac_ext
   {0, (lt_ptr_t) 0}
 };
@@ -3948,10 +4508,10 @@
       # like `-m68040'.
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-m68020 -resident32 -malways-restore-a4'
       ;;
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | cygwin* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
-    cygwin* | mingw* | os2*)
+    mingw* | os2* | pw32*)
       # This hack is so that the source file can tell whether it is being
       # built for inclusion in a dll (and should export symbols for example).
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'
@@ -3971,10 +4531,15 @@
       fi
       ;;
     hpux*)
-      # PIC is the default for IA64 HP-UX, but not for PA HP-UX.
-      if test &quot;$host_cpu&quot; != ia64; then
+      # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
+      # not for PA HP-UX.
+      case &quot;$host_cpu&quot; in
+      hppa*64*|ia64*)
+	;;
+      *)
 	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
-      fi
+	;;
+      esac
       ;;
     *)
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
@@ -4027,9 +4592,14 @@
 	  aCC)
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)=&quot;${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive&quot;
-	    if test &quot;$host_cpu&quot; != ia64; then
+	    case &quot;$host_cpu&quot; in
+	    hppa*64*|ia64*)
+	      # +Z the default
+	      ;;
+	    *)
 	      _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='+Z'
-	    fi
+	      ;;
+	    esac
 	    ;;
 	  *)
 	    ;;
@@ -4058,7 +4628,7 @@
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
-	    ;;
+	    ;; 
 	  cxx)
 	    # Compaq C++
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
@@ -4189,11 +4759,11 @@
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-m68020 -resident32 -malways-restore-a4'
       ;;
 
-    beos* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
+    beos* | cygwin* | irix5* | irix6* | nonstopux* | osf3* | osf4* | osf5*)
       # PIC is the default for these OSes.
       ;;
 
-    cygwin* | mingw* | pw32* | os2*)
+    mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
       # built for inclusion in a dll (and should export symbols for example).
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'
@@ -4219,10 +4789,16 @@
       ;;
 
     hpux*)
-      # PIC is the default for IA64 HP-UX, but not for PA HP-UX.
-      if test &quot;$host_cpu&quot; != ia64; then
+      # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
+      # not for PA HP-UX.
+      case &quot;$host_cpu&quot; in
+      hppa*64*|ia64*)
+	# +Z the default
+	;;
+      *)
 	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
-      fi
+	;;
+      esac
       ;;
 
     *)
@@ -4242,7 +4818,7 @@
       fi
       ;;
 
-    cygwin* | mingw* | pw32* | os2*)
+    mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
       # built for inclusion in a dll (and should export symbols for example).
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-DDLL_EXPORT'
@@ -4250,9 +4826,16 @@
 
     hpux9* | hpux10* | hpux11*)
       _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
-      if test &quot;$host_cpu&quot; != ia64; then
+      # PIC is the default for IA64 HP-UX and 64-bit HP-UX, but
+      # not for PA HP-UX.
+      case &quot;$host_cpu&quot; in
+      hppa*64*|ia64*)
+	# +Z the default
+	;;
+      *)
 	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='+Z'
-      fi
+	;;
+      esac
       # Is there a better lt_prog_compiler_static that works with the bundled CC?
       _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='${wl}-a ${wl}archive'
       ;;
@@ -4269,11 +4852,18 @@
       ;;
 
     linux*)
-      if test &quot;$CC&quot; = &quot;icc&quot;; then
+      case $CC in
+      icc* | ecc*)
 	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	_LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
-      fi
+        ;;
+      ccc*)
+        _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+        # All Alpha code is PIC.
+        _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
+        ;;
+      esac
       ;;
 
     osf3* | osf4* | osf5*)
@@ -4300,11 +4890,7 @@
       ;;
 
     sysv4 | sysv4.2uw2* | sysv4.3* | sysv5*)
-      if test &quot;x$host_vendor&quot; = xsni; then
-	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-LD'
-      else
-	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
-      fi
+      _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
       _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
       ;;
@@ -4335,7 +4921,7 @@
 if test -n &quot;$_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)&quot;; then
   AC_LIBTOOL_COMPILER_OPTION([if $compiler PIC flag $_LT_AC_TAGVAR(lt_prog_compiler_pic, $1) works],
     _LT_AC_TAGVAR(lt_prog_compiler_pic_works, $1),
-    [$_LT_AC_TAGVAR(lt_prog_compiler_pic, $1) -DPIC], [],
+    [$_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)ifelse([$1],[],[ -DPIC],[ifelse([$1],[CXX],[ -DPIC],[])])], [],
     [case $_LT_AC_TAGVAR(lt_prog_compiler_pic, $1) in
      &quot;&quot; | &quot; &quot;*) ;;
      *) _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)=&quot; $_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)&quot; ;;
@@ -4349,7 +4935,7 @@
     _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)=
     ;;
   *)
-    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)=&quot;$_LT_AC_TAGVAR(lt_prog_compiler_pic, $1) -DPIC&quot;
+    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)=&quot;$_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)ifelse([$1],[],[ -DPIC],[ifelse([$1],[CXX],[ -DPIC],[])])&quot;
     ;;
 esac
 ])
@@ -4361,30 +4947,32 @@
 AC_DEFUN([AC_LIBTOOL_PROG_LD_SHLIBS],
 [AC_MSG_CHECKING([whether the $compiler linker ($LD) supports shared libraries])
 ifelse([$1],[CXX],[
-  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | sed '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
+  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
   case $host_os in
   aix4* | aix5*)
     # If we're using GNU nm, then we don't want the &quot;-C&quot; option.
     # -C means demangle to AIX nm, but means don't demangle with GNU nm
-    if $NM -V 2&gt;&amp;1 | egrep '(GNU)' &gt; /dev/null; then
+    if $NM -V 2&gt;&amp;1 | grep 'GNU' &gt; /dev/null; then
       _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\[$]2 == &quot;T&quot;) || (\[$]2 == &quot;D&quot;) || (\[$]2 == &quot;B&quot;)) &amp;&amp; ([substr](\[$]3,1,1) != &quot;.&quot;)) { print \[$]3 } }'\'' | sort -u &gt; $export_symbols'
     else
       _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\[$]2 == &quot;T&quot;) || (\[$]2 == &quot;D&quot;) || (\[$]2 == &quot;B&quot;)) &amp;&amp; ([substr](\[$]3,1,1) != &quot;.&quot;)) { print \[$]3 } }'\'' | sort -u &gt; $export_symbols'
     fi
     ;;
-  cygwin* | mingw* | pw32*)
+  pw32*)
     _LT_AC_TAGVAR(export_symbols_cmds, $1)=&quot;$ltdll_cmds&quot;
   ;;
+  cygwin* | mingw*)
+    _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGS]] /s/.* \([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+  ;;
   *)
-    _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | sed '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
+    _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
   ;;
   esac
 ],[
   runpath_var=
   _LT_AC_TAGVAR(allow_undefined_flag, $1)=
-
+  _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=no
   _LT_AC_TAGVAR(archive_cmds, $1)=
-  _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=
   _LT_AC_TAGVAR(archive_expsym_cmds, $1)=
   _LT_AC_TAGVAR(old_archive_From_new_cmds, $1)=
   _LT_AC_TAGVAR(old_archive_from_expsyms_cmds, $1)=
@@ -4392,17 +4980,21 @@
   _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
   _LT_AC_TAGVAR(thread_safe_flag_spec, $1)=
   _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
+  _LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)=
   _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=
   _LT_AC_TAGVAR(hardcode_direct, $1)=no
   _LT_AC_TAGVAR(hardcode_minus_L, $1)=no
   _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
   _LT_AC_TAGVAR(link_all_deplibs, $1)=unknown
+  _LT_AC_TAGVAR(hardcode_automatic, $1)=no
+  _LT_AC_TAGVAR(module_cmds, $1)=
+  _LT_AC_TAGVAR(module_expsym_cmds, $1)=  
   _LT_AC_TAGVAR(always_export_symbols, $1)=no
-  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | sed '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
+  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
   # include_expsyms should be a list of space-separated symbols to be *always*
   # included in the symbol list
   _LT_AC_TAGVAR(include_expsyms, $1)=
-  # exclude_expsyms can be an egrep regular expression of symbols to exclude
+  # exclude_expsyms can be an extended regexp of symbols to exclude
   # it will be wrapped by ` (' and `)$', so one must not match beginning or
   # end of line.  Example: `a|bc|.*d.*' will exclude the symbols `a' and `bc',
   # as well as any symbol that contains `d'.
@@ -4466,7 +5058,7 @@
       ;;
 
     beos*)
-      if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
 	# Joseph Beckenbach &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">jrb3 at best.com</A>&gt; says some releases of gcc
 	# support --undefined.  This deserves some investigation.  FIXME
@@ -4477,80 +5069,28 @@
       ;;
 
     cygwin* | mingw* | pw32*)
-      # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless, as there is
-      # no search path for DLLs.
+      # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
+      # as there is no search path for DLLs.
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
-      _LT_AC_TAGVAR(always_export_symbols, $1)=yes
-
-      extract_expsyms_cmds='test -f $output_objdir/impgen.c || \
-	sed -e &quot;/^# \/\* impgen\.c starts here \*\//,/^# \/\* impgen.c ends here \*\// { s/^# //;s/^# *$//; p; }&quot; -e d &lt; $''0 &gt; $output_objdir/impgen.c~
-	test -f $output_objdir/impgen.exe || (cd $output_objdir &amp;&amp; \
-	if test &quot;x$HOST_CC&quot; != &quot;x&quot; ; then $HOST_CC -o impgen impgen.c ; \
-	else $CC -o impgen impgen.c ; fi)~
-	$output_objdir/impgen $dir/$soroot &gt; $output_objdir/$soname-def'
-
-      _LT_AC_TAGVAR(old_archive_from_expsyms_cmds, $1)='$DLLTOOL --as=$AS --dllname $soname --def $output_objdir/$soname-def --output-lib $output_objdir/$newlib'
-
-      # cygwin and mingw dlls have different entry points and sets of symbols
-      # to exclude.
-      # FIXME: what about values for MSVC?
-      dll_entry=<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">__cygwin_dll_entry at 12</A>
-      dll_exclude_symbols=<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">DllMain at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,_cygwin_dll_entry at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,_cygwin_noncygwin_dll_entry at 12</A>~
-      case $host_os in
-      mingw*)
-	# mingw values
-	dll_entry=<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">_DllMainCRTStartup at 12</A>
-	dll_exclude_symbols=<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">DllMain at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,DllMainCRTStartup at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,DllEntryPoint at 12</A>~
-	;;
-      esac
-
-      # mingw and cygwin differ, and it's simplest to just exclude the union
-      # of the two symbol sets.
-      dll_exclude_symbols=<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">DllMain at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,_cygwin_dll_entry at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,_cygwin_noncygwin_dll_entry at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,DllMainCRTStartup at 12</A><A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">,DllEntryPoint at 12</A>
-
-      # recent cygwin and mingw systems supply a stub DllMain which the user
-      # can override, but on older systems we have to supply one (in ltdll.c)
-      if test &quot;x$lt_cv_need_dllmain&quot; = &quot;xyes&quot;; then
-	ltdll_obj='$output_objdir/$soname-ltdll.'&quot;$ac_objext &quot;
-	ltdll_cmds='test -f $output_objdir/$soname-ltdll.c || sed -e &quot;/^# \/\* ltdll\.c starts here \*\//,/^# \/\* ltdll.c ends here \*\// { s/^# //; p; }&quot; -e d &lt; $''0 &gt; $output_objdir/$soname-ltdll.c~
-  	test -f $output_objdir/$soname-ltdll.$ac_objext || (cd $output_objdir &amp;&amp; $CC -c $soname-ltdll.c)~'
-      else
-	ltdll_obj=
-	ltdll_cmds=
-      fi
-
-      # Extract the symbol export list from an `--export-all' def file,
-      # then regenerate the def file from the symbol export list, so that
-      # the compiled dll only exports the symbol export list.
-      # Be careful not to strip the DATA tag left by newer dlltools.
-      _LT_AC_TAGVAR(export_symbols_cmds, $1)=&quot;$ltdll_cmds&quot;'
-	$DLLTOOL --export-all --exclude-symbols '$dll_exclude_symbols' --output-def $output_objdir/$soname-def '$ltdll_obj'$libobjs $convenience~
-	sed -e &quot;1,/EXPORTS/d&quot; -e &quot;s/ @ [[0-9]]*//&quot; -e &quot;s/ *;.*$//&quot; &lt; $output_objdir/$soname-def &gt; $export_symbols'
+      _LT_AC_TAGVAR(allow_undefined_flag, $1)=no
+      _LT_AC_TAGVAR(always_export_symbols, $1)=no
+      _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
+      _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGS]] /s/.* \([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
 
-      # If the export-symbols file already is a .def file (1st line
-      # is EXPORTS), use it as is.
-      # If DATA tags from a recent dlltool are present, honour them!
-      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='if test &quot;x`head -n 1 $export_symbols`&quot; = xEXPORTS; then
-	  cp $export_symbols $output_objdir/$soname-def;
+      if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
+        _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
+	# If the export-symbols file already is a .def file (1st line
+	# is EXPORTS), use it as is; otherwise, prepend...
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='if test &quot;x`$SED 1q $export_symbols`&quot; = xEXPORTS; then
+	  cp $export_symbols $output_objdir/$soname.def;
 	else
-	  echo EXPORTS &gt; $output_objdir/$soname-def;
-	  _lt_hint=1;
-	  cat $export_symbols | while read symbol; do
-	   set dummy \$symbol;
-	   case \[$]# in
-	     2) echo &quot;   \[$]2 @ \$_lt_hint ; &quot; &gt;&gt; $output_objdir/$soname-def;;
-	     *) echo &quot;   \[$]2 @ \$_lt_hint \[$]3 ; &quot; &gt;&gt; $output_objdir/$soname-def;;
-	   esac;
-	   _lt_hint=`expr 1 + \$_lt_hint`;
-	  done;
+	  echo EXPORTS &gt; $output_objdir/$soname.def;
+	  cat $export_symbols &gt;&gt; $output_objdir/$soname.def;
 	fi~
-	'&quot;$ltdll_cmds&quot;'
-	$CC -Wl,--base-file,$output_objdir/$soname-base '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~
-	$DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp~
-	$CC -Wl,--base-file,$output_objdir/$soname-base $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags~
-	$DLLTOOL --as=$AS --dllname $soname --exclude-symbols '$dll_exclude_symbols' --def $output_objdir/$soname-def --base-file $output_objdir/$soname-base --output-exp $output_objdir/$soname-exp --output-lib $output_objdir/$libname.dll.a~
-	$CC $output_objdir/$soname-exp '$lt_cv_cc_dll_switch' -Wl,-e,'$dll_entry' -o $output_objdir/$soname '$ltdll_obj'$libobjs $deplibs $compiler_flags'
+	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
+      else
+	ld_shlibs=no
+      fi
       ;;
 
     netbsd*)
@@ -4558,13 +5098,13 @@
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
       else
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nodefaultlibs $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared -nodefaultlibs $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       fi
       ;;
 
     solaris* | sysv5*)
-      if $LD -v 2&gt;&amp;1 | egrep 'BFD 2\.8' &gt; /dev/null; then
+      if $LD -v 2&gt;&amp;1 | grep 'BFD 2\.8' &gt; /dev/null; then
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	cat &lt;&lt;EOF 1&gt;&amp;2
 
@@ -4576,7 +5116,7 @@
 *** used, and then restart.
 
 EOF
-      elif $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      elif $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
@@ -4592,7 +5132,7 @@
       ;;
 
     *)
-      if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
       else
@@ -4605,20 +5145,12 @@
       runpath_var=LD_RUN_PATH
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
       _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-      case $host_os in
-      cygwin* | mingw* | pw32*)
-	# dlltool doesn't understand --whole-archive et. al.
-	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
-	;;
-      *)
-	# ancient GNU ld didn't support --whole-archive et. al.
-	if $LD --help 2&gt;&amp;1 | egrep 'no-whole-archive' &gt; /dev/null; then
-  	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
-	else
+      # ancient GNU ld didn't support --whole-archive et. al.
+      if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
+ 	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+      else
   	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
-	fi
-	;;
-      esac
+      fi
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -4647,7 +5179,7 @@
       else
 	# If we're using GNU nm, then we don't want the &quot;-C&quot; option.
 	# -C means demangle to AIX nm, but means don't demangle with GNU nm
-	if $NM -V 2&gt;&amp;1 | egrep '(GNU)' &gt; /dev/null; then
+	if $NM -V 2&gt;&amp;1 | grep 'GNU' &gt; /dev/null; then
 	  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM -Bpg $libobjs $convenience | awk '\''{ if (((\[$]2 == &quot;T&quot;) || (\[$]2 == &quot;D&quot;) || (\[$]2 == &quot;B&quot;)) &amp;&amp; ([substr](\[$]3,1,1) != &quot;.&quot;)) { print \[$]3 } }'\'' | sort -u &gt; $export_symbols'
 	else
 	  _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM -BCpg $libobjs $convenience | awk '\''{ if (((\[$]2 == &quot;T&quot;) || (\[$]2 == &quot;D&quot;) || (\[$]2 == &quot;B&quot;)) &amp;&amp; ([substr](\[$]3,1,1) != &quot;.&quot;)) { print \[$]3 } }'\'' | sort -u &gt; $export_symbols'
@@ -4760,38 +5292,58 @@
       # hardcode_libdir_flag_spec is actually meaningless, as there is
       # no search path for DLLs.
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=' '
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
+      _LT_AC_TAGVAR(allow_undefined_flag, $1)=no
       # Tell ltmain to make .lib files, not .a files.
       libext=lib
+      # Tell ltmain to make .dll files, not .so files.
+      shrext=&quot;.dll&quot;
       # FIXME: Setting linknames here is a bad hack.
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `echo &quot;$deplibs&quot; | sed -e '\''s/ -lc$//'\''` -link -dll~linknames='
+      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -o $lib $libobjs $compiler_flags `echo &quot;$deplibs&quot; | $SED -e '\''s/ -lc$//'\''` -link -dll~linknames='
       # The linker will automatically build a .lib file if we build a DLL.
       _LT_AC_TAGVAR(old_archive_From_new_cmds, $1)='true'
       # FIXME: Should let the user specify the lib program.
       _LT_AC_TAGVAR(old_archive_cmds, $1)='lib /OUT:$oldlib$oldobjs$old_deplibs'
       fix_srcfile_path='`cygpath -w &quot;$srcfile&quot;`'
+      _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
       ;;
 
     darwin* | rhapsody*)
+    if test &quot;$GXX&quot; = yes ; then
+      _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
       case &quot;$host_os&quot; in
       rhapsody* | darwin1.[[012]])
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
 	;;
       *) # Darwin 1.3 on
-	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+	test -z ${LD_TWOLEVEL_NAMESPACE} &amp;&amp; _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
 	;;
       esac
-
-      # FIXME: Relying on posixy $() will cause problems for
-      #        cross-compilation, but unfortunately the echo tests do not
-      #        yet detect zsh echo's removal of \ escapes.  Also zsh mangles
-      #	       `&quot;' quotes if we put them in here... so don't!
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC $(test .$module = .yes &amp;&amp; echo -bundle || echo -dynamiclib) $allow_undefined_flag -o $lib $libobjs $deplibs$linker_flags -install_name $rpath/$soname $verstring'
-      # We need to add '_' to the symbols in $export_symbols first
-      #_LT_AC_TAGVAR(archive_expsym_cmds, $1)=&quot;$_LT_AC_TAGVAR(archive_cmds, $1)&quot;' &amp;&amp; strip -s $export_symbols'
-      _LT_AC_TAGVAR(hardcode_direct, $1)=yes
-      _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+    	lt_int_apple_cc_single_mod=no
+    	output_verbose_link_cmd='echo'
+    	if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
+    	  lt_int_apple_cc_single_mod=yes
+    	fi
+    	if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+    	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+    	else
+        _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+      fi
+      _LT_AC_TAGVAR(module_cmds, $1)='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+        if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+          _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        else
+          _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+        fi
+          _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      _LT_AC_TAGVAR(hardcode_direct, $1)=no
+      _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
+      _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
       _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
+      _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
+    else  
+      _LT_AC_TAGVAR(ld_shlibs, $1)=no
+    fi  
       ;;
 
     dgux*)
@@ -4831,54 +5383,80 @@
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
 
-    hpux9* | hpux10* | hpux11*)
+    hpux9*)
       if test &quot;$GCC&quot; = yes; then
-	case $host_os in
-	  hpux9*)
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
-	    ;;
-	  *)
-	    if test &quot;$host_cpu&quot; = ia64; then
-	      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	    else
-	      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
-	    fi
-	    ;;
-	esac
+	_LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -shared -fPIC ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $libobjs $deplibs $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       else
-	case $host_os in
-	  hpux9*)
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
-	    ;;
-	  *)
-	    if test &quot;$host_cpu&quot; = ia64; then
-	      _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $libobjs $deplibs $linker_flags'
-	    else
-	      _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
-	    fi
-	    ;;
-	esac
-      fi
-      if test &quot;$host_cpu&quot; = ia64; then
-	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
-	_LT_AC_TAGVAR(hardcode_direct, $1)=no
-	_LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
-      else
-	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
-	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
-	_LT_AC_TAGVAR(hardcode_direct, $1)=yes
+	_LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$LD -b +b $install_libdir -o $output_objdir/$soname $libobjs $deplibs $linker_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       fi
+      _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+      _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
+      _LT_AC_TAGVAR(hardcode_direct, $1)=yes
+
       # hardcode_minus_L: Not really in the search PATH,
       # but as the default location of the library.
       _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
       _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
       ;;
 
+    hpux10* | hpux11*)
+      if test &quot;$GCC&quot; = yes -a &quot;$with_gnu_ld&quot; = no; then
+	case &quot;$host_cpu&quot; in
+	hppa*64*|ia64*)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}+h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	*)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -fPIC ${wl}+h ${wl}$soname ${wl}+b ${wl}$install_libdir -o $lib $libobjs $deplibs $compiler_flags'
+	  ;;
+	esac
+      else
+	case &quot;$host_cpu&quot; in
+	hppa*64*|ia64*)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  ;;
+	*)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname +b $install_libdir -o $lib $libobjs $deplibs $linker_flags'
+	  ;;
+	esac
+      fi
+      if test &quot;$with_gnu_ld&quot; = no; then
+	case &quot;$host_cpu&quot; in
+	hppa*64*)
+	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='+b $libdir'
+	  _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=no
+	  _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+	  ;;
+	ia64*)
+	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-L$libdir'
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=no
+	  _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+
+	  # hardcode_minus_L: Not really in the search PATH,
+	  # but as the default location of the library.
+	  _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
+	  ;;
+	*)
+	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}+b ${wl}$libdir'
+	  _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=yes
+	  _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+
+	  # hardcode_minus_L: Not really in the search PATH,
+	  # but as the default location of the library.
+	  _LT_AC_TAGVAR(hardcode_minus_L, $1)=yes
+	  ;;
+	esac
+      fi
+      ;;
+
     irix5* | irix6* | nonstopux*)
       if test &quot;$GCC&quot; = yes; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
       else
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -shared $libobjs $deplibs $linker_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
+	_LT_AC_TAGVAR(hardcode_libdir_flag_spec_ld, $1)='-rpath $libdir'
       fi
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
       _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -4907,9 +5485,8 @@
     openbsd*)
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
-
       if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linker_flags'
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
       else
@@ -4919,7 +5496,7 @@
 	   _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
 	   ;;
 	 *)
-	   _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $linker_flags'
+	   _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
 	   _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	   ;;
        esac
@@ -4954,7 +5531,7 @@
       else
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;-exported_symbol &quot; &gt;&gt; $lib.exp; echo &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
 	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
@@ -4975,11 +5552,11 @@
       _LT_AC_TAGVAR(no_undefined_flag, $1)=' -z text'
       if test &quot;$GCC&quot; = yes; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
       else
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
       fi
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
@@ -5007,13 +5584,23 @@
       ;;
 
     sysv4)
-      if test &quot;x$host_vendor&quot; = xsni; then
-	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -G -Bsymbolic -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	_LT_AC_TAGVAR(hardcode_direct, $1)=yes # is this really true???
-      else
-	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
-	_LT_AC_TAGVAR(hardcode_direct, $1)=no #Motorola manual says yes, but my tests say they lie
-      fi
+      case $host_vendor in
+	sni)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=yes # is this really true???
+	;;
+	siemens)
+	  ## LD is ld it makes a PLAMLIB
+	  ## CC just makes a GrossModule.
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -G -o $lib $libobjs $deplibs $linker_flags'
+	  _LT_AC_TAGVAR(reload_cmds, $1)='$CC -r -o $output$reload_objs'
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=no
+        ;;
+	motorola)
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -G -h $soname -o $lib $libobjs $deplibs $linker_flags'
+	  _LT_AC_TAGVAR(hardcode_direct, $1)=no #Motorola manual says yes, but my tests say they lie
+	;;
+      esac
       runpath_var='LD_RUN_PATH'
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
@@ -5059,7 +5646,7 @@
       # $CC -shared without GNU ld will not create a library from C++
       # object files and a static libstdc++, better avoid it by now
       _LT_AC_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
-      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   		$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
@@ -5089,48 +5676,54 @@
 #
 # Do we need to explicitly link libc?
 #
-_LT_AC_TAGVAR(archive_cmds_need_lc, $1)=yes
-if test &quot;$enable_shared&quot; = yes &amp;&amp; test &quot;$GCC&quot; = yes; then
-  case $_LT_AC_TAGVAR(archive_cmds, $1) in
-  *'~'*)
-    # FIXME: we may have to deal with multi-command sequences.
-    ;;
-  '$CC '*)
-    # Test whether the compiler implicitly links with -lc since on some
-    # systems, -lgcc has to come before -lc. If gcc already passes -lc
-    # to ld, don't add -lc before -lgcc.
-    AC_MSG_CHECKING([whether -lc should be explicitly linked in])
-    $rm conftest*
-    echo 'static int dummy;' &gt; conftest.$ac_ext
-
-    if AC_TRY_EVAL(ac_compile) 2&gt;conftest.err; then
-      soname=conftest
-      lib=conftest
-      libobjs=conftest.$ac_objext
-      deplibs=
-      wl=$_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)
-      compiler_flags=-v
-      linker_flags=-v
-      verstring=
-      output_objdir=.
-      libname=conftest
-      lt_save_allow_undefined_flag=$_LT_AC_TAGVAR(allow_undefined_flag, $1)
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)=
-      if AC_TRY_EVAL(_LT_AC_TAGVAR(archive_cmds, $1) 2\&gt;\&amp;1 \| grep \&quot; -lc \&quot; \&gt;/dev/null 2\&gt;\&amp;1)
-      then
-	_LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+case &quot;x$_LT_AC_TAGVAR(archive_cmds_need_lc, $1)&quot; in
+x|xyes)
+  # Assume -lc should be added
+  _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=yes
+
+  if test &quot;$enable_shared&quot; = yes &amp;&amp; test &quot;$GCC&quot; = yes; then
+    case $_LT_AC_TAGVAR(archive_cmds, $1) in
+    *'~'*)
+      # FIXME: we may have to deal with multi-command sequences.
+      ;;
+    '$CC '*)
+      # Test whether the compiler implicitly links with -lc since on some
+      # systems, -lgcc has to come before -lc. If gcc already passes -lc
+      # to ld, don't add -lc before -lgcc.
+      AC_MSG_CHECKING([whether -lc should be explicitly linked in])
+      $rm conftest*
+      printf &quot;$lt_simple_compile_test_code&quot; &gt; conftest.$ac_ext
+  
+      if AC_TRY_EVAL(ac_compile) 2&gt;conftest.err; then
+        soname=conftest
+        lib=conftest
+        libobjs=conftest.$ac_objext
+        deplibs=
+        wl=$_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)
+        compiler_flags=-v
+        linker_flags=-v
+        verstring=
+        output_objdir=.
+        libname=conftest
+        lt_save_allow_undefined_flag=$_LT_AC_TAGVAR(allow_undefined_flag, $1)
+        _LT_AC_TAGVAR(allow_undefined_flag, $1)=
+        if AC_TRY_EVAL(_LT_AC_TAGVAR(archive_cmds, $1) 2\&gt;\&amp;1 \| grep \&quot; -lc \&quot; \&gt;/dev/null 2\&gt;\&amp;1)
+        then
+	  _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+        else
+	  _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=yes
+        fi
+        _LT_AC_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
       else
-	_LT_AC_TAGVAR(archive_cmds_need_lc, $1)=yes
+        cat conftest.err 1&gt;&amp;5
       fi
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)=$lt_save_allow_undefined_flag
-    else
-      cat conftest.err 1&gt;&amp;5
-    fi
-    $rm conftest*
-    AC_MSG_RESULT([$_LT_AC_TAGVAR(archive_cmds_need_lc, $1)])
-    ;;
-  esac
-fi
+      $rm conftest*
+      AC_MSG_RESULT([$_LT_AC_TAGVAR(archive_cmds_need_lc, $1)])
+      ;;
+    esac
+  fi
+  ;;
+esac
 ])# AC_LIBTOOL_PROG_LD_SHLIBS
 
 
@@ -5174,146 +5767,6 @@
 ])# _LT_AC_FILE_LTDLL_C
 
 
-# _LT_AC_FILE_IMPGEN_C
-# --------------------
-# Be careful that the start marker always follows a newline.
-AC_DEFUN([_LT_AC_FILE_IMPGEN_C], [
-# /* impgen.c starts here */
-# /*   Copyright (C) 1999, 2000, 2001 Free Software Foundation, Inc.
-#
-#  This file is part of GNU libtool.
-#
-#  This program is free software; you can redistribute it and/or modify
-#  it under the terms of the GNU General Public License as published by
-#  the Free Software Foundation; either version 2 of the License, or
-#  (at your option) any later version.
-#
-#  This program is distributed in the hope that it will be useful,
-#  but WITHOUT ANY WARRANTY; without even the implied warranty of
-#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-#  GNU General Public License for more details.
-#
-#  You should have received a copy of the GNU General Public License
-#  along with this program; if not, write to the Free Software
-#  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-#  */
-#
-# #include &lt;stdio.h&gt;		/* for printf() */
-# #include &lt;unistd.h&gt;		/* for open(), lseek(), read() */
-# #include &lt;fcntl.h&gt;		/* for O_RDONLY, O_BINARY */
-# #include &lt;string.h&gt;		/* for strdup() */
-#
-# /* O_BINARY isn't required (or even defined sometimes) under Unix */
-# #ifndef O_BINARY
-# #define O_BINARY 0
-# #endif
-#
-# static unsigned int
-# pe_get16 (fd, offset)
-#      int fd;
-#      int offset;
-# {
-#   unsigned char b[2];
-#   lseek (fd, offset, SEEK_SET);
-#   read (fd, b, 2);
-#   return b[0] + (b[1]&lt;&lt;8);
-# }
-#
-# static unsigned int
-# pe_get32 (fd, offset)
-#     int fd;
-#     int offset;
-# {
-#   unsigned char b[4];
-#   lseek (fd, offset, SEEK_SET);
-#   read (fd, b, 4);
-#   return b[0] + (b[1]&lt;&lt;8) + (b[2]&lt;&lt;16) + (b[3]&lt;&lt;24);
-# }
-#
-# static unsigned int
-# pe_as32 (ptr)
-#      void *ptr;
-# {
-#   unsigned char *b = ptr;
-#   return b[0] + (b[1]&lt;&lt;8) + (b[2]&lt;&lt;16) + (b[3]&lt;&lt;24);
-# }
-#
-# int
-# main (argc, argv)
-#     int argc;
-#     char *argv[];
-# {
-#     int dll;
-#     unsigned long pe_header_offset, opthdr_ofs, num_entries, i;
-#     unsigned long export_rva, export_size, nsections, secptr, expptr;
-#     unsigned long name_rvas, nexp;
-#     unsigned char *expdata, *erva;
-#     char *filename, *dll_name;
-#
-#     filename = argv[1];
-#
-#     dll = open(filename, O_RDONLY|O_BINARY);
-#     if (dll &lt; 1)
-# 	return 1;
-#
-#     dll_name = filename;
-#
-#     for (i=0; filename[i]; i++)
-# 	if (filename[i] == '/' || filename[i] == '\\'  || filename[i] == ':')
-# 	    dll_name = filename + i +1;
-#
-#     pe_header_offset = pe_get32 (dll, 0x3c);
-#     opthdr_ofs = pe_header_offset + 4 + 20;
-#     num_entries = pe_get32 (dll, opthdr_ofs + 92);
-#
-#     if (num_entries &lt; 1) /* no exports */
-# 	return 1;
-#
-#     export_rva = pe_get32 (dll, opthdr_ofs + 96);
-#     export_size = pe_get32 (dll, opthdr_ofs + 100);
-#     nsections = pe_get16 (dll, pe_header_offset + 4 +2);
-#     secptr = (pe_header_offset + 4 + 20 +
-# 	      pe_get16 (dll, pe_header_offset + 4 + 16));
-#
-#     expptr = 0;
-#     for (i = 0; i &lt; nsections; i++)
-#     {
-# 	char sname[8];
-# 	unsigned long secptr1 = secptr + 40 * i;
-# 	unsigned long vaddr = pe_get32 (dll, secptr1 + 12);
-# 	unsigned long vsize = pe_get32 (dll, secptr1 + 16);
-# 	unsigned long fptr = pe_get32 (dll, secptr1 + 20);
-# 	lseek(dll, secptr1, SEEK_SET);
-# 	read(dll, sname, 8);
-# 	if (vaddr &lt;= export_rva &amp;&amp; vaddr+vsize &gt; export_rva)
-# 	{
-# 	    expptr = fptr + (export_rva - vaddr);
-# 	    if (export_rva + export_size &gt; vaddr + vsize)
-# 		export_size = vsize - (export_rva - vaddr);
-# 	    break;
-# 	}
-#     }
-#
-#     expdata = (unsigned char*)malloc(export_size);
-#     lseek (dll, expptr, SEEK_SET);
-#     read (dll, expdata, export_size);
-#     erva = expdata - export_rva;
-#
-#     nexp = pe_as32 (expdata+24);
-#     name_rvas = pe_as32 (expdata+32);
-#
-#     printf (&quot;EXPORTS\n&quot;);
-#     for (i = 0; i&lt;nexp; i++)
-#     {
-# 	unsigned long name_rva = pe_as32 (erva+name_rvas+i*4);
-# 	printf (&quot;\t%s @ %ld ;\n&quot;, erva+name_rva, 1+ i);
-#     }
-#
-#     return 0;
-# }
-# /* impgen.c ends here */
-])# _LT_AC_FILE_IMPGEN_C
-
 # _LT_AC_TAGVAR(VARNAME, [TAGNAME])
 # ---------------------------------
 AC_DEFUN([_LT_AC_TAGVAR], [ifelse([$2], [], [$1], [$1_$2])])
@@ -5361,67 +5814,45 @@
 do
   IFS=$as_save_IFS
   test -z &quot;$as_dir&quot; &amp;&amp; as_dir=.
-  for ac_prog in sed gsed; do
+  for lt_ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
-      if $as_executable_p &quot;$as_dir/$ac_prog$ac_exec_ext&quot;; then
-        _sed_list=&quot;$_sed_list $as_dir/$ac_prog$ac_exec_ext&quot;
+      if $as_executable_p &quot;$as_dir/$lt_ac_prog$ac_exec_ext&quot;; then
+        lt_ac_sed_list=&quot;$lt_ac_sed_list $as_dir/$lt_ac_prog$ac_exec_ext&quot;
       fi
     done
   done
 done
-
-  # Create a temporary directory, and hook for its removal unless debugging.
-$debug ||
-{
-  trap 'exit_status=$?; rm -rf $tmp &amp;&amp; exit $exit_status' 0
-  trap '{ (exit 1); exit 1; }' 1 2 13 15
-}
-
-# Create a (secure) tmp directory for tmp files.
-: ${TMPDIR=/tmp}
-{
-  tmp=`(umask 077 &amp;&amp; mktemp -d -q &quot;$TMPDIR/sedXXXXXX&quot;) 2&gt;/dev/null` &amp;&amp;
-  test -n &quot;$tmp&quot; &amp;&amp; test -d &quot;$tmp&quot;
-}  ||
-{
-  tmp=$TMPDIR/sed$$-$RANDOM
-  (umask 077 &amp;&amp; mkdir $tmp)
-} ||
-{
-   echo &quot;$me: cannot create a temporary directory in $TMPDIR&quot; &gt;&amp;2
-   { (exit 1); exit 1; }
-}
-  _max=0
-  _count=0
-  # Add /usr/xpg4/bin/sed as it is typically found on Solaris
-  # along with /bin/sed that truncates output.
-  for _sed in $_sed_list /usr/xpg4/bin/sed; do
-    test ! -f ${_sed} &amp;&amp; break
-    cat /dev/null &gt; &quot;$tmp/sed.in&quot;
-    _count=0
-    echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;&quot;$tmp/sed.in&quot;
-    # Check for GNU sed and select it if it is found.
-    if &quot;${_sed}&quot; --version 2&gt;&amp;1 &lt; /dev/null | egrep '(GNU)' &gt; /dev/null; then
-      lt_cv_path_SED=${_sed}
-      break;
+lt_ac_max=0
+lt_ac_count=0
+# Add /usr/xpg4/bin/sed as it is typically found on Solaris
+# along with /bin/sed that truncates output.
+for lt_ac_sed in $lt_ac_sed_list /usr/xpg4/bin/sed; do
+  test ! -f $lt_ac_sed &amp;&amp; break
+  cat /dev/null &gt; conftest.in
+  lt_ac_count=0
+  echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;conftest.in
+  # Check for GNU sed and select it if it is found.
+  if &quot;$lt_ac_sed&quot; --version 2&gt;&amp;1 &lt; /dev/null | grep 'GNU' &gt; /dev/null; then
+    lt_cv_path_SED=$lt_ac_sed
+    break
+  fi
+  while true; do
+    cat conftest.in conftest.in &gt;conftest.tmp
+    mv conftest.tmp conftest.in
+    cp conftest.in conftest.nl
+    echo &gt;&gt;conftest.nl
+    $lt_ac_sed -e 's/a$//' &lt; conftest.nl &gt;conftest.out || break
+    cmp -s conftest.out conftest.nl || break
+    # 10000 chars as input seems more than enough
+    test $lt_ac_count -gt 10 &amp;&amp; break
+    lt_ac_count=`expr $lt_ac_count + 1`
+    if test $lt_ac_count -gt $lt_ac_max; then
+      lt_ac_max=$lt_ac_count
+      lt_cv_path_SED=$lt_ac_sed
     fi
-    while true; do
-      cat &quot;$tmp/sed.in&quot; &quot;$tmp/sed.in&quot; &gt;&quot;$tmp/sed.tmp&quot;
-      mv &quot;$tmp/sed.tmp&quot; &quot;$tmp/sed.in&quot;
-      cp &quot;$tmp/sed.in&quot; &quot;$tmp/sed.nl&quot;
-      echo &gt;&gt;&quot;$tmp/sed.nl&quot;
-      ${_sed} -e 's/a$//' &lt; &quot;$tmp/sed.nl&quot; &gt;&quot;$tmp/sed.out&quot; || break
-      cmp -s &quot;$tmp/sed.out&quot; &quot;$tmp/sed.nl&quot; || break
-      # 10000 chars as input seems more than enough
-      test $_count -gt 10 &amp;&amp; break
-      _count=`expr $_count + 1`
-      if test $_count -gt $_max; then
-        _max=$_count
-        lt_cv_path_SED=$_sed
-      fi
-    done
   done
-  rm -rf &quot;$tmp&quot;
+done
 ])
+SED=$lt_cv_path_SED
 AC_MSG_RESULT([$SED])
 ])
Index: am_edit
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/am_edit,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/am_edit -Ladmin/am_edit -u -r1.1.1.1 -r1.2
--- admin/am_edit
+++ admin/am_edit
@@ -51,6 +51,7 @@
 sub pruneMocCandidates ($);
 sub checkMocCandidates ();
 sub addMocRules ();
+sub findKcfgFile($);
 
 sub tag_AUTOMAKE ();
 sub tag_META_INCLUDES ();
@@ -60,6 +61,7 @@
 sub tag_LOCALINSTALL();
 sub tag_IDLFILES();
 sub tag_UIFILES();
+sub tag_KCFGFILES();
 sub tag_SUBDIRS();
 sub tag_ICON();
 sub tag_CLOSURE();
@@ -111,11 +113,12 @@
     {
         $verbose = 1;       # Oh is there a problem...?
     }
-    elsif (/^-p(.+)$|^--path=(.+)$/)
+    elsif (/^(?:-p|--path=)(.+)$/)
     {
-        $thisProg = &quot;$1/&quot;.basename($thisProg) if($1);
-        $thisProg = &quot;$2/&quot;.basename($thisProg) if($2);
+        my $p = $1;
+        $thisProg = $p . &quot;/&quot;. basename($thisProg);
         warn (&quot;$thisProg doesn't exist\n&quot;)      if (!(-f $thisProg));
+        $thisProg .= &quot; -p&quot;.$p;
         $pathoption=1;
     }
     elsif (/^--help$|^-h$/)
@@ -222,10 +225,12 @@
     local %globalmocs = ();# list of all mocfiles (in %mocFiles format)
     local %important = (); # list of files to be generated asap
     local %uiFiles = ();
+    local %kcfgFiles = ();
 
     local $allidls = &quot;&quot;;
     local $idl_output = &quot;&quot;;# lists all idl generated files for cleantarget
     local $ui_output = &quot;&quot;;# lists all uic generated files for cleantarget
+    local $kcfg_output = &quot;&quot;;# lists all kcfg generated files for cleantarget
 
     local %dependmocs = ();
     
@@ -263,14 +268,15 @@
 	tag_NO_UNDEFINED();
 	tag_CLOSURE();
 	tag_NMCHECK();
-	tag_UIFILES();             # Sorts out ui rules
+	tag_UIFILES();              # Sorts out ui rules
+	tag_KCFGFILES();            # Sorts out kcfg rules
         tag_METASOURCES ();         # Sorts out the moc rules
         if ($sources_changed{$program}) {
             my $lookup = $program . '_SOURCES\s*=[ \t]*(.*)';
 
             if($program =~ /libkdeinit_(.*)/) {
                 my $prog = $1;
-                substituteLine($prog . '_SOURCES\s*=[ \t]*.*', 
+                substituteLine($prog . '_SOURCES\s*=[ \t]*(.*)', 
                     &quot;${prog}_SOURCES = ${prog}_dummy.$cxxsuffix\n&quot; .
                     &quot;libkdeinit_${prog}_SOURCES = &quot; . $sources{$program});
                 $sources{$prog} = &quot;${prog}_dummy.$cxxsuffix&quot;;
@@ -320,6 +326,11 @@
         $target_adds{&quot;$cleantarget-am&quot;} .= &quot;$cleantarget-ui &quot;;
     }
 
+    if ($kcfg_output) {
+        appendLines (&quot;$cleantarget-kcfg:\n\t-rm -f $kcfg_output\n&quot;);
+        $target_adds{&quot;$cleantarget-am&quot;} .= &quot;$cleantarget-kcfg &quot;;
+    }
+
     if ($closure_output) {
         appendLines (&quot;$cleantarget-closures:\n\t-rm -f $closure_output\n&quot;);
         $target_adds{&quot;$cleantarget-am&quot;} .= &quot;$cleantarget-closures &quot;;
@@ -527,8 +538,10 @@
     }
 
     # Checking for files to process...
-    open (FILEIN, $makefile)
-      || die &quot;Could not open $makefileDir/$makefile: $!\n&quot;;
+
+    open (FILEIN, $makefile) || die &quot;Can't open $makefileDir/$makefile: $!\n&quot;;
+    # perl bug in 5.8.0: in utf8 mode it badly screws up
+    binmode(FILEIN, &quot;:bytes&quot;) if ($] &gt;= 5.008);
     # Read the file
     # stat(FILEIN)[7] might look more elegant, but is slower as it 
     # requires stat'ing the file
@@ -734,6 +747,7 @@
         my %shash = ();
         @shash{@progsources} = 1;  # we are only interested in the existence
         my %sourcelist = ();
+        my %extradeps = ();
         
         foreach $source (@progsources) {
             my $suffix = $source;
@@ -751,8 +765,13 @@
 		$moc_cpp_added = 1;
 	    }
         }
+
+        # scan for extra given dependencies and add them to our target
+        while ($MakefileData =~ /\n\s*(\S+)\.(?:lo|o)\s*:([^\n]*)/g) {
+            $extradeps{$1} = $2;
+        }
+
         foreach $suffix (keys %sourcelist) {
-            
             # See if this file contains c++ code. (i.e., just check the file's suffix against c++ extensions)
             my $suffix_is_cxx = 0;
             if($suffix =~ /($cppExt)$/) {
@@ -769,7 +788,8 @@
                 # we support IDL on our own
                 if ($suffix eq &quot;skel&quot; || $suffix =~ /^stub/
 		    || $suffix =~ /^signals/ # obsolete, remove in KDE-4
-                    || $suffix eq &quot;h&quot; || $suffix eq &quot;ui&quot; ) {
+                    || $suffix eq &quot;h&quot; || $suffix eq &quot;ui&quot; 
+                    || $suffix eq &quot;kcfgc&quot; ) {
                     next;
                 }
                 
@@ -793,6 +813,9 @@
                 } else {
                     $source_deps .= &quot; $source&quot;;
                 }
+                my $plainsource = $source;
+                $plainsource =~ s/\.$cppExt$//;
+                $source_deps .= &quot; &quot; . $extradeps{$plainsource} if (exists($extradeps{$plainsource}));
             }
 
             $handling = &quot;$program.all_$suffix.$suffix: \$(srcdir)/Makefile.in&quot; . $source_deps . &quot; &quot; . join(' ', $mocs)  . &quot;\n&quot;;
@@ -852,7 +875,8 @@
                 $lines .= &quot;\techo 'int main(int argc, char* argv[]) { return kdemain(argc,argv); }' &gt;&gt; ${kdeinit}.la.$cxxsuffix\n&quot;;
 
                 $lines .= &quot;\n${kdeinit}_dummy.$cxxsuffix:\n&quot;;
-                $lines .= &quot;\t echo &gt; ${kdeinit}_dummy.$cxxsuffix\n&quot;;
+                $lines .= &quot;\techo 'extern \&quot;C\&quot; int kdemain(int argc, char* argv[]);' &gt; ${kdeinit}_dummy.$cxxsuffix; \\\n&quot;;
+                $lines .= &quot;\techo 'extern \&quot;C\&quot; int kdeinitmain(int argc, char* argv[]) { return kdemain(argc,argv); }' &gt;&gt; ${kdeinit}_dummy.$cxxsuffix\n&quot;;
 
                 push(@cleanfiles, &quot;${kdeinit}.la.$cxxsuffix&quot;);
                 push(@cleanfiles, &quot;${kdeinit}_dummy.$cxxsuffix&quot;);
@@ -868,7 +892,7 @@
                     substituteLine($lookup, &quot;${kdeinit}_la_LIBADD = libkdeinit_${kdeinit}.la&quot;);
                     appendLines(&quot;libkdeinit_${kdeinit}_la_LIBADD = $libadd\n&quot;);
                 }
-                appendLines(&quot;libkdeinit_${kdeinit}_la_LDFLAGS = \$(all_libraries)\n&quot;);
+                appendLines(&quot;libkdeinit_${kdeinit}_la_LDFLAGS = -no-undefined -avoid-version \$(all_libraries)\n&quot;);
 
                 # add library dependencies
                 $lookup = $kdeinit . '_la_DEPENDENCIES\s*=[ \t]*(.*)';
@@ -944,7 +968,7 @@
                 $realname{$kdeinit} = $kdeinit;
                 $sources{$kdeinit} = &quot;${kdeinit}.la.$cxxsuffix&quot;;
 
-                $lines .= &quot;${kdeinit}_LDFLAGS = \$(all_libraries)\n&quot;;
+                $lines .= &quot;${kdeinit}_LDFLAGS = \$(KDE_RPATH) -no-undefined \$(all_libraries)\n&quot;;
                 $lines .= &quot;${kdeinit}_LDADD = libkdeinit_${kdeinit}.la\n&quot;;
                 $lines .= &quot;${kdeinit}_DEPENDENCIES = libkdeinit_${kdeinit}.la\n&quot;;
 
@@ -972,7 +996,7 @@
 
     if($#progs &gt;= 0) {
         if($MakefileData !~ m/\nbin_PROGRAMS\s*=/) {
-            print STDERR &quot;Error: bin_PROGRAMS missing in $printname (required for bin_PROGRAMS).\n&quot;;
+            print STDERR &quot;Error: bin_PROGRAMS missing in $printname (required for kdeinit_LTLIBRARIES).\n&quot;;
             $errorflag = 1;
         }
         else {
@@ -1026,7 +1050,7 @@
           next if defined($donesources{$depend});
           push @deps, $depend;
         }
-        $target_adds{$sdeps} = join(' ', @deps) if (@deps);
+        $target_adds{$sdeps} .= join(' ', @deps) . ' ' if (@deps);
         $donesources{$source} = 1;
       }
     }
@@ -1123,12 +1147,16 @@
     print STDOUT &quot;AUTOMAKE processing &lt;$1&gt;\n&quot;        if ($verbose);
 
     my $newLine = $1.&quot;\n\tcd \$(top_srcdir) &amp;&amp; perl $thisProg $printname&quot;;
+
+    # automake 1.8.x adds another automake call. *sigh*
+    $newLine =~ s/;([\034\s]+cd\s+\$\(srcdir\)\s+&amp;&amp;[\034\s]+\$\(AUTOMAKE\).*)[\034\s]+\&amp;\&amp;[\034\s]+exit[\034\s]+0;([\034\s]+exit\s+1)/; \034 ( $1 ) || exit 1; echo \' cd \$(top_srcdir) &amp;&amp; perl $thisProg \'; cd \$(top_srcdir) &amp;&amp; perl $thisProg &amp;&amp; exit 0; $2/;
     substituteLine ($lookup, $newLine);
     $automkCall = $1;
 
     $lookup = '.*cd \$\(srcdir\)\s+&amp;&amp;[\034\s]+\$\(AUTOCONF\)(.*)';
     if ($MakefileData =~ /\n($lookup)\n/) {
-      $newLine = &quot;\tcd \$(srcdir) &amp;&amp; rm -f configure &amp;&amp; \$(MAKE) -f admin/Makefile.common configure&quot;;
+      $newLine  = &quot;\tcd \$(srcdir) &amp;&amp; rm -f configure\n&quot;;
+      $newLine .= &quot;\tcd \$(top_srcdir) &amp;&amp; \$(MAKE) -f admin/Makefile.common configure&quot;;
       substituteLine ($lookup, $newLine);
     }
 
@@ -1236,8 +1264,11 @@
             
             if ($allidls !~ /$source\_kidl/) {
                 
+                $use_ng = ($MakefileData =~ /\n$source\_DCOPIDLNG\s*=\s*(\S+)\n/);
+                $dcopidl =  $use_ng ? &quot;KDECONFIG=\&quot;\$(KDECONFIG)\&quot; \$(DCOPIDLNG)&quot; : &quot;\$(DCOPIDL)&quot;;
+
                 $dep_lines .= &quot;$source.kidl: $sourcedir$source.h \$(DCOP_DEPENDENCIES)\n&quot;;
-                $dep_lines .= &quot;\t\$(DCOPIDL) $sourcedir$source.h &gt; $source.kidl || ( rm -f $source.kidl ; false )\n&quot;;
+                $dep_lines .= &quot;\t$dcopidl $sourcedir$source.h &gt; $source.kidl || ( rm -f $source.kidl ; false )\n&quot;;
                 
                 $allidls .= $source . &quot;_kidl &quot;;
             }
@@ -1332,11 +1363,12 @@
                 my $dep_lines = &quot;$source.$cxxsuffix: $sourcedir$source.ui $source.h $source.moc\n&quot;;
                 $dep_lines .= &quot;\trm -f $source.$cxxsuffix\n&quot;;
                 if (!$kdeopts{&quot;qtonly&quot;}) {
-                    $dep_lines .= &quot;\techo '#include &lt;klocale.h&gt;' &gt; $source.$cxxsuffix\n&quot;;
+                    $dep_lines .= &quot;\techo '#include &lt;kdialog.h&gt;' &gt; $source.$cxxsuffix\n&quot;;
+                    $dep_lines .= &quot;\techo '#include &lt;klocale.h&gt;' &gt;&gt; $source.$cxxsuffix\n&quot;;
                     my ($mangled_source) = $source;
                     $mangled_source =~ s/[^A-Za-z0-9]/_/g;  # get rid of garbage
                     $dep_lines .= &quot;\t\$(UIC) -tr \${UIC_TR} -i $source.h $sourcedir$source.ui &gt; $source.$cxxsuffix.temp ; ret=\$\$?; \\\n&quot;;
-                    $dep_lines .= &quot;\tsed -e \&quot;s,\${UIC_TR}( \\\&quot;\\\&quot; ),QString::null,g\&quot; $source.$cxxsuffix.temp | sed -e \&quot;s,\${UIC_TR}( \\\&quot;\\\&quot;\\, \\\&quot;\\\&quot; ),QString::null,g\&quot; | sed -e \&quot;s,image\\([0-9][0-9]*\\)_data,img\\1_&quot; . $mangled_source . &quot;,g\&quot; &gt;&gt; $source.$cxxsuffix ;\\\n&quot;;
+                    $dep_lines .= &quot;\t\$(PERL) -pe \&quot;s,\${UIC_TR}( \\\&quot;\\\&quot; ),QString::null,g\&quot; $source.$cxxsuffix.temp | \$(PERL) -pe \&quot;s,\${UIC_TR}( \\\&quot;\\\&quot;\\, \\\&quot;\\\&quot; ),QString::null,g\&quot; | \$(PERL) -pe \&quot;s,image([0-9][0-9]*)_data,img\\\$\$1_&quot; . $mangled_source . &quot;,g\&quot; &gt;&gt; $source.$cxxsuffix ;\\\n&quot;;
 		    $dep_lines .= &quot;\trm -f $source.$cxxsuffix.temp ;\\\n&quot;;
                 } else {
                     $dep_lines .= &quot;\t\$(UIC) -i $source.h $sourcedir$source.ui &gt; $source.$cxxsuffix; ret=\$\$?; \\\n&quot;;
@@ -1364,13 +1396,69 @@
             $important{$program} .= &quot;$source.h &quot;;
             $ui_output .= &quot;\\\n\t$source.$cxxsuffix $source.h $source.moc &quot;;
             push(@cleanfiles, &quot;$source.$cxxsuffix&quot;);
-            push(@cleanfiles, &quot;source.h&quot;);
+            push(@cleanfiles, &quot;$source.h&quot;);
             push(@cleanfiles, &quot;$source.moc&quot;);
             $dep_files .= &quot; \$(DEPDIR)/$source.P&quot; if($dep_files !~/$source.P/ );
         }
     }
 }
 
+sub tag_KCFGFILES ()
+{
+    my @psources = split(/[\034\s]+/, $sources{$program});
+    my @depFiles = ();
+    
+    foreach $source (@psources) {
+
+        if ($source =~ m/\.kcfgc$/) {
+
+            print STDERR &quot;adding KCFG file $source\n&quot; if ($verbose);
+
+            my $qs = quotemeta($source);
+            $sources{$program} =~ s/$qs//;
+            $sources_changed{$program} = 1;
+      
+            $source =~ s/\.kcfgc$//;
+
+            my $sourcedir = '';
+            if (-f &quot;$makefileDir/$source.kcfgc&quot;) {
+                $sourcedir = '$(srcdir)/';
+            }
+
+            if (!$kcfgFiles{$source}) {
+                $kcfg = &quot;$program.kcfg&quot;;
+                findKcfgFile(&quot;$source.kcfgc&quot;);
+
+                my $fixsuffix = &quot;&quot;;
+                $fixsuffix = &quot;else mv $source.cpp $source.$cxxsuffix ; &quot; 
+                    unless &quot;cpp&quot; eq $cxxsuffix;
+
+                my $dep_lines = &quot;$source.$cxxsuffix: $source.h\n&quot;;
+                $dep_lines .= &quot;$source.h: $sourcedir$kcfg $sourcedir$source.kcfgc \$(KCFG_DEPENDENCIES)\n&quot;;
+                $dep_lines .= &quot;\t\$(KCONFIG_COMPILER) $sourcedir$kcfg $sourcedir$source.kcfgc; ret=\$\$?; \\\n&quot;;
+		$dep_lines .= &quot;\tif test \&quot;\$\$ret\&quot; != 0; then rm -f $source.h ; exit \$\$ret ; $fixsuffix fi\n\n&quot;;
+
+                $rule_adds{&quot;$source.$cxxsuffix&quot;} = $dep_lines;
+
+		$kcfgFiles{$source} = 1;
+            }
+            
+            if ($program =~ /_la$/) {
+                $realObjs{$program} .= &quot; $source.lo&quot;;
+            } else {
+                $realObjs{$program} .= &quot; $source.\$(OBJEXT)&quot;;
+            }
+            $sources{$program} .= &quot; $source.$cxxsuffix&quot;;
+            $sources_changed{$program} = 1;
+            $important{$program} .= &quot;$source.h &quot;;
+            $kcfg_output .= &quot;\\\n\t$source.$cxxsuffix $source.h &quot;;
+            push(@cleanfiles, &quot;$source.$cxxsuffix&quot;);
+            push(@cleanfiles, &quot;$source.h&quot;);
+            $dep_files .= &quot; \$(DEPDIR)/$source.P&quot; if($dep_files !~/$source.P/ );
+        }
+    }
+}
+
 sub tag_ICON()
 {
     my $lookup = '([^\s]*)_ICON\s*=[ \t]*(.*)';
@@ -1644,7 +1732,7 @@
 	$pofiles =  join(&quot; &quot;, grep(/\.po$/, readdir(THISDIR)));
         closedir (THISDIR);
         print STDOUT &quot;pofiles found = $pofiles\n&quot;   if ($verbose);
-	if (-f &quot;charset&quot; &amp;&amp; -f &quot;kdelibs.po&quot;) {
+	if (-f &quot;charset&quot; &amp;&amp; -f &quot;kdelibs/kdelibs.po&quot;) {
 	    handle_TOPLEVEL();
 	}
     }
@@ -2188,7 +2276,7 @@
     $t .=  $cxxsuffix eq &quot;KKK&quot; ?
            &quot;\$(CXX) \$(DEFS) -I. -I\$(srcdir) -I\$(top_builddir) \$(INCLUDES) \$(AM_CPPFLAGS) \$(CPPFLAGS) \$(KDE_CXXFLAGS) &quot; :
            &quot;\$(CXXCOMPILE) &quot;;
-    $t .=  &quot; --dump-class-hierarchy \$\$i.bchecktest.cc; then \\\n&quot; .
+    $t .=  &quot; --dump-class-hierarchy -c \$\$i.bchecktest.cc; then \\\n&quot; .
            &quot;\t            rm -f \$\$i.bchecktest.cc; exit 1; \\\n&quot; .
            &quot;\t        fi ; \\\n&quot; .
            &quot;\t        echo \&quot;\&quot; &gt;&gt; \$\$i.bchecktest.cc.class; \\\n&quot; .
@@ -2337,3 +2425,18 @@
 }
 
 #-----------------------------------------------------------------------------
+
+# find the .kcfg file listed in the .kcfgc file
+sub findKcfgFile($)
+{
+  my ($kcfgf) = @_;
+  open (KCFGFIN, $kcfgf) || die &quot;Could not open $kcfgf: $!\n&quot;;
+  seek(KCFGFIN, 0, 2);
+  my $kcfgfsize = tell(KCFGFIN);
+  seek(KCFGFIN, 0, 0);
+  read KCFGFIN, $kcfgfData, $kcfgfsize;
+  close KCFGFIN;
+  if(($kcfgfData =~ m/^File=(.*\.kcfg)/gm)) {
+    $kcfg = $1;
+  }
+}
Index: configure.in.bot.end
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/configure.in.bot.end,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/configure.in.bot.end -Ladmin/configure.in.bot.end -u -r1.1.1.1 -r1.2
--- admin/configure.in.bot.end
+++ admin/configure.in.bot.end
@@ -1,6 +1,24 @@
+# Check if KDE_SET_PREFIX was called, and --prefix was passed to configure
+if test -n &quot;$kde_libs_prefix&quot; -a -n &quot;$given_prefix&quot;; then
+  # And if so, warn when they don't match
+  if test &quot;$kde_libs_prefix&quot; != &quot;$given_prefix&quot;; then
+    # And if kde doesn't know about the prefix yet
+    echo &quot;:&quot;`kde-config --path exe`&quot;:&quot; | grep &quot;:$given_prefix/bin/:&quot; 2&gt;&amp;1 &gt;/dev/null
+    if test $? -ne 0; then
+      echo &quot;&quot;
+      echo &quot;Warning: you chose to install this package in $given_prefix,&quot;
+      echo &quot;but KDE was found in $kde_libs_prefix.&quot;
+      echo &quot;For this to work, you will need to tell KDE about the new prefix, by ensuring&quot;
+      echo &quot;that KDEDIRS contains it, e.g. export KDEDIRS=$given_prefix:$kde_libs_prefix&quot;
+      echo &quot;Then restart KDE.&quot;
+      echo &quot;&quot;
+    fi
+  fi
+fi
+
 if test &quot;$all_tests&quot; = &quot;bad&quot;; then
   if test ! &quot;$cache_file&quot; = &quot;/dev/null&quot;; then
-    echo &quot;&quot;    
+    echo &quot;&quot;
     echo &quot;Please remove the file $cache_file after changing your setup&quot;
     echo &quot;so that configure will find the changes next time.&quot;
     echo &quot;&quot;
Index: bcheck.pl
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/bcheck.pl,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/bcheck.pl -Ladmin/bcheck.pl -u -r1.1.1.1 -r1.2
--- admin/bcheck.pl
+++ admin/bcheck.pl
@@ -68,7 +68,7 @@
         print &quot;-----------------------------------------------\n&quot;;
         print @new;
         $haschanges = 1;
-        return;
+        return $haschanges;
     }
 
     print $old[0];
@@ -84,7 +84,6 @@
         next if ($o eq $n);
 
         if(defined($class) and $n =~ /^(\d+\s+)\w+(::\S+\s*.*)$/) {
-            print &quot;comparing &gt;$n&lt; against &gt;$1$class$2&lt;\n&quot;;
             next if ($n eq &quot;$1$class$2&quot;);
         }
 
@@ -118,6 +117,8 @@
     chop;
 
     s/0x[0-9a-fA-F]+/0x......../g;
+    s/base size=/size=/g;
+    s/base align=/align=/g;
 
     $chunk .= $_ . &quot;\n&quot;;
 
Index: detect-autoconf.sh
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/detect-autoconf.sh,v
retrieving revision 1.4
retrieving revision 1.5
diff -Ladmin/detect-autoconf.sh -Ladmin/detect-autoconf.sh -u -r1.4 -r1.5
--- admin/detect-autoconf.sh
+++ admin/detect-autoconf.sh
@@ -13,74 +13,75 @@
 # our includer.  The repeated type calls are not that expensive.
 checkAutoconf()
 {
-  if test -x &quot;`$WHICH autoconf-2.5x`&quot; ; then	
+  if test -x &quot;`$WHICH autoconf-2.5x 2&gt;/dev/null`&quot; ; then	
     AUTOCONF=&quot;`$WHICH autoconf-2.5x`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.54`&quot; ; then
+  elif test -x &quot;`$WHICH autoconf-2.57 2&gt;/dev/null`&quot; ; then
+    AUTOCONF=&quot;`$WHICH autoconf-2.57`&quot;
+  elif test -x &quot;`$WHICH autoconf257 2&gt;/dev/null`&quot; ; then
+    AUTOCONF=&quot;`$WHICH autoconf257`&quot;
+  elif test -x &quot;`$WHICH autoconf-2.56 2&gt;/dev/null`&quot; ; then
+    AUTOCONF=&quot;`$WHICH autoconf-2.56`&quot;
+  elif test -x &quot;`$WHICH autoconf-2.55 2&gt;/dev/null`&quot; ; then
+    AUTOCONF=&quot;`$WHICH autoconf-2.55`&quot;
+  elif test -x &quot;`$WHICH autoconf-2.54 2&gt;/dev/null`&quot; ; then
     AUTOCONF=&quot;`$WHICH autoconf-2.54`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.53`&quot; ; then
+  elif test -x &quot;`$WHICH autoconf-2.53 2&gt;/dev/null`&quot; ; then
     AUTOCONF=&quot;`$WHICH autoconf-2.53`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.53a`&quot; ; then
+  elif test -x &quot;`$WHICH autoconf-2.53a 2&gt;/dev/null`&quot; ; then
     AUTOCONF=&quot;`$WHICH autoconf-2.53a`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.52`&quot; ; then
+  elif test -x &quot;`$WHICH autoconf-2.52 2&gt;/dev/null`&quot; ; then
     AUTOCONF=&quot;`$WHICH autoconf-2.52`&quot;
-  elif test -x &quot;`$WHICH autoconf2.50`&quot; ; then
+  elif test -x &quot;`$WHICH autoconf2.50 2&gt;/dev/null`&quot; ; then
     AUTOCONF=&quot;`$WHICH autoconf2.50`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.55`&quot; ; then
-    AUTOCONF=&quot;`$WHICH autoconf-2.55`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.56`&quot; ; then
-    AUTOCONF=&quot;`$WHICH autoconf-2.56`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.57`&quot; ; then
-    AUTOCONF=&quot;`$WHICH autoconf-2.57`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.58`&quot; ; then
-    AUTOCONF=&quot;`$WHICH autoconf-2.58`&quot;
-  elif test -x &quot;`$WHICH autoconf-2.59`&quot; ; then
-    AUTOCONF=&quot;`$WHICH autoconf-2.59`&quot;
   fi
-
 }
 
 checkAutoheader()
 {
-  if test -x &quot;`$WHICH autoheader-2.5x`&quot; ; then
+  if test -x &quot;`$WHICH autoheader-2.5x 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader-2.5x`&quot;
     AUTOM4TE=&quot;`$WHICH autom4te-2.5x`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.54`&quot; ; then
+  elif test -x &quot;`$WHICH autoheader-2.57 2&gt;/dev/null`&quot; ; then
+    AUTOHEADER=&quot;`$WHICH autoheader-2.57`&quot;
+    AUTOM4TE=&quot;`$WHICH autom4te-2.57`&quot;
+  elif test -x &quot;`$WHICH autoheader257 2&gt;/dev/null`&quot; ; then
+    AUTOHEADER=&quot;`$WHICH autoheader257`&quot;
+    AUTOM4TE=&quot;`$WHICH autom4te257`&quot;
+  elif test -x &quot;`$WHICH autoheader-2.56 2&gt;/dev/null`&quot; ; then
+    AUTOHEADER=&quot;`$WHICH autoheader-2.56`&quot;
+    AUTOM4TE=&quot;`$WHICH autom4te-2.56`&quot;
+  elif test -x &quot;`$WHICH autoheader-2.55 2&gt;/dev/null`&quot; ; then
+    AUTOHEADER=&quot;`$WHICH autoheader-2.55`&quot;
+    AUTOM4TE=&quot;`$WHICH autom4te-2.55`&quot;
+  elif test -x &quot;`$WHICH autoheader-2.54 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader-2.54`&quot;
     AUTOM4TE=&quot;`$WHICH autom4te-2.54`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.53`&quot; ; then
+  elif test -x &quot;`$WHICH autoheader-2.53 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader-2.53`&quot;
     AUTOM4TE=&quot;`$WHICH autom4te-2.53`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.53a`&quot; ; then
+  elif test -x &quot;`$WHICH autoheader-2.53a 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader-2.53a`&quot;
     AUTOM4TE=&quot;`$WHICH autom4te-2.53a`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.52`&quot; ; then
+  elif test -x &quot;`$WHICH autoheader-2.52 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader-2.52`&quot;
-  elif test -x &quot;`$WHICH autoheader2.50`&quot; ; then
+  elif test -x &quot;`$WHICH autoheader2.50 2&gt;/dev/null`&quot; ; then
     AUTOHEADER=&quot;`$WHICH autoheader2.50`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.55`&quot; ; then
-    AUTOHEADER=&quot;`$WHICH autoheader-2.55`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.56`&quot; ; then
-    AUTOHEADER=&quot;`$WHICH autoheader-2.56`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.57`&quot; ; then
-    AUTOHEADER=&quot;`$WHICH autoheader-2.57`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.58`&quot; ; then
-    AUTOHEADER=&quot;`$WHICH autoheader-2.58`&quot;
-  elif test -x &quot;`$WHICH autoheader-2.59`&quot; ; then
-    AUTOHEADER=&quot;`$WHICH autoheader-2.59`&quot;
   fi
 }
 
 checkAutomakeAclocal ()
 {
-  if test -z &quot;$UNSERMAKE&quot;; then
-    if test -x &quot;`$WHICH automake-1.6`&quot; ; then
-      AUTOMAKE=&quot;`$WHICH automake-1.6`&quot;
-      ACLOCAL=&quot;`$WHICH aclocal-1.6`&quot;
-    elif test -x &quot;`$WHICH automake-1.7`&quot; ; then
-      AUTOMAKE=&quot;`$WHICH automake-1.7`&quot;
-      ACLOCAL=&quot;`$WHICH aclocal-1.7`&quot;
-    fi
-  else
+ if test -x &quot;`$WHICH automake-1.6 2&gt;/dev/null`&quot; ; then
+    AUTOMAKE=&quot;`$WHICH automake-1.6`&quot;
+    ACLOCAL=&quot;`$WHICH aclocal-1.6`&quot;
+  elif test -x &quot;`$WHICH automake-1.7 2&gt;/dev/null`&quot; ; then
+    AUTOMAKE=&quot;`$WHICH automake-1.7`&quot;
+    ACLOCAL=&quot;`$WHICH aclocal-1.7`&quot;
+  elif test -x &quot;`$WHICH automake17 2&gt;/dev/null`&quot; ; then
+    AUTOMAKE=&quot;`$WHICH automake17`&quot;
+    ACLOCAL=&quot;`$WHICH aclocal17`&quot;
+  fi
+  if test -n &quot;$UNSERMAKE&quot;; then 
      AUTOMAKE=&quot;$UNSERMAKE&quot;
   fi
 }
Index: acinclude.m4.in
===================================================================
RCS file: /cvsroot/schafkopf/schafkopf/admin/acinclude.m4.in,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -Ladmin/acinclude.m4.in -Ladmin/acinclude.m4.in -u -r1.1.1.1 -r1.2
--- admin/acinclude.m4.in
+++ admin/acinclude.m4.in
@@ -29,7 +29,7 @@
 # KDE_PATH_X_DIRECT
 dnl Internal subroutine of AC_PATH_X.
 dnl Set ac_x_includes and/or ac_x_libraries.
-AC_DEFUN(KDE_PATH_X_DIRECT,
+AC_DEFUN([KDE_PATH_X_DIRECT],
 [
 AC_REQUIRE([KDE_CHECK_LIB64])
 
@@ -156,7 +156,7 @@
 dnl Find a file (or one of more files in a list of dirs)
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_FIND_FILE,
+AC_DEFUN([AC_FIND_FILE],
 [
 $3=NO
 for i in $2;
@@ -173,9 +173,15 @@
 done
 ])
 
-dnl KDE_FIND_PATH(programm-name, variable-name, list of directories,
-dnl	if-not-found, test-parameter)
-AC_DEFUN(KDE_FIND_PATH,
+dnl KDE_FIND_PATH(program-name, variable-name, list-of-dirs,
+dnl	if-not-found, test-parameter, prepend-path)
+dnl
+dnl Look for program-name in list-of-dirs+$PATH.
+dnl If prepend-path is set, look in $PATH+list-of-dirs instead.
+dnl If found, $variable-name is set. If not, if-not-found is evaluated.
+dnl test-parameter: if set, the program is executed with this arg,
+dnl                 and only a successful exit code is required.
+AC_DEFUN([KDE_FIND_PATH],
 [
    AC_MSG_CHECKING([for $1])
    if test -n &quot;$$2&quot;; then
@@ -186,12 +192,17 @@
         AC_CACHE_VAL(kde_cv_path_$kde_cache,
         [
         kde_cv_path=&quot;NONE&quot;
-	dirs=&quot;$3&quot;
 	kde_save_IFS=$IFS
 	IFS=':'
+	dirs=&quot;&quot;
 	for dir in $PATH; do
 	  dirs=&quot;$dirs $dir&quot;
-        done
+	done
+	if test -z &quot;$6&quot;; then  dnl Append dirs in PATH (default)
+	  dirs=&quot;$3 $dirs&quot;
+        else  dnl Prepend dirs in PATH (if 6th arg is set)
+	  dirs=&quot;$dirs $3&quot;
+	fi
 	IFS=$kde_save_IFS
 
         for dir in $dirs; do
@@ -228,7 +239,7 @@
    fi
 ])
 
-AC_DEFUN(KDE_MOC_ERROR_MESSAGE,
+AC_DEFUN([KDE_MOC_ERROR_MESSAGE],
 [
     AC_MSG_ERROR([No Qt meta object compiler (moc) found!
 Please check whether you installed Qt correctly.
@@ -240,7 +251,7 @@
 ])
 ])
 
-AC_DEFUN(KDE_UIC_ERROR_MESSAGE,
+AC_DEFUN([KDE_UIC_ERROR_MESSAGE],
 [
     AC_MSG_WARN([No Qt ui compiler (uic) found!
 Please check whether you installed Qt correctly.
@@ -253,7 +264,7 @@
 ])
 
 
-AC_DEFUN(KDE_CHECK_UIC_FLAG,
+AC_DEFUN([KDE_CHECK_UIC_FLAG],
 [
     AC_MSG_CHECKING([whether uic supports -$1 ])
     kde_cache=`echo $1 | sed 'y% .=/+-%____p_%'`
@@ -288,8 +299,9 @@
 dnl in $QTDIR/bin, and some more usual places
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_PATH_QT_MOC_UIC,
+AC_DEFUN([AC_PATH_QT_MOC_UIC],
 [
+   AC_REQUIRE([KDE_CHECK_PERL])
    qt_bindirs=&quot;&quot;
    for dir in $kde_qt_dirs; do
       qt_bindirs=&quot;$qt_bindirs $dir/bin $dir/src/moc&quot;
@@ -305,16 +317,19 @@
      if test -z &quot;$UIC_PATH&quot; ; then
        KDE_UIC_ERROR_MESSAGE
        exit 1
-     elif test $kde_qtver = 3; then
-       KDE_CHECK_UIC_FLAG(L,[/nonexistant],ac_uic_supports_libpath=yes,ac_uic_supports_libpath=no)
-       KDE_CHECK_UIC_FLAG(nounload,,ac_uic_supports_nounload=yes,ac_uic_supports_nounload=no)
-
+     else
        UIC=$UIC_PATH
-       if test x$ac_uic_supports_libpath = xyes; then
-           UIC=&quot;$UIC -L \$(kde_widgetdir)&quot;
-       fi
-       if test x$ac_uic_supports_nounload = xyes; then
-           UIC=&quot;$UIC -nounload&quot;
+
+       if test $kde_qtver = 3; then
+         KDE_CHECK_UIC_FLAG(L,[/nonexistent],ac_uic_supports_libpath=yes,ac_uic_supports_libpath=no)
+         KDE_CHECK_UIC_FLAG(nounload,,ac_uic_supports_nounload=yes,ac_uic_supports_nounload=no)
+
+         if test x$ac_uic_supports_libpath = xyes; then
+             UIC=&quot;$UIC -L \$(kde_widgetdir)&quot;
+         fi
+         if test x$ac_uic_supports_nounload = xyes; then
+             UIC=&quot;$UIC -nounload&quot;
+         fi
        fi
      fi
    else
@@ -332,7 +347,7 @@
    AC_SUBST(UIC_TR)
 ])
 
-AC_DEFUN(KDE_1_CHECK_PATHS,
+AC_DEFUN([KDE_1_CHECK_PATHS],
 [
   KDE_1_CHECK_PATH_HEADERS
 
@@ -380,7 +395,7 @@
 
 ])
 
-AC_DEFUN(KDE_SET_PATHS,
+AC_DEFUN([KDE_SET_PATHS],
 [
   kde_cv_all_paths=&quot;kde_have_all_paths=\&quot;yes\&quot; \
 	kde_htmldir=\&quot;$kde_htmldir\&quot; \
@@ -391,6 +406,7 @@
 	kde_locale=\&quot;$kde_locale\&quot; \
 	kde_cgidir=\&quot;$kde_cgidir\&quot; \
 	kde_confdir=\&quot;$kde_confdir\&quot; \
+	kde_kcfgdir=\&quot;$kde_kcfgdir\&quot; \
 	kde_mimedir=\&quot;$kde_mimedir\&quot; \
 	kde_toolbardir=\&quot;$kde_toolbardir\&quot; \
 	kde_wallpaperdir=\&quot;$kde_wallpaperdir\&quot; \
@@ -402,58 +418,62 @@
 	kde_styledir=\&quot;$kde_styledir\&quot; \
 	kde_widgetdir=\&quot;$kde_widgetdir\&quot; \
 	xdg_appsdir=\&quot;$xdg_appsdir\&quot; \
+	xdg_menudir=\&quot;$xdg_menudir\&quot; \
 	xdg_directorydir=\&quot;$xdg_directorydir\&quot; \
 	kde_result=$1&quot;
 ])
 
-AC_DEFUN(KDE_SET_DEFAULT_PATHS,
+AC_DEFUN([KDE_SET_DEFAULT_PATHS],
 [
 if test &quot;$1&quot; = &quot;default&quot;; then
 
   if test -z &quot;$kde_htmldir&quot;; then
-    kde_htmldir='\${prefix}/share/doc/HTML'
+    kde_htmldir='\${datadir}/doc/HTML'
   fi
   if test -z &quot;$kde_appsdir&quot;; then
-    kde_appsdir='\${prefix}/share/applnk'
+    kde_appsdir='\${datadir}/applnk'
   fi
   if test -z &quot;$kde_icondir&quot;; then
-    kde_icondir='\${prefix}/share/icons'
+    kde_icondir='\${datadir}/icons'
   fi
   if test -z &quot;$kde_sounddir&quot;; then
-    kde_sounddir='\${prefix}/share/sounds'
+    kde_sounddir='\${datadir}/sounds'
   fi
   if test -z &quot;$kde_datadir&quot;; then
-    kde_datadir='\${prefix}/share/apps'
+    kde_datadir='\${datadir}/apps'
   fi
   if test -z &quot;$kde_locale&quot;; then
-    kde_locale='\${prefix}/share/locale'
+    kde_locale='\${datadir}/locale'
   fi
   if test -z &quot;$kde_cgidir&quot;; then
     kde_cgidir='\${exec_prefix}/cgi-bin'
   fi
   if test -z &quot;$kde_confdir&quot;; then
-    kde_confdir='\${prefix}/share/config'
+    kde_confdir='\${datadir}/config'
+  fi
+  if test -z &quot;$kde_kcfgdir&quot;; then
+    kde_kcfgdir='\${datadir}/config.kcfg'
   fi
   if test -z &quot;$kde_mimedir&quot;; then
-    kde_mimedir='\${prefix}/share/mimelnk'
+    kde_mimedir='\${datadir}/mimelnk'
   fi
   if test -z &quot;$kde_toolbardir&quot;; then
-    kde_toolbardir='\${prefix}/share/toolbar'
+    kde_toolbardir='\${datadir}/toolbar'
   fi
   if test -z &quot;$kde_wallpaperdir&quot;; then
-    kde_wallpaperdir='\${prefix}/share/wallpapers'
+    kde_wallpaperdir='\${datadir}/wallpapers'
   fi
   if test -z &quot;$kde_templatesdir&quot;; then
-    kde_templatesdir='\${prefix}/share/templates'
+    kde_templatesdir='\${datadir}/templates'
   fi
   if test -z &quot;$kde_bindir&quot;; then
     kde_bindir='\${exec_prefix}/bin'
   fi
   if test -z &quot;$kde_servicesdir&quot;; then
-    kde_servicesdir='\${prefix}/share/services'
+    kde_servicesdir='\${datadir}/services'
   fi
   if test -z &quot;$kde_servicetypesdir&quot;; then
-    kde_servicetypesdir='\${prefix}/share/servicetypes'
+    kde_servicetypesdir='\${datadir}/servicetypes'
   fi
   if test -z &quot;$kde_moduledir&quot;; then
     if test &quot;$kde_qtver&quot; = &quot;2&quot;; then
@@ -469,7 +489,10 @@
     kde_widgetdir='\${libdir}/kde3/plugins/designer'
   fi
   if test -z &quot;$xdg_appsdir&quot;; then
-    xdg_appsdir='\${datadir}/applications'
+    xdg_appsdir='\${datadir}/applications/kde'
+  fi
+  if test -z &quot;$xdg_menudir&quot;; then
+    xdg_menudir='\${sysconfdir}/xdg/menus'
   fi
   if test -z &quot;$xdg_directorydir&quot;; then
     xdg_directorydir='\${datadir}/desktop-directories'
@@ -489,65 +512,89 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_PATHS_FOR_COMPLETENESS,
+AC_DEFUN([KDE_CHECK_PATHS_FOR_COMPLETENESS],
 [ if test -z &quot;$kde_htmldir&quot; || test -z &quot;$kde_appsdir&quot; ||
    test -z &quot;$kde_icondir&quot; || test -z &quot;$kde_sounddir&quot; ||
    test -z &quot;$kde_datadir&quot; || test -z &quot;$kde_locale&quot;  ||
    test -z &quot;$kde_cgidir&quot;  || test -z &quot;$kde_confdir&quot; ||
+   test -z &quot;$kde_kcfgdir&quot; ||
    test -z &quot;$kde_mimedir&quot; || test -z &quot;$kde_toolbardir&quot; ||
    test -z &quot;$kde_wallpaperdir&quot; || test -z &quot;$kde_templatesdir&quot; ||
    test -z &quot;$kde_bindir&quot; || test -z &quot;$kde_servicesdir&quot; ||
    test -z &quot;$kde_servicetypesdir&quot; || test -z &quot;$kde_moduledir&quot; ||
    test -z &quot;$kde_styledir&quot; || test -z &quot;kde_widgetdir&quot; ||
-   test -z &quot;$xdg_appsdir&quot; || test -z &quot;xdg_directorydir&quot; 
+   test -z &quot;$xdg_appsdir&quot; || test -z &quot;$xdg_menudir&quot; || test -z &quot;$xdg_directorydir&quot; ||
    test &quot;x$kde_have_all_paths&quot; != &quot;xyes&quot;; then
      kde_have_all_paths=no
   fi
 ])
 
-AC_DEFUN(KDE_MISSING_PROG_ERROR,
+AC_DEFUN([KDE_MISSING_PROG_ERROR],
 [
     AC_MSG_ERROR([The important program $1 was not found!
 Please check whether you installed KDE correctly.
 ])
 ])
 
-AC_DEFUN(KDE_MISSING_ARTS_ERROR,
+AC_DEFUN([KDE_MISSING_ARTS_ERROR],
 [
     AC_MSG_ERROR([The important program $1 was not found!
-Please check whether you installed aRts correctly.
+Please check whether you installed aRts correctly or use
+--without-arts to compile without aRts support (this will remove functionality).
 ])
 ])
 
-AC_DEFUN(KDE_SUBST_PROGRAMS,
+AC_DEFUN([KDE_SET_DEFAULT_BINDIRS],
+[
+    kde_default_bindirs=&quot;/usr/bin /usr/local/bin /opt/local/bin /usr/X11R6/bin /opt/kde/bin /opt/kde3/bin /usr/kde/bin /usr/local/kde/bin&quot;
+    test -n &quot;$KDEDIR&quot; &amp;&amp; kde_default_bindirs=&quot;$KDEDIR/bin $kde_default_bindirs&quot;
+    if test -n &quot;$KDEDIRS&quot;; then
+       kde_save_IFS=$IFS
+       IFS=:
+       for dir in $KDEDIRS; do
+            kde_default_bindirs=&quot;$dir/bin $kde_default_bindirs &quot;
+       done
+       IFS=$kde_save_IFS
+    fi
+])
+
+AC_DEFUN([KDE_SUBST_PROGRAMS],
 [
     AC_ARG_WITH(arts,
-        [  --without-arts        build without aRts [default=detect] ],
+        AC_HELP_STRING([--without-arts],[build without aRts [default=yes]]),
         [build_arts=$withval],
         [build_arts=yes]
     )
     AM_CONDITIONAL(include_ARTS, test &quot;$build_arts&quot; != &quot;no&quot;)
+    if test &quot;$build_arts&quot; == &quot;no&quot;; then
+        AC_DEFINE(WITHOUT_ARTS, 1, [Defined if compiling without arts])
+    fi
 
-        kde_default_bindirs=&quot;/usr/bin /usr/local/bin /opt/local/bin /usr/X11R6/bin /opt/kde/bin /opt/kde3/bin /usr/kde/bin /usr/local/kde/bin&quot;
-        test -n &quot;$KDEDIR&quot; &amp;&amp; kde_default_bindirs=&quot;$KDEDIR/bin $kde_default_bindirs&quot;
-        if test -n &quot;$KDEDIRS&quot;; then
-           kde_save_IFS=$IFS
-           IFS=:
-           for dir in $KDEDIRS; do
-                kde_default_bindirs=&quot;$dir/bin $kde_default_bindirs &quot;
-           done
-           IFS=$kde_save_IFS
-        fi
-        kde_default_bindirs=&quot;$exec_prefix/bin $prefix/bin $kde_default_bindirs&quot;
+        KDE_SET_DEFAULT_BINDIRS
+        kde_default_bindirs=&quot;$exec_prefix/bin $prefix/bin $kde_libs_prefix/bin $kde_default_bindirs&quot;
         KDE_FIND_PATH(dcopidl, DCOPIDL, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(dcopidl)])
         KDE_FIND_PATH(dcopidl2cpp, DCOPIDL2CPP, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(dcopidl2cpp)])
         if test &quot;$build_arts&quot; != &quot;no&quot;; then
           KDE_FIND_PATH(mcopidl, MCOPIDL, [$kde_default_bindirs], [KDE_MISSING_ARTS_ERROR(mcopidl)])
           KDE_FIND_PATH(artsc-config, ARTSCCONFIG, [$kde_default_bindirs], [KDE_MISSING_ARTS_ERROR(artsc-config)])
         fi
-        KDE_FIND_PATH(kde-config, KDECONFIG, [$kde_default_bindirs])
         KDE_FIND_PATH(meinproc, MEINPROC, [$kde_default_bindirs])
 
+        kde32ornewer=1
+        if test -n &quot;$kde_qtver&quot; &amp;&amp; test &quot;$kde_qtver&quot; -lt 3; then
+            kde32ornewer=
+        else
+            if test &quot;$kde_qtver&quot; = &quot;3&quot; &amp;&amp; test &quot;$kde_qtsubver&quot; -le 1; then
+                kde32ornewer=
+            fi
+        fi
+
+        if test -n &quot;$kde32ornewer&quot;; then
+            KDE_FIND_PATH(kconfig_compiler, KCONFIG_COMPILER, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(kconfig_compiler)])
+            KDE_FIND_PATH(dcopidlng, DCOPIDLNG, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(dcopidlng)])
+        fi
+        KDE_FIND_PATH(xmllint, XMLLINT, [${prefix}/bin ${exec_prefix}/bin /usr/local/bin /opt/local/bin], [XMLLINT=&quot;&quot;])
+
         if test -n &quot;$MEINPROC&quot; &amp;&amp; test ! &quot;$MEINPROC&quot; = &quot;compiled&quot;; then  
  	    kde_sharedirs=&quot;/usr/share/kde /usr/local/share /usr/share /opt/kde3/share /opt/kde/share $prefix/share&quot;
             test -n &quot;$KDEDIR&quot; &amp;&amp; kde_sharedirs=&quot;$KDEDIR/share $kde_sharedirs&quot;
@@ -560,34 +607,24 @@
         fi
 
         DCOP_DEPENDENCIES='$(DCOPIDL)'
+        if test -n &quot;$kde32ornewer&quot;; then
+            KCFG_DEPENDENCIES='$(KCONFIG_COMPILER)'
+            DCOP_DEPENDENCIES='$(DCOPIDL) $(DCOPIDLNG)'
+            AC_SUBST(KCONFIG_COMPILER)
+            AC_SUBST(KCFG_DEPENDENCIES)
+            AC_SUBST(DCOPIDLNG)
+        fi
         AC_SUBST(DCOPIDL)
         AC_SUBST(DCOPIDL2CPP)
         AC_SUBST(DCOP_DEPENDENCIES)
         AC_SUBST(MCOPIDL)
         AC_SUBST(ARTSCCONFIG)
-        AC_SUBST(KDECONFIG)
-        AC_SUBST(BROCKENBORING)
 	AC_SUBST(MEINPROC)
  	AC_SUBST(KDE_XSL_STYLESHEET)
-
-        if test -x &quot;$KDECONFIG&quot;; then # it can be &quot;compiled&quot;
-          kde_libs_prefix=`$KDECONFIG --prefix`
-          if test -z &quot;$kde_libs_prefix&quot; || test ! -x &quot;$kde_libs_prefix&quot;; then
-               AC_MSG_ERROR([$KDECONFIG --prefix outputed the non existant prefix '$kde_libs_prefix' for kdelibs.
-                          This means it has been moved since you installed it.
-                          This won't work. Please recompile kdelibs for the new prefix.
-                          ])
-           fi
-           kde_libs_htmldir=`$KDECONFIG --install html --expandvars`
-        else
-           kde_libs_prefix='$(prefix)'
-           kde_libs_htmldir='$(kde_htmldir)'
-        fi
-        AC_SUBST(kde_libs_prefix)
-        AC_SUBST(kde_libs_htmldir)
+	AC_SUBST(XMLLINT)
 ])dnl
 
-AC_DEFUN(AC_CREATE_KFSSTND,
+AC_DEFUN([AC_CREATE_KFSSTND],
 [
 AC_REQUIRE([AC_CHECK_RPATH])
 
@@ -605,13 +642,13 @@
   # wrong values were cached, may be, we can set better ones
   kde_result=
   kde_htmldir= kde_appsdir= kde_icondir= kde_sounddir=
-  kde_datadir= kde_locale=  kde_cgidir=  kde_confdir=
+  kde_datadir= kde_locale=  kde_cgidir=  kde_confdir= kde_kcfgdir=
   kde_mimedir= kde_toolbardir= kde_wallpaperdir= kde_templatesdir=
   kde_bindir= kde_servicesdir= kde_servicetypesdir= kde_moduledir=
   kde_have_all_paths=
   kde_styledir=
   kde_widgetdir=
-  xdg_appsdir = xdg_directorydir=
+  xdg_appsdir = xdg_menudir= xdg_directorydir= 
   KDE_SET_DEFAULT_PATHS($1)
   eval &quot;$kde_cv_all_paths&quot;
   KDE_CHECK_PATHS_FOR_COMPLETENESS
@@ -635,7 +672,7 @@
 
 ])
 
-AC_DEFUN(AC_SUBST_KFSSTND,
+AC_DEFUN([AC_SUBST_KFSSTND],
 [
 AC_SUBST(kde_htmldir)
 AC_SUBST(kde_appsdir)
@@ -644,11 +681,13 @@
 AC_SUBST(kde_datadir)
 AC_SUBST(kde_locale)
 AC_SUBST(kde_confdir)
+AC_SUBST(kde_kcfgdir)
 AC_SUBST(kde_mimedir)
 AC_SUBST(kde_wallpaperdir)
 AC_SUBST(kde_bindir)
 dnl X Desktop Group standards
 AC_SUBST(xdg_appsdir)
+AC_SUBST(xdg_menudir)
 AC_SUBST(xdg_directorydir)
 dnl for KDE 2
 AC_SUBST(kde_templatesdir)
@@ -670,9 +709,8 @@
 dnl AC_SUBST(kde_toolbardir)
 ])
 
-AC_DEFUN(KDE_MISC_TESTS,
+AC_DEFUN([KDE_MISC_TESTS],
 [
-   AC_LANG_C
    dnl Checks for libraries.
    AC_CHECK_LIB(util, main, [LIBUTIL=&quot;-lutil&quot;]) dnl for *BSD 
    AC_SUBST(LIBUTIL)
@@ -691,7 +729,6 @@
       AC_DEFINE_UNQUOTED(HAVE_CRYPT, 1, [Defines if your system has the crypt function])
    fi
    AC_CHECK_SOCKLEN_T
-   AC_LANG_C
    AC_CHECK_LIB(dnet, dnet_ntoa, [X_EXTRA_LIBS=&quot;$X_EXTRA_LIBS -ldnet&quot;])
    if test $ac_cv_lib_dnet_dnet_ntoa = no; then
       AC_CHECK_LIB(dnet_stub, dnet_ntoa,
@@ -719,6 +756,9 @@
    # more headers that need to be explicitly included on darwin
    AC_CHECK_HEADERS(sys/types.h stdint.h)
 
+   # sys/bitypes.h is needed for uint32_t and friends on Tru64
+   AC_CHECK_HEADERS(sys/bitypes.h)
+
    # darwin requires a poll emulation library
    AC_CHECK_LIB(poll, poll, LIB_POLL=&quot;-lpoll&quot;)
 
@@ -807,28 +847,28 @@
 dnl macro AC_PATH_X
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(K_PATH_X,
+AC_DEFUN([K_PATH_X],
 [
 AC_REQUIRE([KDE_MISC_TESTS])dnl
 AC_REQUIRE([KDE_CHECK_LIB64])
 
 AC_ARG_ENABLE(
   embedded,
-  [  --enable-embedded       link to Qt-embedded, don't use X],
+  AC_HELP_STRING([--enable-embedded],[link to Qt-embedded, don't use X]),
   kde_use_qt_emb=$enableval,
   kde_use_qt_emb=no
 )
 
 AC_ARG_ENABLE(
   qtopia,
-  [  --enable-qtopia         link to Qt-embedded, link to the Qtopia Environment],
+  AC_HELP_STRING([--enable-qtopia],[link to Qt-embedded, link to the Qtopia Environment]),
   kde_use_qt_emb_palm=$enableval,
   kde_use_qt_emb_palm=no
 )
 
 AC_ARG_ENABLE(
   mac,
-  [  --enable-mac       link to Qt/Mac (don't use X)],
+  AC_HELP_STRING([--enable-mac],[link to Qt/Mac (don't use X)]),
   kde_use_qt_mac=$enableval,
   kde_use_qt_mac=no
 )
@@ -836,8 +876,7 @@
 if test &quot;$kde_use_qt_emb&quot; = &quot;no&quot; &amp;&amp; test &quot;$kde_use_qt_mac&quot; = &quot;no&quot;; then
 
 AC_MSG_CHECKING(for X)
-AC_LANG_SAVE
-AC_LANG_C
+
 AC_CACHE_VAL(kde_cv_have_x,
 [# One or both of the vars are not set, and there is no cached value.
 if test &quot;{$x_includes+set}&quot; = set || test &quot;$x_includes&quot; = NONE; then
@@ -1023,11 +1062,9 @@
 AC_SUBST(QTE_NORTTI)
 AC_SUBST(LIB_XEXT)
 
-AC_LANG_RESTORE
-
 ])
 
-AC_DEFUN(KDE_PRINT_QT_PROGRAM,
+AC_DEFUN([KDE_PRINT_QT_PROGRAM],
 [
 AC_REQUIRE([KDE_USE_QT])
 cat &gt; conftest.$ac_ext &lt;&lt;EOF
@@ -1090,12 +1127,12 @@
 EOF
 ])
 
-AC_DEFUN(KDE_USE_QT,
+AC_DEFUN([KDE_USE_QT],
 [
 if test -z &quot;$1&quot;; then
-  # Current default Qt version: 3.1
+  # Current default Qt version: 3.2
   kde_qtver=3
-  kde_qtsubver=1
+  kde_qtsubver=2
 else
   kde_qtsubver=`echo &quot;$1&quot; | sed -e 's#[0-9][0-9]*\.\([0-9][0-9]*\).*#\1#'`
   # following is the check if subversion isnt found in passed argument
@@ -1118,7 +1155,11 @@
   fi
   if test &quot;$kde_qtver&quot; = &quot;3&quot;; then
     if test $kde_qtsubver -gt 0; then
-      kde_qt_minversion=&quot;&gt;= Qt 3.1 (20021021)&quot;
+	 if test $kde_qtsubver -gt 1; then
+	    kde_qt_minversion=&quot;&gt;= Qt 3.2&quot;
+	 else
+            kde_qt_minversion=&quot;&gt;= Qt 3.1 (20021021)&quot;
+         fi
     else
       kde_qt_minversion=&quot;&gt;= Qt 3.0&quot;
     fi
@@ -1127,13 +1168,15 @@
     kde_qt_minversion=&quot;&gt;= 1.42 and &lt; 2.0&quot;
   fi
 else
-   kde_qt_minversion=$2
+   kde_qt_minversion=&quot;$2&quot;
 fi
 
 if test -z &quot;$3&quot;; then
    if test $kde_qtver = 3; then
      if test $kde_qtsubver -gt 0; then
-       kde_qt_verstring=&quot;QT_VERSION &gt;= 0x030100&quot;
+       kde_qt_verstring=&quot;QT_VERSION &gt;= <A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">0x03 at VER</A>@00&quot;
+       qtsubver=`echo &quot;00$kde_qtsubver&quot; | sed -e 's,.*\(..\)$,\1,'`
+       kde_qt_verstring=`echo $kde_qt_verstring | sed -e &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">s, at VER</A>@,$qtsubver,&quot;`
      else
        kde_qt_verstring=&quot;QT_VERSION &gt;= 300&quot;
      fi
@@ -1149,7 +1192,7 @@
     kde_qt_verstring=&quot;QT_VERSION &gt;= 142 &amp;&amp; QT_VERSION &lt; 200&quot;
    fi
 else
-   kde_qt_verstring=$3
+   kde_qt_verstring=&quot;$3&quot;
 fi
 
 if test $kde_qtver = 3; then
@@ -1163,7 +1206,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_QT_DIRECT,
+AC_DEFUN([KDE_CHECK_QT_DIRECT],
 [
 AC_REQUIRE([KDE_USE_QT])
 AC_MSG_CHECKING([if Qt compiles without flags])
@@ -1226,7 +1269,7 @@
 dnl and $(QT_INCLUDES) will be -Iqthdrlocation (if needed)
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_PATH_QT_1_3,
+AC_DEFUN([AC_PATH_QT_1_3],
 [
 AC_REQUIRE([K_PATH_X])
 AC_REQUIRE([KDE_USE_QT])
@@ -1238,7 +1281,7 @@
 
 AC_ARG_ENABLE(
   mt,
-  [  --disable-mt            link to non-threaded Qt (deprecated)],
+  AC_HELP_STRING([--disable-mt],[link to non-threaded Qt (deprecated)]),
   kde_use_qt_mt=$enableval,
   [
     if test $kde_qtver = 3; then
@@ -1353,14 +1396,14 @@
 qt_libraries=&quot;&quot;
 qt_includes=&quot;&quot;
 AC_ARG_WITH(qt-dir,
-    [  --with-qt-dir=DIR       where the root of Qt is installed ],
+    AC_HELP_STRING([--with-qt-dir=DIR],[where the root of Qt is installed ]),
     [  ac_qt_includes=&quot;$withval&quot;/include
        ac_qt_libraries=&quot;$withval&quot;/lib${kdelibsuff}
        ac_qt_bindir=&quot;$withval&quot;/bin
     ])
 
 AC_ARG_WITH(qt-includes,
-    [  --with-qt-includes=DIR  where the Qt includes are. ],
+    AC_HELP_STRING([--with-qt-includes=DIR],[where the Qt includes are. ]),
     [
        ac_qt_includes=&quot;$withval&quot;
     ])
@@ -1368,7 +1411,7 @@
 kde_qt_libs_given=no
 
 AC_ARG_WITH(qt-libraries,
-    [  --with-qt-libraries=DIR where the Qt library is installed.],
+    AC_HELP_STRING([--with-qt-libraries=DIR],[where the Qt library is installed.]),
     [  ac_qt_libraries=&quot;$withval&quot;
        kde_qt_libs_given=yes
     ])
@@ -1485,8 +1528,8 @@
   qt_includes=&quot;$ac_qt_includes&quot;
 fi
 
-if test ! &quot;$kde_qt_libs_given&quot; = &quot;yes&quot;; then
-KDE_CHECK_QT_DIRECT(qt_libraries= ,[])
+if test ! &quot;$kde_qt_libs_given&quot; = &quot;yes&quot; &amp;&amp; test ! &quot;$kde_qtver&quot; = 3; then
+     KDE_CHECK_QT_DIRECT(qt_libraries= ,[])
 fi
 
 AC_SUBST(qt_libraries)
@@ -1532,12 +1575,12 @@
 AC_SUBST(kde_qtver)
 ])
 
-AC_DEFUN(AC_PATH_QT,
+AC_DEFUN([AC_PATH_QT],
 [
 AC_PATH_QT_1_3
 ])
 
-AC_DEFUN(KDE_CHECK_UIC_PLUGINS,
+AC_DEFUN([KDE_CHECK_UIC_PLUGINS],
 [
 AC_REQUIRE([AC_PATH_QT_MOC_UIC])
 
@@ -1568,6 +1611,9 @@
 fi
 kde_line=&quot;$kde_line -impl actest.h actest.ui &gt; actest.cpp&quot;
 if AC_TRY_EVAL(kde_line); then
+	# if you're trying to debug this check and think it's incorrect,
+	# better check your installation. The check _is_ correct - your
+	# installation is not.
 	if test -f actest.cpp &amp;&amp; grep klineedit actest.cpp &gt; /dev/null; then
 		kde_cv_uic_plugins=yes
 	fi
@@ -1582,9 +1628,11 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_FINAL,
+AC_DEFUN([KDE_CHECK_FINAL],
 [
-  AC_ARG_ENABLE(final, [  --enable-final          build size optimized apps (experimental - needs lots of memory)],
+  AC_ARG_ENABLE(final,
+	AC_HELP_STRING([--enable-final],
+		       [build size optimized apps (experimental - needs lots of memory)]),
 	kde_use_final=$enableval, kde_use_final=no)
 
   if test &quot;x$kde_use_final&quot; = &quot;xyes&quot;; then
@@ -1598,10 +1646,11 @@
   AC_SUBST(KDE_USE_FINAL_FALSE)
 ])
 
-AC_DEFUN(KDE_CHECK_CLOSURE,
+AC_DEFUN([KDE_CHECK_CLOSURE],
 [
-  AC_ARG_ENABLE(closure, [  --disable-closure       don't delay template instantiation],
-  	kde_use_closure=$enableval, kde_use_closure=yes)
+  AC_ARG_ENABLE(closure,
+		AC_HELP_STRING([--enable-closure],[delay template instantiation]),
+  	kde_use_closure=$enableval, kde_use_closure=no)
 
   KDE_NO_UNDEFINED=&quot;&quot;
   if test &quot;x$kde_use_closure&quot; = &quot;xyes&quot;; then
@@ -1611,20 +1660,25 @@
   else
        KDE_USE_CLOSURE_TRUE=&quot;#&quot;
        KDE_USE_CLOSURE_FALSE=&quot;&quot;
-       KDE_CHECK_COMPILER_FLAG([Wl,--no-undefined],
-            [KDE_CHECK_COMPILER_FLAG([Wl,--allow-shlib-undefined],
+       KDE_NO_UNDEFINED=&quot;&quot;
+       case $host in 
+         *-*-linux-gnu)
+           KDE_CHECK_COMPILER_FLAG([Wl,--no-undefined],
+                [KDE_CHECK_COMPILER_FLAG([Wl,--allow-shlib-undefined],
 		[KDE_NO_UNDEFINED=&quot;-Wl,--no-undefined -Wl,--allow-shlib-undefined&quot;],
 		[KDE_NO_UNDEFINED=&quot;&quot;])],
 	    [KDE_NO_UNDEFINED=&quot;&quot;])
+           ;;
+       esac
   fi
   AC_SUBST(KDE_USE_CLOSURE_TRUE)
   AC_SUBST(KDE_USE_CLOSURE_FALSE)
   AC_SUBST(KDE_NO_UNDEFINED)
 ])
 
-AC_DEFUN(KDE_CHECK_NMCHECK,
+AC_DEFUN([KDE_CHECK_NMCHECK],
 [
-  AC_ARG_ENABLE(nmcheck, [  --enable-nmcheck        enable automatic namespace cleanness check],
+  AC_ARG_ENABLE(nmcheck,AC_HELP_STRING([--enable-nmcheck],[enable automatic namespace cleanness check]),
 	kde_use_nmcheck=$enableval, kde_use_nmcheck=no)
 
   if test &quot;$kde_use_nmcheck&quot; = &quot;yes&quot;; then
@@ -1638,6 +1692,13 @@
   AC_SUBST(KDE_USE_NMCHECK_FALSE)
 ])
 
+AC_DEFUN([KDE_EXPAND_MAKEVAR], [
+savex=$exec_prefix
+test &quot;x$exec_prefix&quot; = xNONE &amp;&amp; exec_prefix=$prefix
+tmp=$$2
+while $1=`eval echo &quot;$tmp&quot;`; test &quot;x$$1&quot; != &quot;x$tmp&quot;; do tmp=$$1; done
+exec_prefix=$savex
+])
 
 dnl ------------------------------------------------------------------------
 dnl Now, the same with KDE
@@ -1645,9 +1706,9 @@
 dnl and $(kde_includes) will be the kdehdrlocation (if needed)
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_BASE_PATH_KDE,
+AC_DEFUN([AC_BASE_PATH_KDE],
 [
-AC_PREREQ([2.13])
+AC_REQUIRE([KDE_CHECK_STL])
 AC_REQUIRE([AC_PATH_QT])dnl
 AC_REQUIRE([KDE_CHECK_LIB64])
 
@@ -1655,19 +1716,12 @@
 AC_MSG_CHECKING([for KDE])
 
 if test &quot;${prefix}&quot; != NONE; then
-  kde_includes=${prefix}/include
-  ac_kde_includes=$prefix/include
+  kde_includes=${includedir}
+  KDE_EXPAND_MAKEVAR(ac_kde_includes, includedir)
+
+  kde_libraries=${libdir}
+  KDE_EXPAND_MAKEVAR(ac_kde_libraries, libdir)
 
-  if test &quot;${exec_prefix}&quot; != NONE; then
-     kde_libraries=${libdir}
-     ac_kde_libraries=$libdir
-     if test &quot;$ac_kde_libraries&quot; = '${exec_prefix}/lib'${kdelibsuff}; then
-	ac_kde_libraries=$exec_prefix/lib${kdelibsuff}
-     fi
-  else
-     kde_libraries=${prefix}/lib${kdelibsuff}
-     ac_kde_libraries=$prefix/lib${kdelibsuff}
-  fi
 else
   ac_kde_includes=
   ac_kde_libraries=
@@ -1688,7 +1742,7 @@
 
 if test -z &quot;$1&quot;; then
 
-kde_incdirs=&quot;/usr/lib/kde/include /usr/local/kde/include /usr/local/include /usr/kde/include /usr/include/kde /usr/include /opt/kde3/include /opt/kde/include $x_includes $qt_includes&quot;
+kde_incdirs=&quot;$kde_libs_prefix/include /usr/lib/kde/include /usr/local/kde/include /usr/local/include /usr/kde/include /usr/include/kde /usr/include /opt/kde3/include /opt/kde/include $x_includes $qt_includes&quot;
 test -n &quot;$KDEDIR&quot; &amp;&amp; kde_incdirs=&quot;$KDEDIR/include $KDEDIR/include/kde $KDEDIR $kde_incdirs&quot;
 kde_incdirs=&quot;$ac_kde_includes $kde_incdirs&quot;
 AC_FIND_FILE($kde_check_header, $kde_incdirs, kde_incdir)
@@ -1700,7 +1754,7 @@
 So, check this please and use another prefix!])
 fi
 
-kde_libdirs=&quot;/usr/lib/kde/lib${kdelibsuff} /usr/local/kde/lib${kdelibsuff} /usr/kde/lib${kdelibsuff} /usr/lib${kdelibsuff}/kde /usr/lib${kdelibsuff}/kde3 /usr/lib${kdelibsuff} /usr/X11R6/lib${kdelibsuff} /usr/local/lib${kdelibsuff} /opt/kde3/lib${kdelibsuff} /opt/kde/lib${kdelibsuff} /usr/X11R6/kde/lib${kdelibsuff}&quot;
+kde_libdirs=&quot;$kde_libs_prefix/lib${kdelibsuff} /usr/lib/kde/lib${kdelibsuff} /usr/local/kde/lib${kdelibsuff} /usr/kde/lib${kdelibsuff} /usr/lib${kdelibsuff}/kde /usr/lib${kdelibsuff}/kde3 /usr/lib${kdelibsuff} /usr/X11R6/lib${kdelibsuff} /usr/local/lib${kdelibsuff} /opt/kde3/lib${kdelibsuff} /opt/kde/lib${kdelibsuff} /usr/X11R6/kde/lib${kdelibsuff}&quot;
 test -n &quot;$KDEDIR&quot; &amp;&amp; kde_libdirs=&quot;$KDEDIR/lib${kdelibsuff} $KDEDIR $kde_libdirs&quot;
 kde_libdirs=&quot;$ac_kde_libraries $libdir $kde_libdirs&quot;
 AC_FIND_FILE($kde_check_lib, $kde_libdirs, kde_libdir)
@@ -1734,7 +1788,7 @@
     ac_kde_includes=$ac_kde_includes ac_kde_libraries=$ac_kde_libraries&quot;
 fi
 
-else dnl test -z $1
+else dnl test -z $1, e.g. from kdelibs
 
   ac_cv_have_kde=&quot;have_kde=no&quot;
 
@@ -1758,7 +1812,7 @@
  fi
 
  kde_libraries=&quot;${libdir}&quot;
- kde_includes=${ac_kde_prefix}/include
+ kde_includes=&quot;${includedir}&quot;
 
 else
   ac_cv_have_kde=&quot;have_kde=yes \
@@ -1806,11 +1860,10 @@
 
 ])
 
-AC_DEFUN(KDE_CHECK_EXTRA_LIBS,
+AC_DEFUN([KDE_CHECK_EXTRA_LIBS],
 [
 AC_MSG_CHECKING(for extra includes)
-AC_ARG_WITH(extra-includes, [  --with-extra-includes=DIR
-                          adds non standard include paths],
+AC_ARG_WITH(extra-includes,AC_HELP_STRING([--with-extra-includes=DIR],[adds non standard include paths]),
   kde_use_extra_includes=&quot;$withval&quot;,
   kde_use_extra_includes=NONE
 )
@@ -1835,7 +1888,7 @@
 
 kde_extra_libs=
 AC_MSG_CHECKING(for extra libs)
-AC_ARG_WITH(extra-libs, [  --with-extra-libs=DIR   adds non standard library paths],
+AC_ARG_WITH(extra-libs,AC_HELP_STRING([--with-extra-libs=DIR],[adds non standard library paths]),
   kde_use_extra_libs=$withval,
   kde_use_extra_libs=NONE
 )
@@ -1861,7 +1914,7 @@
 
 ])
 
-AC_DEFUN(KDE_1_CHECK_PATH_HEADERS,
+AC_DEFUN([KDE_1_CHECK_PATH_HEADERS],
 [
     AC_MSG_CHECKING([for KDE headers installed])
     AC_LANG_SAVE
@@ -1895,12 +1948,15 @@
     printf(&quot;kde_styledir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
     printf(&quot;kde_widgetdir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
     printf(&quot;xdg_appsdir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
+    printf(&quot;xdg_menudir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
     printf(&quot;xdg_directorydir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
+    printf(&quot;kde_kcfgdir=\\&quot;/tmp/dummy\\&quot;\n&quot;);
     return 0;
     }
 EOF
 
- ac_compile='${CXX-g++} -c $CXXFLAGS $all_includes $CPPFLAGS conftest.$ac_ext'
+ ac_save_CPPFLAGS=$CPPFLAGS
+ CPPFLAGS=&quot;$all_includes $CPPFLAGS&quot;
  if AC_TRY_EVAL(ac_compile); then
    AC_MSG_RESULT(yes)
  else
@@ -1908,11 +1964,12 @@
 Check, if you installed the KDE header files correctly.
 For more details about this problem, look at the end of config.log.])
   fi
+  CPPFLAGS=$ac_save_CPPFLAGS
 
   AC_LANG_RESTORE
 ])
 
-AC_DEFUN(KDE_CHECK_KDEQTADDON,
+AC_DEFUN([KDE_CHECK_KDEQTADDON],
 [
 AC_MSG_CHECKING(for kde-qt-addon)
 AC_CACHE_VAL(kde_cv_have_kdeqtaddon,
@@ -1948,38 +2005,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_KIMGIO,
-[
-   AC_REQUIRE([AC_BASE_PATH_KDE])
-   AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
-   AC_REQUIRE([AC_FIND_TIFF])
-   AC_REQUIRE([AC_FIND_JPEG])
-   AC_REQUIRE([AC_FIND_PNG])
-   AC_REQUIRE([AC_FIND_JASPER])
-   AC_REQUIRE([KDE_CREATE_LIBS_ALIASES])
-
-   if test &quot;$1&quot; = &quot;existance&quot;; then
-     AC_LANG_SAVE
-     AC_LANG_CPLUSPLUS
-     kde_save_LIBS=&quot;$LIBS&quot;
-     LIBS=&quot;$LIBS $all_libraries $LIBJPEG $LIBTIFF $LIBPNG $LIBQT -lm&quot;
-     AC_CHECK_LIB(kimgio, kimgioRegister, [
-      LIBKIMGIO_EXISTS=yes],LIBKIMGIO_EXISTS=no)
-     LIBS=&quot;$kde_save_LIBS&quot;
-     AC_LANG_RESTORE
-   else
-     LIBKIMGIO_EXISTS=yes
-   fi
-
-   if test &quot;$LIBKIMGIO_EXISTS&quot; = &quot;yes&quot;; then
-     LIB_KIMGIO='-lkimgio'
-   else
-     LIB_KIMGIO=''
-   fi
-   AC_SUBST(LIB_KIMGIO)
-])
-
-AC_DEFUN(KDE_CREATE_LIBS_ALIASES,
+AC_DEFUN([KDE_CREATE_LIBS_ALIASES],
 [
    AC_REQUIRE([KDE_MISC_TESTS])
    AC_REQUIRE([KDE_CHECK_LIBDL])
@@ -1996,6 +2022,8 @@
    AC_SUBST(LIB_KSPELL, &quot;-lkspell&quot;)
    AC_SUBST(LIB_KPARTS, &quot;-lkparts&quot;)
    AC_SUBST(LIB_KDEPRINT, &quot;-lkdeprint&quot;)
+   AC_SUBST(LIB_KUTILS, &quot;-lkutils&quot;)
+   AC_SUBST(LIB_KDEPIM, &quot;-lkdepim&quot;)
 # these are for backward compatibility
    AC_SUBST(LIB_KSYCOCA, &quot;-lkio&quot;)
    AC_SUBST(LIB_KFILE, &quot;-lkio&quot;)
@@ -2020,10 +2048,10 @@
 fi
 ])
 
-AC_DEFUN(AC_PATH_KDE,
+AC_DEFUN([AC_PATH_KDE],
 [
   AC_BASE_PATH_KDE
-  AC_ARG_ENABLE(path-check, [  --disable-path-check    don't try to find out, where to install],
+  AC_ARG_ENABLE(path-check,AC_HELP_STRING([--disable-path-check],[don't try to find out, where to install]),
   [
   if test &quot;$enableval&quot; = &quot;no&quot;;
     then ac_use_path_checking=&quot;default&quot;
@@ -2045,7 +2073,7 @@
 ])
 
 dnl KDE_CHECK_FUNC_EXT(&lt;func&gt;, [headers], [sample-use], [C prototype], [autoheader define], [call if found])
-AC_DEFUN(KDE_CHECK_FUNC_EXT,
+AC_DEFUN([KDE_CHECK_FUNC_EXT],
 [
 AC_MSG_CHECKING(for $1)
 AC_CACHE_VAL(kde_cv_func_$1,
@@ -2126,14 +2154,17 @@
 [
 #if !defined(HAVE_$5_PROTO)
 #ifdef __cplusplus
-extern &quot;C&quot;
+extern &quot;C&quot; {
 #endif
 $4;
+#ifdef __cplusplus
+}
+#endif
 #endif
 ])
 ])
 
-AC_DEFUN(AC_CHECK_SETENV,
+AC_DEFUN([AC_CHECK_SETENV],
 [
 	KDE_CHECK_FUNC_EXT(setenv, [
 #include &lt;stdlib.h&gt;
@@ -2143,7 +2174,7 @@
 		[SETENV])
 ])
 
-AC_DEFUN(AC_CHECK_UNSETENV,
+AC_DEFUN([AC_CHECK_UNSETENV],
 [
 	KDE_CHECK_FUNC_EXT(unsetenv, [
 #include &lt;stdlib.h&gt;
@@ -2153,21 +2184,23 @@
 		[UNSETENV])
 ])
 
-AC_DEFUN(AC_CHECK_GETDOMAINNAME,
+AC_DEFUN([AC_CHECK_GETDOMAINNAME],
 [
 	KDE_CHECK_FUNC_EXT(getdomainname, [
 #include &lt;stdlib.h&gt;
 #include &lt;unistd.h&gt;
+#include &lt;netdb.h&gt;
 ], 
 		[
 char buffer[200];
 getdomainname(buffer, 200);
 ], 	
-	        [int getdomainname (char *, size_t)],
+	        [#include &lt;sys/types.h&gt;
+		int getdomainname (char *, size_t)],
 		[GETDOMAINNAME])
 ])
 
-AC_DEFUN(AC_CHECK_GETHOSTNAME,
+AC_DEFUN([AC_CHECK_GETHOSTNAME],
 [
 	KDE_CHECK_FUNC_EXT(gethostname, [
 #include &lt;stdlib.h&gt;
@@ -2181,7 +2214,7 @@
 		[GETHOSTNAME])
 ])
 
-AC_DEFUN(AC_CHECK_USLEEP,
+AC_DEFUN([AC_CHECK_USLEEP],
 [
 	KDE_CHECK_FUNC_EXT(usleep, [
 #include &lt;unistd.h&gt;
@@ -2194,7 +2227,7 @@
 ])
 
 
-AC_DEFUN(AC_CHECK_RANDOM,
+AC_DEFUN([AC_CHECK_RANDOM],
 [
 	KDE_CHECK_FUNC_EXT(random, [
 #include &lt;stdlib.h&gt;
@@ -2216,7 +2249,7 @@
 
 ])
 
-AC_DEFUN(AC_CHECK_INITGROUPS,
+AC_DEFUN([AC_CHECK_INITGROUPS],
 [
 	KDE_CHECK_FUNC_EXT(initgroups, [
 #include &lt;sys/types.h&gt;
@@ -2231,7 +2264,7 @@
 	[INITGROUPS])
 ])
 
-AC_DEFUN(AC_CHECK_MKSTEMPS,
+AC_DEFUN([AC_CHECK_MKSTEMPS],
 [
 	KDE_CHECK_FUNC_EXT(mkstemps, [
 #include &lt;stdlib.h&gt;
@@ -2244,7 +2277,7 @@
 	[MKSTEMPS])
 ])
 
-AC_DEFUN(AC_CHECK_MKDTEMP,
+AC_DEFUN([AC_CHECK_MKDTEMP],
 [
 	KDE_CHECK_FUNC_EXT(mkdtemp, [
 #include &lt;stdlib.h&gt;
@@ -2258,7 +2291,7 @@
 ])
 
 
-AC_DEFUN(AC_CHECK_RES_INIT,
+AC_DEFUN([AC_CHECK_RES_INIT],
 [
   AC_MSG_CHECKING([if res_init needs -lresolv])
   kde_libs_safe=&quot;$LIBS&quot;
@@ -2302,7 +2335,7 @@
   )
 ])
 
-AC_DEFUN(AC_CHECK_STRLCPY,
+AC_DEFUN([AC_CHECK_STRLCPY],
 [
 	KDE_CHECK_FUNC_EXT(strlcpy, [
 #include &lt;string.h&gt;
@@ -2314,7 +2347,7 @@
 	[STRLCPY])
 ])
 
-AC_DEFUN(AC_CHECK_STRLCAT,
+AC_DEFUN([AC_CHECK_STRLCAT],
 [
 	KDE_CHECK_FUNC_EXT(strlcat, [
 #include &lt;string.h&gt;
@@ -2327,7 +2360,7 @@
 	[STRLCAT])
 ])
 
-AC_DEFUN(AC_FIND_GIF,
+AC_DEFUN([AC_FIND_GIF],
    [AC_MSG_CHECKING([for giflib])
 AC_CACHE_VAL(ac_cv_lib_gif,
 [ac_save_LIBS=&quot;$LIBS&quot;
@@ -2361,12 +2394,11 @@
 fi
 ])
 
-AC_DEFUN(KDE_FIND_JPEG_HELPER,
+AC_DEFUN([KDE_FIND_JPEG_HELPER],
 [
 AC_MSG_CHECKING([for libjpeg$2])
 AC_CACHE_VAL(ac_cv_lib_jpeg_$1,
 [
-AC_LANG_C
 ac_save_LIBS=&quot;$LIBS&quot;
 LIBS=&quot;$all_libraries $USER_LDFLAGS -ljpeg$2 -lm&quot;
 ac_save_CFLAGS=&quot;$CFLAGS&quot;
@@ -2404,7 +2436,7 @@
 
 ])
 
-AC_DEFUN(AC_FIND_JPEG,
+AC_DEFUN([AC_FIND_JPEG],
 [
 dnl first look for libraries
 KDE_FIND_JPEG_HELPER(6b, 6b,
@@ -2456,7 +2488,7 @@
 ])
 ])
 
-AC_DEFUN(KDE_CHECK_QT_JPEG,
+AC_DEFUN([KDE_CHECK_QT_JPEG],
 [
 if test -n &quot;$LIBJPEG&quot;; then
 AC_MSG_CHECKING([if Qt needs $LIBJPEG])
@@ -2493,13 +2525,12 @@
 
 ])
 
-AC_DEFUN(AC_FIND_ZLIB,
+AC_DEFUN([AC_FIND_ZLIB],
 [
 AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 AC_MSG_CHECKING([for libz])
 AC_CACHE_VAL(ac_cv_lib_z,
 [
-AC_LANG_C
 kde_save_LIBS=&quot;$LIBS&quot;
 LIBS=&quot;$all_libraries $USER_LDFLAGS -lz $LIBSOCKET&quot;
 kde_save_CFLAGS=&quot;$CFLAGS&quot;
@@ -2536,7 +2567,7 @@
 AC_SUBST(LIBZ)
 ])
 
-AC_DEFUN(KDE_TRY_TIFFLIB,
+AC_DEFUN([KDE_TRY_TIFFLIB],
 [
 AC_MSG_CHECKING([for libtiff $1])
 
@@ -2582,7 +2613,7 @@
 
 ])
 
-AC_DEFUN(AC_FIND_TIFF,
+AC_DEFUN([AC_FIND_TIFF],
 [
 AC_REQUIRE([K_PATH_X])
 AC_REQUIRE([AC_FIND_ZLIB])
@@ -2596,7 +2627,7 @@
 ])
 
 
-AC_DEFUN(AC_FIND_PNG,
+AC_DEFUN([AC_FIND_PNG],
 [
 AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 AC_REQUIRE([AC_FIND_ZLIB])
@@ -2611,7 +2642,7 @@
 fi
 kde_save_CFLAGS=&quot;$CFLAGS&quot;
 CFLAGS=&quot;$CFLAGS $all_includes $USER_INCLUDES&quot;
-AC_LANG_C
+
 AC_TRY_LINK(dnl
     [
     #include&lt;png.h&gt;
@@ -2640,7 +2671,7 @@
 ])
 
 
-AC_DEFUN(AC_FIND_JASPER,
+AC_DEFUN([AC_FIND_JASPER],
 [
 AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 AC_REQUIRE([AC_FIND_JPEG])
@@ -2651,7 +2682,7 @@
 LIBS=&quot;$LIBS $all_libraries $USER_LDFLAGS -ljasper $LIBJPEG -lm&quot;
 kde_save_CFLAGS=&quot;$CFLAGS&quot;
 CFLAGS=&quot;$CFLAGS $all_includes $USER_INCLUDES&quot;
-AC_LANG_C
+
 AC_TRY_LINK(dnl
     [
     #include&lt;jasper/jasper.h&gt;
@@ -2676,12 +2707,12 @@
 AC_SUBST(LIB_JASPER)
 ])
 
-AC_DEFUN(AC_CHECK_BOOL,
+AC_DEFUN([AC_CHECK_BOOL],
 [
   AC_DEFINE_UNQUOTED(HAVE_BOOL, 1, [You _must_ have bool])
 ])
 
-AC_DEFUN(AC_CHECK_GNU_EXTENSIONS,
+AC_DEFUN([AC_CHECK_GNU_EXTENSIONS],
 [
 AC_MSG_CHECKING(if you need GNU extensions)
 AC_CACHE_VAL(ac_cv_gnu_extensions,
@@ -2709,7 +2740,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_COMPILER_FLAG,
+AC_DEFUN([KDE_CHECK_COMPILER_FLAG],
 [
 AC_MSG_CHECKING([whether $CXX supports -$1])
 kde_cache=`echo $1 | sed 'y% .=/+-,%____p__%'`
@@ -2734,10 +2765,36 @@
 fi
 ])
 
+AC_DEFUN([KDE_CHECK_C_COMPILER_FLAG],
+[
+AC_MSG_CHECKING([whether $CC supports -$1])
+kde_cache=`echo $1 | sed 'y% .=/+-,%____p__%'`
+AC_CACHE_VAL(kde_cv_prog_cc_$kde_cache,
+[
+  AC_LANG_SAVE
+  AC_LANG_C
+  save_CFLAGS=&quot;$CFLAGS&quot;
+  CFLAGS=&quot;$CFLAGS -$1&quot;
+  AC_TRY_LINK([],[ return 0; ], [eval &quot;kde_cv_prog_cc_$kde_cache=yes&quot;], [])
+  CFLAGS=&quot;$save_CFLAGS&quot;
+  AC_LANG_RESTORE
+])
+if eval &quot;test \&quot;`echo '$kde_cv_prog_cc_'$kde_cache`\&quot; = yes&quot;; then
+ AC_MSG_RESULT(yes)
+ :
+ $2
+else
+ AC_MSG_RESULT(no)
+ :
+ $3
+fi
+])
+
+
 dnl AC_REMOVE_FORBIDDEN removes forbidden arguments from variables
 dnl use: AC_REMOVE_FORBIDDEN(CC, [-forbid -bad-option whatever])
 dnl it's all white-space separated
-AC_DEFUN(AC_REMOVE_FORBIDDEN,
+AC_DEFUN([AC_REMOVE_FORBIDDEN],
 [ __val=$$1
   __forbid=&quot; $2 &quot;
   if test -n &quot;$__val&quot;; then
@@ -2758,7 +2815,7 @@
 ])
 
 dnl AC_VALIDIFY_CXXFLAGS checks for forbidden flags the user may have given
-AC_DEFUN(AC_VALIDIFY_CXXFLAGS,
+AC_DEFUN([AC_VALIDIFY_CXXFLAGS],
 [dnl
 if test &quot;x$kde_use_qt_emb&quot; != &quot;xyes&quot;; then
  AC_REMOVE_FORBIDDEN(CXX, [-fno-rtti -rpath])
@@ -2769,9 +2826,10 @@
 fi
 ])
 
-AC_DEFUN(AC_CHECK_COMPILERS,
+AC_DEFUN([AC_CHECK_COMPILERS],
 [
-  AC_ARG_ENABLE(debug,[  --enable-debug[=ARG]    enables debug symbols (yes|no|full) [default=no]],
+  AC_ARG_ENABLE(debug,
+	        AC_HELP_STRING([--enable-debug=ARG],[enables debug symbols (yes|no|full) [default=no]]),
   [
     case $enableval in
       yes)
@@ -2793,9 +2851,14 @@
   ])
 
   dnl Just for configure --help
-  AC_ARG_ENABLE(dummyoption,[  --disable-debug         disables debug output and debug symbols [default=no]],[],[])
-
-  AC_ARG_ENABLE(strict,[  --enable-strict         compiles with strict compiler options (may not work!)],
+  AC_ARG_ENABLE(dummyoption,
+	        AC_HELP_STRING([--disable-debug],
+	  		       [disables debug output and debug symbols [default=no]]),
+		[],[])
+
+  AC_ARG_ENABLE(strict,
+		AC_HELP_STRING([--enable-strict],
+			      [compiles with strict compiler options (may not work!)]),
    [
     if test $enableval = &quot;no&quot;; then
          kde_use_strict_options=&quot;no&quot;
@@ -2804,7 +2867,7 @@
     fi
    ], [kde_use_strict_options=&quot;no&quot;])
 
-  AC_ARG_ENABLE(warnings,[  --disable-warnings      disables compilation with -Wall and similiar],
+  AC_ARG_ENABLE(warnings,AC_HELP_STRING([--disable-warnings],[disables compilation with -Wall and similiar]),
    [
     if test $enableval = &quot;no&quot;; then
          kde_use_warnings=&quot;no&quot;
@@ -2818,7 +2881,7 @@
     kde_use_warnings=yes
   fi
 
-  AC_ARG_ENABLE(profile,[  --enable-profile        creates profiling infos [default=no]],
+  AC_ARG_ENABLE(profile,AC_HELP_STRING([--enable-profile],[creates profiling infos [default=no]]),
     [kde_use_profiling=$enableval],
     [kde_use_profiling=&quot;no&quot;]
   )
@@ -2899,14 +2962,15 @@
 
   if test &quot;$kde_use_warnings&quot; = &quot;yes&quot;; then
       if test &quot;$GCC&quot; = &quot;yes&quot;; then
+        CXXFLAGS=&quot;-Wall -W -Wpointer-arith -Wwrite-strings $CXXFLAGS&quot;
         case $host in
           *-*-linux-gnu)	
-            CFLAGS=&quot;-ansi -W -Wall -pedantic -Wchar-subscripts -Wshadow -Wpointer-arith -Wmissing-prototypes -Wwrite-strings -D_XOPEN_SOURCE=500 -D_BSD_SOURCE $CFLAGS&quot;
+            CFLAGS=&quot;-ansi -W -Wall -Wchar-subscripts -Wshadow -Wpointer-arith -Wmissing-prototypes -Wwrite-strings -D_XOPEN_SOURCE=500 -D_BSD_SOURCE $CFLAGS&quot;
             CXXFLAGS=&quot;-ansi -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -Wcast-align -Wconversion -Wchar-subscripts $CXXFLAGS&quot;
-            KDE_CHECK_COMPILER_FLAG(Wmissing-format-attribute, [CXXFLAGS=&quot;$CXXFLAGS -Wformat-security -Wmissing-format-attribute&quot;; CFLAGS=&quot;$CFLAGS -Wformat-security -Wmissing-format-attribute&quot;])
+            KDE_CHECK_COMPILER_FLAG(Wmissing-format-attribute, [CXXFLAGS=&quot;$CXXFLAGS -Wformat-security -Wmissing-format-attribute&quot;])
+            KDE_CHECK_C_COMPILER_FLAG(Wmissing-format-attribute, [CFLAGS=&quot;$CFLAGS -Wformat-security -Wmissing-format-attribute&quot;])
           ;;
         esac
-        CXXFLAGS=&quot;-Wall -pedantic -W -Wpointer-arith -Wwrite-strings $CXXFLAGS&quot;
         KDE_CHECK_COMPILER_FLAG(Wundef,[CXXFLAGS=&quot;-Wundef $CXXFLAGS&quot;])
         KDE_CHECK_COMPILER_FLAG(Wno-long-long,[CXXFLAGS=&quot;-Wno-long-long $CXXFLAGS&quot;])
         KDE_CHECK_COMPILER_FLAG(Wnon-virtual-dtor,[CXXFLAGS=&quot;-Wnon-virtual-dtor $CXXFLAGS&quot;])
@@ -2922,6 +2986,7 @@
     KDE_CHECK_COMPILER_FLAG(fno-check-new, [CXXFLAGS=&quot;$CXXFLAGS -fno-check-new&quot;])
     KDE_CHECK_COMPILER_FLAG(fno-common, [CXXFLAGS=&quot;$CXXFLAGS -fno-common&quot;])
     KDE_CHECK_COMPILER_FLAG(fexceptions, [USE_EXCEPTIONS=&quot;-fexceptions&quot;], USE_EXCEPTIONS=	)
+    ENABLE_PERMISSIVE_FLAG=&quot;-fpermissive&quot;
   fi
   if test &quot;$CXX&quot; = &quot;KCC&quot;; then
     dnl unfortunately we currently cannot disable exception support in KCC
@@ -2929,7 +2994,9 @@
     dnl KDE_CHECK_COMPILER_FLAG(-no_exceptions,[CXXFLAGS=&quot;$CXXFLAGS --no_exceptions&quot;])
     dnl KDE_CHECK_COMPILER_FLAG(-exceptions, [USE_EXCEPTIONS=&quot;--exceptions&quot;], USE_EXCEPTIONS=	)
 
-    AC_ARG_ENABLE(pch,[  --enable-pch            enables precompiled header support (currently only KCC) [default=no]],
+    AC_ARG_ENABLE(pch,
+	AC_HELP_STRING([--enable-pch],
+		       [enables precompiled header support (currently only KCC) [default=no]]),
     [
       kde_use_pch=$enableval
     ],[kde_use_pch=no])
@@ -2990,6 +3057,7 @@
 
   AC_SUBST(NOOPT_CXXFLAGS)
   AC_SUBST(NOOPT_CFLAGS)
+  AC_SUBST(ENABLE_PERMISSIVE_FLAG)
 
   KDE_CHECK_FINAL
   KDE_CHECK_CLOSURE
@@ -2998,14 +3066,14 @@
   ifdef([AM_DEPENDENCIES], AC_REQUIRE([KDE_ADD_DEPENDENCIES]), [])
 ])
 
-AC_DEFUN(KDE_ADD_DEPENDENCIES,
+AC_DEFUN([KDE_ADD_DEPENDENCIES],
 [
    [A]M_DEPENDENCIES(CC)
    [A]M_DEPENDENCIES(CXX)
 ])
 
 dnl just a wrapper to clean up configure.in
-AC_DEFUN(KDE_PROG_LIBTOOL,
+AC_DEFUN([KDE_PROG_LIBTOOL],
 [
 AC_REQUIRE([AC_CHECK_COMPILERS])
 AC_REQUIRE([AC_ENABLE_SHARED])
@@ -3014,11 +3082,8 @@
 AC_REQUIRE([AC_LIBTOOL_DLOPEN])
 AC_REQUIRE([KDE_CHECK_LIB64])
 
-AC_LANG_SAVE
-AC_LANG_C
 AC_OBJEXT
 AC_EXEEXT
-AC_LANG_RESTORE
 
 AM_PROG_LIBTOOL
 AC_LIBTOOL_CXX
@@ -3028,30 +3093,20 @@
 KDE_PLUGIN=&quot;-avoid-version -module -no-undefined \$(KDE_NO_UNDEFINED) \$(KDE_RPATH) \$(KDE_MT_LDFLAGS)&quot;
 AC_SUBST(KDE_PLUGIN)
 
-AC_ARG_ENABLE(objprelink, [  --enable-objprelink     prelink apps using objprelink (obsolete)],
-       kde_use_objprelink=$enableval, kde_use_objprelink=no)
-  if test &quot;x$kde_use_objprelink&quot; = &quot;xyes&quot;; then 
-        AC_MSG_WARN([
-------------------------------------------------------------
-Configuration option --enable-objprelink is no longer useful.
-See http:://objprelink.sourceforge.net for details:
-1- Recent binutils are fast enough to do without objprelink.
-2- Newer versions of objprelink do not need this option.
-------------------------------------------------------------
-])
-  fi
+# we patch configure quite some so we better keep that consistent for incremental runs 
+AC_SUBST(AUTOCONF,'$(SHELL) $(top_srcdir)/admin/cvs.sh configure || touch configure')
 ])
 
-AC_DEFUN(KDE_CHECK_LIB64,
+AC_DEFUN([KDE_CHECK_LIB64],
 [
-    kdelibsuff=none
+    kdelibsuff=no
     AC_ARG_ENABLE(libsuffix,
         AC_HELP_STRING([--enable-libsuffix],
             [/lib directory suffix (64,32,none[=default])]),
             kdelibsuff=$enableval)
     # TODO: add an auto case that compiles a little C app to check
     # where the glibc is
-    if test &quot;$kdelibsuff&quot; = &quot;none&quot;; then
+    if test &quot;$kdelibsuff&quot; = &quot;no&quot;; then
        kdelibsuff=
     fi
     if test -z &quot;$kdelibsuff&quot;; then
@@ -3067,13 +3122,15 @@
     fi
 ])
 
-AC_DEFUN(KDE_CHECK_TYPES,
+AC_DEFUN([KDE_CHECK_TYPES],
 [  AC_CHECK_SIZEOF(int, 4)dnl
+   AC_CHECK_SIZEOF(short)dnl
   AC_CHECK_SIZEOF(long, 4)dnl
   AC_CHECK_SIZEOF(char *, 4)dnl
 ])dnl
 
-AC_DEFUN(KDE_DO_IT_ALL,
+dnl Not used - kept for compat only?
+AC_DEFUN([KDE_DO_IT_ALL],
 [
 AC_CANONICAL_SYSTEM
 AC_ARG_PROGRAM
@@ -3086,11 +3143,11 @@
 AC_PATH_KDE
 ])
 
-AC_DEFUN(AC_CHECK_RPATH,
+AC_DEFUN([AC_CHECK_RPATH],
 [
 AC_MSG_CHECKING(for rpath)
 AC_ARG_ENABLE(rpath,
-      [  --disable-rpath         do not use the rpath feature of ld],
+      AC_HELP_STRING([--disable-rpath],[do not use the rpath feature of ld]),
       USE_RPATH=$enableval, USE_RPATH=yes)
 
 if test -z &quot;$KDE_RPATH&quot; &amp;&amp; test &quot;$USE_RPATH&quot; = &quot;yes&quot;; then
@@ -3102,7 +3159,7 @@
   fi
   dnl $x_libraries is set to /usr/lib in case
   if test -n &quot;$X_LDFLAGS&quot;; then
-    X_RPATH=&quot;-R \$(x_libraries)&quot; 
+    X_RPATH=&quot;-R \$(x_libraries)&quot;
     KDE_RPATH=&quot;$KDE_RPATH $X_RPATH&quot;
   fi
   if test -n &quot;$KDE_EXTRA_RPATH&quot;; then
@@ -3116,7 +3173,7 @@
 ])
 
 dnl Check for the type of the third argument of getsockname
-AC_DEFUN(AC_CHECK_SOCKLEN_T, [
+AC_DEFUN([AC_CHECK_SOCKLEN_T], [
   AC_MSG_CHECKING(for socklen_t)
   AC_CACHE_VAL(ac_cv_socklen_t, [
     AC_LANG_SAVE
@@ -3168,7 +3225,7 @@
 dnl &gt;
 dnl for this file it is relicensed under LGPL
 
-AC_DEFUN(AM_KDE_WITH_NLS,
+AC_DEFUN([AM_KDE_WITH_NLS],
   [
     dnl If we use NLS figure out what method
 
@@ -3211,7 +3268,7 @@
 
 dnl AM_PATH_PROG_WITH_TEST_KDE(VARIABLE, PROG-TO-CHECK-FOR,
 dnl   TEST-PERFORMED-ON-FOUND_PROGRAM [, VALUE-IF-NOT-FOUND [, PATH]])
-AC_DEFUN(AM_PATH_PROG_WITH_TEST_KDE,
+AC_DEFUN([AM_PATH_PROG_WITH_TEST_KDE],
 [# Extract the first word of &quot;$2&quot;, so it can be a program name with args.
 set dummy $2; ac_word=[$]2
 AC_MSG_CHECKING([for $ac_word])
@@ -3253,7 +3310,7 @@
 
 # serial 1
 
-AC_DEFUN(AM_LC_MESSAGES,
+AC_DEFUN([AM_LC_MESSAGES],
   [if test $ac_cv_header_locale_h = yes; then
     AC_CACHE_CHECK([for LC_MESSAGES], am_cv_val_LC_MESSAGES,
       [AC_TRY_LINK([#include &lt;locale.h&gt;], [return LC_MESSAGES],
@@ -3299,7 +3356,7 @@
 # serial 1
 # Stephan Kulow: I put a KDE in it to avoid name conflicts
 
-AC_DEFUN(AM_KDE_GNU_GETTEXT,
+AC_DEFUN([AM_KDE_GNU_GETTEXT],
   [AC_REQUIRE([AC_PROG_MAKE_SET])dnl
    AC_REQUIRE([AC_PROG_RANLIB])dnl
    AC_REQUIRE([AC_HEADER_STDC])dnl
@@ -3361,14 +3418,14 @@
 
   ])
 
-AC_DEFUN(AC_HAVE_XPM,
+AC_DEFUN([AC_HAVE_XPM],
  [AC_REQUIRE_CPP()dnl
   AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 
  test -z &quot;$XPM_LDFLAGS&quot; &amp;&amp; XPM_LDFLAGS=
  test -z &quot;$XPM_INCLUDE&quot; &amp;&amp; XPM_INCLUDE=
 
- AC_ARG_WITH(xpm, [  --without-xpm           disable color pixmap XPM tests],
+ AC_ARG_WITH(xpm,AC_HELP_STRING([--without-xpm],[disable color pixmap XPM tests]),
 	xpm_test=$withval, xpm_test=&quot;yes&quot;)
  if test &quot;x$xpm_test&quot; = xno; then
    ac_cv_have_xpm=no
@@ -3376,7 +3433,6 @@
    AC_MSG_CHECKING(for XPM)
    AC_CACHE_VAL(ac_cv_have_xpm,
    [
-    AC_LANG_C
     ac_save_ldflags=&quot;$LDFLAGS&quot;
     ac_save_cflags=&quot;$CFLAGS&quot;
     if test &quot;x$kde_use_qt_emb&quot; != &quot;xyes&quot; &amp;&amp; test &quot;x$kde_use_qt_mac&quot; != &quot;xyes&quot;; then
@@ -3417,7 +3473,7 @@
  AC_SUBST(XPMLIB)
 ])
 
-AC_DEFUN(AC_HAVE_DPMS,
+AC_DEFUN([AC_HAVE_DPMS],
  [AC_REQUIRE_CPP()dnl
   AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 
@@ -3425,7 +3481,7 @@
  test -z &quot;$DPMS_INCLUDE&quot; &amp;&amp; DPMS_INCLUDE=
  DPMS_LIB=
 
- AC_ARG_WITH(dpms, [  --without-dpms          disable DPMS power saving],
+ AC_ARG_WITH(dpms,AC_HELP_STRING([--without-dpms],[disable DPMS power saving]),
 	dpms_test=$withval, dpms_test=&quot;yes&quot;)
  if test &quot;x$dpms_test&quot; = xno; then
    ac_cv_have_dpms=no
@@ -3439,7 +3495,6 @@
       AC_MSG_RESULT(no)
       ac_cv_have_dpms=&quot;no&quot;
     else
-      AC_LANG_C
       ac_save_ldflags=&quot;$LDFLAGS&quot;
       ac_save_cflags=&quot;$CFLAGS&quot;
       ac_save_libs=&quot;$LIBS&quot;
@@ -3501,18 +3556,32 @@
     $1
   fi
  fi
+ ac_save_cflags=&quot;$CFLAGS&quot;
+ CFLAGS=&quot;$CFLAGS $X_INCLUDES&quot;
+ test -n &quot;$DPMS_INCLUDE&quot; &amp;&amp; CFLAGS=&quot;-I$DPMS_INCLUDE $CFLAGS&quot;
+ AH_TEMPLATE(HAVE_DPMSCAPABLE_PROTO,
+   [Define if you have the DPMSCapable prototype in &lt;X11/extensions/dpms.h&gt;])
+ AC_CHECK_DECL(DPMSCapable,
+   AC_DEFINE(HAVE_DPMSCAPABLE_PROTO),,
+   [#include &lt;X11/extensions/dpms.h&gt;])
+ AH_TEMPLATE(HAVE_DPMSINFO_PROTO,
+   [Define if you have the DPMSInfo prototype in &lt;X11/extensions/dpms.h&gt;])
+ AC_CHECK_DECL(DPMSInfo,
+   AC_DEFINE(HAVE_DPMSINFO_PROTO),,
+   [#include &lt;X11/extensions/dpms.h&gt;])
+ CFLAGS=&quot;$ac_save_cflags&quot;
  AC_SUBST(DPMSINC)
  AC_SUBST(DPMSLIB)
 ])
 
-AC_DEFUN(AC_HAVE_GL,
+AC_DEFUN([AC_HAVE_GL],
  [AC_REQUIRE_CPP()dnl
   AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 
  test -z &quot;$GL_LDFLAGS&quot; &amp;&amp; GL_LDFLAGS=
  test -z &quot;$GL_INCLUDE&quot; &amp;&amp; GL_INCLUDE=
 
- AC_ARG_WITH(gl, [  --without-gl            disable 3D GL modes],
+ AC_ARG_WITH(gl,AC_HELP_STRING([--without-gl],[disable 3D GL modes]),
 	gl_test=$withval, gl_test=&quot;yes&quot;)
  if test &quot;x$kde_use_qt_emb&quot; = &quot;xyes&quot;; then
    # GL and Qt Embedded is a no-go for now.
@@ -3588,72 +3657,74 @@
 
  dnl shadow password and PAM magic - maintained by <A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">ossi at kde.org</A>
 
-AC_DEFUN(KDE_PAM, [
+AC_DEFUN([KDE_PAM], [
   AC_REQUIRE([KDE_CHECK_LIBDL])
 
+  want_pam=
   AC_ARG_WITH(pam,
-    [  --with-pam[=ARG]        enable support for PAM: ARG=[yes|no|service name]],
+    AC_HELP_STRING([--with-pam[=ARG]],[enable support for PAM: ARG=[yes|no|service name]]),
     [ if test &quot;x$withval&quot; = &quot;xyes&quot;; then
-        use_pam=yes
+        want_pam=yes
         pam_service=kde
       elif test &quot;x$withval&quot; = &quot;xno&quot;; then
-        use_pam=no
+        want_pam=no
       else
-        use_pam=yes
+        want_pam=yes
         pam_service=$withval
       fi
-      ac_cv_path_pam=&quot;use_pam=$use_pam pam_service=$pam_service&quot;
-    ], [
-      AC_CACHE_VAL(ac_cv_path_pam,
-        [ use_pam=no
-          AC_CHECK_LIB(pam, pam_start,
-            [ use_pam=yes
-              pam_service=kde
-            ], , $LIBDL)
-        ])
-    ])
-  eval &quot;$ac_cv_path_pam&quot;
+    ], [ pam_service=kde ])
 
-  pam_header=
-
-  AC_CHECK_HEADER(security/pam_appl.h,
-  [ pam_header=&quot;security/pam_appl.h&quot;
-  ],
-  [ AC_CHECK_HEADER(pam/pam_appl.h,
-    [ pam_header=&quot;pam/pam_appl.h&quot;
-    ], [ use_pam=no
-    ])
-  ])
-
-  AC_MSG_CHECKING(for PAM)
-  if test &quot;x$use_pam&quot; = xno; then
-    AC_MSG_RESULT(no)
-    PAMLIBS=&quot;&quot;
-  else
-    AC_MSG_RESULT(yes)
-    AC_DEFINE(HAVE_PAM, 1, [Defines if you have PAM (Pluggable Authentication Modules)])
-    PAMLIBS=&quot;$PAM_MISC_LIB -lpam $LIBDL&quot;
+  use_pam=
+  PAMLIBS=
+  if test &quot;x$want_pam&quot; != xno; then
+    AC_CHECK_LIB(pam, pam_start, [
+      AC_CHECK_HEADER(security/pam_appl.h,
+        [ pam_header=security/pam_appl.h ],
+        [ AC_CHECK_HEADER(pam/pam_appl.h,
+            [ pam_header=pam/pam_appl.h ],
+            [
+    AC_MSG_WARN([PAM detected, but no headers found!
+Make sure you have the necessary development packages installed.])
+            ]
+          )
+        ]
+      )
+    ], , $LIBDL)
+    if test -z &quot;$pam_header&quot;; then
+      if test &quot;x$want_pam&quot; = xyes; then
+        AC_MSG_ERROR([--with-pam was specified, but cannot compile with PAM!])
+      fi
+    else
+      AC_DEFINE(HAVE_PAM, 1, [Defines if you have PAM (Pluggable Authentication Modules)])
+      PAMLIBS=&quot;$PAM_MISC_LIB -lpam $LIBDL&quot;
+      use_pam=yes
+
+      dnl darwin claims to be something special
+      if test &quot;$pam_header&quot; = &quot;pam/pam_appl.h&quot;; then
+        AC_DEFINE(HAVE_PAM_PAM_APPL_H, 1, [Define if your PAM headers are in pam/ instead of security/])
+      fi
 
-    dnl test whether struct pam_message is const (Linux) or not (Sun)
-    AC_MSG_CHECKING(for const pam_message)
-    AC_EGREP_HEADER([struct pam_message], $pam_header,
-      [ AC_EGREP_HEADER([const struct pam_message], $pam_header,
-                        [AC_MSG_RESULT([const: Linux-type PAM])],
-                        [AC_MSG_RESULT([nonconst: Sun-type PAM])
-                        AC_DEFINE(PAM_MESSAGE_NONCONST, 1, [Define if your PAM support takes non-const arguments (Solaris)])]
-                        )],
-      [AC_MSG_RESULT([not found - assume const, Linux-type PAM])])
+      dnl test whether struct pam_message is const (Linux) or not (Sun)
+      AC_MSG_CHECKING(for const pam_message)
+      AC_EGREP_HEADER([struct pam_message], $pam_header,
+        [ AC_EGREP_HEADER([const struct pam_message], $pam_header,
+                          [AC_MSG_RESULT([const: Linux-type PAM])],
+                          [AC_MSG_RESULT([nonconst: Sun-type PAM])
+                          AC_DEFINE(PAM_MESSAGE_NONCONST, 1, [Define if your PAM support takes non-const arguments (Solaris)])]
+                          )],
+        [AC_MSG_RESULT([not found - assume const, Linux-type PAM])])
+    fi
   fi
 
   AC_SUBST(PAMLIBS)
 ])
 
 dnl DEF_PAM_SERVICE(arg name, full name, define name)
-AC_DEFUN(DEF_PAM_SERVICE, [
+AC_DEFUN([DEF_PAM_SERVICE], [
   AC_ARG_WITH($1-pam,
-    [  --with-$1-pam=[val]    override PAM service from --with-pam for $2],
+    AC_HELP_STRING([--with-$1-pam=[val]],[override PAM service from --with-pam for $2]),
     [ if test &quot;x$use_pam&quot; = xyes; then
-        $3_PAM_SERVICE=&quot;$withval&quot;
+        $3_PAM_SERVICE=$withval
       else
         AC_MSG_ERROR([Cannot use use --with-$1-pam, as no PAM was detected.
 You may want to enforce it by using --with-pam.])
@@ -3670,7 +3741,7 @@
     AC_SUBST($3_PAM_SERVICE)
 ])
 
-AC_DEFUN(KDE_SHADOWPASSWD, [
+AC_DEFUN([KDE_SHADOWPASSWD], [
   AC_REQUIRE([KDE_PAM])
 
   AC_CHECK_LIB(shadow, getspent,
@@ -3693,7 +3764,7 @@
   AC_MSG_CHECKING([for shadow passwords])
 
   AC_ARG_WITH(shadow,
-    [  --with-shadow		  If you want shadow password support ],
+    AC_HELP_STRING([--with-shadow],[If you want shadow password support]),
     [ if test &quot;x$withval&quot; != &quot;xno&quot;; then
         use_shadow=yes
       else
@@ -3727,7 +3798,7 @@
 
 ])
 
-AC_DEFUN(KDE_PASSWDLIBS, [
+AC_DEFUN([KDE_PASSWDLIBS], [
   AC_REQUIRE([KDE_MISC_TESTS]) dnl for LIBCRYPT
   AC_REQUIRE([KDE_PAM])
   AC_REQUIRE([KDE_SHADOWPASSWD])
@@ -3753,7 +3824,7 @@
   AC_SUBST(PASSWDLIBS)
 ])
 
-AC_DEFUN(KDE_CHECK_LIBDL,
+AC_DEFUN([KDE_CHECK_LIBDL],
 [
 AC_CHECK_LIB(dl, dlopen, [
 LIBDL=&quot;-ldl&quot;
@@ -3768,7 +3839,7 @@
 AC_SUBST(LIBDL)
 ])
 
-AC_DEFUN(KDE_CHECK_DLOPEN,
+AC_DEFUN([KDE_CHECK_DLOPEN],
 [
 KDE_CHECK_LIBDL
 AC_CHECK_HEADERS(dlfcn.h dl.h)
@@ -3783,7 +3854,7 @@
 dnl XXX why change enable_dlopen? its already set by autoconf's AC_ARG_ENABLE
 dnl (MM)
 AC_ARG_ENABLE(dlopen,
-[  --disable-dlopen        link statically [default=no]] ,
+AC_HELP_STRING([--disable-dlopen],[link statically [default=no]]),
 enable_dlopen=$enableval,
 enable_dlopen=yes)
 
@@ -3808,7 +3879,7 @@
 
 ])
 
-AC_DEFUN(KDE_CHECK_DYNAMIC_LOADING,
+AC_DEFUN([KDE_CHECK_DYNAMIC_LOADING],
 [
 KDE_CHECK_DLOPEN(libtool_enable_shared=yes, libtool_enable_static=no)
 KDE_PROG_LIBTOOL
@@ -3828,7 +3899,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_ADD_INCLUDES,
+AC_DEFUN([KDE_ADD_INCLUDES],
 [
 if test -z &quot;$1&quot;; then
   test_include=&quot;Pix.h&quot;
@@ -3865,190 +3936,30 @@
 ])
 ])
 
-
-AC_DEFUN(KDE_CHECK_MICO,
+AC_DEFUN([KDE_CHECK_LIBPTHREAD],
 [
-AC_REQUIRE([KDE_CHECK_LIBDL])
-AC_REQUIRE([KDE_MISC_TESTS])
-AC_MSG_CHECKING(for MICO)
+  LIBPTHREAD=&quot;&quot;
 
-if test -z &quot;$MICODIR&quot;; then
-    kde_micodir=/usr/local
- else
-    kde_micodir=&quot;$MICODIR&quot;
-fi
-
-AC_ARG_WITH(micodir,
-  [  --with-micodir=micodir  where mico is installed ],
-  kde_micodir=$withval,
-  kde_micodir=$kde_micodir
-)
-
-AC_CACHE_VAL(kde_cv_mico_incdir,
-[
-  mico_incdirs=&quot;$kde_micodir/include /usr/include /usr/local/include /usr/local/include /opt/local/include $kde_extra_includes&quot;
-AC_FIND_FILE(CORBA.h, $mico_incdirs, kde_cv_mico_incdir)
-
-])
-kde_micodir=`echo $kde_cv_mico_incdir | sed -e 's#/include##'`
-
-if test ! -r  $kde_micodir/include/CORBA.h; then
-  AC_MSG_ERROR([No CORBA.h found, specify another micodir])
-fi
-
-AC_MSG_RESULT($kde_micodir)
-
-MICO_INCLUDES=-I$kde_micodir/include
-AC_SUBST(MICO_INCLUDES)
-MICO_LDFLAGS=-L$kde_micodir/lib
-AC_SUBST(MICO_LDFLAGS)
-micodir=$kde_micodir
-AC_SUBST(micodir)
-
-AC_MSG_CHECKING([for MICO version])
-AC_CACHE_VAL(kde_cv_mico_version,
-[
-AC_LANG_C
-cat &gt;conftest.$ac_ext &lt;&lt;EOF
-#include &lt;stdio.h&gt;
-#include &lt;mico/version.h&gt;
-int main() {
-
-   printf(&quot;MICO_VERSION=%s\n&quot;,MICO_VERSION);
-   return (0);
-}
-EOF
-ac_compile='${CC-gcc} $CFLAGS $MICO_INCLUDES conftest.$ac_ext -o conftest'
-if AC_TRY_EVAL(ac_compile); then
-  if eval `./conftest 2&gt;&amp;5`; then
-    kde_cv_mico_version=$MICO_VERSION
-  else
-    AC_MSG_ERROR([your system is not able to execute a small application to
-    find MICO version! Check $kde_micodir/include/mico/version.h])
+  if test -n &quot;$PTHREAD_LIBS&quot;; then
+    PTHREAD_LIBS_save=&quot;$PTHREAD_LIBS&quot;
+    PTHREAD_LIBS=`echo &quot;$PTHREAD_LIBS_save&quot; | sed -e 's,^-l,,g'`
+    KDE_CHECK_LIB($PTHREAD_LIBS, pthread_create, [LIBPTHREAD=&quot;$PTHREAD_LIBS_save&quot;] )
+    PTHREAD_LIBS=&quot;$PTHREAD_LIBS_save&quot;
   fi
-else
-  AC_MSG_ERROR([your system is not able to compile a small application to
-  find MICO version! Check $kde_micodir/include/mico/version.h])
-fi
-])
-
-dnl installed MICO version
-mico_v_maj=`echo $kde_cv_mico_version | sed -e 's/^\(.*\)\..*\..*$/\1/'`
-mico_v_mid=`echo $kde_cv_mico_version | sed -e 's/^.*\.\(.*\)\..*$/\1/'`
-mico_v_min=`echo $kde_cv_mico_version | sed -e 's/^.*\..*\.\(.*\)$/\1/'`
-
-if test &quot;x$1&quot; = &quot;x&quot;; then
- req_version=&quot;2.3.0&quot;
-else
- req_version=$1
-fi
-
-dnl required MICO version
-req_v_maj=`echo $req_version | sed -e 's/^\(.*\)\..*\..*$/\1/'`
-req_v_mid=`echo $req_version | sed -e 's/^.*\.\(.*\)\..*$/\1/'`
-req_v_min=`echo $req_version | sed -e 's/^.*\..*\.\(.*\)$/\1/'`
-
-if test &quot;$mico_v_maj&quot; -lt &quot;$req_v_maj&quot; || \
-   ( test &quot;$mico_v_maj&quot; -eq &quot;$req_v_maj&quot; &amp;&amp; \
-        test &quot;$mico_v_mid&quot; -lt &quot;$req_v_mid&quot; ) || \
-   ( test &quot;$mico_v_mid&quot; -eq &quot;$req_v_mid&quot; &amp;&amp; \
-        test &quot;$mico_v_min&quot; -lt &quot;$req_v_min&quot; )
-
-then
-  AC_MSG_ERROR([found MICO version $kde_cv_mico_version but version $req_version \
-at least is required. You should upgrade MICO.])
-else
-  AC_MSG_RESULT([$kde_cv_mico_version (minimum version $req_version, ok)])
-fi
-
-LIBMICO=&quot;-lmico$kde_cv_mico_version $LIBCRYPT $LIBSOCKET $LIBDL&quot;
-AC_SUBST(LIBMICO)
-if test -z &quot;$IDL&quot;; then
-  IDL='$(kde_bindir)/cuteidl'
-fi
-AC_SUBST(IDL)
-IDL_DEPENDENCIES='$(kde_includes)/CUTE.h'
-AC_SUBST(IDL_DEPENDENCIES)
-
-idldir=&quot;\$(includedir)/idl&quot;
-AC_SUBST(idldir)
-
-])
-
-AC_DEFUN(KDE_CHECK_MINI_STL,
-[
-AC_REQUIRE([KDE_CHECK_MICO])
-
-AC_MSG_CHECKING(if we use mico's mini-STL)
-AC_CACHE_VAL(kde_cv_have_mini_stl,
-[
-AC_LANG_SAVE
-AC_LANG_CPLUSPLUS
-kde_save_cxxflags=&quot;$CXXFLAGS&quot;
-CXXFLAGS=&quot;$CXXFLAGS $MICO_INCLUDES&quot;
-AC_TRY_COMPILE(
-[
-#include &lt;mico/config.h&gt;
-],
-[
-#ifdef HAVE_MINI_STL
-#error &quot;nothing&quot;
-#endif
-],
-kde_cv_have_mini_stl=no,
-kde_cv_have_mini_stl=yes)
-CXXFLAGS=&quot;$kde_save_cxxflags&quot;
-AC_LANG_RESTORE
-])
-
-if test &quot;x$kde_cv_have_mini_stl&quot; = &quot;xyes&quot;; then
-   AC_MSG_RESULT(yes)
-   $1
-else
-   AC_MSG_RESULT(no)
-   $2
-fi
-])
-
-])
 
+  if test -z &quot;$LIBPTHREAD&quot;; then
+    AC_CHECK_LIB(pthread, pthread_create, [LIBPTHREAD=&quot;-lpthread&quot;] )
+  fi
 
-AC_DEFUN(KDE_CHECK_LIBPTHREAD,
-[
-AC_CHECK_LIB(pthread, pthread_create, [LIBPTHREAD=&quot;-lpthread&quot;] )
-AC_SUBST(LIBPTHREAD)
+  AC_SUBST(LIBPTHREAD)
 ])
 
-AC_DEFUN(KDE_CHECK_PTHREAD_OPTION,
+AC_DEFUN([KDE_CHECK_PTHREAD_OPTION],
 [
-    AC_ARG_ENABLE(kernel-threads, [  --enable-kernel-threads Enable the use of the LinuxThreads port on FreeBSD/i386 only.],
-	kde_use_kernthreads=$enableval, kde_use_kernthreads=no)
-
-    if test &quot;$kde_use_kernthreads&quot; = &quot;yes&quot;; then
-      ac_save_CXXFLAGS=&quot;$CXXFLAGS&quot;
-      ac_save_CFLAGS=&quot;$CFLAGS&quot;
-      CXXFLAGS=&quot;-I/usr/local/include/pthread/linuxthreads $CXXFLAGS&quot;
-      CFLAGS=&quot;-I/usr/local/include/pthread/linuxthreads $CFLAGS&quot;
-      AC_CHECK_HEADERS(pthread/linuxthreads/pthread.h)
-      CXXFLAGS=&quot;$ac_save_CXXFLAGS&quot;
-      CFLAGS=&quot;$ac_save_CFLAGS&quot;
-      if test &quot;$ac_cv_header_pthread_linuxthreads_pthread_h&quot; = &quot;no&quot;; then
-        kde_use_kernthreads=no
-      else
-        dnl Add proper -I and -l statements
-        AC_CHECK_LIB(lthread, pthread_join, [LIBPTHREAD=&quot;-llthread -llgcc_r&quot;]) dnl for FreeBSD
-        if test &quot;x$LIBPTHREAD&quot; = &quot;x&quot;; then
-          kde_use_kernthreads=no
-        else
-          USE_THREADS=&quot;-D_THREAD_SAFE -I/usr/local/include/pthread/linuxthreads&quot;
-        fi
-      fi
-    else 
       USE_THREADS=&quot;&quot;
       if test -z &quot;$LIBPTHREAD&quot;; then
-        KDE_CHECK_COMPILER_FLAG(pthread, [USE_THREADS=&quot;-pthread&quot;] )
+        KDE_CHECK_COMPILER_FLAG(pthread, [USE_THREADS=&quot;-D_THREAD_SAFE -pthread&quot;])
       fi
-    fi
 
     AH_VERBATIM(__svr_define, [
 #if defined(__SVR4) &amp;&amp; !defined(__svr4__)
@@ -4061,7 +3972,7 @@
                 CPPFLAGS=&quot;$CPPFLAGS -D_REENTRANT -D_POSIX_PTHREAD_SEMANTICS -DUSE_SOLARIS -DSVR4&quot;
     		;;
         freebsd*)
-                CPPFLAGS=&quot;$CPPFLAGS -D_THREAD_SAFE&quot;
+                CPPFLAGS=&quot;$CPPFLAGS -D_THREAD_SAFE $PTHREAD_CFLAGS&quot;
                 ;;
         aix*)
                 CPPFLAGS=&quot;$CPPFLAGS -D_THREAD_SAFE&quot;
@@ -4080,7 +3991,7 @@
     AC_SUBST(LIBPTHREAD)
 ])
 
-AC_DEFUN(KDE_CHECK_THREADING,
+AC_DEFUN([KDE_CHECK_THREADING],
 [
   AC_REQUIRE([KDE_CHECK_LIBPTHREAD])
   AC_REQUIRE([KDE_CHECK_PTHREAD_OPTION])
@@ -4094,14 +4005,14 @@
   else
     kde_check_threading_default=yes
   fi
-  AC_ARG_ENABLE(threading, [  --disable-threading     disables threading even if libpthread found ],
+  AC_ARG_ENABLE(threading,AC_HELP_STRING([--disable-threading],[disables threading even if libpthread found]),
    kde_use_threading=$enableval, kde_use_threading=$kde_check_threading_default)
   if test &quot;x$kde_use_threading&quot; = &quot;xyes&quot;; then
     AC_DEFINE(HAVE_LIBPTHREAD, 1, [Define if you have a working libpthread (will enable threaded code)])
   fi
 ])
 
-AC_DEFUN(KDE_TRY_LINK_PYTHON,
+AC_DEFUN([KDE_TRY_LINK_PYTHON],
 [
 if test &quot;$kde_python_link_found&quot; = no; then
 
@@ -4113,8 +4024,6 @@
 
 AC_CACHE_VAL(kde_cv_try_link_python_$1,
 [
-AC_LANG_SAVE
-AC_LANG_C
 kde_save_cflags=&quot;$CFLAGS&quot;
 CFLAGS=&quot;$CFLAGS $PYTHONINC&quot;
 kde_save_libs=&quot;$LIBS&quot;
@@ -4147,13 +4056,12 @@
   AC_MSG_RESULT(no)
   $4
 fi
-AC_LANG_RESTORE
 
 fi
 
 ])
 
-AC_DEFUN(KDE_CHECK_PYTHON_DIR,
+AC_DEFUN([KDE_CHECK_PYTHON_DIR],
 [
 AC_MSG_CHECKING([for Python directory])
  
@@ -4167,7 +4075,7 @@
 ])
  
 AC_ARG_WITH(pythondir,
-[  --with-pythondir=pythondir   use python installed in pythondir ],
+AC_HELP_STRING([--with-pythondir=pythondir],[use python installed in pythondir]),
 [
   ac_python_dir=$withval
 ], ac_python_dir=$kde_cv_pythondir
@@ -4176,7 +4084,7 @@
 AC_MSG_RESULT($ac_python_dir)
 ])
 
-AC_DEFUN(KDE_CHECK_PYTHON_INTERN,
+AC_DEFUN([KDE_CHECK_PYTHON_INTERN],
 [
 AC_REQUIRE([KDE_CHECK_LIBDL])
 AC_REQUIRE([KDE_CHECK_LIBPTHREAD])
@@ -4202,13 +4110,16 @@
 
 PYTHONINC=-I$python_incdir
 
-python_libdirs=&quot;$ac_python_dir/lib /usr/lib /usr/local /usr/lib $kde_extra_libs&quot;
-AC_FIND_FILE(libpython$version.a, $python_libdirs, python_libdir)
-if test ! -r $python_libdir/libpython$version.a; then
-  AC_FIND_FILE(python$version/config/libpython$version.a, $python_libdirs, python_libdir)
-  python_libdir=$python_libdir/python$version/config
+python_libdirs=&quot;$ac_python_dir/lib$kdelibsuff /usr/lib$kdelibsuff /usr/local /usr/lib$kdelibsuff $kde_extra_libs&quot;
+AC_FIND_FILE(libpython$version.so, $python_libdirs, python_libdir)
+if test ! -r $python_libdir/libpython$version.so; then
+  AC_FIND_FILE(libpython$version.a, $python_libdirs, python_libdir)
   if test ! -r $python_libdir/libpython$version.a; then
-    python_libdir=no
+    AC_FIND_FILE(python$version/config/libpython$version.a, $python_libdirs, python_libdir)
+    python_libdir=$python_libdir/python$version/config
+    if test ! -r $python_libdir/libpython$version.a; then
+      python_libdir=no
+    fi
   fi
 fi
 
@@ -4218,7 +4129,6 @@
   LIBPYTHON=-lpython$version
 fi
 
-python_libdirs=&quot;$ac_python_dir/lib /usr/lib /usr/local /usr/lib $kde_extra_libs&quot;
 AC_FIND_FILE(python$version/copy.py, $python_libdirs, python_moddir)
 python_moddir=$python_moddir/python$version
 if test ! -r $python_moddir/copy.py; then
@@ -4266,7 +4176,7 @@
 ])
 
 
-AC_DEFUN(KDE_CHECK_PYTHON,
+AC_DEFUN([KDE_CHECK_PYTHON],
 [
   KDE_CHECK_PYTHON_INTERN(&quot;2.3&quot;, 
    [KDE_CHECK_PYTHON_INTERN(&quot;2.2&quot;, 
@@ -4278,10 +4188,15 @@
    ])
 ])
 
-AC_DEFUN(KDE_CHECK_STL_SGI,
+AC_DEFUN([KDE_CHECK_STL],
 [
-    AC_MSG_CHECKING([if STL implementation is SGI like])
-    AC_CACHE_VAL(kde_cv_stl_type_sgi,
+    AC_LANG_SAVE
+    AC_LANG_CPLUSPLUS
+    ac_save_CXXFLAGS=&quot;$CXXFLAGS&quot;
+    CXXFLAGS=&quot;`echo $CXXFLAGS | sed s/-fno-exceptions//`&quot;
+
+    AC_MSG_CHECKING([if C++ programs can be compiled])
+    AC_CACHE_VAL(kde_cv_stl_works,
     [
       AC_TRY_COMPILE([
 #include &lt;string&gt;
@@ -4290,60 +4205,26 @@
   string astring=&quot;Hallo Welt.&quot;;
   astring.erase(0, 6); // now astring is &quot;Welt&quot;
   return 0;
-], kde_cv_stl_type_sgi=yes,
-   kde_cv_stl_type_sgi=no)
+], kde_cv_stl_works=yes,
+   kde_cv_stl_works=no)
 ])
 
-   AC_MSG_RESULT($kde_cv_stl_type_sgi)
+   AC_MSG_RESULT($kde_cv_stl_works)
 
-   if test &quot;$kde_cv_stl_type_sgi&quot; = &quot;yes&quot;; then
-	AC_DEFINE_UNQUOTED(HAVE_SGI_STL, 1, [Define if you have a STL implementation by SGI])
-   fi
-])
-
-AC_DEFUN(KDE_CHECK_STL_HP,
-[
-    AC_MSG_CHECKING([if STL implementation is HP like])
-    AC_CACHE_VAL(kde_cv_stl_type_hp,
-    [
-      AC_TRY_COMPILE([
-#include &lt;string&gt;
-using namespace std;
-],[
-  string astring=&quot;Hello World&quot;;
-  astring.remove(0, 6); // now astring is &quot;World&quot;
-  return 0;
-], kde_cv_stl_type_hp=yes,
-   kde_cv_stl_type_hp=no)
-])
-   AC_MSG_RESULT($kde_cv_stl_type_hp)
-
-   if test &quot;$kde_cv_stl_type_hp&quot; = &quot;yes&quot;; then
-	AC_DEFINE_UNQUOTED(HAVE_HP_STL, 1, [Define if you have a STL implementation by HP])
+   if test &quot;$kde_cv_stl_works&quot; = &quot;yes&quot;; then
+     # back compatible
+	 AC_DEFINE_UNQUOTED(HAVE_SGI_STL, 1, [Define if you have a STL implementation by SGI])
+   else
+	 AC_MSG_ERROR([Your Installation isn't able to compile simple C++ programs.
+Check config.log for details - if you're using a Linux distribution you might miss
+a package named similiar to libstd++-dev.])
    fi
-])
-
-AC_DEFUN(KDE_CHECK_STL,
-[
-    AC_LANG_SAVE
-    AC_LANG_CPLUSPLUS
-    ac_save_CXXFLAGS=&quot;$CXXFLAGS&quot;
-    CXXFLAGS=&quot;`echo $CXXFLAGS | sed s/-fno-exceptions//`&quot;
-    KDE_CHECK_STL_SGI
-
-    if test &quot;$kde_cv_stl_type_sgi&quot; = &quot;no&quot;; then
-       KDE_CHECK_STL_HP
 
-       if test &quot;$kde_cv_stl_type_hp&quot; = &quot;no&quot;; then
-         AC_MSG_ERROR(&quot;no known STL type found - did you forget to install libstdc++[-devel] ?&quot;)
-       fi
-    fi
-
-    CXXFLAGS=&quot;$ac_save_CXXFLAGS&quot;
-    AC_LANG_RESTORE
+   CXXFLAGS=&quot;$ac_save_CXXFLAGS&quot;
+   AC_LANG_RESTORE
 ])
 
-AC_DEFUN(AC_FIND_QIMGIO,
+AC_DEFUN([AC_FIND_QIMGIO],
    [AC_REQUIRE([AC_FIND_JPEG])
 AC_REQUIRE([KDE_CHECK_EXTRA_LIBS])
 AC_MSG_CHECKING([for qimgio])
@@ -4382,28 +4263,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_ANSI,
-[
-])
-
-AC_DEFUN(KDE_CHECK_INSURE,
-[
-  AC_ARG_ENABLE(insure, [  --enable-insure             use insure++ for debugging [default=no]],
-  [
-  if test $enableval = &quot;no&quot;; dnl
-	then ac_use_insure=&quot;no&quot;
-	else ac_use_insure=&quot;yes&quot;
-   fi
-  ], [ac_use_insure=&quot;no&quot;])
-
-  AC_MSG_CHECKING(if we will use Insure++ to debug)
-  AC_MSG_RESULT($ac_use_insure)
-  if test &quot;$ac_use_insure&quot; = &quot;yes&quot;; dnl
-       then CC=&quot;insure&quot;; CXX=&quot;insure&quot;; dnl CFLAGS=&quot;$CLAGS -fno-rtti -fno-exceptions &quot;????
-   fi
-])
-
-AC_DEFUN(AM_DISABLE_LIBRARIES,
+AC_DEFUN([AM_DISABLE_LIBRARIES],
 [
     AC_PROVIDE([AM_ENABLE_STATIC])
     AC_PROVIDE([AM_ENABLE_SHARED])
@@ -4412,7 +4272,7 @@
 ])
 
 
-AC_DEFUN(AC_CHECK_UTMP_FILE,
+AC_DEFUN([AC_CHECK_UTMP_FILE],
 [
     AC_MSG_CHECKING([for utmp file])
 
@@ -4445,7 +4305,7 @@
 ])
 
 
-AC_DEFUN(KDE_CREATE_SUBDIRSLIST,
+AC_DEFUN([KDE_CREATE_SUBDIRSLIST],
 [
 
 DO_NOT_COMPILE=&quot;$DO_NOT_COMPILE CVS debian bsd-port admin&quot;
@@ -4460,9 +4320,10 @@
   done
 fi
 
+ac_topsubdirs=
 if test -s $srcdir/inst-apps; then
   ac_topsubdirs=&quot;`cat $srcdir/inst-apps`&quot;
-else
+elif test -s $srcdir/subdirs; then
   ac_topsubdirs=&quot;`cat $srcdir/subdirs`&quot;
 fi
 
@@ -4479,7 +4340,7 @@
     install_it=&quot;no&quot;
   fi
   AC_MSG_RESULT($install_it)
-  vari=`echo $i | sed -e 's,[[-+.]],_,g'`
+  vari=`echo $i | sed -e 's,[[-+.@]],_,g'`
   if test $install_it = &quot;yes&quot;; then
     TOPSUBDIRS=&quot;$TOPSUBDIRS $i&quot;
     eval &quot;$vari&quot;&quot;_SUBDIR_included=yes&quot;
@@ -4491,7 +4352,7 @@
 AC_SUBST(TOPSUBDIRS)
 ])
 
-AC_DEFUN(KDE_CHECK_NAMESPACES,
+AC_DEFUN([KDE_CHECK_NAMESPACES],
 [
 AC_MSG_CHECKING(whether C++ compiler supports namespaces)
 AC_LANG_SAVE
@@ -4517,22 +4378,15 @@
 AC_LANG_RESTORE
 ])
 
-AC_DEFUN(KDE_CHECK_NEWLIBS,
-[
-
-])
-
 dnl ------------------------------------------------------------------------
 dnl Check for S_ISSOCK macro. Doesn't exist on Unix SCO. <A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">faure at kde.org</A>
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_CHECK_S_ISSOCK,
+AC_DEFUN([AC_CHECK_S_ISSOCK],
 [
 AC_MSG_CHECKING(for S_ISSOCK)
 AC_CACHE_VAL(ac_cv_have_s_issock,
 [
-AC_LANG_SAVE
-AC_LANG_C
 AC_TRY_LINK(
 [
 #include &lt;sys/stat.h&gt;
@@ -4543,7 +4397,6 @@
 ],
 ac_cv_have_s_issock=yes,
 ac_cv_have_s_issock=no)
-AC_LANG_RESTORE
 ])
 AC_MSG_RESULT($ac_cv_have_s_issock)
 if test &quot;$ac_cv_have_s_issock&quot; = &quot;yes&quot;; then
@@ -4564,12 +4417,11 @@
 dnl Check for MAXPATHLEN macro, defines KDEMAXPATHLEN. <A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">faure at kde.org</A>
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(AC_CHECK_KDEMAXPATHLEN,
+AC_DEFUN([AC_CHECK_KDEMAXPATHLEN],
 [
 AC_MSG_CHECKING(for MAXPATHLEN)
 AC_CACHE_VAL(ac_cv_maxpathlen,
 [
-AC_LANG_C
 cat &gt; conftest.$ac_ext &lt;&lt;EOF
 #ifdef STDC_HEADERS
 # include &lt;stdlib.h&gt;
@@ -4599,18 +4451,18 @@
 AC_DEFINE_UNQUOTED(KDEMAXPATHLEN,$ac_cv_maxpathlen, [Define a safe value for MAXPATHLEN] )
 ])
 
-AC_DEFUN(KDE_CHECK_HEADER,
+AC_DEFUN([KDE_CHECK_HEADER],
 [
    AC_LANG_SAVE
    kde_safe_cppflags=$CPPFLAGS
    CPPFLAGS=&quot;$CPPFLAGS $all_includes&quot;
    AC_LANG_CPLUSPLUS
-   AC_CHECK_HEADER($1, $2, $3, $4)
+   AC_CHECK_HEADER([$1], [$2], [$3], [$4])
    CPPFLAGS=$kde_safe_cppflags
    AC_LANG_RESTORE
 ])
 
-AC_DEFUN(KDE_CHECK_HEADERS,
+AC_DEFUN([KDE_CHECK_HEADERS],
 [
    AH_CHECK_HEADERS([$1])
    AC_LANG_SAVE
@@ -4622,14 +4474,14 @@
    AC_LANG_RESTORE
 ])
 
-AC_DEFUN(KDE_FAST_CONFIGURE,
+AC_DEFUN([KDE_FAST_CONFIGURE],
 [
   dnl makes configure fast (needs perl)
-  AC_ARG_ENABLE(fast-perl, [  --disable-fast-perl     disable fast Makefile generation (needs perl)],
+  AC_ARG_ENABLE(fast-perl, AC_HELP_STRING([--disable-fast-perl],[disable fast Makefile generation (needs perl)]),
       with_fast_perl=$enableval, with_fast_perl=yes)
 ])
 
-AC_DEFUN(KDE_CONF_FILES,
+AC_DEFUN([KDE_CONF_FILES],
 [
   val=
   if test -f $srcdir/configure.files ; then
@@ -4644,7 +4496,10 @@
   AC_SUBST(CONF_FILES)
 ])dnl
 
-AC_DEFUN(KDE_SET_PREFIX,
+dnl This sets the prefix, for arts and kdelibs
+dnl Do NOT use in any other module.
+dnl It only looks at --prefix, KDEDIR and falls back to /usr/local/kde
+AC_DEFUN([KDE_SET_PREFIX_CORE],
 [
   unset CDPATH
   dnl make $KDEDIR the default for the installation
@@ -4654,13 +4509,65 @@
     prefix=$ac_default_prefix
     ac_configure_args=&quot;$ac_configure_args --prefix=$prefix&quot;
   fi
-  # And delete superflous '/' to make compares easier
+  # And delete superfluous '/' to make compares easier
   prefix=`echo &quot;$prefix&quot; | sed 's,//*,/,g' | sed -e 's,/$,,'`
   exec_prefix=`echo &quot;$exec_prefix&quot; | sed 's,//*,/,g' | sed -e 's,/$,,'`
   KDE_FAST_CONFIGURE
   KDE_CONF_FILES
 ])
 
+
+AC_DEFUN([KDE_SET_PREFIX],
+[
+  unset CDPATH
+  dnl We can't give real code to that macro, only a value.
+  dnl It only matters for --help, since we set the prefix in this function anyway.
+  AC_PREFIX_DEFAULT(${KDEDIR:-the kde prefix})
+
+  KDE_SET_DEFAULT_BINDIRS
+  if test &quot;x$prefix&quot; = &quot;xNONE&quot;; then
+    dnl no prefix given: look for kde-config in the PATH and deduce the prefix from it
+    KDE_FIND_PATH(kde-config, KDECONFIG, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(kde-config)], [], prepend)
+  else
+    dnl prefix given: look for kde-config, preferrably in prefix, otherwise in PATH
+    kde_save_PATH=&quot;$PATH&quot;
+    PATH=&quot;$exec_prefix/bin:$prefix/bin:$PATH&quot;
+    KDE_FIND_PATH(kde-config, KDECONFIG, [$kde_default_bindirs], [KDE_MISSING_PROG_ERROR(kde-config)], [], prepend)
+    PATH=&quot;$kde_save_PATH&quot;
+  fi
+
+  kde_libs_prefix=`$KDECONFIG --prefix`
+  if test -z &quot;$kde_libs_prefix&quot; || test ! -x &quot;$kde_libs_prefix&quot;; then
+       AC_MSG_ERROR([$KDECONFIG --prefix outputed the non existant prefix '$kde_libs_prefix' for kdelibs.
+                    This means it has been moved since you installed it.
+                    This won't work. Please recompile kdelibs for the new prefix.
+                    ])
+  fi
+  kde_libs_htmldir=`$KDECONFIG --install html --expandvars`
+
+  AC_MSG_CHECKING([where to install])
+  if test &quot;x$prefix&quot; = &quot;xNONE&quot;; then
+    prefix=$kde_libs_prefix
+    AC_MSG_RESULT([$prefix (as returned by kde-config)])
+  else
+    dnl --prefix was given. Compare prefixes and warn (in configure.in.bot.end) if different
+    given_prefix=$prefix
+    AC_MSG_RESULT([$prefix (as requested)])
+  fi
+
+  # And delete superfluous '/' to make compares easier
+  prefix=`echo &quot;$prefix&quot; | sed 's,//*,/,g' | sed -e 's,/$,,'`
+  exec_prefix=`echo &quot;$exec_prefix&quot; | sed 's,//*,/,g' | sed -e 's,/$,,'`
+  given_prefix=`echo &quot;$given_prefix&quot; | sed 's,//*,/,g' | sed -e 's,/$,,'`
+
+  AC_SUBST(KDECONFIG)
+  AC_SUBST(kde_libs_prefix)
+  AC_SUBST(kde_libs_htmldir)
+
+  KDE_FAST_CONFIGURE
+  KDE_CONF_FILES
+])
+
 pushdef([AC_PROG_INSTALL],
 [
   dnl our own version, testing for a -p flag
@@ -4727,7 +4634,7 @@
   fi
 ])dnl
 
-AC_DEFUN(KDE_LANG_CPLUSPLUS,
+AC_DEFUN([KDE_LANG_CPLUSPLUS],
 [AC_LANG_CPLUSPLUS
 ac_link='rm -rf SunWS_cache; ${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1&gt;&amp;AC_FD_CC'
 pushdef([AC_LANG_CPLUSPLUS], [popdef([AC_LANG_CPLUSPLUS]) KDE_LANG_CPLUSPLUS])
@@ -4738,7 +4645,7 @@
 KDE_LANG_CPLUSPLUS
 ])
 
-AC_DEFUN(KDE_CHECK_LONG_LONG,
+AC_DEFUN([KDE_CHECK_LONG_LONG],
 [
 AC_MSG_CHECKING(for long long)
 AC_CACHE_VAL(kde_cv_c_long_long,
@@ -4758,7 +4665,7 @@
 fi
 ])
 
-AC_DEFUN(KDE_CHECK_LIB,
+AC_DEFUN([KDE_CHECK_LIB],
 [
      kde_save_LDFLAGS=&quot;$LDFLAGS&quot;
      dnl AC_CHECK_LIB modifies LIBS, so save it here
@@ -4774,7 +4681,7 @@
      LIBS=&quot;$kde_save_LIBS&quot;
 ])
 
-AC_DEFUN(KDE_JAVA_PREFIX,
+AC_DEFUN([KDE_JAVA_PREFIX],
 [
 	dir=`dirname &quot;$1&quot;`
 	base=`basename &quot;$1&quot;`
@@ -4797,11 +4704,11 @@
 ])
 
 dnl KDE_CHEC_JAVA_DIR(onlyjre)
-AC_DEFUN(KDE_CHECK_JAVA_DIR,
+AC_DEFUN([KDE_CHECK_JAVA_DIR],
 [
 
 AC_ARG_WITH(java,
-[  --with-java=javadir     use java installed in javadir, --without-java disables ],
+AC_HELP_STRING([--with-java=javadir],[use java installed in javadir, --without-java disables]),
 [  ac_java_dir=$withval
 ], ac_java_dir=&quot;&quot;
 )
@@ -4813,13 +4720,18 @@
    kde_java_bindir=no
    kde_java_includedir=no
    kde_java_libjvmdir=no
+   kde_java_libgcjdir=no
    kde_java_libhpidir=no
 else
   if test &quot;x$ac_java_dir&quot; = &quot;x&quot;; then
      
      
-      dnl No option set -&gt; look in $PATH
+      dnl No option set -&gt; collect list of candidate paths
+      if test -n &quot;$JAVA_HOME&quot;; then
+        KDE_JAVA_PREFIX($JAVA_HOME)
+      fi
       KDE_JAVA_PREFIX(/usr/j2se)
+      KDE_JAVA_PREFIX(/usr/lib/j2se)
       KDE_JAVA_PREFIX(/usr/j*dk*)
       KDE_JAVA_PREFIX(/usr/lib/j*dk*)
       KDE_JAVA_PREFIX(/opt/j*sdk*)
@@ -4832,25 +4744,33 @@
       KDE_JAVA_PREFIX(/usr/lib/IBMJava2*)
       KDE_JAVA_PREFIX(/usr/lib/IBMJava*)
       KDE_JAVA_PREFIX(/opt/java*)
-    
+
       kde_cv_path=&quot;NONE&quot;
       kde_save_IFS=$IFS
       IFS=':'
       for dir in $PATH; do
-	  javadirs=&quot;$javadirs $dir&quot;
+	  if test -d &quot;$dir&quot;; then
+	      javadirs=&quot;$javadirs $dir&quot;
+	  fi
       done
       IFS=$kde_save_IFS
       jredirs=
 
+      dnl Now javadirs contains a list of paths that exist, all ending with bin/
       for dir in $javadirs; do
-	  if test ! -d $dir; then break; fi
-          if test -x &quot;$dir/java&quot;; then
-                libjvmdir=`find $dir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
-		if test ! -f $libjvmdir/libjvm.so; then continue; fi
-		jredirs=&quot;$jredirs $dir&quot;
+          dnl Check for the java executable
+	  if test -x &quot;$dir/java&quot;; then
+	      dnl And also check for a libjvm.so somewhere under there
+	      dnl Since we have to go to the parent dir, /usr/bin is excluded, /usr is too big.
+              if test &quot;$dir&quot; != &quot;/usr/bin&quot;; then
+                  libjvmdir=`find $dir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
+		  if test ! -f $libjvmdir/libjvm.so; then continue; fi
+		  jredirs=&quot;$jredirs $dir&quot;
+	      fi
 	  fi
       done
 
+      dnl Now jredirs contains a reduced list, of paths where both java and ../**/libjvm.so was found
       JAVAC=
       JAVA=
       kde_java_bindir=no
@@ -4885,6 +4805,8 @@
 
   dnl Look for libjvm.so
   kde_java_libjvmdir=`find $kde_java_bindir/.. -name libjvm.so | sed 's,libjvm.so,,'|head -n 1`
+  dnl Look for libgcj.so
+  kde_java_libgcjdir=`find $kde_java_bindir/.. -name libgcj.so | sed 's,libgcj.so,,'|head -n 1`
   dnl Look for libhpi.so and avoid green threads
   kde_java_libhpidir=`find $kde_java_bindir/.. -name libhpi.so | grep -v green | sed 's,libhpi.so,,' | head -n 1`
 
@@ -4906,26 +4828,41 @@
 
     jni_includes=&quot;-I$kde_java_includedir&quot;
     dnl Strange thing, jni.h requires jni_md.h which is under genunix here..
-    dnl and under linux here..
-    test -d &quot;$kde_java_includedir/linux&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/linux&quot;
-    test -d &quot;$kde_java_includedir/solaris&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/solaris&quot;
-    test -d &quot;$kde_java_includedir/genunix&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/genunix&quot;
+    dnl and under linux here.. 
+    
+    dnl not needed for gcj
+
+    if test &quot;x$kde_java_libgcjdir&quot; = &quot;x&quot;; then 
+      test -d &quot;$kde_java_includedir/linux&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/linux&quot;
+      test -d &quot;$kde_java_includedir/solaris&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/solaris&quot;
+      test -d &quot;$kde_java_includedir/genunix&quot; &amp;&amp; jni_includes=&quot;$jni_includes -I$kde_java_includedir/genunix&quot;
+    fi
 
   else
     JAVAC=
     jni_includes=
   fi
 
-  if test ! -r &quot;$kde_java_libjvmdir/libjvm.so&quot;; then
-     AC_MSG_ERROR([libjvm.so not found under $kde_java_libjvmdir. Use --without-java.])
-  fi 
+  if test &quot;x$kde_java_libgcjdir&quot; = &quot;x&quot;; then 
+     if test ! -r &quot;$kde_java_libjvmdir/libjvm.so&quot;; then
+        AC_MSG_ERROR([libjvm.so not found under $kde_java_libjvmdir. Use --without-java.])
+     fi 
+  else
+     if test ! -r &quot;$kde_java_libgcjdir/libgcj.so&quot;; then
+        AC_MSG_ERROR([libgcj.so not found under $kde_java_libgcjdir. Use --without-java.])
+     fi 
+  fi
 
   if test ! -x &quot;$kde_java_bindir/java&quot;; then
       AC_MSG_ERROR([java not found under $kde_java_bindir. javac was found though! Use --with-java or --without-java.])
   fi
 
-  if test ! -r &quot;$kde_java_libhpidir/libhpi.so&quot;; then
-    AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
+  dnl not needed for gcj compile
+
+  if test &quot;x$kde_java_libgcjdir&quot; = &quot;x&quot;; then 
+      if test ! -r &quot;$kde_java_libhpidir/libhpi.so&quot;; then
+        AC_MSG_ERROR([libhpi.so not found under $kde_java_libhpidir. Use --without-java.])
+      fi
   fi
 
   if test -n &quot;$jni_includes&quot;; then
@@ -4964,7 +4901,11 @@
     JAVAH=$kde_java_bindir/javah
     JAR=$kde_java_bindir/jar
     AC_DEFINE_UNQUOTED(PATH_JAVA, &quot;$kde_java_bindir/java&quot;, [Define where your java executable is])
-    JVMLIBS=&quot;-L$kde_java_libjvmdir -ljvm -L$kde_java_libhpidir -lhpi&quot;
+    if test &quot;x$kde_java_libgcjdir&quot; = &quot;x&quot;; then 
+      JVMLIBS=&quot;-L$kde_java_libjvmdir -ljvm -L$kde_java_libhpidir -lhpi&quot;
+    else
+      JVMLIBS=&quot;-L$kde_java_libgcjdir -lgcj&quot;
+    fi
     AC_MSG_RESULT([java JDK in $kde_java_bindir])
 
   else
@@ -5013,7 +4954,7 @@
 m4_define([AC_FOREACH],
 [mm_foreach([$1], m4_split(m4_normalize([$2])), [$3])])
 
-AC_DEFUN(KDE_NEED_FLEX,
+AC_DEFUN([KDE_NEED_FLEX],
 [
 kde_libs_safe=$LIBS
 LIBS=&quot;$LIBS $USER_LDFLAGS&quot;
@@ -5025,7 +4966,7 @@
 AC_SUBST(LEXLIB)
 ])
 
-AC_DEFUN(AC_PATH_QTOPIA,
+AC_DEFUN([AC_PATH_QTOPIA],
 [
   dnl TODO: use AC_CACHE_VAL
 
@@ -5054,7 +4995,7 @@
   ac_qtopia_incdir=NO
 
   AC_ARG_WITH(qtopia-dir,
-              [  --with-qtopia-dir=DIR   where the root of Qtopia is installed ],
+              AC_HELP_STRING([--with-qtopia-dir=DIR],[where the root of Qtopia is installed]),
               [  ac_qtopia_incdir=&quot;$withval&quot;/include] ) 
   
   qtopia_incdirs=&quot;&quot;
@@ -5129,7 +5070,7 @@
 ])
 
 
-AC_DEFUN(KDE_INIT_DOXYGEN,
+AC_DEFUN([KDE_INIT_DOXYGEN],
 [
 AC_MSG_CHECKING([for Qt docs])
 kde_qtdir=
@@ -5166,16 +5107,17 @@
 ])
 
 
-AC_DEFUN(AC_FIND_BZIP2,
+AC_DEFUN([AC_FIND_BZIP2],
 [
 AC_MSG_CHECKING([for bzDecompress in libbz2])
 AC_CACHE_VAL(ac_cv_lib_bzip2,
 [
-AC_LANG_C
+AC_LANG_SAVE
+AC_LANG_CPLUSPLUS
 kde_save_LIBS=&quot;$LIBS&quot;
 LIBS=&quot;$all_libraries $USER_LDFLAGS -lbz2 $LIBSOCKET&quot;
-kde_save_CFLAGS=&quot;$CFLAGS&quot;
-CFLAGS=&quot;$CFLAGS $all_includes $USER_INCLUDES&quot;
+kde_save_CXXFLAGS=&quot;$CXXFLAGS&quot;
+CXXFLAGS=&quot;$CXXFLAGS $all_includes $USER_INCLUDES&quot;
 AC_TRY_LINK(dnl
 [
 #define BZ_NO_STDIO
@@ -5185,7 +5127,8 @@
             eval &quot;ac_cv_lib_bzip2='-lbz2'&quot;,
             eval &quot;ac_cv_lib_bzip2=no&quot;)
 LIBS=&quot;$kde_save_LIBS&quot;
-CFLAGS=&quot;$kde_save_CFLAGS&quot;
+CXXFLAGS=&quot;$kde_save_CXXFLAGS&quot;
+AC_LANG_RESTORE
 ])dnl
 AC_MSG_RESULT($ac_cv_lib_bzip2)
 
@@ -5209,6 +5152,7 @@
    AC_MSG_CHECKING([for BZ2_bzDecompress in (shared) libbz2])
    AC_CACHE_VAL(ac_cv_lib_bzip2_prefix,
    [
+   AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    kde_save_LIBS=&quot;$LIBS&quot;
    LIBS=&quot;$all_libraries $USER_LDFLAGS $ld_shared_flag -lbz2 $LIBSOCKET&quot;
@@ -5225,12 +5169,11 @@
                eval &quot;ac_cv_lib_bzip2_prefix=no&quot;)
    LIBS=&quot;$kde_save_LIBS&quot;
    CXXFLAGS=&quot;$kde_save_CXXFLAGS&quot;
+   AC_LANG_RESTORE
    ])dnl
 
    AC_MSG_RESULT($ac_cv_lib_bzip2_prefix)
    
-
-
    if test ! &quot;$ac_cv_lib_bzip2_prefix&quot; = no; then
      BZIP2DIR=bzip2
     
@@ -5251,7 +5194,7 @@
 dnl and $(SSL_INCLUDES) will be -Isslhdrlocation (if needed)
 dnl ------------------------------------------------------------------------
 dnl
-AC_DEFUN(KDE_CHECK_SSL,
+AC_DEFUN([KDE_CHECK_SSL],
 [
 LIBSSL=&quot;-lssl -lcrypto&quot;
 AC_REQUIRE([KDE_CHECK_LIB64])
@@ -5260,14 +5203,14 @@
 ssl_libraries=&quot;&quot;
 ssl_includes=&quot;&quot;
 AC_ARG_WITH(ssl-dir,
-    [  --with-ssl-dir=DIR      where the root of OpenSSL is installed],
+    AC_HELP_STRING([--with-ssl-dir=DIR],[where the root of OpenSSL is installed]),
     [  ac_ssl_includes=&quot;$withval&quot;/include
        ac_ssl_libraries=&quot;$withval&quot;/lib$kdelibsuff
     ])
 
 want_ssl=yes
 AC_ARG_WITH(ssl,
-    [  --without-ssl           disable SSL checks],
+    AC_HELP_STRING([--without-ssl],[disable SSL checks]),
     [want_ssl=$withval])
 
 if test $want_ssl = yes; then
@@ -5296,14 +5239,9 @@
 
   ac_ssl_libraries=&quot;$ssl_libdir&quot;
 
-  AC_LANG_SAVE
-  AC_LANG_C
-
-  ac_cflags_safe=&quot;$CFLAGS&quot;
   ac_ldflags_safe=&quot;$LDFLAGS&quot;
   ac_libs_safe=&quot;$LIBS&quot;
 
-  CFLAGS=&quot;$CFLAGS -I$ssl_incdir $all_includes&quot;
   LDFLAGS=&quot;$LDFLAGS -L$ssl_libdir $all_libraries&quot;
   LIBS=&quot;$LIBS $LIBSSL -lRSAglue -lrsaref&quot;
 
@@ -5313,12 +5251,9 @@
   ac_ssl_rsaref=&quot;no&quot;
   )
 
-  CFLAGS=&quot;$ac_cflags_safe&quot;
   LDFLAGS=&quot;$ac_ldflags_safe&quot;
   LIBS=&quot;$ac_libs_safe&quot;
 
-  AC_LANG_RESTORE
-
   if test &quot;$ac_ssl_includes&quot; = NO || test &quot;$ac_ssl_libraries&quot; = NO; then
     have_ssl=no
   else
@@ -5346,8 +5281,6 @@
   dnl Check for SSL version
   AC_CACHE_VAL(ac_cv_ssl_version,
   [
-    AC_LANG_SAVE
-    AC_LANG_C 
 
     cat &gt;conftest.$ac_ext &lt;&lt;EOF
 #include &lt;openssl/opensslv.h&gt;
@@ -5366,8 +5299,12 @@
     }
 EOF
 
-    ac_compile='${CC-gcc} $CFLAGS -I$ac_ssl_includes conftest.$ac_ext -o conftest'
-    if AC_TRY_EVAL(ac_compile); then 
+    ac_save_CPPFLAGS=$CPPFLAGS
+    if test &quot;$ac_ssl_includes&quot; != &quot;/usr/include&quot;; then
+        CPPFLAGS=&quot;$CPPFLAGS -I$ac_ssl_includes&quot;
+    fi
+
+    if AC_TRY_EVAL(ac_link); then 
 
       if eval `./conftest 2&gt;&amp;5`; then
         if test $ssl_version = error; then
@@ -5390,8 +5327,7 @@
       Check config.log, and if you can't figure it out, send a mail to 
       David Faure &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">faure at kde.org</A>&gt;, attaching your config.log])
     fi 
-
-    AC_LANG_RESTORE
+    CPPFLAGS=$ac_save_CPPFLAGS
 
   ])
 
@@ -5419,13 +5355,17 @@
   fi
 fi
 
-if test &quot;$ssl_includes&quot; = &quot;/usr/include&quot; || test  &quot;$ssl_includes&quot; = &quot;/usr/local/include&quot; || test -z &quot;$ssl_includes&quot;; then
- SSL_INCLUDES=&quot;&quot;;
-else
- SSL_INCLUDES=&quot;-I$ssl_includes&quot;
+SSL_INCLUDES=
+
+if test &quot;$ssl_includes&quot; = &quot;/usr/include&quot;; then
+  if test -f /usr/kerberos/include/krb5.h; then
+	SSL_INCLUDES=&quot;-I/usr/kerberos/include&quot;
+  fi
+elif test  &quot;$ssl_includes&quot; != &quot;/usr/local/include&quot; &amp;&amp; test -n &quot;$ssl_includes&quot;; then
+  SSL_INCLUDES=&quot;-I$ssl_includes&quot;
 fi
 
-if test &quot;$ssl_libraries&quot; = &quot;/usr/lib&quot; || test &quot;$ssl_libraries&quot; = &quot;/usr/local/lib&quot; || test -z &quot;$ssl_libraries&quot;; then
+if test &quot;$ssl_libraries&quot; = &quot;/usr/lib&quot; || test &quot;$ssl_libraries&quot; = &quot;/usr/local/lib&quot; || test -z &quot;$ssl_libraries&quot; || test &quot;$ssl_libraries&quot; = &quot;NONE&quot;; then
  SSL_LDFLAGS=&quot;&quot;
 else
  SSL_LDFLAGS=&quot;-L$ssl_libraries -R$ssl_libraries&quot;
@@ -5436,7 +5376,7 @@
 AC_SUBST(LIBSSL)
 ])
 
-AC_DEFUN(KDE_CHECK_STRLCPY,
+AC_DEFUN([KDE_CHECK_STRLCPY],
 [
   AC_REQUIRE([AC_CHECK_STRLCAT])
   AC_REQUIRE([AC_CHECK_STRLCPY])
@@ -5457,7 +5397,7 @@
   ])
 ])
 
-AC_DEFUN(KDE_CHECK_BINUTILS,
+AC_DEFUN([KDE_CHECK_BINUTILS],
 [
   AC_MSG_CHECKING([if ld supports unversioned version maps])
 
@@ -5490,4 +5430,13 @@
 fi
 AC_SUBST(OBJCFLAGS)
 _AM_IF_OPTION([no-dependencies],, [_AM_DEPENDENCIES(OBJC)])
+])
+
+AC_DEFUN([KDE_CHECK_PERL],
+[
+	KDE_FIND_PATH(perl, PERL, [$bindir $exec_prefix/bin $prefix/bin], [
+		    AC_MSG_ERROR([No Perl found in your $PATH.
+We need perl to generate some code.])
+	])
+    AC_SUBST(PERL)
 ])
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000094.html">[Schafkopf-devel] Commit Report - Schafkopf patch by Dominik Kuhlen
</A></li>
	<LI>Next message: <A HREF="000100.html">[Schafkopf-devel] Commit Report - Schafkopf Fixed: der spieler der zuletzt geklopft hat
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#95">[ date ]</a>
              <a href="thread.html#95">[ thread ]</a>
              <a href="subject.html#95">[ subject ]</a>
              <a href="author.html#95">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/schafkopf-devel">More information about the Schafkopf-devel
mailing list</a><br>
</body></html>
